# Comparing `tmp/censoredsummarystats-0.0.3.tar.gz` & `tmp/censoredsummarystats-0.0.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "censoredsummarystats-0.0.3.tar", max compression
+gzip compressed data, was "censoredsummarystats-0.0.4.tar", max compression
```

## Comparing `censoredsummarystats-0.0.3.tar` & `censoredsummarystats-0.0.4.tar`

### file list

```diff
@@ -1,7 +1,7 @@
--rw-r--r--   0        0        0      123 2023-05-10 02:13:31.336281 censoredsummarystats-0.0.3/censoredsummarystats/__init__.py
--rw-r--r--   0        0        0    63747 2023-05-10 02:16:46.950279 censoredsummarystats-0.0.3/censoredsummarystats/statistics.py
--rw-r--r--   0        0        0     2291 2023-04-29 21:55:33.186386 censoredsummarystats-0.0.3/censoredsummarystats/utils.py
--rw-r--r--   0        0        0    11558 2023-03-12 00:39:53.769556 censoredsummarystats-0.0.3/LICENSE
--rw-r--r--   0        0        0      558 2023-05-10 02:22:06.559332 censoredsummarystats-0.0.3/pyproject.toml
--rw-r--r--   0        0        0      775 2023-04-30 00:34:22.741093 censoredsummarystats-0.0.3/README.md
--rw-r--r--   0        0        0     1530 1970-01-01 00:00:00.000000 censoredsummarystats-0.0.3/PKG-INFO
+-rw-r--r--   0        0        0      123 2023-05-10 02:13:31.336281 censoredsummarystats-0.0.4/censoredsummarystats/__init__.py
+-rw-r--r--   0        0        0    63774 2023-05-14 10:04:27.004920 censoredsummarystats-0.0.4/censoredsummarystats/statistics.py
+-rw-r--r--   0        0        0     2291 2023-04-29 21:55:33.186386 censoredsummarystats-0.0.4/censoredsummarystats/utils.py
+-rw-r--r--   0        0        0    11558 2023-03-12 00:39:53.769556 censoredsummarystats-0.0.4/LICENSE
+-rw-r--r--   0        0        0      558 2023-05-14 10:12:09.207115 censoredsummarystats-0.0.4/pyproject.toml
+-rw-r--r--   0        0        0     4309 2023-05-14 10:11:56.349705 censoredsummarystats-0.0.4/README.md
+-rw-r--r--   0        0        0     5005 1970-01-01 00:00:00.000000 censoredsummarystats-0.0.4/PKG-INFO
```

### Comparing `censoredsummarystats-0.0.3/censoredsummarystats/statistics.py` & `censoredsummarystats-0.0.4/censoredsummarystats/statistics.py`

 * *Files 1% similar despite different names*

```diff
@@ -41,3945 +41,3946 @@
 00000280: 2325 2525 2042 6574 7765 656e 2072 6573  #%%% Between res
 00000290: 756c 7420 616e 6420 6365 6e73 6f72 2f6e  ult and censor/n
 000002a0: 756d 6572 6963 2063 6f6d 706f 6e65 6e74  umeric component
 000002b0: 730d 0a0d 0a64 6566 2072 6573 756c 745f  s....def result_
 000002c0: 746f 5f63 6f6d 706f 6e65 6e74 7328 6466  to_components(df
 000002d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 000002e0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000002f0: 6c74 5f63 6f6c 2c0d 0a20 2020 2020 2020  lt_col,..       
+000002f0: 6c74 735f 636f 6c2c 0d0a 2020 2020 2020  lts_col,..      
 00000300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000310: 2020 6365 6e73 6f72 5f63 6f6c 3d63 656e    censor_col=cen
-00000320: 736f 725f 636f 6c2c 0d0a 2020 2020 2020  sor_col,..      
+00000310: 2020 2063 656e 736f 725f 636f 6c3d 6365     censor_col=ce
+00000320: 6e73 6f72 5f63 6f6c 2c0d 0a20 2020 2020  nsor_col,..     
 00000330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000340: 2020 206e 756d 6572 6963 5f63 6f6c 3d6e     numeric_col=n
-00000350: 756d 6572 6963 5f63 6f6c 293a 0d0a 2020  umeric_col):..  
-00000360: 2020 2727 270d 0a20 2020 2041 2066 756e    '''..    A fun
-00000370: 6374 696f 6e20 7468 6174 2073 6570 6172  ction that separ
-00000380: 6174 6573 2063 656e 736f 7273 2028 3c2c  ates censors (<,
-00000390: e289 a42c e289 a52c 3e29 2066 726f 6d20  ...,...,>) from 
-000003a0: 6120 7265 7375 6c74 2e20 5370 6c69 7474  a result. Splitt
-000003b0: 696e 6720 7468 650d 0a20 2020 2063 656e  ing the..    cen
-000003c0: 736f 7220 636f 6d70 6f6e 656e 7420 6672  sor component fr
-000003d0: 6f6d 2074 6865 206e 756d 6572 6963 2063  om the numeric c
-000003e0: 6f6d 706f 6e65 6e74 2065 6e61 626c 6573  omponent enables
-000003f0: 2074 6865 2075 7365 206f 6620 6e75 6d65   the use of nume
-00000400: 7269 630d 0a20 2020 2064 6174 6120 7479  ric..    data ty
-00000410: 7065 732e 2041 2072 6573 756c 7420 6f66  pes. A result of
-00000420: 203c 3130 2028 7374 7269 6e67 2f74 6578   <10 (string/tex
-00000430: 7429 2069 7320 7370 6c69 7420 696e 746f  t) is split into
-00000440: 2061 2063 656e 736f 7220 636f 6d70 6f6e   a censor compon
-00000450: 656e 740d 0a20 2020 206f 6620 3c20 2873  ent..    of < (s
-00000460: 7472 696e 672f 7465 7874 2920 616e 6420  tring/text) and 
-00000470: 6120 6e75 6d65 7269 6320 636f 6d70 6f6e  a numeric compon
-00000480: 656e 7420 6f66 2031 3020 2866 6c6f 6174  ent of 10 (float
-00000490: 2f64 6563 696d 616c 292e 0d0a 0d0a 2020  /decimal).....  
-000004a0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-000004b0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-000004c0: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-000004d0: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
-000004e0: 616d 6520 636f 6e74 6169 6e69 6e67 2061  ame containing a
-000004f0: 2063 6f6c 756d 6e20 746f 2062 6520 7370   column to be sp
-00000500: 6c69 7420 696e 746f 2063 6f6d 706f 6e65  lit into compone
-00000510: 6e74 730d 0a20 2020 2072 6573 756c 745f  nts..    result_
-00000520: 636f 6c20 3a20 7374 7269 6e67 0d0a 2020  col : string..  
-00000530: 2020 2020 2020 436f 6c75 6d6e 206e 616d        Column nam
-00000540: 6520 666f 7220 7468 6520 636f 6c75 6d6e  e for the column
-00000550: 2074 6861 7420 636f 6e74 6169 6e73 2074   that contains t
-00000560: 6865 2072 6573 756c 7473 2074 6f20 6265  he results to be
-00000570: 2073 706c 6974 0d0a 2020 2020 6365 6e73   split..    cens
-00000580: 6f72 5f63 6f6c 203a 2073 7472 696e 670d  or_col : string.
-00000590: 0a20 2020 2020 2020 2043 6f6c 756d 6e20  .        Column 
-000005a0: 6e61 6d65 2074 6f20 6769 7665 2074 6865  name to give the
-000005b0: 2063 7265 6174 6564 2063 656e 736f 7220   created censor 
-000005c0: 636f 6c75 6d6e 2e0d 0a20 2020 2020 2020  column...       
-000005d0: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-000005e0: 4365 6e73 6f72 436f 6d70 6f6e 656e 742e  CensorComponent.
-000005f0: 0d0a 2020 2020 6e75 6d65 7269 635f 636f  ..    numeric_co
-00000600: 6c20 3a20 7374 7269 6e67 0d0a 2020 2020  l : string..    
-00000610: 2020 2020 436f 6c75 6d6e 206e 616d 6520      Column name 
-00000620: 746f 2067 6976 6520 7468 6520 6372 6561  to give the crea
-00000630: 7465 6420 6e75 6d65 7269 6320 636f 6c75  ted numeric colu
-00000640: 6d6e 2e0d 0a20 2020 2020 2020 2054 6865  mn...        The
-00000650: 2064 6566 6175 6c74 2069 7320 4e75 6d65   default is Nume
-00000660: 7269 6343 6f6d 706f 6e65 6e74 2e0d 0a0d  ricComponent....
-00000670: 0a20 2020 2052 6574 7572 6e73 0d0a 2020  .    Returns..  
-00000680: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064    -------..    d
-00000690: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-000006a0: 2020 2020 2020 2049 6e70 7574 2044 6174         Input Dat
-000006b0: 6146 7261 6d65 2077 6974 6820 7477 6f20  aFrame with two 
-000006c0: 6164 6469 7469 6f6e 616c 2063 6f6c 756d  additional colum
-000006d0: 6e73 2063 7265 6174 6564 2066 6f72 2074  ns created for t
-000006e0: 6865 2063 656e 736f 720d 0a20 2020 2020  he censor..     
-000006f0: 2020 2061 6e64 206e 756d 6572 6963 2063     and numeric c
-00000700: 6f6d 706f 6e65 6e74 730d 0a0d 0a20 2020  omponents....   
-00000710: 2027 2727 0d0a 2020 2020 0d0a 2020 2020   '''..    ..    
-00000720: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
-00000730: 6f66 2074 6865 2044 6174 6146 7261 6d65  of the DataFrame
-00000740: 0d0a 2020 2020 6466 203d 2064 662e 636f  ..    df = df.co
-00000750: 7079 2829 0d0a 2020 2020 0d0a 2020 2020  py()..    ..    
-00000760: 2320 456e 7375 7265 2074 6865 2076 616c  # Ensure the val
-00000770: 7565 2063 6f6c 756d 6e20 6973 2074 6578  ue column is tex
-00000780: 742f 7374 7269 6e67 2064 6174 6120 7479  t/string data ty
-00000790: 7065 2e0d 0a20 2020 2064 665b 7265 7375  pe...    df[resu
-000007a0: 6c74 5f63 6f6c 5d20 3d20 6466 5b72 6573  lt_col] = df[res
-000007b0: 756c 745f 636f 6c5d 2e61 7374 7970 6528  ult_col].astype(
-000007c0: 7374 7229 0d0a 2020 2020 0d0a 2020 2020  str)..    ..    
-000007d0: 2320 4372 6561 7465 2063 656e 736f 7220  # Create censor 
-000007e0: 616e 6420 6e75 6d65 7269 6320 636f 6c75  and numeric colu
-000007f0: 6d6e 7320 6672 6f6d 2072 6573 756c 7420  mns from result 
-00000800: 636f 6c75 6d6e 0d0a 2020 2020 6466 5b63  column..    df[c
-00000810: 656e 736f 725f 636f 6c5d 203d 2064 665b  ensor_col] = df[
-00000820: 7265 7375 6c74 5f63 6f6c 5d2e 7374 722e  result_col].str.
-00000830: 6578 7472 6163 7428 7227 285b 3ce2 89a4  extract(r'([<...
-00000840: e289 a53e 5d29 2729 2e66 696c 6c6e 6128  ...>])').fillna(
-00000850: 2727 290d 0a20 2020 2064 665b 6e75 6d65  '')..    df[nume
-00000860: 7269 635f 636f 6c5d 203d 2064 665b 7265  ric_col] = df[re
-00000870: 7375 6c74 5f63 6f6c 5d2e 7374 722e 7265  sult_col].str.re
-00000880: 706c 6163 6528 273c 7ce2 89a4 7ce2 89a5  place('<|...|...
-00000890: 7c3e 272c 2727 2c72 6567 6578 3d54 7275  |>','',regex=Tru
-000008a0: 6529 2e61 7374 7970 6528 666c 6f61 7429  e).astype(float)
-000008b0: 0d0a 2020 2020 0d0a 2020 2020 7265 7475  ..    ..    retu
-000008c0: 726e 2064 660d 0a0d 0a64 6566 2063 6f6d  rn df....def com
-000008d0: 706f 6e65 6e74 735f 746f 5f72 6573 756c  ponents_to_resul
-000008e0: 7428 6466 2c0d 0a20 2020 2020 2020 2020  t(df,..         
+00000340: 2020 2020 6e75 6d65 7269 635f 636f 6c3d      numeric_col=
+00000350: 6e75 6d65 7269 635f 636f 6c29 3a0d 0a20  numeric_col):.. 
+00000360: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
+00000370: 6e63 7469 6f6e 2074 6861 7420 7365 7061  nction that sepa
+00000380: 7261 7465 7320 6365 6e73 6f72 7320 283c  rates censors (<
+00000390: 2ce2 89a4 2ce2 89a5 2c3e 2920 6672 6f6d  ,...,...,>) from
+000003a0: 2061 2072 6573 756c 742e 2053 706c 6974   a result. Split
+000003b0: 7469 6e67 2074 6865 0d0a 2020 2020 6365  ting the..    ce
+000003c0: 6e73 6f72 2063 6f6d 706f 6e65 6e74 2066  nsor component f
+000003d0: 726f 6d20 7468 6520 6e75 6d65 7269 6320  rom the numeric 
+000003e0: 636f 6d70 6f6e 656e 7420 656e 6162 6c65  component enable
+000003f0: 7320 7468 6520 7573 6520 6f66 206e 756d  s the use of num
+00000400: 6572 6963 0d0a 2020 2020 6461 7461 2074  eric..    data t
+00000410: 7970 6573 2e20 4120 7265 7375 6c74 206f  ypes. A result o
+00000420: 6620 3c31 3020 2873 7472 696e 672f 7465  f <10 (string/te
+00000430: 7874 2920 6973 2073 706c 6974 2069 6e74  xt) is split int
+00000440: 6f20 6120 6365 6e73 6f72 2063 6f6d 706f  o a censor compo
+00000450: 6e65 6e74 0d0a 2020 2020 6f66 203c 2028  nent..    of < (
+00000460: 7374 7269 6e67 2f74 6578 7429 2061 6e64  string/text) and
+00000470: 2061 206e 756d 6572 6963 2063 6f6d 706f   a numeric compo
+00000480: 6e65 6e74 206f 6620 3130 2028 666c 6f61  nent of 10 (floa
+00000490: 742f 6465 6369 6d61 6c29 2e0d 0a0d 0a20  t/decimal)..... 
+000004a0: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+000004b0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+000004c0: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
+000004d0: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
+000004e0: 7261 6d65 2063 6f6e 7461 696e 696e 6720  rame containing 
+000004f0: 6120 636f 6c75 6d6e 2074 6f20 6265 2073  a column to be s
+00000500: 706c 6974 2069 6e74 6f20 636f 6d70 6f6e  plit into compon
+00000510: 656e 7473 0d0a 2020 2020 7265 7375 6c74  ents..    result
+00000520: 735f 636f 6c20 3a20 7374 7269 6e67 0d0a  s_col : string..
+00000530: 2020 2020 2020 2020 436f 6c75 6d6e 206e          Column n
+00000540: 616d 6520 666f 7220 7468 6520 636f 6c75  ame for the colu
+00000550: 6d6e 2074 6861 7420 636f 6e74 6169 6e73  mn that contains
+00000560: 2074 6865 2072 6573 756c 7473 2074 6f20   the results to 
+00000570: 6265 2073 706c 6974 0d0a 2020 2020 6365  be split..    ce
+00000580: 6e73 6f72 5f63 6f6c 203a 2073 7472 696e  nsor_col : strin
+00000590: 670d 0a20 2020 2020 2020 2043 6f6c 756d  g..        Colum
+000005a0: 6e20 6e61 6d65 2074 6f20 6769 7665 2074  n name to give t
+000005b0: 6865 2063 7265 6174 6564 2063 656e 736f  he created censo
+000005c0: 7220 636f 6c75 6d6e 2e0d 0a20 2020 2020  r column...     
+000005d0: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
+000005e0: 7320 4365 6e73 6f72 436f 6d70 6f6e 656e  s CensorComponen
+000005f0: 742e 0d0a 2020 2020 6e75 6d65 7269 635f  t...    numeric_
+00000600: 636f 6c20 3a20 7374 7269 6e67 0d0a 2020  col : string..  
+00000610: 2020 2020 2020 436f 6c75 6d6e 206e 616d        Column nam
+00000620: 6520 746f 2067 6976 6520 7468 6520 6372  e to give the cr
+00000630: 6561 7465 6420 6e75 6d65 7269 6320 636f  eated numeric co
+00000640: 6c75 6d6e 2e0d 0a20 2020 2020 2020 2054  lumn...        T
+00000650: 6865 2064 6566 6175 6c74 2069 7320 4e75  he default is Nu
+00000660: 6d65 7269 6343 6f6d 706f 6e65 6e74 2e0d  mericComponent..
+00000670: 0a0d 0a20 2020 2052 6574 7572 6e73 0d0a  ...    Returns..
+00000680: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
+00000690: 2064 6620 3a20 4461 7461 4672 616d 650d   df : DataFrame.
+000006a0: 0a20 2020 2020 2020 2049 6e70 7574 2044  .        Input D
+000006b0: 6174 6146 7261 6d65 2077 6974 6820 7477  ataFrame with tw
+000006c0: 6f20 6164 6469 7469 6f6e 616c 2063 6f6c  o additional col
+000006d0: 756d 6e73 2063 7265 6174 6564 2066 6f72  umns created for
+000006e0: 2074 6865 2063 656e 736f 720d 0a20 2020   the censor..   
+000006f0: 2020 2020 2061 6e64 206e 756d 6572 6963       and numeric
+00000700: 2063 6f6d 706f 6e65 6e74 730d 0a0d 0a20   components.... 
+00000710: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
+00000720: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
+00000730: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
+00000740: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
+00000750: 636f 7079 2829 0d0a 2020 2020 0d0a 2020  copy()..    ..  
+00000760: 2020 2320 456e 7375 7265 2074 6865 2076    # Ensure the v
+00000770: 616c 7565 2063 6f6c 756d 6e20 6973 2074  alue column is t
+00000780: 6578 742f 7374 7269 6e67 2064 6174 6120  ext/string data 
+00000790: 7479 7065 2e0d 0a20 2020 2064 665b 7265  type...    df[re
+000007a0: 7375 6c74 735f 636f 6c5d 203d 2064 665b  sults_col] = df[
+000007b0: 7265 7375 6c74 735f 636f 6c5d 2e61 7374  results_col].ast
+000007c0: 7970 6528 7374 7229 0d0a 2020 2020 0d0a  ype(str)..    ..
+000007d0: 2020 2020 2320 4372 6561 7465 2063 656e      # Create cen
+000007e0: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
+000007f0: 636f 6c75 6d6e 7320 6672 6f6d 2072 6573  columns from res
+00000800: 756c 7420 636f 6c75 6d6e 0d0a 2020 2020  ult column..    
+00000810: 6466 5b63 656e 736f 725f 636f 6c5d 203d  df[censor_col] =
+00000820: 2064 665b 7265 7375 6c74 735f 636f 6c5d   df[results_col]
+00000830: 2e73 7472 2e65 7874 7261 6374 2872 2728  .str.extract(r'(
+00000840: 5b3c e289 a4e2 89a5 3e5d 2927 292e 6669  [<......>])').fi
+00000850: 6c6c 6e61 2827 2729 0d0a 2020 2020 6466  llna('')..    df
+00000860: 5b6e 756d 6572 6963 5f63 6f6c 5d20 3d20  [numeric_col] = 
+00000870: 6466 5b72 6573 756c 7473 5f63 6f6c 5d2e  df[results_col].
+00000880: 7374 722e 7265 706c 6163 6528 273c 7ce2  str.replace('<|.
+00000890: 89a4 7ce2 89a5 7c3e 272c 2727 2c72 6567  ..|...|>','',reg
+000008a0: 6578 3d54 7275 6529 2e61 7374 7970 6528  ex=True).astype(
+000008b0: 666c 6f61 7429 0d0a 2020 2020 0d0a 2020  float)..    ..  
+000008c0: 2020 7265 7475 726e 2064 660d 0a0d 0a64    return df....d
+000008d0: 6566 2063 6f6d 706f 6e65 6e74 735f 746f  ef components_to
+000008e0: 5f72 6573 756c 7428 6466 2c0d 0a20 2020  _result(df,..   
 000008f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000900: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
-00000910: 6e67 203d 2054 7275 6529 3a0d 0a20 2020  ng = True):..   
-00000920: 2027 2727 0d0a 2020 2020 4120 6675 6e63   '''..    A func
-00000930: 7469 6f6e 2074 6861 7420 636f 6d62 696e  tion that combin
-00000940: 6573 2063 656e 736f 7220 616e 6420 6e75  es censor and nu
-00000950: 6d65 7269 6320 636f 6d70 6f6e 656e 7473  meric components
-00000960: 2069 6e74 6f20 6120 636f 6d62 696e 6564   into a combined
-00000970: 0d0a 2020 2020 7374 7269 6e67 2f74 6578  ..    string/tex
-00000980: 7420 7265 7375 6c74 2e0d 0a0d 0a20 2020  t result.....   
-00000990: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
-000009a0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-000009b0: 2064 6620 3a20 4461 7461 4672 616d 650d   df : DataFrame.
-000009c0: 0a20 2020 2020 2020 2044 6174 6146 7261  .        DataFra
-000009d0: 6d65 2063 6f6e 7461 696e 696e 6720 6365  me containing ce
-000009e0: 6e73 6f72 2061 6e64 206e 756d 6572 6963  nsor and numeric
-000009f0: 2063 6f6c 756d 6e73 2074 6861 7420 7769   columns that wi
-00000a00: 6c6c 2062 6520 636f 6d62 696e 6564 0d0a  ll be combined..
-00000a10: 2020 2020 7072 6563 6973 696f 6e5f 726f      precision_ro
-00000a20: 756e 6469 6e67 203a 2062 6f6f 6c65 616e  unding : boolean
-00000a30: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
-00000a40: 2020 2020 4966 2054 7275 652c 2061 2072      If True, a r
-00000a50: 6f75 6e64 696e 6720 6d65 7468 6f64 2069  ounding method i
-00000a60: 7320 6170 706c 6965 6420 746f 2072 6f75  s applied to rou
-00000a70: 6e64 2072 6573 756c 7473 2074 6f20 6861  nd results to ha
-00000a80: 7665 206e 6f20 6d6f 7265 0d0a 2020 2020  ve no more..    
-00000a90: 2020 2020 6465 6369 6d61 6c73 2074 6861      decimals tha
-00000aa0: 6e20 7768 6174 2063 616e 2062 6520 6d65  n what can be me
-00000ab0: 6173 7572 6564 2e0d 0a20 2020 2020 2020  asured...       
-00000ac0: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-00000ad0: 5472 7565 2e0d 0a0d 0a20 2020 2052 6574  True.....    Ret
-00000ae0: 7572 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d  urns..    ------
-00000af0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
-00000b00: 4672 616d 650d 0a20 2020 2020 2020 2049  Frame..        I
-00000b10: 6e70 7574 2044 6174 6146 7261 6d65 2074  nput DataFrame t
-00000b20: 6861 7420 636f 6e74 6169 6e73 2061 206e  hat contains a n
-00000b30: 6577 2073 7472 696e 672f 7465 7874 2063  ew string/text c
-00000b40: 6f6c 756d 6e20 7468 6174 2063 6f6d 6269  olumn that combi
-00000b50: 6e65 730d 0a20 2020 2020 2020 2074 6865  nes..        the
-00000b60: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
-00000b70: 7269 6320 636f 6d70 6f6e 656e 7473 206f  ric components o
-00000b80: 6620 6120 7265 7375 6c74 0d0a 0d0a 2020  f a result....  
-00000b90: 2020 2727 270d 0a20 2020 200d 0a20 2020    '''..    ..   
-00000ba0: 2023 2043 7265 6174 6520 6120 636f 7079   # Create a copy
-00000bb0: 206f 6620 7468 6520 4461 7461 4672 616d   of the DataFram
-00000bc0: 650d 0a20 2020 2064 6620 3d20 6466 2e63  e..    df = df.c
-00000bd0: 6f70 7928 290d 0a20 2020 200d 0a20 2020  opy()..    ..   
-00000be0: 2023 2043 6f6d 6269 6e65 2074 6865 2063   # Combine the c
-00000bf0: 656e 736f 7220 616e 6420 6e75 6d65 7269  ensor and numeri
-00000c00: 6320 636f 6d70 6f6e 656e 7473 2074 6f20  c components to 
-00000c10: 6372 6561 7465 2061 2063 6f6d 6269 6e65  create a combine
-00000c20: 6420 7265 7375 6c74 0d0a 2020 2020 2320  d result..    # 
-00000c30: 4170 706c 7920 7468 6520 6170 7072 6f70  Apply the approp
-00000c40: 7269 6174 6520 726f 756e 6469 6e67 2066  riate rounding f
-00000c50: 756e 6374 696f 6e73 2069 6620 7072 6563  unctions if prec
-00000c60: 6973 696f 6e5f 726f 756e 6469 6e67 2069  ision_rounding i
-00000c70: 7320 5472 7565 0d0a 2020 2020 6966 2070  s True..    if p
-00000c80: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
-00000c90: 673a 0d0a 2020 2020 2020 2020 6466 5b72  g:..        df[r
-00000ca0: 6573 756c 745f 636f 6c5d 203d 2064 665b  esult_col] = df[
-00000cb0: 6365 6e73 6f72 5f63 6f6c 5d20 2b20 6466  censor_col] + df
-00000cc0: 5b6e 756d 6572 6963 5f63 6f6c 5d2e 6170  [numeric_col].ap
-00000cd0: 706c 7928 7374 7269 6e67 5f70 7265 6369  ply(string_preci
-00000ce0: 7369 6f6e 2c74 686f 7573 616e 6473 5f63  sion,thousands_c
-00000cf0: 6f6d 6d61 3d54 7275 6529 0d0a 2020 2020  omma=True)..    
-00000d00: 2020 2020 6466 5b6e 756d 6572 6963 5f63      df[numeric_c
-00000d10: 6f6c 5d20 3d20 6466 5b6e 756d 6572 6963  ol] = df[numeric
-00000d20: 5f63 6f6c 5d2e 6170 706c 7928 6e75 6d65  _col].apply(nume
-00000d30: 7269 635f 7072 6563 6973 696f 6e29 0d0a  ric_precision)..
-00000d40: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00000d50: 2020 2064 665b 7265 7375 6c74 5f63 6f6c     df[result_col
-00000d60: 5d20 3d20 6466 5b63 656e 736f 725f 636f  ] = df[censor_co
-00000d70: 6c5d 202b 2064 665b 6e75 6d65 7269 635f  l] + df[numeric_
-00000d80: 636f 6c5d 2e61 7374 7970 6528 7374 7229  col].astype(str)
-00000d90: 0d0a 2020 2020 0d0a 2020 2020 7265 7475  ..    ..    retu
-00000da0: 726e 2064 660d 0a0d 0a23 2525 2520 4265  rn df....#%%% Be
-00000db0: 7477 6565 6e20 6365 6e73 6f72 2f6e 756d  tween censor/num
-00000dc0: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
-00000dd0: 616e 6420 696e 7465 7276 616c 2063 6f6d  and interval com
-00000de0: 706f 6e65 6e74 730d 0a0d 0a64 6566 2063  ponents....def c
-00000df0: 6f6d 706f 6e65 6e74 735f 746f 5f69 6e74  omponents_to_int
-00000e00: 6572 7661 6c28 6466 2c0d 0a20 2020 2020  erval(df,..     
-00000e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000e20: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
-00000e30: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-00000e40: 3d20 4661 6c73 6529 3a0d 0a20 2020 2027  = False):..    '
-00000e50: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
-00000e60: 6f6e 2074 6861 7420 7574 696c 6973 6573  on that utilises
-00000e70: 2074 6865 2063 656e 736f 7220 616e 6420   the censor and 
-00000e80: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
-00000e90: 7473 2074 6f20 636f 6e76 6572 740d 0a20  ts to convert.. 
-00000ea0: 2020 2065 6163 6820 7265 7375 6c74 2069     each result i
-00000eb0: 6e74 6f20 696e 7465 7276 616c 206e 6f74  nto interval not
-00000ec0: 6174 696f 6e2e 2046 6f75 7220 636f 6c75  ation. Four colu
-00000ed0: 6d6e 7320 6172 6520 6372 6561 7465 6420  mns are created 
-00000ee0: 746f 2073 746f 7265 0d0a 2020 2020 7468  to store..    th
-00000ef0: 6520 696e 7465 7276 616c 2069 6e66 6f72  e interval infor
-00000f00: 6d61 7469 6f6e 2069 6e63 6c75 6469 6e67  mation including
-00000f10: 206c 6566 742f 7269 6768 7420 626f 756e   left/right boun
-00000f20: 6473 2061 6e64 2077 6865 7468 6572 2074  ds and whether t
-00000f30: 6865 0d0a 2020 2020 656e 6470 6f69 6e74  he..    endpoint
-00000f40: 732f 626f 756e 6461 7269 6573 2061 7265  s/boundaries are
-00000f50: 2069 6e63 6c75 7369 7665 206f 7220 6578   inclusive or ex
-00000f60: 636c 7573 6976 6520 2865 2e67 2e2c 203c  clusive (e.g., <
-00000f70: 3120 7673 20e2 89a4 3129 0d0a 0d0a 2020  1 vs ...1)....  
-00000f80: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-00000f90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-00000fa0: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-00000fb0: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
-00000fc0: 616d 6520 636f 6e74 6169 6e69 6e67 2074  ame containing t
-00000fd0: 6865 2063 656e 736f 7220 616e 6420 6e75  he censor and nu
-00000fe0: 6d65 7269 6320 636f 6c75 6d6e 730d 0a20  meric columns.. 
-00000ff0: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
-00001000: 6976 655f 696e 7465 7276 616c 203a 2062  ive_interval : b
-00001010: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
-00001020: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
-00001030: 652c 2074 6865 6e20 616c 6c20 706f 7369  e, then all posi
-00001040: 7469 7665 2061 6e64 206e 6567 6174 6976  tive and negativ
-00001050: 6520 7661 6c75 6573 2061 7265 2063 6f6e  e values are con
-00001060: 7369 6465 7265 640d 0a20 2020 2020 2020  sidered..       
-00001070: 2065 2e67 2e2c 203c 302e 3520 776f 756c   e.g., <0.5 woul
-00001080: 6420 6265 2063 6f6e 7665 7274 6564 2074  d be converted t
-00001090: 6f20 282d 6e70 2e69 6e66 2c35 292e 0d0a  o (-np.inf,5)...
-000010a0: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-000010b0: 2c20 7468 656e 206f 6e6c 7920 6e6f 6e2d  , then only non-
-000010c0: 6e65 6761 7469 7665 2076 616c 7565 7320  negative values 
-000010d0: 6172 6520 636f 6e73 6964 6572 6564 0d0a  are considered..
-000010e0: 2020 2020 2020 2020 652e 672e 2c20 3c30          e.g., <0
-000010f0: 2e35 2077 6f75 6c64 2062 6520 636f 6e76  .5 would be conv
-00001100: 6572 7465 6420 746f 205b 302c 3529 2e0d  erted to [0,5)..
-00001110: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-00001120: 6175 6c74 2069 7320 4661 6c73 652e 0d0a  ault is False...
-00001130: 2020 2020 0d0a 2020 2020 5261 6973 6573      ..    Raises
-00001140: 0d0a 2020 2020 2d2d 2d2d 2d2d 0d0a 2020  ..    ------..  
-00001150: 2020 5661 6c75 6545 7272 6f72 0d0a 2020    ValueError..  
-00001160: 2020 2020 2020 416e 2065 7272 6f72 2074        An error t
-00001170: 6861 7420 6973 2072 6574 7572 6e65 6420  hat is returned 
-00001180: 7768 656e 2072 6573 756c 7473 2061 7265  when results are
-00001190: 2066 6f75 6e64 2074 6f20 6265 206f 7574   found to be out
-000011a0: 7369 6465 2074 6865 0d0a 2020 2020 2020  side the..      
-000011b0: 2020 6173 7375 6d65 6420 6f72 2064 6566    assumed or def
-000011c0: 696e 6564 206c 6f77 6572 2061 6e64 2075  ined lower and u
-000011d0: 7070 6572 2062 6f75 6e64 6172 6965 732e  pper boundaries.
-000011e0: 0d0a 0d0a 2020 2020 5265 7475 726e 730d  ....    Returns.
-000011f0: 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a 2020  .    -------..  
-00001200: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-00001210: 0d0a 2020 2020 2020 2020 496e 7075 7420  ..        Input 
-00001220: 4461 7461 4672 616d 6520 7769 7468 2066  DataFrame with f
-00001230: 6f75 7220 6164 6469 7469 6f6e 616c 2063  our additional c
-00001240: 6f6c 756d 6e73 2063 7265 6174 6564 2074  olumns created t
-00001250: 6861 7420 7374 6f72 6520 7468 650d 0a20  hat store the.. 
-00001260: 2020 2020 2020 2069 6e66 6f72 6d61 7469         informati
-00001270: 6f6e 2066 6f72 2074 6865 2069 6e74 6572  on for the inter
-00001280: 7661 6c73 2074 6861 7420 7265 7072 6573  vals that repres
-00001290: 656e 7420 7468 6520 7261 6e67 6520 6f66  ent the range of
-000012a0: 2070 6f74 656e 7469 616c 0d0a 2020 2020   potential..    
-000012b0: 2020 2020 7661 6c75 6573 2066 6f72 2074      values for t
-000012c0: 6865 2072 6573 756c 7473 0d0a 0d0a 2020  he results....  
-000012d0: 2020 2727 270d 0a20 2020 200d 0a20 2020    '''..    ..   
-000012e0: 2023 2043 7265 6174 6520 6120 636f 7079   # Create a copy
-000012f0: 206f 6620 7468 6520 4461 7461 4672 616d   of the DataFram
-00001300: 650d 0a20 2020 2064 6620 3d20 6466 2e63  e..    df = df.c
-00001310: 6f70 7928 290d 0a20 2020 200d 0a20 2020  opy()..    ..   
-00001320: 2023 2044 6566 696e 6520 7768 6572 6520   # Define where 
-00001330: 7468 6520 6c65 6674 2062 6f75 6e64 2069  the left bound i
-00001340: 7320 636c 6f73 6564 0d0a 2020 2020 6466  s closed..    df
-00001350: 5b6c 6566 745f 626f 756e 6461 7279 5f63  [left_boundary_c
-00001360: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2864  ol] = np.where(d
-00001370: 665b 6365 6e73 6f72 5f63 6f6c 5d2e 6973  f[censor_col].is
-00001380: 696e 285b 2727 2c27 e289 a527 5d29 2c0d  in(['','...']),.
-00001390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000900: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
+00000910: 726f 756e 6469 6e67 203d 2054 7275 6529  rounding = True)
+00000920: 3a0d 0a20 2020 2027 2727 0d0a 2020 2020  :..    '''..    
+00000930: 4120 6675 6e63 7469 6f6e 2074 6861 7420  A function that 
+00000940: 636f 6d62 696e 6573 2063 656e 736f 7220  combines censor 
+00000950: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
+00000960: 6f6e 656e 7473 2069 6e74 6f20 6120 636f  onents into a co
+00000970: 6d62 696e 6564 0d0a 2020 2020 7374 7269  mbined..    stri
+00000980: 6e67 2f74 6578 7420 7265 7375 6c74 2e0d  ng/text result..
+00000990: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+000009a0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
+000009b0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+000009c0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+000009d0: 6174 6146 7261 6d65 2063 6f6e 7461 696e  ataFrame contain
+000009e0: 696e 6720 6365 6e73 6f72 2061 6e64 206e  ing censor and n
+000009f0: 756d 6572 6963 2063 6f6c 756d 6e73 2074  umeric columns t
+00000a00: 6861 7420 7769 6c6c 2062 6520 636f 6d62  hat will be comb
+00000a10: 696e 6564 0d0a 2020 2020 7072 6563 6973  ined..    precis
+00000a20: 696f 6e5f 726f 756e 6469 6e67 203a 2062  ion_rounding : b
+00000a30: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
+00000a40: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
+00000a50: 652c 2061 2072 6f75 6e64 696e 6720 6d65  e, a rounding me
+00000a60: 7468 6f64 2069 7320 6170 706c 6965 6420  thod is applied 
+00000a70: 746f 2072 6f75 6e64 2072 6573 756c 7473  to round results
+00000a80: 2074 6f20 6861 7665 206e 6f20 6d6f 7265   to have no more
+00000a90: 0d0a 2020 2020 2020 2020 6465 6369 6d61  ..        decima
+00000aa0: 6c73 2074 6861 6e20 7768 6174 2063 616e  ls than what can
+00000ab0: 2062 6520 6d65 6173 7572 6564 2e0d 0a20   be measured... 
+00000ac0: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
+00000ad0: 6c74 2069 7320 5472 7565 2e0d 0a0d 0a20  lt is True..... 
+00000ae0: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
+00000af0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
+00000b00: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
+00000b10: 2020 2020 2049 6e70 7574 2044 6174 6146       Input DataF
+00000b20: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
+00000b30: 6e73 2061 206e 6577 2073 7472 696e 672f  ns a new string/
+00000b40: 7465 7874 2063 6f6c 756d 6e20 7468 6174  text column that
+00000b50: 2063 6f6d 6269 6e65 730d 0a20 2020 2020   combines..     
+00000b60: 2020 2074 6865 2063 656e 736f 7220 616e     the censor an
+00000b70: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
+00000b80: 656e 7473 206f 6620 6120 7265 7375 6c74  ents of a result
+00000b90: 0d0a 0d0a 2020 2020 2727 270d 0a20 2020  ....    '''..   
+00000ba0: 200d 0a20 2020 2023 2043 7265 6174 6520   ..    # Create 
+00000bb0: 6120 636f 7079 206f 6620 7468 6520 4461  a copy of the Da
+00000bc0: 7461 4672 616d 650d 0a20 2020 2064 6620  taFrame..    df 
+00000bd0: 3d20 6466 2e63 6f70 7928 290d 0a20 2020  = df.copy()..   
+00000be0: 200d 0a20 2020 2023 2043 6f6d 6269 6e65   ..    # Combine
+00000bf0: 2074 6865 2063 656e 736f 7220 616e 6420   the censor and 
+00000c00: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
+00000c10: 7473 2074 6f20 6372 6561 7465 2061 2063  ts to create a c
+00000c20: 6f6d 6269 6e65 6420 7265 7375 6c74 0d0a  ombined result..
+00000c30: 2020 2020 2320 4170 706c 7920 7468 6520      # Apply the 
+00000c40: 6170 7072 6f70 7269 6174 6520 726f 756e  appropriate roun
+00000c50: 6469 6e67 2066 756e 6374 696f 6e73 2069  ding functions i
+00000c60: 6620 7072 6563 6973 696f 6e5f 726f 756e  f precision_roun
+00000c70: 6469 6e67 2069 7320 5472 7565 0d0a 2020  ding is True..  
+00000c80: 2020 6966 2070 7265 6369 7369 6f6e 5f72    if precision_r
+00000c90: 6f75 6e64 696e 673a 0d0a 2020 2020 2020  ounding:..      
+00000ca0: 2020 6466 5b72 6573 756c 745f 636f 6c5d    df[result_col]
+00000cb0: 203d 2064 665b 6365 6e73 6f72 5f63 6f6c   = df[censor_col
+00000cc0: 5d20 2b20 6466 5b6e 756d 6572 6963 5f63  ] + df[numeric_c
+00000cd0: 6f6c 5d2e 6170 706c 7928 7374 7269 6e67  ol].apply(string
+00000ce0: 5f70 7265 6369 7369 6f6e 2c74 686f 7573  _precision,thous
+00000cf0: 616e 6473 5f63 6f6d 6d61 3d54 7275 6529  ands_comma=True)
+00000d00: 0d0a 2020 2020 2020 2020 6466 5b6e 756d  ..        df[num
+00000d10: 6572 6963 5f63 6f6c 5d20 3d20 6466 5b6e  eric_col] = df[n
+00000d20: 756d 6572 6963 5f63 6f6c 5d2e 6170 706c  umeric_col].appl
+00000d30: 7928 6e75 6d65 7269 635f 7072 6563 6973  y(numeric_precis
+00000d40: 696f 6e29 0d0a 2020 2020 656c 7365 3a0d  ion)..    else:.
+00000d50: 0a20 2020 2020 2020 2064 665b 7265 7375  .        df[resu
+00000d60: 6c74 5f63 6f6c 5d20 3d20 6466 5b63 656e  lt_col] = df[cen
+00000d70: 736f 725f 636f 6c5d 202b 2064 665b 6e75  sor_col] + df[nu
+00000d80: 6d65 7269 635f 636f 6c5d 2e61 7374 7970  meric_col].astyp
+00000d90: 6528 7374 7229 0d0a 2020 2020 0d0a 2020  e(str)..    ..  
+00000da0: 2020 7265 7475 726e 2064 660d 0a0d 0a23    return df....#
+00000db0: 2525 2520 4265 7477 6565 6e20 6365 6e73  %%% Between cens
+00000dc0: 6f72 2f6e 756d 6572 6963 2063 6f6d 706f  or/numeric compo
+00000dd0: 6e65 6e74 7320 616e 6420 696e 7465 7276  nents and interv
+00000de0: 616c 2063 6f6d 706f 6e65 6e74 730d 0a0d  al components...
+00000df0: 0a64 6566 2063 6f6d 706f 6e65 6e74 735f  .def components_
+00000e00: 746f 5f69 6e74 6572 7661 6c28 6466 2c0d  to_interval(df,.
+00000e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000e20: 2020 2020 2020 2020 2020 2020 696e 636c              incl
+00000e30: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
+00000e40: 6572 7661 6c20 3d20 4661 6c73 6529 3a0d  erval = False):.
+00000e50: 0a20 2020 2027 2727 0d0a 2020 2020 4120  .    '''..    A 
+00000e60: 6675 6e63 7469 6f6e 2074 6861 7420 7574  function that ut
+00000e70: 696c 6973 6573 2074 6865 2063 656e 736f  ilises the censo
+00000e80: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
+00000e90: 6d70 6f6e 656e 7473 2074 6f20 636f 6e76  mponents to conv
+00000ea0: 6572 740d 0a20 2020 2065 6163 6820 7265  ert..    each re
+00000eb0: 7375 6c74 2069 6e74 6f20 696e 7465 7276  sult into interv
+00000ec0: 616c 206e 6f74 6174 696f 6e2e 2046 6f75  al notation. Fou
+00000ed0: 7220 636f 6c75 6d6e 7320 6172 6520 6372  r columns are cr
+00000ee0: 6561 7465 6420 746f 2073 746f 7265 0d0a  eated to store..
+00000ef0: 2020 2020 7468 6520 696e 7465 7276 616c      the interval
+00000f00: 2069 6e66 6f72 6d61 7469 6f6e 2069 6e63   information inc
+00000f10: 6c75 6469 6e67 206c 6566 742f 7269 6768  luding left/righ
+00000f20: 7420 626f 756e 6473 2061 6e64 2077 6865  t bounds and whe
+00000f30: 7468 6572 2074 6865 0d0a 2020 2020 656e  ther the..    en
+00000f40: 6470 6f69 6e74 732f 626f 756e 6461 7269  dpoints/boundari
+00000f50: 6573 2061 7265 2069 6e63 6c75 7369 7665  es are inclusive
+00000f60: 206f 7220 6578 636c 7573 6976 6520 2865   or exclusive (e
+00000f70: 2e67 2e2c 203c 3120 7673 20e2 89a4 3129  .g., <1 vs ...1)
+00000f80: 0d0a 0d0a 2020 2020 5061 7261 6d65 7465  ....    Paramete
+00000f90: 7273 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d  rs..    --------
+00000fa0: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
+00000fb0: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
+00000fc0: 4461 7461 4672 616d 6520 636f 6e74 6169  DataFrame contai
+00000fd0: 6e69 6e67 2074 6865 2063 656e 736f 7220  ning the censor 
+00000fe0: 616e 6420 6e75 6d65 7269 6320 636f 6c75  and numeric colu
+00000ff0: 6d6e 730d 0a20 2020 2069 6e63 6c75 6465  mns..    include
+00001000: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
+00001010: 616c 203a 2062 6f6f 6c65 616e 2c20 6f70  al : boolean, op
+00001020: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
+00001030: 4966 2054 7275 652c 2074 6865 6e20 616c  If True, then al
+00001040: 6c20 706f 7369 7469 7665 2061 6e64 206e  l positive and n
+00001050: 6567 6174 6976 6520 7661 6c75 6573 2061  egative values a
+00001060: 7265 2063 6f6e 7369 6465 7265 640d 0a20  re considered.. 
+00001070: 2020 2020 2020 2065 2e67 2e2c 203c 302e         e.g., <0.
+00001080: 3520 776f 756c 6420 6265 2063 6f6e 7665  5 would be conve
+00001090: 7274 6564 2074 6f20 282d 6e70 2e69 6e66  rted to (-np.inf
+000010a0: 2c35 292e 0d0a 2020 2020 2020 2020 4966  ,5)...        If
+000010b0: 2046 616c 7365 2c20 7468 656e 206f 6e6c   False, then onl
+000010c0: 7920 6e6f 6e2d 6e65 6761 7469 7665 2076  y non-negative v
+000010d0: 616c 7565 7320 6172 6520 636f 6e73 6964  alues are consid
+000010e0: 6572 6564 0d0a 2020 2020 2020 2020 652e  ered..        e.
+000010f0: 672e 2c20 3c30 2e35 2077 6f75 6c64 2062  g., <0.5 would b
+00001100: 6520 636f 6e76 6572 7465 6420 746f 205b  e converted to [
+00001110: 302c 3529 2e0d 0a20 2020 2020 2020 2054  0,5)...        T
+00001120: 6865 2064 6566 6175 6c74 2069 7320 4661  he default is Fa
+00001130: 6c73 652e 0d0a 2020 2020 0d0a 2020 2020  lse...    ..    
+00001140: 5261 6973 6573 0d0a 2020 2020 2d2d 2d2d  Raises..    ----
+00001150: 2d2d 0d0a 2020 2020 5661 6c75 6545 7272  --..    ValueErr
+00001160: 6f72 0d0a 2020 2020 2020 2020 416e 2065  or..        An e
+00001170: 7272 6f72 2074 6861 7420 6973 2072 6574  rror that is ret
+00001180: 7572 6e65 6420 7768 656e 2072 6573 756c  urned when resul
+00001190: 7473 2061 7265 2066 6f75 6e64 2074 6f20  ts are found to 
+000011a0: 6265 206f 7574 7369 6465 2074 6865 0d0a  be outside the..
+000011b0: 2020 2020 2020 2020 6173 7375 6d65 6420          assumed 
+000011c0: 6f72 2064 6566 696e 6564 206c 6f77 6572  or defined lower
+000011d0: 2061 6e64 2075 7070 6572 2062 6f75 6e64   and upper bound
+000011e0: 6172 6965 732e 0d0a 0d0a 2020 2020 5265  aries.....    Re
+000011f0: 7475 726e 730d 0a20 2020 202d 2d2d 2d2d  turns..    -----
+00001200: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
+00001210: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
+00001220: 496e 7075 7420 4461 7461 4672 616d 6520  Input DataFrame 
+00001230: 7769 7468 2066 6f75 7220 6164 6469 7469  with four additi
+00001240: 6f6e 616c 2063 6f6c 756d 6e73 2063 7265  onal columns cre
+00001250: 6174 6564 2074 6861 7420 7374 6f72 6520  ated that store 
+00001260: 7468 650d 0a20 2020 2020 2020 2069 6e66  the..        inf
+00001270: 6f72 6d61 7469 6f6e 2066 6f72 2074 6865  ormation for the
+00001280: 2069 6e74 6572 7661 6c73 2074 6861 7420   intervals that 
+00001290: 7265 7072 6573 656e 7420 7468 6520 7261  represent the ra
+000012a0: 6e67 6520 6f66 2070 6f74 656e 7469 616c  nge of potential
+000012b0: 0d0a 2020 2020 2020 2020 7661 6c75 6573  ..        values
+000012c0: 2066 6f72 2074 6865 2072 6573 756c 7473   for the results
+000012d0: 0d0a 0d0a 2020 2020 2727 270d 0a20 2020  ....    '''..   
+000012e0: 200d 0a20 2020 2023 2043 7265 6174 6520   ..    # Create 
+000012f0: 6120 636f 7079 206f 6620 7468 6520 4461  a copy of the Da
+00001300: 7461 4672 616d 650d 0a20 2020 2064 6620  taFrame..    df 
+00001310: 3d20 6466 2e63 6f70 7928 290d 0a20 2020  = df.copy()..   
+00001320: 200d 0a20 2020 2023 2044 6566 696e 6520   ..    # Define 
+00001330: 7768 6572 6520 7468 6520 6c65 6674 2062  where the left b
+00001340: 6f75 6e64 2069 7320 636c 6f73 6564 0d0a  ound is closed..
+00001350: 2020 2020 6466 5b6c 6566 745f 626f 756e      df[left_boun
+00001360: 6461 7279 5f63 6f6c 5d20 3d20 6e70 2e77  dary_col] = np.w
+00001370: 6865 7265 2864 665b 6365 6e73 6f72 5f63  here(df[censor_c
+00001380: 6f6c 5d2e 6973 696e 285b 2727 2c27 e289  ol].isin(['','..
+00001390: a527 5d29 2c0d 0a20 2020 2020 2020 2020  .']),..         
 000013a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000013b0: 2020 2027 436c 6f73 6564 272c 2027 4f70     'Closed', 'Op
-000013c0: 656e 2729 0d0a 2020 2020 0d0a 2020 2020  en')..    ..    
-000013d0: 2320 4465 6669 6e65 2077 6865 7265 206c  # Define where l
-000013e0: 6566 7420 626f 756e 6420 6973 2075 6e6c  eft bound is unl
-000013f0: 696d 6974 6564 0d0a 2020 2020 6466 5b6c  imited..    df[l
-00001400: 6566 745f 626f 756e 645f 636f 6c5d 203d  eft_bound_col] =
-00001410: 206e 702e 7768 6572 6528 6466 5b63 656e   np.where(df[cen
-00001420: 736f 725f 636f 6c5d 2e69 7369 6e28 5b27  sor_col].isin(['
-00001430: 3c27 2c27 e289 a427 5d29 2c0d 0a20 2020  <','...']),..   
-00001440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001450: 2020 2020 2020 2020 2020 2020 2d6e 702e              -np.
-00001460: 696e 662c 2064 665b 6e75 6d65 7269 635f  inf, df[numeric_
-00001470: 636f 6c5d 290d 0a20 2020 200d 0a20 2020  col])..    ..   
-00001480: 2023 2044 6566 696e 6520 7768 6572 6520   # Define where 
-00001490: 7269 6768 7420 626f 756e 6420 6973 2075  right bound is u
-000014a0: 6e6c 696d 6974 6564 0d0a 2020 2020 6466  nlimited..    df
-000014b0: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
-000014c0: 5d20 3d20 6e70 2e77 6865 7265 2864 665b  ] = np.where(df[
-000014d0: 6365 6e73 6f72 5f63 6f6c 5d2e 6973 696e  censor_col].isin
-000014e0: 285b 27e2 89a5 272c 273e 275d 292c 0d0a  (['...','>']),..
-000014f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000013b0: 2020 2020 2020 2020 2027 436c 6f73 6564           'Closed
+000013c0: 272c 2027 4f70 656e 2729 0d0a 2020 2020  ', 'Open')..    
+000013d0: 0d0a 2020 2020 2320 4465 6669 6e65 2077  ..    # Define w
+000013e0: 6865 7265 206c 6566 7420 626f 756e 6420  here left bound 
+000013f0: 6973 2075 6e6c 696d 6974 6564 0d0a 2020  is unlimited..  
+00001400: 2020 6466 5b6c 6566 745f 626f 756e 645f    df[left_bound_
+00001410: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
+00001420: 6466 5b63 656e 736f 725f 636f 6c5d 2e69  df[censor_col].i
+00001430: 7369 6e28 5b27 3c27 2c27 e289 a427 5d29  sin(['<','...'])
+00001440: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00001450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001460: 2020 2d6e 702e 696e 662c 2064 665b 6e75    -np.inf, df[nu
+00001470: 6d65 7269 635f 636f 6c5d 290d 0a20 2020  meric_col])..   
+00001480: 200d 0a20 2020 2023 2044 6566 696e 6520   ..    # Define 
+00001490: 7768 6572 6520 7269 6768 7420 626f 756e  where right boun
+000014a0: 6420 6973 2075 6e6c 696d 6974 6564 0d0a  d is unlimited..
+000014b0: 2020 2020 6466 5b72 6967 6874 5f62 6f75      df[right_bou
+000014c0: 6e64 5f63 6f6c 5d20 3d20 6e70 2e77 6865  nd_col] = np.whe
+000014d0: 7265 2864 665b 6365 6e73 6f72 5f63 6f6c  re(df[censor_col
+000014e0: 5d2e 6973 696e 285b 27e2 89a5 272c 273e  ].isin(['...','>
+000014f0: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
 00001500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001510: 6e70 2e69 6e66 2c20 6466 5b6e 756d 6572  np.inf, df[numer
-00001520: 6963 5f63 6f6c 5d29 0d0a 2020 2020 0d0a  ic_col])..    ..
-00001530: 2020 2020 2320 4465 6669 6e65 2077 6865      # Define whe
-00001540: 7265 2074 6865 2072 6967 6874 2062 6f75  re the right bou
-00001550: 6e64 2069 7320 636c 6f73 6564 0d0a 2020  nd is closed..  
-00001560: 2020 6466 5b72 6967 6874 5f62 6f75 6e64    df[right_bound
-00001570: 6172 795f 636f 6c5d 203d 206e 702e 7768  ary_col] = np.wh
-00001580: 6572 6528 6466 5b63 656e 736f 725f 636f  ere(df[censor_co
-00001590: 6c5d 2e69 7369 6e28 5b27 e289 a427 2c27  l].isin(['...','
-000015a0: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
+00001510: 2020 2020 2020 6e70 2e69 6e66 2c20 6466        np.inf, df
+00001520: 5b6e 756d 6572 6963 5f63 6f6c 5d29 0d0a  [numeric_col])..
+00001530: 2020 2020 0d0a 2020 2020 2320 4465 6669      ..    # Defi
+00001540: 6e65 2077 6865 7265 2074 6865 2072 6967  ne where the rig
+00001550: 6874 2062 6f75 6e64 2069 7320 636c 6f73  ht bound is clos
+00001560: 6564 0d0a 2020 2020 6466 5b72 6967 6874  ed..    df[right
+00001570: 5f62 6f75 6e64 6172 795f 636f 6c5d 203d  _boundary_col] =
+00001580: 206e 702e 7768 6572 6528 6466 5b63 656e   np.where(df[cen
+00001590: 736f 725f 636f 6c5d 2e69 7369 6e28 5b27  sor_col].isin(['
+000015a0: e289 a427 2c27 275d 292c 0d0a 2020 2020  ...','']),..    
 000015b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015c0: 2020 2020 2020 2020 2027 436c 6f73 6564           'Closed
-000015d0: 272c 2027 4f70 656e 2729 0d0a 2020 2020  ', 'Open')..    
-000015e0: 0d0a 2020 2020 2320 4966 206c 6566 7420  ..    # If left 
-000015f0: 6365 6e73 6f72 6564 2061 7265 2061 7373  censored are ass
-00001600: 756d 6564 2070 6f73 6974 6976 650d 0a20  umed positive.. 
-00001610: 2020 2069 6620 6e6f 7420 696e 636c 7564     if not includ
-00001620: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-00001630: 7661 6c3a 0d0a 2020 2020 2020 2020 2320  val:..        # 
-00001640: 4368 6563 6b20 666f 7220 616e 7920 6e65  Check for any ne
-00001650: 6761 7469 7665 2076 616c 7565 7320 2865  gative values (e
-00001660: 7863 6c75 6465 202d 696e 6629 0d0a 2020  xclude -inf)..  
-00001670: 2020 2020 2020 6966 2064 665b 6c65 6674        if df[left
-00001680: 5f62 6f75 6e64 5f63 6f6c 5d2e 6265 7477  _bound_col].betw
-00001690: 6565 6e28 2d6e 702e 696e 662c 2030 2c20  een(-np.inf, 0, 
-000016a0: 696e 636c 7573 6976 653d 276e 6569 7468  inclusive='neith
-000016b0: 6572 2729 2e61 6e79 2829 3a0d 0a20 2020  er').any():..   
-000016c0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000016d0: 616c 7565 4572 726f 7228 274e 6567 6174  alueError('Negat
-000016e0: 6976 6520 7661 6c75 6573 2065 7869 7374  ive values exist
-000016f0: 2069 6e20 7468 6520 6461 7461 2e20 5265   in the data. Re
-00001700: 736f 6c76 6520 6e65 6761 7469 7665 270d  solve negative'.
-00001710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001720: 2020 2020 2020 2020 2020 2020 2020 2776                'v
-00001730: 616c 7565 7320 6f72 2073 6574 2069 6e63  alues or set inc
-00001740: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
-00001750: 7465 7276 616c 2074 6f20 5472 7565 2729  terval to True')
-00001760: 0d0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-00001770: 616e 7920 2d69 6e66 206c 6566 7420 626f  any -inf left bo
-00001780: 756e 6473 2074 6f20 3020 7769 7468 2063  unds to 0 with c
-00001790: 6c6f 7365 6420 626f 756e 6461 7279 0d0a  losed boundary..
-000017a0: 2020 2020 2020 2020 636f 6e64 6974 696f          conditio
-000017b0: 6e20 3d20 2864 665b 6c65 6674 5f62 6f75  n = (df[left_bou
-000017c0: 6e64 5f63 6f6c 5d20 3c20 3029 0d0a 2020  nd_col] < 0)..  
-000017d0: 2020 2020 2020 6466 5b6c 6566 745f 626f        df[left_bo
-000017e0: 756e 6461 7279 5f63 6f6c 5d20 3d20 6e70  undary_col] = np
-000017f0: 2e77 6865 7265 2863 6f6e 6469 7469 6f6e  .where(condition
-00001800: 2c20 2743 6c6f 7365 6427 2c20 6466 5b6c  , 'Closed', df[l
-00001810: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-00001820: 5d29 0d0a 2020 2020 2020 2020 6466 5b6c  ])..        df[l
-00001830: 6566 745f 626f 756e 645f 636f 6c5d 203d  eft_bound_col] =
-00001840: 206e 702e 7768 6572 6528 636f 6e64 6974   np.where(condit
-00001850: 696f 6e2c 2030 2e30 2c20 6466 5b6c 6566  ion, 0.0, df[lef
-00001860: 745f 626f 756e 645f 636f 6c5d 290d 0a20  t_bound_col]).. 
-00001870: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
-00001880: 6466 0d0a 0d0a 0d0a 6465 6620 696e 7465  df......def inte
-00001890: 7276 616c 5f74 6f5f 636f 6d70 6f6e 656e  rval_to_componen
-000018a0: 7473 2864 662c 0d0a 2020 2020 2020 2020  ts(df,..        
+000015c0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000015d0: 436c 6f73 6564 272c 2027 4f70 656e 2729  Closed', 'Open')
+000015e0: 0d0a 2020 2020 0d0a 2020 2020 2320 4966  ..    ..    # If
+000015f0: 206c 6566 7420 6365 6e73 6f72 6564 2061   left censored a
+00001600: 7265 2061 7373 756d 6564 2070 6f73 6974  re assumed posit
+00001610: 6976 650d 0a20 2020 2069 6620 6e6f 7420  ive..    if not 
+00001620: 696e 636c 7564 655f 6e65 6761 7469 7665  include_negative
+00001630: 5f69 6e74 6572 7661 6c3a 0d0a 2020 2020  _interval:..    
+00001640: 2020 2020 2320 4368 6563 6b20 666f 7220      # Check for 
+00001650: 616e 7920 6e65 6761 7469 7665 2076 616c  any negative val
+00001660: 7565 7320 2865 7863 6c75 6465 202d 696e  ues (exclude -in
+00001670: 6629 0d0a 2020 2020 2020 2020 6966 2064  f)..        if d
+00001680: 665b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f[left_bound_col
+00001690: 5d2e 6265 7477 6565 6e28 2d6e 702e 696e  ].between(-np.in
+000016a0: 662c 2030 2c20 696e 636c 7573 6976 653d  f, 0, inclusive=
+000016b0: 276e 6569 7468 6572 2729 2e61 6e79 2829  'neither').any()
+000016c0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+000016d0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000016e0: 274e 6567 6174 6976 6520 7661 6c75 6573  'Negative values
+000016f0: 2065 7869 7374 2069 6e20 7468 6520 6461   exist in the da
+00001700: 7461 2e20 5265 736f 6c76 6520 6e65 6761  ta. Resolve nega
+00001710: 7469 7665 270d 0a20 2020 2020 2020 2020  tive'..         
+00001720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001730: 2020 2020 2776 616c 7565 7320 6f72 2073      'values or s
+00001740: 6574 2069 6e63 6c75 6465 5f6e 6567 6174  et include_negat
+00001750: 6976 655f 696e 7465 7276 616c 2074 6f20  ive_interval to 
+00001760: 5472 7565 2729 0d0a 2020 2020 2020 2020  True')..        
+00001770: 2320 5365 7420 616e 7920 2d69 6e66 206c  # Set any -inf l
+00001780: 6566 7420 626f 756e 6473 2074 6f20 3020  eft bounds to 0 
+00001790: 7769 7468 2063 6c6f 7365 6420 626f 756e  with closed boun
+000017a0: 6461 7279 0d0a 2020 2020 2020 2020 636f  dary..        co
+000017b0: 6e64 6974 696f 6e20 3d20 2864 665b 6c65  ndition = (df[le
+000017c0: 6674 5f62 6f75 6e64 5f63 6f6c 5d20 3c20  ft_bound_col] < 
+000017d0: 3029 0d0a 2020 2020 2020 2020 6466 5b6c  0)..        df[l
+000017e0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
+000017f0: 5d20 3d20 6e70 2e77 6865 7265 2863 6f6e  ] = np.where(con
+00001800: 6469 7469 6f6e 2c20 2743 6c6f 7365 6427  dition, 'Closed'
+00001810: 2c20 6466 5b6c 6566 745f 626f 756e 6461  , df[left_bounda
+00001820: 7279 5f63 6f6c 5d29 0d0a 2020 2020 2020  ry_col])..      
+00001830: 2020 6466 5b6c 6566 745f 626f 756e 645f    df[left_bound_
+00001840: 636f 6c5d 203d 206e 702e 7768 6572 6528  col] = np.where(
+00001850: 636f 6e64 6974 696f 6e2c 2030 2e30 2c20  condition, 0.0, 
+00001860: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
+00001870: 6c5d 290d 0a20 2020 200d 0a20 2020 2072  l])..    ..    r
+00001880: 6574 7572 6e20 6466 0d0a 0d0a 0d0a 6465  eturn df......de
+00001890: 6620 696e 7465 7276 616c 5f74 6f5f 636f  f interval_to_co
+000018a0: 6d70 6f6e 656e 7473 2864 662c 0d0a 2020  mponents(df,..  
 000018b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018c0: 2020 2066 6f63 7573 5f68 6967 685f 706f     focus_high_po
-000018d0: 7465 6e74 6961 6c20 3d20 5472 7565 2c0d  tential = True,.
-000018e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000018f0: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00001900: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-00001910: 6572 7661 6c20 3d20 4661 6c73 652c 0d0a  erval = False,..
-00001920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001930: 2020 2020 2020 2020 2020 2070 7265 6369             preci
-00001940: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
-00001950: 6f5f 6472 6f70 5f63 656e 736f 7220 3d20  o_drop_censor = 
-00001960: 302e 3235 293a 0d0a 2020 2020 2727 270d  0.25):..    '''.
-00001970: 0a20 2020 2041 2066 756e 6374 696f 6e20  .    A function 
-00001980: 7468 6174 2064 6574 6572 6d69 6e65 7320  that determines 
-00001990: 7468 6520 6365 6e73 6f72 2061 6e64 206e  the censor and n
-000019a0: 756d 6572 6963 2063 6f6d 706f 6e65 6e74  umeric component
-000019b0: 730d 0a20 2020 2066 726f 6d20 696e 7465  s..    from inte
-000019c0: 7276 616c 730d 0a0d 0a20 2020 2050 6172  rvals....    Par
-000019d0: 616d 6574 6572 730d 0a20 2020 202d 2d2d  ameters..    ---
-000019e0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-000019f0: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-00001a00: 2020 2020 2044 6174 6146 7261 6d65 2074       DataFrame t
-00001a10: 6861 7420 636f 6e74 6169 6e73 2069 6e74  hat contains int
-00001a20: 6572 7661 6c20 696e 666f 726d 6174 696f  erval informatio
-00001a30: 6e0d 0a20 2020 2066 6f63 7573 5f68 6967  n..    focus_hig
-00001a40: 685f 706f 7465 6e74 6961 6c20 3a20 626f  h_potential : bo
-00001a50: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
-00001a60: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-00001a70: 2c20 7468 656e 2069 6e66 6f72 6d61 7469  , then informati
-00001a80: 6f6e 206f 6e20 7468 6520 6869 6768 6573  on on the highes
-00001a90: 7420 706f 7465 6e74 6961 6c20 7265 7375  t potential resu
-00001aa0: 6c74 2077 696c 6c20 6265 0d0a 2020 2020  lt will be..    
-00001ab0: 2020 2020 666f 6375 7365 6420 6f76 6572      focused over
-00001ac0: 2074 6865 206c 6f77 6573 7420 706f 7465   the lowest pote
-00001ad0: 6e74 6961 6c20 7265 7375 6c74 2e0d 0a20  ntial result... 
-00001ae0: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
-00001af0: 6976 655f 696e 7465 7276 616c 203a 2062  ive_interval : b
-00001b00: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
-00001b10: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
-00001b20: 652c 2074 6865 6e20 616c 6c20 706f 7369  e, then all posi
-00001b30: 7469 7665 2061 6e64 206e 6567 6174 6976  tive and negativ
-00001b40: 6520 7661 6c75 6573 2061 7265 2063 6f6e  e values are con
-00001b50: 7369 6465 7265 640d 0a20 2020 2020 2020  sidered..       
-00001b60: 2065 2e67 2e2c 203c 302e 3520 776f 756c   e.g., <0.5 woul
-00001b70: 6420 6265 2063 6f6e 7665 7274 6564 2074  d be converted t
-00001b80: 6f20 282d 6e70 2e69 6e66 2c35 292e 0d0a  o (-np.inf,5)...
-00001b90: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-00001ba0: 2c20 7468 656e 206f 6e6c 7920 6e6f 6e2d  , then only non-
-00001bb0: 6e65 6761 7469 7665 2076 616c 7565 7320  negative values 
-00001bc0: 6172 6520 636f 6e73 6964 6572 6564 0d0a  are considered..
-00001bd0: 2020 2020 2020 2020 652e 672e 2c20 3c30          e.g., <0
-00001be0: 2e35 2077 6f75 6c64 2062 6520 636f 6e76  .5 would be conv
-00001bf0: 6572 7465 6420 746f 205b 302c 3529 2e0d  erted to [0,5)..
-00001c00: 0a20 2020 2020 2020 2054 6869 7320 7365  .        This se
-00001c10: 7474 696e 6720 6f6e 6c79 2061 6666 6563  tting only affec
-00001c20: 7473 2072 6573 756c 7473 2069 6620 666f  ts results if fo
-00001c30: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
-00001c40: 616c 2069 7320 4661 6c73 652e 0d0a 2020  al is False...  
-00001c50: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-00001c60: 7420 6973 2046 616c 7365 2e0d 0a20 2020  t is False...   
-00001c70: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
-00001c80: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
-00001c90: 736f 7220 3a20 666c 6f61 742c 206f 7074  sor : float, opt
-00001ca0: 696f 6e61 6c0d 0a20 2020 2020 2020 2054  ional..        T
-00001cb0: 6872 6573 686f 6c64 2066 6f72 2072 6570  hreshold for rep
-00001cc0: 6f72 7469 6e67 2063 656e 736f 7265 6420  orting censored 
-00001cd0: 7673 206e 6f6e 2d63 656e 736f 7265 6420  vs non-censored 
-00001ce0: 7265 7375 6c74 732e 0d0a 2020 2020 2020  results...      
-00001cf0: 2020 5573 696e 6720 7468 6520 6465 6661    Using the defa
-00001d00: 756c 742c 2061 2072 6573 756c 7420 7468  ult, a result th
-00001d10: 6174 2069 7320 6b6e 6f77 6e20 746f 2062  at is known to b
-00001d20: 6520 696e 2074 6865 2069 6e74 6572 7661  e in the interva
-00001d30: 6c20 2830 2e33 2c20 302e 3529 0d0a 2020  l (0.3, 0.5)..  
-00001d40: 2020 2020 2020 776f 756c 6420 6265 2072        would be r
-00001d50: 6574 7572 6e65 6420 6173 2030 2e34 2c20  eturned as 0.4, 
-00001d60: 7768 6572 6561 7320 6120 746f 6c65 7261  whereas a tolera
-00001d70: 6e63 6520 6f66 2030 2077 6f75 6c64 2079  nce of 0 would y
-00001d80: 6965 6c64 2061 0d0a 2020 2020 2020 2020  ield a..        
-00001d90: 7265 7375 6c74 206f 6620 3c30 2e35 206f  result of <0.5 o
-00001da0: 7220 3e30 2e33 2064 6570 656e 6469 6e67  r >0.3 depending
-00001db0: 206f 6e20 7468 6520 7661 6c75 6520 6f66   on the value of
-00001dc0: 2066 6f63 7573 5f68 6967 6865 7374 5f70   focus_highest_p
-00001dd0: 6f74 656e 7469 616c 2e0d 0a20 2020 2020  otential...     
-00001de0: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
-00001df0: 7320 302e 3235 2e0d 0a0d 0a20 2020 2052  s 0.25.....    R
-00001e00: 6574 7572 6e73 0d0a 2020 2020 2d2d 2d2d  eturns..    ----
-00001e10: 2d2d 2d0d 0a20 2020 2064 6620 3a20 4461  ---..    df : Da
-00001e20: 7461 4672 616d 650d 0a20 2020 2020 2020  taFrame..       
-00001e30: 2044 6174 6146 7261 6d65 2077 6865 7265   DataFrame where
-00001e40: 2069 6e74 6572 7661 6c73 2066 6f72 2072   intervals for r
-00001e50: 6573 756c 7473 2068 6176 6520 6265 656e  esults have been
-00001e60: 2061 6e61 6c79 7365 6420 746f 2063 656e   analysed to cen
-00001e70: 736f 7220 616e 640d 0a20 2020 2020 2020  sor and..       
-00001e80: 206e 756d 6572 6963 2063 6f6d 706f 6e65   numeric compone
-00001e90: 6e74 732e 0d0a 0d0a 2020 2020 2727 270d  nts.....    '''.
-00001ea0: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
-00001eb0: 6174 6520 6120 636f 7079 206f 6620 7468  ate a copy of th
-00001ec0: 6520 4461 7461 4672 616d 650d 0a20 2020  e DataFrame..   
-00001ed0: 2064 6620 3d20 6466 2e63 6f70 7928 290d   df = df.copy().
-00001ee0: 0a20 2020 200d 0a20 2020 2023 2044 6574  .    ..    # Det
-00001ef0: 6572 6d69 6e65 2074 6865 206d 6964 706f  ermine the midpo
-00001f00: 696e 7420 666f 7220 7468 6520 696e 7465  int for the inte
-00001f10: 7276 616c 2069 6620 6669 6e69 7465 2069  rval if finite i
-00001f20: 6e74 6572 7661 6c0d 0a20 2020 2064 665b  nterval..    df[
-00001f30: 6d69 6470 6f69 6e74 5f63 6f6c 5d20 3d20  midpoint_col] = 
-00001f40: 6e70 2e77 6865 7265 2828 6466 5b6c 6566  np.where((df[lef
-00001f50: 745f 626f 756e 645f 636f 6c5d 203e 202d  t_bound_col] > -
-00001f60: 6e70 2e69 6e66 2920 2620 2864 665b 7269  np.inf) & (df[ri
-00001f70: 6768 745f 626f 756e 645f 636f 6c5d 203c  ght_bound_col] <
-00001f80: 206e 702e 696e 6629 2c0d 0a20 2020 2020   np.inf),..     
-00001f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fa0: 2020 2020 2020 2020 2030 2e35 202a 2028           0.5 * (
-00001fb0: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
-00001fc0: 6c5d 202b 2064 665b 7269 6768 745f 626f  l] + df[right_bo
-00001fd0: 756e 645f 636f 6c5d 292c 0d0a 2020 2020  und_col]),..    
-00001fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ff0: 2020 2020 2020 2020 2020 6e70 2e6e 616e            np.nan
-00002000: 290d 0a20 2020 200d 0a20 2020 200d 0a20  )..    ..    .. 
-00002010: 2020 2023 2044 6566 696e 6520 7468 6520     # Define the 
-00002020: 636f 6e64 6974 696f 6e73 2066 6f72 2061  conditions for a
-00002030: 6e20 756e 6365 6e73 6f72 6564 2072 6573  n uncensored res
-00002040: 756c 740d 0a20 2020 2063 6f6e 6469 7469  ult..    conditi
-00002050: 6f6e 7320 3d20 5b0d 0a20 2020 2020 2020  ons = [..       
-00002060: 2023 2049 6620 7468 6520 626f 756e 6473   # If the bounds
-00002070: 2061 7265 2065 7175 616c 2c20 7468 656e   are equal, then
-00002080: 2074 6865 2072 6573 756c 7420 6973 2075   the result is u
-00002090: 6e63 656e 736f 7265 640d 0a20 2020 2020  ncensored..     
-000020a0: 2020 2028 6466 5b6c 6566 745f 626f 756e     (df[left_boun
-000020b0: 645f 636f 6c5d 203d 3d20 6466 5b72 6967  d_col] == df[rig
-000020c0: 6874 5f62 6f75 6e64 5f63 6f6c 5d29 2c0d  ht_bound_col]),.
-000020d0: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
-000020e0: 6520 626f 756e 6473 2061 7265 2066 696e  e bounds are fin
-000020f0: 6974 6520 616e 6420 7468 6520 696e 7465  ite and the inte
-00002100: 7276 616c 2069 7320 7769 7468 696e 2074  rval is within t
-00002110: 6865 2070 7265 6369 7369 6f6e 2074 6f6c  he precision tol
-00002120: 6572 616e 6365 2c20 6176 6f69 6420 7468  erance, avoid th
-00002130: 6520 7573 6520 6f66 2063 656e 736f 7273  e use of censors
-00002140: 0d0a 2020 2020 2020 2020 2864 665b 7269  ..        (df[ri
-00002150: 6768 745f 626f 756e 645f 636f 6c5d 202d  ght_bound_col] -
-00002160: 2064 665b 6d69 6470 6f69 6e74 5f63 6f6c   df[midpoint_col
-00002170: 5d29 203c 3d20 6466 5b6d 6964 706f 696e  ]) <= df[midpoin
-00002180: 745f 636f 6c5d 202a 2070 7265 6369 7369  t_col] * precisi
-00002190: 6f6e 5f74 6f6c 6572 616e 6365 5f74 6f5f  on_tolerance_to_
-000021a0: 6472 6f70 5f63 656e 736f 720d 0a20 2020  drop_censor..   
-000021b0: 2020 2020 205d 0d0a 2020 2020 0d0a 2020       ]..    ..  
-000021c0: 2020 6365 6e73 6f72 5f72 6573 756c 7473    censor_results
-000021d0: 203d 205b 0d0a 2020 2020 2020 2020 2727   = [..        ''
-000021e0: 2c0d 0a20 2020 2020 2020 2027 270d 0a20  ,..        ''.. 
-000021f0: 2020 2020 2020 205d 0d0a 2020 2020 0d0a         ]..    ..
-00002200: 2020 2020 6e75 6d65 7269 635f 7265 7375      numeric_resu
-00002210: 6c74 7320 3d5b 0d0a 2020 2020 2020 2020  lts =[..        
-00002220: 6466 5b6d 6964 706f 696e 745f 636f 6c5d  df[midpoint_col]
-00002230: 2c0d 0a20 2020 2020 2020 2064 665b 6d69  ,..        df[mi
-00002240: 6470 6f69 6e74 5f63 6f6c 5d0d 0a20 2020  dpoint_col]..   
-00002250: 2020 2020 205d 0d0a 2020 2020 0d0a 2020       ]..    ..  
-00002260: 2020 2320 4966 2066 6f63 7573 6564 206f    # If focused o
-00002270: 6e20 7468 6520 6869 6768 6573 7420 706f  n the highest po
-00002280: 7465 6e74 6961 6c20 7265 7375 6c74 0d0a  tential result..
-00002290: 2020 2020 6966 2066 6f63 7573 5f68 6967      if focus_hig
-000022a0: 685f 706f 7465 6e74 6961 6c3a 0d0a 2020  h_potential:..  
-000022b0: 2020 2020 2020 2320 5365 7420 6365 6e73        # Set cens
-000022c0: 6f72 2061 6e64 206e 756d 6572 6963 2063  or and numeric c
-000022d0: 6f6d 706f 6e65 6e74 7320 666f 7220 6561  omponents for ea
-000022e0: 6368 2063 6f6e 6469 7469 6f6e 0d0a 2020  ch condition..  
-000022f0: 2020 2020 2020 636f 6e64 6974 696f 6e73        conditions
-00002300: 202b 3d20 5b0d 0a20 2020 2020 2020 2020   += [..         
-00002310: 2020 2023 2049 6620 7468 6572 6520 6973     # If there is
-00002320: 2061 6e20 696e 6669 6e69 7465 2072 6967   an infinite rig
-00002330: 6874 2062 6f75 6e64 2c20 7468 6520 7265  ht bound, the re
-00002340: 7375 6c74 2069 7320 7269 6768 7420 6365  sult is right ce
-00002350: 6e73 6f72 6564 0d0a 2020 2020 2020 2020  nsored..        
-00002360: 2020 2020 2864 665b 7269 6768 745f 626f      (df[right_bo
-00002370: 756e 645f 636f 6c5d 203d 3d20 6e70 2e69  und_col] == np.i
-00002380: 6e66 2920 2620 2864 665b 6c65 6674 5f62  nf) & (df[left_b
-00002390: 6f75 6e64 5f63 6f6c 5d20 3e20 2d6e 702e  ound_col] > -np.
-000023a0: 696e 6629 2026 2028 6466 5b6c 6566 745f  inf) & (df[left_
-000023b0: 626f 756e 6461 7279 5f63 6f6c 5d20 3d3d  boundary_col] ==
-000023c0: 2027 4f70 656e 2729 2c0d 0a20 2020 2020   'Open'),..     
-000023d0: 2020 2020 2020 2028 6466 5b72 6967 6874         (df[right
-000023e0: 5f62 6f75 6e64 5f63 6f6c 5d20 3d3d 206e  _bound_col] == n
-000023f0: 702e 696e 6629 2026 2028 6466 5b6c 6566  p.inf) & (df[lef
-00002400: 745f 626f 756e 645f 636f 6c5d 203e 202d  t_bound_col] > -
-00002410: 6e70 2e69 6e66 2920 2620 2864 665b 6c65  np.inf) & (df[le
-00002420: 6674 5f62 6f75 6e64 6172 795f 636f 6c5d  ft_boundary_col]
-00002430: 203d 3d20 2743 6c6f 7365 6427 292c 0d0a   == 'Closed'),..
-00002440: 2020 2020 2020 2020 2020 2020 2320 4f74              # Ot
-00002450: 6865 7277 6973 652c 2074 6865 2072 6573  herwise, the res
-00002460: 756c 7420 7368 6f75 6c64 2062 6520 6c65  ult should be le
-00002470: 6674 2063 656e 736f 7265 640d 0a20 2020  ft censored..   
-00002480: 2020 2020 2020 2020 2028 6466 5b72 6967           (df[rig
-00002490: 6874 5f62 6f75 6e64 5f63 6f6c 5d20 3c20  ht_bound_col] < 
-000024a0: 6e70 2e69 6e66 2920 2620 2864 665b 7269  np.inf) & (df[ri
-000024b0: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-000024c0: 5d20 3d3d 2027 4f70 656e 2729 2c0d 0a20  ] == 'Open'),.. 
-000024d0: 2020 2020 2020 2020 2020 2028 6466 5b72             (df[r
-000024e0: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d20  ight_bound_col] 
-000024f0: 3c20 6e70 2e69 6e66 2920 2620 2864 665b  < np.inf) & (df[
-00002500: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
-00002510: 6f6c 5d20 3d3d 2027 436c 6f73 6564 2729  ol] == 'Closed')
-00002520: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
-00002530: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00002540: 2020 2063 656e 736f 725f 7265 7375 6c74     censor_result
-00002550: 7320 2b3d 205b 0d0a 2020 2020 2020 2020  s += [..        
-00002560: 2020 2020 273e 272c 0d0a 2020 2020 2020      '>',..      
-00002570: 2020 2020 2020 27e2 89a5 272c 0d0a 2020        '...',..  
-00002580: 2020 2020 2020 2020 2020 273c 272c 0d0a            '<',..
-00002590: 2020 2020 2020 2020 2020 2020 27e2 89a4              '...
-000025a0: 270d 0a20 2020 2020 2020 2020 2020 205d  '..            ]
-000025b0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000025c0: 2020 2020 6e75 6d65 7269 635f 7265 7375      numeric_resu
-000025d0: 6c74 7320 2b3d 205b 0d0a 2020 2020 2020  lts += [..      
-000025e0: 2020 2020 2020 6466 5b6c 6566 745f 626f        df[left_bo
-000025f0: 756e 645f 636f 6c5d 2c0d 0a20 2020 2020  und_col],..     
-00002600: 2020 2020 2020 2064 665b 6c65 6674 5f62         df[left_b
-00002610: 6f75 6e64 5f63 6f6c 5d2c 0d0a 2020 2020  ound_col],..    
-00002620: 2020 2020 2020 2020 6466 5b72 6967 6874          df[right
-00002630: 5f62 6f75 6e64 5f63 6f6c 5d2c 0d0a 2020  _bound_col],..  
-00002640: 2020 2020 2020 2020 2020 6466 5b72 6967            df[rig
-00002650: 6874 5f62 6f75 6e64 5f63 6f6c 5d0d 0a20  ht_bound_col].. 
-00002660: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
-00002670: 2020 2320 456c 7365 2066 6f63 7573 6564    # Else focused
-00002680: 206f 6e20 7468 6520 6c6f 7765 7374 2070   on the lowest p
-00002690: 6f74 656e 7469 616c 2072 6573 756c 740d  otential result.
-000026a0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
-000026b0: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
-000026c0: 7468 6520 6c6f 7765 7220 626f 756e 640d  the lower bound.
-000026d0: 0a20 2020 2020 2020 2069 6620 696e 636c  .        if incl
-000026e0: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-000026f0: 6572 7661 6c3a 0d0a 2020 2020 2020 2020  erval:..        
-00002700: 2020 2020 6c6f 7765 725f 626f 756e 6420      lower_bound 
-00002710: 3d20 2d6e 702e 696e 660d 0a20 2020 2020  = -np.inf..     
-00002720: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00002730: 2020 2020 2020 6c6f 7765 725f 626f 756e        lower_boun
-00002740: 6420 3d20 302e 300d 0a20 2020 2020 2020  d = 0.0..       
-00002750: 2023 2053 6574 2063 656e 736f 7220 616e   # Set censor an
-00002760: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
-00002770: 656e 7473 2066 6f72 2065 6163 6820 636f  ents for each co
-00002780: 6e64 6974 696f 6e0d 0a20 2020 2020 2020  ndition..       
-00002790: 2063 6f6e 6469 7469 6f6e 7320 2b3d 205b   conditions += [
-000027a0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000027b0: 4966 2074 6865 206c 6566 7420 626f 756e  If the left boun
-000027c0: 6420 6973 2069 6465 6e74 6963 616c 2074  d is identical t
-000027d0: 6f20 7468 6520 6c6f 7765 7374 2070 6f74  o the lowest pot
-000027e0: 656e 7469 616c 206c 6f77 6572 2062 6f75  ential lower bou
-000027f0: 6e64 2c0d 0a20 2020 2020 2020 2020 2020  nd,..           
-00002800: 2023 2074 6865 6e20 7468 6520 7265 7375   # then the resu
-00002810: 6c74 2069 7320 6c65 6674 2063 656e 736f  lt is left censo
-00002820: 7265 640d 0a20 2020 2020 2020 2020 2020  red..           
-00002830: 2028 6466 5b6c 6566 745f 626f 756e 645f   (df[left_bound_
-00002840: 636f 6c5d 203d 3d20 6c6f 7765 725f 626f  col] == lower_bo
-00002850: 756e 6429 2026 2028 6466 5b72 6967 6874  und) & (df[right
-00002860: 5f62 6f75 6e64 5f63 6f6c 5d20 3c20 6e70  _bound_col] < np
-00002870: 2e69 6e66 2920 2620 2864 665b 7269 6768  .inf) & (df[righ
-00002880: 745f 626f 756e 6461 7279 5f63 6f6c 5d20  t_boundary_col] 
-00002890: 3d3d 2027 4f70 656e 2729 2c0d 0a20 2020  == 'Open'),..   
-000028a0: 2020 2020 2020 2020 2028 6466 5b6c 6566           (df[lef
-000028b0: 745f 626f 756e 645f 636f 6c5d 203d 3d20  t_bound_col] == 
-000028c0: 6c6f 7765 725f 626f 756e 6429 2026 2028  lower_bound) & (
-000028d0: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
-000028e0: 6f6c 5d20 3c20 6e70 2e69 6e66 2920 2620  ol] < np.inf) & 
-000028f0: 2864 665b 7269 6768 745f 626f 756e 6461  (df[right_bounda
-00002900: 7279 5f63 6f6c 5d20 3d3d 2027 436c 6f73  ry_col] == 'Clos
-00002910: 6564 2729 2c0d 0a20 2020 2020 2020 2020  ed'),..         
-00002920: 2020 2023 204f 7468 6572 7769 7365 2c20     # Otherwise, 
-00002930: 7468 6520 7265 7375 6c74 2073 686f 756c  the result shoul
-00002940: 6420 6265 2072 6967 6874 2063 656e 736f  d be right censo
-00002950: 7265 640d 0a20 2020 2020 2020 2020 2020  red..           
-00002960: 2028 6466 5b6c 6566 745f 626f 756e 645f   (df[left_bound_
-00002970: 636f 6c5d 203e 206c 6f77 6572 5f62 6f75  col] > lower_bou
-00002980: 6e64 2920 2620 2864 665b 6c65 6674 5f62  nd) & (df[left_b
-00002990: 6f75 6e64 6172 795f 636f 6c5d 203d 3d20  oundary_col] == 
-000029a0: 274f 7065 6e27 292c 0d0a 2020 2020 2020  'Open'),..      
-000029b0: 2020 2020 2020 2864 665b 6c65 6674 5f62        (df[left_b
-000029c0: 6f75 6e64 5f63 6f6c 5d20 3e20 6c6f 7765  ound_col] > lowe
-000029d0: 725f 626f 756e 6429 2026 2028 6466 5b6c  r_bound) & (df[l
-000029e0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-000029f0: 5d20 3d3d 2027 436c 6f73 6564 2729 0d0a  ] == 'Closed')..
-00002a00: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
-00002a10: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00002a20: 2063 656e 736f 725f 7265 7375 6c74 7320   censor_results 
-00002a30: 2b3d 205b 0d0a 2020 2020 2020 2020 2020  += [..          
-00002a40: 2020 273c 272c 0d0a 2020 2020 2020 2020    '<',..        
-00002a50: 2020 2020 27e2 89a4 272c 0d0a 2020 2020      '...',..    
-00002a60: 2020 2020 2020 2020 273e 272c 0d0a 2020          '>',..  
-00002a70: 2020 2020 2020 2020 2020 27e2 89a5 270d            '...'.
-00002a80: 0a20 2020 2020 2020 2020 2020 205d 0d0a  .            ]..
-00002a90: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00002aa0: 2020 6e75 6d65 7269 635f 7265 7375 6c74    numeric_result
-00002ab0: 7320 2b3d 205b 0d0a 2020 2020 2020 2020  s += [..        
-00002ac0: 2020 2020 6466 5b72 6967 6874 5f62 6f75      df[right_bou
-00002ad0: 6e64 5f63 6f6c 5d2c 0d0a 2020 2020 2020  nd_col],..      
-00002ae0: 2020 2020 2020 6466 5b72 6967 6874 5f62        df[right_b
-00002af0: 6f75 6e64 5f63 6f6c 5d2c 0d0a 2020 2020  ound_col],..    
-00002b00: 2020 2020 2020 2020 6466 5b6c 6566 745f          df[left_
-00002b10: 626f 756e 645f 636f 6c5d 2c0d 0a20 2020  bound_col],..   
-00002b20: 2020 2020 2020 2020 2064 665b 6c65 6674           df[left
-00002b30: 5f62 6f75 6e64 5f63 6f6c 5d0d 0a20 2020  _bound_col]..   
-00002b40: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
-00002b50: 0d0a 2020 2020 2320 4465 7465 726d 696e  ..    # Determin
-00002b60: 6520 7468 6520 6365 6e73 6f72 2061 6e64  e the censor and
-00002b70: 206e 756d 6572 6963 2063 6f6d 706f 6e65   numeric compone
-00002b80: 6e74 730d 0a20 2020 2023 2049 6620 6e6f  nts..    # If no
-00002b90: 2063 6f6e 6469 7469 6f6e 2069 7320 6d65   condition is me
-00002ba0: 742c 2064 6566 6175 6c74 2074 6f20 3c3e  t, default to <>
-00002bb0: 2061 6e64 204e 614e 0d0a 2020 2020 6466   and NaN..    df
-00002bc0: 5b63 656e 736f 725f 636f 6c5d 203d 206e  [censor_col] = n
-00002bd0: 702e 7365 6c65 6374 2863 6f6e 6469 7469  p.select(conditi
-00002be0: 6f6e 732c 2063 656e 736f 725f 7265 7375  ons, censor_resu
-00002bf0: 6c74 732c 2027 3c3e 2729 0d0a 2020 2020  lts, '<>')..    
-00002c00: 6466 5b6e 756d 6572 6963 5f63 6f6c 5d20  df[numeric_col] 
-00002c10: 3d20 6e70 2e73 656c 6563 7428 636f 6e64  = np.select(cond
-00002c20: 6974 696f 6e73 2c20 6e75 6d65 7269 635f  itions, numeric_
-00002c30: 7265 7375 6c74 732c 206e 702e 6e61 6e29  results, np.nan)
-00002c40: 0d0a 2020 2020 0d0a 2020 2020 7265 7475  ..    ..    retu
-00002c50: 726e 2064 660d 0a0d 0a23 2525 2520 496e  rn df....#%%% In
-00002c60: 7465 7276 616c 2063 6f6d 706f 6e65 6e74  terval component
-00002c70: 7320 746f 2069 6e74 6572 7661 6c20 7374  s to interval st
-00002c80: 7269 6e67 0d0a 0d0a 6465 6620 696e 7465  ring....def inte
-00002c90: 7276 616c 5f6e 6f74 6174 696f 6e28 6466  rval_notation(df
-00002ca0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00002cb0: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
-00002cc0: 6f6e 5f72 6f75 6e64 696e 673d 5472 7565  on_rounding=True
-00002cd0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-00002ce0: 2054 6869 7320 6675 6e63 7469 6f6e 2063   This function c
-00002cf0: 7265 6174 6573 2061 2063 6f6c 756d 6e20  reates a column 
-00002d00: 7468 6174 2063 6f6d 6269 6e65 7320 7468  that combines th
-00002d10: 6520 696e 7465 7276 616c 2063 6f6d 706f  e interval compo
-00002d20: 6e65 6e74 730d 0a20 2020 2069 6e74 6f20  nents..    into 
-00002d30: 6120 7369 6e67 6c65 2074 6578 7420 6e6f  a single text no
-00002d40: 7461 7469 6f6e 2066 6f72 2069 6e74 6572  tation for inter
-00002d50: 7661 6c73 2e0d 0a0d 0a20 2020 2050 6172  vals.....    Par
-00002d60: 616d 6574 6572 730d 0a20 2020 202d 2d2d  ameters..    ---
-00002d70: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-00002d80: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-00002d90: 2020 2020 2044 6174 6146 7261 6d65 2063       DataFrame c
-00002da0: 6f6e 7461 696e 696e 6720 636f 6c75 6d6e  ontaining column
-00002db0: 7320 666f 7220 6c65 6674 2f72 6967 6874  s for left/right
-00002dc0: 2062 6f75 6e64 7320 616e 6420 626f 756e   bounds and boun
-00002dd0: 6461 7269 6573 0d0a 2020 2020 7072 6563  daries..    prec
-00002de0: 6973 696f 6e5f 726f 756e 6469 6e67 203a  ision_rounding :
-00002df0: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
-00002e00: 616c 0d0a 2020 2020 2020 2020 4966 2054  al..        If T
-00002e10: 7275 652c 2061 2072 6f75 6e64 696e 6720  rue, a rounding 
-00002e20: 6d65 7468 6f64 2069 7320 6170 706c 6965  method is applie
-00002e30: 6420 746f 2072 6f75 6e64 2072 6573 756c  d to round resul
-00002e40: 7473 2074 6f20 6861 7665 206e 6f20 6d6f  ts to have no mo
-00002e50: 7265 0d0a 2020 2020 2020 2020 6465 6369  re..        deci
-00002e60: 6d61 6c73 2074 6861 6e20 7768 6174 2063  mals than what c
-00002e70: 616e 2062 6520 6d65 6173 7572 6564 2e0d  an be measured..
-00002e80: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-00002e90: 6175 6c74 2069 7320 5472 7565 2e0d 0a0d  ault is True....
-00002ea0: 0a20 2020 2052 6574 7572 6e73 0d0a 2020  .    Returns..  
-00002eb0: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064    -------..    d
-00002ec0: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-00002ed0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-00002ee0: 2069 6465 6e74 6963 616c 2074 6f20 696e   identical to in
-00002ef0: 7470 7574 2077 6974 6820 6164 6469 7469  tput with additi
-00002f00: 6f6e 616c 2063 6f6c 756d 6e20 7769 7468  onal column with
-00002f10: 2063 6f6d 6269 6e65 640d 0a20 2020 2020   combined..     
-00002f20: 2020 2069 6e74 6572 7661 6c20 6e6f 7461     interval nota
-00002f30: 7469 6f6e 0d0a 0d0a 2020 2020 2727 270d  tion....    '''.
-00002f40: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
-00002f50: 6174 6520 6120 636f 7079 206f 6620 7468  ate a copy of th
-00002f60: 6520 4461 7461 4672 616d 650d 0a20 2020  e DataFrame..   
-00002f70: 2064 6620 3d20 6466 2e63 6f70 7928 290d   df = df.copy().
-00002f80: 0a20 2020 200d 0a20 2020 2023 2044 6574  .    ..    # Det
-00002f90: 6572 6d69 6e65 2074 6865 206c 6566 7420  ermine the left 
-00002fa0: 626f 756e 6461 7279 2073 796d 626f 6c0d  boundary symbol.
-00002fb0: 0a20 2020 2064 665b 696e 7465 7276 616c  .    df[interval
-00002fc0: 5f63 6f6c 5d20 3d20 6e70 2e77 6865 7265  _col] = np.where
-00002fd0: 2864 665b 6c65 6674 5f62 6f75 6e64 6172  (df[left_boundar
-00002fe0: 795f 636f 6c5d 203d 3d20 274f 7065 6e27  y_col] == 'Open'
-00002ff0: 2c20 2728 272c 2027 5b27 290d 0a20 2020  , '(', '[')..   
-00003000: 200d 0a20 2020 2023 2049 6e63 6f72 706f   ..    # Incorpo
-00003010: 7261 7465 206c 6566 7420 616e 6420 7269  rate left and ri
-00003020: 6768 7420 626f 756e 6473 0d0a 2020 2020  ght bounds..    
-00003030: 6966 2070 7265 6369 7369 6f6e 5f72 6f75  if precision_rou
-00003040: 6e64 696e 673a 0d0a 2020 2020 2020 2020  nding:..        
-00003050: 6466 5b69 6e74 6572 7661 6c5f 636f 6c5d  df[interval_col]
-00003060: 202b 3d20 6466 5b6c 6566 745f 626f 756e   += df[left_boun
-00003070: 645f 636f 6c5d 2e61 7070 6c79 2873 7472  d_col].apply(str
-00003080: 696e 675f 7072 6563 6973 696f 6e29 202b  ing_precision) +
-00003090: 2027 2c20 2720 2b20 6466 5b72 6967 6874   ', ' + df[right
-000030a0: 5f62 6f75 6e64 5f63 6f6c 5d2e 6170 706c  _bound_col].appl
-000030b0: 7928 7374 7269 6e67 5f70 7265 6369 7369  y(string_precisi
-000030c0: 6f6e 290d 0a20 2020 2065 6c73 653a 0d0a  on)..    else:..
-000030d0: 2020 2020 2020 2020 6466 5b69 6e74 6572          df[inter
-000030e0: 7661 6c5f 636f 6c5d 202b 3d20 6466 5b6c  val_col] += df[l
-000030f0: 6566 745f 626f 756e 645f 636f 6c5d 2e61  eft_bound_col].a
-00003100: 7374 7970 6528 7374 7229 202b 2027 2c20  stype(str) + ', 
-00003110: 2720 2b20 6466 5b72 6967 6874 5f62 6f75  ' + df[right_bou
-00003120: 6e64 5f63 6f6c 5d2e 6173 7479 7065 2873  nd_col].astype(s
-00003130: 7472 290d 0a20 2020 200d 0a20 2020 2023  tr)..    ..    #
-00003140: 2044 6574 6572 6d69 6e65 2074 6865 2072   Determine the r
-00003150: 6967 6874 2062 6f75 6e64 6172 7920 7379  ight boundary sy
-00003160: 6d62 6f6c 0d0a 2020 2020 6466 5b69 6e74  mbol..    df[int
-00003170: 6572 7661 6c5f 636f 6c5d 202b 3d20 6e70  erval_col] += np
-00003180: 2e77 6865 7265 2864 665b 7269 6768 745f  .where(df[right_
-00003190: 626f 756e 6461 7279 5f63 6f6c 5d2e 6973  boundary_col].is
-000031a0: 696e 285b 274f 7065 6e27 5d29 2c20 2729  in(['Open']), ')
-000031b0: 272c 2027 5d27 290d 0a20 2020 200d 0a20  ', ']')..    .. 
-000031c0: 2020 2072 6574 7572 6e20 6466 0d0a 0d0a     return df....
-000031d0: 0d0a 2325 2520 4d61 7869 6d75 6d20 5265  ..#%% Maximum Re
-000031e0: 7375 6c74 0d0a 0d0a 6465 6620 6d61 7869  sult....def maxi
-000031f0: 6d75 6d5f 696e 7465 7276 616c 2864 662c  mum_interval(df,
-00003200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003210: 2020 2020 2020 2067 726f 7570 6279 5f63         groupby_c
-00003220: 6f6c 7329 3a0d 0a20 2020 2027 2727 0d0a  ols):..    '''..
-00003230: 2020 2020 4120 6675 6e63 7469 6f6e 2074      A function t
-00003240: 6861 7420 616e 616c 7973 6573 2074 6865  hat analyses the
-00003250: 2069 6e74 6572 7661 6c20 6e6f 7461 7469   interval notati
-00003260: 6f6e 2066 6f72 6d20 6f66 2072 6573 756c  on form of resul
-00003270: 7473 2072 6574 7572 6e65 640d 0a20 2020  ts returned..   
-00003280: 2066 726f 6d20 636f 6d70 6f6e 656e 7473   from components
-00003290: 5f74 6f5f 696e 7465 7276 616c 2074 6f20  _to_interval to 
-000032a0: 6765 6e65 7261 7465 2061 206e 6577 2069  generate a new i
-000032b0: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
-000032c0: 6d61 7869 6d75 6d2e 2047 726f 7570 730d  maximum. Groups.
-000032d0: 0a20 2020 206f 6620 7265 7375 6c74 7320  .    of results 
-000032e0: 6361 6e20 6265 2064 6566 696e 6564 2062  can be defined b
-000032f0: 7920 696e 636c 7564 696e 6720 7468 6520  y including the 
-00003300: 636f 6c75 6d6e 7320 7468 6174 2073 686f  columns that sho
-00003310: 756c 6420 6265 2075 7365 6420 746f 0d0a  uld be used to..
-00003320: 2020 2020 6372 6561 7465 2067 726f 7570      create group
-00003330: 732e 0d0a 0d0a 2020 2020 5061 7261 6d65  s.....    Parame
-00003340: 7465 7273 0d0a 2020 2020 2d2d 2d2d 2d2d  ters..    ------
-00003350: 2d2d 2d2d 0d0a 2020 2020 6466 203a 2044  ----..    df : D
-00003360: 6174 6146 7261 6d65 0d0a 2020 2020 2020  ataFrame..      
-00003370: 2020 4461 7461 4672 616d 6520 7468 6174    DataFrame that
-00003380: 2063 6f6e 7461 696e 7320 7265 7375 6c74   contains result
-00003390: 7320 696e 2061 2073 7065 6369 6669 6320  s in a specific 
-000033a0: 696e 7465 7276 616c 206e 6f74 6174 696f  interval notatio
-000033b0: 6e2e 0d0a 2020 2020 6772 6f75 7062 795f  n...    groupby_
-000033c0: 636f 6c73 203a 206c 6973 7420 6f66 2073  cols : list of s
-000033d0: 7472 696e 6773 0d0a 2020 2020 2020 2020  trings..        
-000033e0: 4c69 7374 206f 6620 636f 6c75 6d6e 206e  List of column n
-000033f0: 616d 6573 2074 6861 7420 7368 6f75 6c64  ames that should
-00003400: 2062 6520 7573 6564 2074 6f20 6372 6561   be used to crea
-00003410: 7465 2067 726f 7570 732e 0d0a 0d0a 2020  te groups.....  
-00003420: 2020 5265 7475 726e 730d 0a20 2020 202d    Returns..    -
-00003430: 2d2d 2d2d 2d2d 0d0a 2020 2020 6466 203a  ------..    df :
-00003440: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-00003450: 2020 2020 4461 7461 4672 616d 6520 7468      DataFrame th
-00003460: 6174 2068 6173 2074 6865 2069 6e74 6572  at has the inter
-00003470: 7661 6c20 666f 7220 7468 6520 6d61 7869  val for the maxi
-00003480: 6d75 6d20 2866 6f72 2065 6163 6820 6772  mum (for each gr
-00003490: 6f75 7020 6966 0d0a 2020 2020 2020 2020  oup if..        
-000034a0: 636f 6c75 6d6e 206e 616d 6573 2061 7265  column names are
-000034b0: 2070 726f 7669 6465 6420 666f 7220 6772   provided for gr
-000034c0: 6f75 7069 6e67 290d 0a0d 0a20 2020 2027  ouping)....    '
-000034d0: 2727 0d0a 2020 2020 0d0a 2020 2020 2320  ''..    ..    # 
-000034e0: 4372 6561 7465 2061 2063 6f70 7920 6f66  Create a copy of
-000034f0: 2074 6865 2044 6174 6146 7261 6d65 0d0a   the DataFrame..
-00003500: 2020 2020 6466 203d 2064 662e 636f 7079      df = df.copy
-00003510: 2829 0d0a 2020 2020 0d0a 2020 2020 2320  ()..    ..    # 
-00003520: 4372 6561 7465 2063 6f6c 756d 6e20 7468  Create column th
-00003530: 6174 2069 6e64 6963 6174 6573 2074 6865  at indicates the
-00003540: 2067 656e 6572 6174 6564 2073 7461 7469   generated stati
-00003550: 7374 6963 2061 6e64 2061 7070 656e 6420  stic and append 
-00003560: 746f 2067 726f 7570 696e 6720 6c69 7374  to grouping list
-00003570: 0d0a 2020 2020 6466 5b73 7461 745f 636f  ..    df[stat_co
-00003580: 6c5d 203d 2027 4d61 7869 6d75 6d27 0d0a  l] = 'Maximum'..
-00003590: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
-000035a0: 2e61 7070 656e 6428 7374 6174 5f63 6f6c  .append(stat_col
-000035b0: 290d 0a20 2020 200d 0a20 2020 2023 2044  )..    ..    # D
-000035c0: 6574 6572 6d69 6e65 206c 6566 7420 626f  etermine left bo
-000035d0: 756e 6420 616e 6420 626f 756e 6461 7279  und and boundary
-000035e0: 2066 6f72 206d 6178 696d 756d 2066 6f72   for maximum for
-000035f0: 2065 6163 6820 6772 6f75 702e 0d0a 2020   each group...  
-00003600: 2020 0d0a 2020 2020 2320 436f 6e73 6964    ..    # Consid
-00003610: 6572 2074 6865 206d 6178 696d 756d 2062  er the maximum b
-00003620: 6f75 6e64 2066 6f72 2065 6163 6820 6c65  ound for each le
-00003630: 6674 2062 6f75 6e64 6172 7920 6f70 7469  ft boundary opti
-00003640: 6f6e 2074 6f20 6465 7465 726d 696e 650d  on to determine.
-00003650: 0a20 2020 2023 2077 6865 7468 6572 2074  .    # whether t
-00003660: 6865 2062 6f75 6e64 2073 686f 756c 6420  he bound should 
-00003670: 6265 206f 7065 6e20 6f72 2063 6c6f 7365  be open or close
-00003680: 642e 0d0a 2020 2020 6c65 6674 203d 2064  d...    left = d
-00003690: 662e 6772 6f75 7062 7928 6772 6f75 7062  f.groupby(groupb
-000036a0: 795f 636f 6c73 2b5b 6c65 6674 5f62 6f75  y_cols+[left_bou
-000036b0: 6e64 6172 795f 636f 6c5d 295b 6c65 6674  ndary_col])[left
-000036c0: 5f62 6f75 6e64 5f63 6f6c 5d2e 6d61 7828  _bound_col].max(
-000036d0: 292e 756e 7374 6163 6b28 6c65 6674 5f62  ).unstack(left_b
-000036e0: 6f75 6e64 6172 795f 636f 6c29 0d0a 2020  oundary_col)..  
-000036f0: 2020 2320 4372 6561 7465 206d 6973 7369    # Create missi
-00003700: 6e67 2063 6f6c 756d 6e73 0d0a 2020 2020  ng columns..    
-00003710: 666f 7220 6974 656d 2069 6e20 5b27 4f70  for item in ['Op
-00003720: 656e 272c 2743 6c6f 7365 6427 5d3a 0d0a  en','Closed']:..
-00003730: 2020 2020 2020 2020 6966 2069 7465 6d20          if item 
-00003740: 6e6f 7420 696e 206c 6566 742e 636f 6c75  not in left.colu
-00003750: 6d6e 733a 0d0a 2020 2020 2020 2020 2020  mns:..          
-00003760: 2020 6c65 6674 5b69 7465 6d5d 203d 206e    left[item] = n
-00003770: 702e 6e61 6e0d 0a20 2020 2023 2055 7365  p.nan..    # Use
-00003780: 2074 6865 206d 6178 696d 756d 2063 6c6f   the maximum clo
-00003790: 7365 6420 626f 756e 6461 7279 2069 6620  sed boundary if 
-000037a0: 7468 6572 6520 6172 6520 6e6f 206f 7065  there are no ope
-000037b0: 6e20 626f 756e 6461 7269 6573 206f 720d  n boundaries or.
-000037c0: 0a20 2020 2023 2069 6620 7468 6520 636c  .    # if the cl
-000037d0: 6f73 6564 2062 6f75 6e64 6172 7920 6973  osed boundary is
-000037e0: 206c 6172 6765 7220 7468 616e 2074 6865   larger than the
-000037f0: 206c 6172 6765 7374 206f 7065 6e20 626f   largest open bo
-00003800: 756e 6461 7279 0d0a 2020 2020 636f 6e64  undary..    cond
-00003810: 6974 696f 6e20 3d20 286c 6566 745b 2743  ition = (left['C
-00003820: 6c6f 7365 6427 5d20 3e20 6c65 6674 5b27  losed'] > left['
-00003830: 4f70 656e 275d 2920 7c20 286c 6566 745b  Open']) | (left[
-00003840: 274f 7065 6e27 5d2e 6973 6e61 2829 290d  'Open'].isna()).
-00003850: 0a20 2020 206c 6566 745b 6c65 6674 5f62  .    left[left_b
-00003860: 6f75 6e64 6172 795f 636f 6c5d 203d 206e  oundary_col] = n
-00003870: 702e 7768 6572 6528 636f 6e64 6974 696f  p.where(conditio
-00003880: 6e2c 2743 6c6f 7365 6427 2c27 4f70 656e  n,'Closed','Open
-00003890: 2729 0d0a 2020 2020 6c65 6674 5b6c 6566  ')..    left[lef
-000038a0: 745f 626f 756e 645f 636f 6c5d 203d 206e  t_bound_col] = n
-000038b0: 702e 7768 6572 6528 636f 6e64 6974 696f  p.where(conditio
-000038c0: 6e2c 6c65 6674 5b27 436c 6f73 6564 275d  n,left['Closed']
-000038d0: 2c6c 6566 745b 274f 7065 6e27 5d29 0d0a  ,left['Open'])..
-000038e0: 2020 2020 6c65 6674 203d 206c 6566 745b      left = left[
-000038f0: 5b6c 6566 745f 626f 756e 6461 7279 5f63  [left_boundary_c
-00003900: 6f6c 2c6c 6566 745f 626f 756e 645f 636f  ol,left_bound_co
-00003910: 6c5d 5d0d 0a20 2020 200d 0a20 2020 2023  l]]..    ..    #
-00003920: 2044 6574 6572 6d69 6e65 2072 6967 6874   Determine right
-00003930: 2062 6f75 6e64 2061 6e64 2062 6f75 6e64   bound and bound
-00003940: 6172 7920 666f 7220 6d61 7869 6d75 6d20  ary for maximum 
-00003950: 666f 7220 6561 6368 2067 726f 7570 2e0d  for each group..
-00003960: 0a20 2020 200d 0a20 2020 2023 2043 6f6e  .    ..    # Con
-00003970: 7369 6465 7220 7468 6520 6d61 7869 6d75  sider the maximu
-00003980: 6d20 626f 756e 6420 666f 7220 6561 6368  m bound for each
-00003990: 2072 6967 6874 2062 6f75 6e64 6172 7920   right boundary 
-000039a0: 6f70 7469 6f6e 2074 6f20 6465 7465 726d  option to determ
-000039b0: 696e 650d 0a20 2020 2023 2077 6865 7468  ine..    # wheth
-000039c0: 6572 2074 6865 2062 6f75 6e64 2073 686f  er the bound sho
-000039d0: 756c 6420 6265 206f 7065 6e20 6f72 2063  uld be open or c
-000039e0: 6c6f 7365 642e 0d0a 2020 2020 7269 6768  losed...    righ
-000039f0: 7420 3d20 6466 2e67 726f 7570 6279 2867  t = df.groupby(g
-00003a00: 726f 7570 6279 5f63 6f6c 732b 5b72 6967  roupby_cols+[rig
-00003a10: 6874 5f62 6f75 6e64 6172 795f 636f 6c5d  ht_boundary_col]
-00003a20: 295b 7269 6768 745f 626f 756e 645f 636f  )[right_bound_co
-00003a30: 6c5d 2e6d 6178 2829 2e75 6e73 7461 636b  l].max().unstack
-00003a40: 2872 6967 6874 5f62 6f75 6e64 6172 795f  (right_boundary_
-00003a50: 636f 6c29 0d0a 2020 2020 2320 4372 6561  col)..    # Crea
-00003a60: 7465 206d 6973 7369 6e67 2063 6f6c 756d  te missing colum
-00003a70: 6e73 0d0a 2020 2020 666f 7220 6974 656d  ns..    for item
-00003a80: 2069 6e20 5b27 4f70 656e 272c 2743 6c6f   in ['Open','Clo
-00003a90: 7365 6427 5d3a 0d0a 2020 2020 2020 2020  sed']:..        
-00003aa0: 6966 2069 7465 6d20 6e6f 7420 696e 2072  if item not in r
-00003ab0: 6967 6874 2e63 6f6c 756d 6e73 3a0d 0a20  ight.columns:.. 
-00003ac0: 2020 2020 2020 2020 2020 2072 6967 6874             right
-00003ad0: 5b69 7465 6d5d 203d 206e 702e 6e61 6e0d  [item] = np.nan.
-00003ae0: 0a20 2020 2023 2055 7365 2074 6865 206d  .    # Use the m
-00003af0: 6178 696d 756d 2063 6c6f 7365 6420 626f  aximum closed bo
-00003b00: 756e 6461 7279 2069 6620 7468 6572 6520  undary if there 
-00003b10: 6172 6520 6e6f 206f 7065 6e20 626f 756e  are no open boun
-00003b20: 6461 7269 6573 206f 720d 0a20 2020 2023  daries or..    #
-00003b30: 2069 6620 7468 6520 636c 6f73 6564 2062   if the closed b
-00003b40: 6f75 6e64 6172 7920 6973 206c 6172 6765  oundary is large
-00003b50: 7220 7468 616e 206f 7220 6571 7561 6c20  r than or equal 
-00003b60: 746f 2074 6865 206c 6172 6765 7374 206f  to the largest o
-00003b70: 7065 6e20 626f 756e 6461 7279 0d0a 2020  pen boundary..  
-00003b80: 2020 636f 6e64 6974 696f 6e20 3d20 2872    condition = (r
-00003b90: 6967 6874 5b27 436c 6f73 6564 275d 203e  ight['Closed'] >
-00003ba0: 3d20 7269 6768 745b 274f 7065 6e27 5d29  = right['Open'])
-00003bb0: 207c 2028 7269 6768 745b 274f 7065 6e27   | (right['Open'
-00003bc0: 5d2e 6973 6e61 2829 290d 0a20 2020 2072  ].isna())..    r
-00003bd0: 6967 6874 5b72 6967 6874 5f62 6f75 6e64  ight[right_bound
-00003be0: 5f63 6f6c 5d20 3d20 6e70 2e77 6865 7265  _col] = np.where
-00003bf0: 2863 6f6e 6469 7469 6f6e 2c72 6967 6874  (condition,right
-00003c00: 5b27 436c 6f73 6564 275d 2c72 6967 6874  ['Closed'],right
-00003c10: 5b27 4f70 656e 275d 290d 0a20 2020 2072  ['Open'])..    r
-00003c20: 6967 6874 5b72 6967 6874 5f62 6f75 6e64  ight[right_bound
-00003c30: 6172 795f 636f 6c5d 203d 206e 702e 7768  ary_col] = np.wh
-00003c40: 6572 6528 636f 6e64 6974 696f 6e2c 2743  ere(condition,'C
-00003c50: 6c6f 7365 6427 2c27 4f70 656e 2729 0d0a  losed','Open')..
-00003c60: 2020 2020 7269 6768 7420 3d20 7269 6768      right = righ
-00003c70: 745b 5b72 6967 6874 5f62 6f75 6e64 5f63  t[[right_bound_c
-00003c80: 6f6c 2c72 6967 6874 5f62 6f75 6e64 6172  ol,right_boundar
-00003c90: 795f 636f 6c5d 5d0d 0a20 2020 200d 0a20  y_col]]..    .. 
-00003ca0: 2020 2023 204d 6572 6765 2074 6865 2074     # Merge the t
-00003cb0: 776f 2062 6f75 6e64 6172 6965 7320 746f  wo boundaries to
-00003cc0: 2063 7265 6174 6520 7468 6520 696e 7465   create the inte
-00003cd0: 7276 616c 2066 6f72 2074 6865 206d 6178  rval for the max
-00003ce0: 696d 756d 0d0a 2020 2020 2320 4368 6563  imum..    # Chec
-00003cf0: 6b20 7468 6174 2074 6865 206d 6572 6765  k that the merge
-00003d00: 2069 7320 312d 746f 2d31 0d0a 2020 2020   is 1-to-1..    
-00003d10: 6466 203d 206c 6566 742e 6d65 7267 6528  df = left.merge(
-00003d20: 7269 6768 742c 2068 6f77 203d 2027 6f75  right, how = 'ou
-00003d30: 7465 7227 2c20 6f6e 203d 2067 726f 7570  ter', on = group
-00003d40: 6279 5f63 6f6c 732c 2076 616c 6964 6174  by_cols, validat
-00003d50: 6520 3d20 2731 3a31 2729 0d0a 2020 2020  e = '1:1')..    
-00003d60: 0d0a 2020 2020 2320 5265 7365 7420 696e  ..    # Reset in
-00003d70: 6465 780d 0a20 2020 2064 6620 3d20 6466  dex..    df = df
-00003d80: 2e72 6573 6574 5f69 6e64 6578 2829 0d0a  .reset_index()..
-00003d90: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
-00003da0: 2064 660d 0a0d 0a64 6566 206d 6178 696d   df....def maxim
-00003db0: 756d 2864 662c 0d0a 2020 2020 2020 2020  um(df,..        
-00003dc0: 2020 2020 7265 7375 6c74 5f63 6f6c 2c0d      result_col,.
-00003dd0: 0a20 2020 2020 2020 2020 2020 2067 726f  .            gro
-00003de0: 7570 6279 5f63 6f6c 7320 3d20 4e6f 6e65  upby_cols = None
-00003df0: 2c0d 0a20 2020 2020 2020 2020 2020 2069  ,..            i
-00003e00: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
-00003e10: 696e 7465 7276 616c 203d 2046 616c 7365  interval = False
-00003e20: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
-00003e30: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-00003e40: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-00003e50: 7220 3d20 302e 3235 2c0d 0a20 2020 2020  r = 0.25,..     
-00003e60: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00003e70: 5f72 6f75 6e64 696e 6720 3d20 5472 7565  _rounding = True
-00003e80: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-00003e90: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
-00003ea0: 2063 6f6d 6269 6e65 7320 7468 6520 7265   combines the re
-00003eb0: 6c65 7661 6e74 206d 6178 696d 756d 2061  levant maximum a
-00003ec0: 6e64 2075 7469 6c69 7479 2066 756e 6374  nd utility funct
-00003ed0: 696f 6e73 2074 6f0d 0a20 2020 2067 656e  ions to..    gen
-00003ee0: 6572 6174 6520 7468 6520 6d61 7869 6d61  erate the maxima
-00003ef0: 2072 6573 756c 7473 2066 6f72 2067 726f   results for gro
-00003f00: 7570 7320 7769 7468 696e 2061 2044 6174  ups within a Dat
-00003f10: 6146 7261 6d65 2e0d 0a0d 0a20 2020 2050  aFrame.....    P
-00003f20: 6172 616d 6574 6572 730d 0a20 2020 202d  arameters..    -
-00003f30: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
-00003f40: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-00003f50: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-00003f60: 2074 6861 7420 636f 6e74 6169 6e73 2063   that contains c
-00003f70: 656e 736f 7265 6420 6f72 2075 6e63 656e  ensored or uncen
-00003f80: 736f 7265 6420 7265 7375 6c74 730d 0a20  sored results.. 
-00003f90: 2020 2072 6573 756c 745f 636f 6c20 3a20     result_col : 
-00003fa0: 7374 7269 6e67 0d0a 2020 2020 2020 2020  string..        
-00003fb0: 5468 6520 636f 6c75 6d6e 206e 616d 6520  The column name 
-00003fc0: 666f 7220 7468 6520 636f 6c75 6d6e 2074  for the column t
-00003fd0: 6861 7420 636f 6e74 6169 6e20 7468 6520  hat contain the 
-00003fe0: 7265 7375 6c74 7320 6173 2074 6578 742e  results as text.
-00003ff0: 0d0a 2020 2020 2020 2020 4f6e 6c79 2066  ..        Only f
-00004000: 6f75 7220 706f 7373 6962 6c65 2063 656e  our possible cen
-00004010: 736f 7273 2073 686f 756c 6420 6265 2075  sors should be u
-00004020: 7365 6420 283c 2ce2 89a4 2ce2 89a5 2c3e  sed (<,...,...,>
-00004030: 292e 0d0a 2020 2020 6772 6f75 7062 795f  )...    groupby_
-00004040: 636f 6c73 203a 206c 6973 7473 206f 6620  cols : lists of 
-00004050: 7374 7269 6e67 7320 286f 7220 6c69 7374  strings (or list
-00004060: 206f 6620 6c69 7374 7329 2c20 6f70 7469   of lists), opti
-00004070: 6f6e 616c 0d0a 2020 2020 2020 2020 4c69  onal..        Li
-00004080: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
-00004090: 6573 2074 6861 7420 7368 6f75 6c64 2062  es that should b
-000040a0: 6520 7573 6564 2074 6f20 6372 6561 7465  e used to create
-000040b0: 2067 726f 7570 732e 2041 206d 6178 696d   groups. A maxim
-000040c0: 756d 0d0a 2020 2020 2020 2020 7769 6c6c  um..        will
-000040d0: 2062 6520 666f 756e 6420 7769 7468 696e   be found within
-000040e0: 2065 6163 6820 6772 6f75 702e 204d 756c   each group. Mul
-000040f0: 7469 706c 6520 6c69 7374 7320 6361 6e20  tiple lists can 
-00004100: 6265 2073 7570 706c 6965 6420 746f 0d0a  be supplied to..
-00004110: 2020 2020 2020 2020 7065 7266 6f72 6d20          perform 
-00004120: 7365 7175 656e 7469 616c 206d 6178 696d  sequential maxim
-00004130: 6120 6265 666f 7265 2063 6f6e 7665 7274  a before convert
-00004140: 696e 6720 696e 7465 7276 616c 7320 746f  ing intervals to
-00004150: 2061 2072 6573 756c 742e 0d0a 2020 2020   a result...    
-00004160: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-00004170: 6973 204e 6f6e 652e 0d0a 2020 2020 696e  is None...    in
-00004180: 636c 7564 655f 6e65 6761 7469 7665 5f69  clude_negative_i
-00004190: 6e74 6572 7661 6c20 3a20 626f 6f6c 6561  nterval : boolea
-000041a0: 6e2c 206f 7074 696f 6e61 6c0d 0a20 2020  n, optional..   
-000041b0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-000041c0: 656e 2061 6c6c 2070 6f73 6974 6976 6520  en all positive 
-000041d0: 616e 6420 6e65 6761 7469 7665 2076 616c  and negative val
-000041e0: 7565 7320 6172 6520 636f 6e73 6964 6572  ues are consider
-000041f0: 6564 0d0a 2020 2020 2020 2020 652e 672e  ed..        e.g.
-00004200: 2c20 3c30 2e35 2077 6f75 6c64 2062 6520  , <0.5 would be 
-00004210: 636f 6e76 6572 7465 6420 746f 2028 2d6e  converted to (-n
-00004220: 702e 696e 662c 3529 2e0d 0a20 2020 2020  p.inf,5)...     
-00004230: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
-00004240: 6e20 6f6e 6c79 206e 6f6e 2d6e 6567 6174  n only non-negat
-00004250: 6976 6520 7661 6c75 6573 2061 7265 2063  ive values are c
-00004260: 6f6e 7369 6465 7265 640d 0a20 2020 2020  onsidered..     
-00004270: 2020 2065 2e67 2e2c 203c 302e 3520 776f     e.g., <0.5 wo
-00004280: 756c 6420 6265 2063 6f6e 7665 7274 6564  uld be converted
-00004290: 2074 6f20 5b30 2c35 292e 0d0a 2020 2020   to [0,5)...    
-000042a0: 2020 2020 5468 6973 2073 6574 7469 6e67      This setting
-000042b0: 206f 6e6c 7920 6166 6665 6374 7320 7265   only affects re
-000042c0: 7375 6c74 7320 6966 2066 6f63 7573 5f68  sults if focus_h
-000042d0: 6967 685f 706f 7465 6e74 6961 6c20 6973  igh_potential is
-000042e0: 2046 616c 7365 2e0d 0a20 2020 2020 2020   False...       
-000042f0: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-00004300: 4661 6c73 652e 0d0a 2020 2020 7072 6563  False...    prec
-00004310: 6973 696f 6e5f 746f 6c65 7261 6e63 655f  ision_tolerance_
-00004320: 746f 5f64 726f 705f 6365 6e73 6f72 203a  to_drop_censor :
-00004330: 2066 6c6f 6174 2c20 6f70 7469 6f6e 616c   float, optional
-00004340: 0d0a 2020 2020 2020 2020 5468 7265 7368  ..        Thresh
-00004350: 6f6c 6420 666f 7220 7265 706f 7274 696e  old for reportin
-00004360: 6720 6365 6e73 6f72 6564 2076 7320 6e6f  g censored vs no
-00004370: 6e2d 6365 6e73 6f72 6564 2072 6573 756c  n-censored resul
-00004380: 7473 2e0d 0a20 2020 2020 2020 2055 7369  ts...        Usi
-00004390: 6e67 2074 6865 2064 6566 6175 6c74 2c20  ng the default, 
-000043a0: 6120 7265 7375 6c74 2074 6861 7420 6973  a result that is
-000043b0: 206b 6e6f 776e 2074 6f20 6265 2069 6e20   known to be in 
-000043c0: 7468 6520 696e 7465 7276 616c 2028 302e  the interval (0.
-000043d0: 332c 2030 2e35 290d 0a20 2020 2020 2020  3, 0.5)..       
-000043e0: 2077 6f75 6c64 2062 6520 7265 7475 726e   would be return
-000043f0: 6564 2061 7320 302e 342c 2077 6865 7265  ed as 0.4, where
-00004400: 6173 2061 2074 6f6c 6572 616e 6365 206f  as a tolerance o
-00004410: 6620 3020 776f 756c 6420 7969 656c 6420  f 0 would yield 
-00004420: 610d 0a20 2020 2020 2020 2072 6573 756c  a..        resul
-00004430: 7420 6f66 203c 302e 3520 6f72 203e 302e  t of <0.5 or >0.
-00004440: 3320 6465 7065 6e64 696e 6720 6f6e 2074  3 depending on t
-00004450: 6865 2076 616c 7565 206f 6620 666f 6375  he value of focu
-00004460: 735f 6869 6768 6573 745f 706f 7465 6e74  s_highest_potent
-00004470: 6961 6c2e 0d0a 2020 2020 2020 2020 5468  ial...        Th
-00004480: 6520 6465 6661 756c 7420 6973 2030 2e32  e default is 0.2
-00004490: 352e 0d0a 2020 2020 7072 6563 6973 696f  5...    precisio
-000044a0: 6e5f 726f 756e 6469 6e67 203a 2062 6f6f  n_rounding : boo
-000044b0: 6c65 616e 2c20 6f70 7469 6f6e 616c 0d0a  lean, optional..
-000044c0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-000044d0: 2061 2072 6f75 6e64 696e 6720 6d65 7468   a rounding meth
-000044e0: 6f64 2069 7320 6170 706c 6965 6420 746f  od is applied to
-000044f0: 2072 6f75 6e64 2072 6573 756c 7473 2074   round results t
-00004500: 6f20 6861 7665 206e 6f20 6d6f 7265 0d0a  o have no more..
-00004510: 2020 2020 2020 2020 6465 6369 6d61 6c73          decimals
-00004520: 2074 6861 6e20 7768 6174 2063 616e 2062   than what can b
-00004530: 6520 6d65 6173 7572 6564 2e0d 0a20 2020  e measured...   
-00004540: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
-00004550: 2069 7320 5472 7565 2e0d 0a0d 0a20 2020   is True.....   
-00004560: 2052 6574 7572 6e73 0d0a 2020 2020 2d2d   Returns..    --
-00004570: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
-00004580: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
-00004590: 2020 2044 6174 6146 7261 6d65 2074 6861     DataFrame tha
-000045a0: 7420 636f 6e74 6169 6e73 2061 2063 6f6c  t contains a col
-000045b0: 756d 6e20 7769 7468 2074 6865 2072 656c  umn with the rel
-000045c0: 6576 616e 7420 6d61 7869 6d75 6d20 6f72  evant maximum or
-000045d0: 206d 6178 696d 610d 0a0d 0a20 2020 2027   maxima....    '
-000045e0: 2727 0d0a 2020 2020 0d0a 2020 2020 2320  ''..    ..    # 
-000045f0: 4372 6561 7465 2061 2063 6f70 7920 6f66  Create a copy of
-00004600: 2074 6865 2044 6174 6146 7261 6d65 0d0a   the DataFrame..
-00004610: 2020 2020 6466 203d 2064 662e 636f 7079      df = df.copy
-00004620: 2829 0d0a 2020 2020 0d0a 2020 2020 2320  ()..    ..    # 
-00004630: 5370 6c69 7420 7468 6520 7265 7375 6c74  Split the result
-00004640: 2069 6e74 6f20 6365 6e73 6f72 2061 6e64   into censor and
-00004650: 206e 756d 6572 6963 2063 6f6d 706f 6e65   numeric compone
-00004660: 6e74 730d 0a20 2020 2064 6620 3d20 7265  nts..    df = re
-00004670: 7375 6c74 5f74 6f5f 636f 6d70 6f6e 656e  sult_to_componen
-00004680: 7473 2864 662c 7265 7375 6c74 5f63 6f6c  ts(df,result_col
-00004690: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
-000046a0: 6f6e 7665 7274 2074 6865 2072 6573 756c  onvert the resul
-000046b0: 7473 2066 726f 6d20 6365 6e73 6f72 2061  ts from censor a
-000046c0: 6e64 206e 756d 6572 6963 2063 6f6d 706f  nd numeric compo
-000046d0: 6e65 6e74 7320 746f 2061 6e20 696e 7465  nents to an inte
-000046e0: 7276 616c 2072 6570 7265 7365 6e74 6174  rval representat
-000046f0: 696f 6e0d 0a20 2020 2064 6620 3d20 636f  ion..    df = co
-00004700: 6d70 6f6e 656e 7473 5f74 6f5f 696e 7465  mponents_to_inte
-00004710: 7276 616c 2864 662c 2069 6e63 6c75 6465  rval(df, include
-00004720: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
-00004730: 616c 290d 0a20 2020 200d 0a20 2020 2023  al)..    ..    #
-00004740: 2055 7369 6e67 2074 6865 2069 6e74 6572   Using the inter
-00004750: 7661 6c73 2c20 6465 7465 726d 696e 6520  vals, determine 
-00004760: 7468 6520 7261 6e67 6520 6f66 2070 6f73  the range of pos
-00004770: 7369 626c 6520 6d61 7869 6d61 0d0a 2020  sible maxima..  
-00004780: 2020 0d0a 2020 2020 2320 4966 2074 6865    ..    # If the
-00004790: 7265 2061 7265 206e 6f20 6772 6f75 7062  re are no groupb
-000047a0: 792d 636f 6c75 6d6e 732c 2074 6865 6e20  y-columns, then 
-000047b0: 7461 6b65 206d 6178 206f 6620 616c 6c20  take max of all 
-000047c0: 7265 7375 6c74 730d 0a20 2020 2069 6620  results..    if 
-000047d0: 6e6f 7420 6772 6f75 7062 795f 636f 6c73  not groupby_cols
-000047e0: 3a0d 0a20 2020 2020 2020 2064 6620 3d20  :..        df = 
-000047f0: 6d61 7869 6d75 6d5f 696e 7465 7276 616c  maximum_interval
-00004800: 2864 662c 2067 726f 7570 6279 5f63 6f6c  (df, groupby_col
-00004810: 733d 5b5d 290d 0a20 2020 2023 2049 6620  s=[])..    # If 
-00004820: 7468 6520 6772 6f75 7062 795f 636f 6c73  the groupby_cols
-00004830: 2069 7320 6120 6c69 7374 206f 6620 6c69   is a list of li
-00004840: 7374 732c 2074 6865 6e20 7065 7266 6f72  sts, then perfor
-00004850: 6d20 6d75 6c74 6970 6c65 206d 6178 696d  m multiple maxim
-00004860: 756d 730d 0a20 2020 2065 6c69 6620 6973  ums..    elif is
-00004870: 696e 7374 616e 6365 2867 726f 7570 6279  instance(groupby
-00004880: 5f63 6f6c 735b 305d 2c6c 6973 7429 3a0d  _cols[0],list):.
-00004890: 0a20 2020 2020 2020 2066 6f72 2067 726f  .        for gro
-000048a0: 7570 696e 6720 696e 2067 726f 7570 6279  uping in groupby
-000048b0: 5f63 6f6c 733a 0d0a 2020 2020 2020 2020  _cols:..        
-000048c0: 2020 2020 2320 5573 696e 6720 7468 6520      # Using the 
-000048d0: 696e 7465 7276 616c 732c 2064 6574 6572  intervals, deter
-000048e0: 6d69 6e65 2074 6865 2072 616e 6765 206f  mine the range o
-000048f0: 6620 706f 7373 6962 6c65 206d 6178 696d  f possible maxim
-00004900: 610d 0a20 2020 2020 2020 2020 2020 2064  a..            d
-00004910: 6620 3d20 6d61 7869 6d75 6d5f 696e 7465  f = maximum_inte
-00004920: 7276 616c 2864 662c 2067 726f 7570 696e  rval(df, groupin
-00004930: 6729 0d0a 2020 2020 2320 456c 7365 2074  g)..    # Else t
-00004940: 6865 2067 726f 7570 6279 5f63 6f6c 7320  he groupby_cols 
-00004950: 6973 2061 206c 6973 7420 6f66 2063 6f6c  is a list of col
-00004960: 756d 6e20 6e61 6d65 730d 0a20 2020 2065  umn names..    e
-00004970: 6c73 653a 0d0a 2020 2020 2020 2020 6466  lse:..        df
-00004980: 203d 206d 6178 696d 756d 5f69 6e74 6572   = maximum_inter
-00004990: 7661 6c28 6466 2c20 6772 6f75 7062 795f  val(df, groupby_
-000049a0: 636f 6c73 290d 0a20 2020 200d 0a20 2020  cols)..    ..   
-000049b0: 2023 2043 6f6e 7665 7274 2074 6865 2069   # Convert the i
-000049c0: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
-000049d0: 6d61 7869 6d75 6d20 696e 746f 2063 656e  maximum into cen
-000049e0: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
-000049f0: 6e6f 7461 7469 6f6e 0d0a 2020 2020 6466  notation..    df
-00004a00: 203d 2069 6e74 6572 7661 6c5f 746f 5f63   = interval_to_c
-00004a10: 6f6d 706f 6e65 6e74 7328 6466 2c0d 0a20  omponents(df,.. 
-00004a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00004a40: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
-00004a50: 6961 6c20 3d20 5472 7565 2c0d 0a20 2020  ial = True,..   
-00004a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a70: 2020 2020 2020 2020 2020 2020 2069 6e63               inc
-00004a80: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
-00004a90: 7465 7276 616c 203d 2069 6e63 6c75 6465  terval = include
-00004aa0: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
-00004ab0: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
+000018c0: 2020 2020 2020 2020 2066 6f63 7573 5f68           focus_h
+000018d0: 6967 685f 706f 7465 6e74 6961 6c20 3d20  igh_potential = 
+000018e0: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
+000018f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001900: 2020 696e 636c 7564 655f 6e65 6761 7469    include_negati
+00001910: 7665 5f69 6e74 6572 7661 6c20 3d20 4661  ve_interval = Fa
+00001920: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
+00001930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001940: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
+00001950: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
+00001960: 736f 7220 3d20 302e 3235 293a 0d0a 2020  sor = 0.25):..  
+00001970: 2020 2727 270d 0a20 2020 2041 2066 756e    '''..    A fun
+00001980: 6374 696f 6e20 7468 6174 2064 6574 6572  ction that deter
+00001990: 6d69 6e65 7320 7468 6520 6365 6e73 6f72  mines the censor
+000019a0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
+000019b0: 706f 6e65 6e74 730d 0a20 2020 2066 726f  ponents..    fro
+000019c0: 6d20 696e 7465 7276 616c 730d 0a0d 0a20  m intervals.... 
+000019d0: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+000019e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+000019f0: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
+00001a00: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
+00001a10: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
+00001a20: 6e73 2069 6e74 6572 7661 6c20 696e 666f  ns interval info
+00001a30: 726d 6174 696f 6e0d 0a20 2020 2066 6f63  rmation..    foc
+00001a40: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
+00001a50: 6c20 3a20 626f 6f6c 6561 6e2c 206f 7074  l : boolean, opt
+00001a60: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
+00001a70: 6620 5472 7565 2c20 7468 656e 2069 6e66  f True, then inf
+00001a80: 6f72 6d61 7469 6f6e 206f 6e20 7468 6520  ormation on the 
+00001a90: 6869 6768 6573 7420 706f 7465 6e74 6961  highest potentia
+00001aa0: 6c20 7265 7375 6c74 2077 696c 6c20 6265  l result will be
+00001ab0: 0d0a 2020 2020 2020 2020 666f 6375 7365  ..        focuse
+00001ac0: 6420 6f76 6572 2074 6865 206c 6f77 6573  d over the lowes
+00001ad0: 7420 706f 7465 6e74 6961 6c20 7265 7375  t potential resu
+00001ae0: 6c74 2e0d 0a20 2020 2069 6e63 6c75 6465  lt...    include
+00001af0: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
+00001b00: 616c 203a 2062 6f6f 6c65 616e 2c20 6f70  al : boolean, op
+00001b10: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
+00001b20: 4966 2054 7275 652c 2074 6865 6e20 616c  If True, then al
+00001b30: 6c20 706f 7369 7469 7665 2061 6e64 206e  l positive and n
+00001b40: 6567 6174 6976 6520 7661 6c75 6573 2061  egative values a
+00001b50: 7265 2063 6f6e 7369 6465 7265 640d 0a20  re considered.. 
+00001b60: 2020 2020 2020 2065 2e67 2e2c 203c 302e         e.g., <0.
+00001b70: 3520 776f 756c 6420 6265 2063 6f6e 7665  5 would be conve
+00001b80: 7274 6564 2074 6f20 282d 6e70 2e69 6e66  rted to (-np.inf
+00001b90: 2c35 292e 0d0a 2020 2020 2020 2020 4966  ,5)...        If
+00001ba0: 2046 616c 7365 2c20 7468 656e 206f 6e6c   False, then onl
+00001bb0: 7920 6e6f 6e2d 6e65 6761 7469 7665 2076  y non-negative v
+00001bc0: 616c 7565 7320 6172 6520 636f 6e73 6964  alues are consid
+00001bd0: 6572 6564 0d0a 2020 2020 2020 2020 652e  ered..        e.
+00001be0: 672e 2c20 3c30 2e35 2077 6f75 6c64 2062  g., <0.5 would b
+00001bf0: 6520 636f 6e76 6572 7465 6420 746f 205b  e converted to [
+00001c00: 302c 3529 2e0d 0a20 2020 2020 2020 2054  0,5)...        T
+00001c10: 6869 7320 7365 7474 696e 6720 6f6e 6c79  his setting only
+00001c20: 2061 6666 6563 7473 2072 6573 756c 7473   affects results
+00001c30: 2069 6620 666f 6375 735f 6869 6768 5f70   if focus_high_p
+00001c40: 6f74 656e 7469 616c 2069 7320 4661 6c73  otential is Fals
+00001c50: 652e 0d0a 2020 2020 2020 2020 5468 6520  e...        The 
+00001c60: 6465 6661 756c 7420 6973 2046 616c 7365  default is False
+00001c70: 2e0d 0a20 2020 2070 7265 6369 7369 6f6e  ...    precision
+00001c80: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
+00001c90: 6f70 5f63 656e 736f 7220 3a20 666c 6f61  op_censor : floa
+00001ca0: 742c 206f 7074 696f 6e61 6c0d 0a20 2020  t, optional..   
+00001cb0: 2020 2020 2054 6872 6573 686f 6c64 2066       Threshold f
+00001cc0: 6f72 2072 6570 6f72 7469 6e67 2063 656e  or reporting cen
+00001cd0: 736f 7265 6420 7673 206e 6f6e 2d63 656e  sored vs non-cen
+00001ce0: 736f 7265 6420 7265 7375 6c74 732e 0d0a  sored results...
+00001cf0: 2020 2020 2020 2020 5573 696e 6720 7468          Using th
+00001d00: 6520 6465 6661 756c 742c 2061 2072 6573  e default, a res
+00001d10: 756c 7420 7468 6174 2069 7320 6b6e 6f77  ult that is know
+00001d20: 6e20 746f 2062 6520 696e 2074 6865 2069  n to be in the i
+00001d30: 6e74 6572 7661 6c20 2830 2e33 2c20 302e  nterval (0.3, 0.
+00001d40: 3529 0d0a 2020 2020 2020 2020 776f 756c  5)..        woul
+00001d50: 6420 6265 2072 6574 7572 6e65 6420 6173  d be returned as
+00001d60: 2030 2e34 2c20 7768 6572 6561 7320 6120   0.4, whereas a 
+00001d70: 746f 6c65 7261 6e63 6520 6f66 2030 2077  tolerance of 0 w
+00001d80: 6f75 6c64 2079 6965 6c64 2061 0d0a 2020  ould yield a..  
+00001d90: 2020 2020 2020 7265 7375 6c74 206f 6620        result of 
+00001da0: 3c30 2e35 206f 7220 3e30 2e33 2064 6570  <0.5 or >0.3 dep
+00001db0: 656e 6469 6e67 206f 6e20 7468 6520 7661  ending on the va
+00001dc0: 6c75 6520 6f66 2066 6f63 7573 5f68 6967  lue of focus_hig
+00001dd0: 6865 7374 5f70 6f74 656e 7469 616c 2e0d  hest_potential..
+00001de0: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
+00001df0: 6175 6c74 2069 7320 302e 3235 2e0d 0a0d  ault is 0.25....
+00001e00: 0a20 2020 2052 6574 7572 6e73 0d0a 2020  .    Returns..  
+00001e10: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064    -------..    d
+00001e20: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
+00001e30: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
+00001e40: 2077 6865 7265 2069 6e74 6572 7661 6c73   where intervals
+00001e50: 2066 6f72 2072 6573 756c 7473 2068 6176   for results hav
+00001e60: 6520 6265 656e 2061 6e61 6c79 7365 6420  e been analysed 
+00001e70: 746f 2063 656e 736f 7220 616e 640d 0a20  to censor and.. 
+00001e80: 2020 2020 2020 206e 756d 6572 6963 2063         numeric c
+00001e90: 6f6d 706f 6e65 6e74 732e 0d0a 0d0a 2020  omponents.....  
+00001ea0: 2020 2727 270d 0a20 2020 200d 0a20 2020    '''..    ..   
+00001eb0: 2023 2043 7265 6174 6520 6120 636f 7079   # Create a copy
+00001ec0: 206f 6620 7468 6520 4461 7461 4672 616d   of the DataFram
+00001ed0: 650d 0a20 2020 2064 6620 3d20 6466 2e63  e..    df = df.c
+00001ee0: 6f70 7928 290d 0a20 2020 200d 0a20 2020  opy()..    ..   
+00001ef0: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
+00001f00: 206d 6964 706f 696e 7420 666f 7220 7468   midpoint for th
+00001f10: 6520 696e 7465 7276 616c 2069 6620 6669  e interval if fi
+00001f20: 6e69 7465 2069 6e74 6572 7661 6c0d 0a20  nite interval.. 
+00001f30: 2020 2064 665b 6d69 6470 6f69 6e74 5f63     df[midpoint_c
+00001f40: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2828  ol] = np.where((
+00001f50: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
+00001f60: 6c5d 203e 202d 6e70 2e69 6e66 2920 2620  l] > -np.inf) & 
+00001f70: 2864 665b 7269 6768 745f 626f 756e 645f  (df[right_bound_
+00001f80: 636f 6c5d 203c 206e 702e 696e 6629 2c0d  col] < np.inf),.
+00001f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001fa0: 2020 2020 2020 2020 2020 2020 2020 2030                 0
+00001fb0: 2e35 202a 2028 6466 5b6c 6566 745f 626f  .5 * (df[left_bo
+00001fc0: 756e 645f 636f 6c5d 202b 2064 665b 7269  und_col] + df[ri
+00001fd0: 6768 745f 626f 756e 645f 636f 6c5d 292c  ght_bound_col]),
+00001fe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002000: 6e70 2e6e 616e 290d 0a20 2020 200d 0a20  np.nan)..    .. 
+00002010: 2020 200d 0a20 2020 2023 2044 6566 696e     ..    # Defin
+00002020: 6520 7468 6520 636f 6e64 6974 696f 6e73  e the conditions
+00002030: 2066 6f72 2061 6e20 756e 6365 6e73 6f72   for an uncensor
+00002040: 6564 2072 6573 756c 740d 0a20 2020 2063  ed result..    c
+00002050: 6f6e 6469 7469 6f6e 7320 3d20 5b0d 0a20  onditions = [.. 
+00002060: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00002070: 626f 756e 6473 2061 7265 2065 7175 616c  bounds are equal
+00002080: 2c20 7468 656e 2074 6865 2072 6573 756c  , then the resul
+00002090: 7420 6973 2075 6e63 656e 736f 7265 640d  t is uncensored.
+000020a0: 0a20 2020 2020 2020 2028 6466 5b6c 6566  .        (df[lef
+000020b0: 745f 626f 756e 645f 636f 6c5d 203d 3d20  t_bound_col] == 
+000020c0: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
+000020d0: 6f6c 5d29 2c0d 0a20 2020 2020 2020 2023  ol]),..        #
+000020e0: 2049 6620 7468 6520 626f 756e 6473 2061   If the bounds a
+000020f0: 7265 2066 696e 6974 6520 616e 6420 7468  re finite and th
+00002100: 6520 696e 7465 7276 616c 2069 7320 7769  e interval is wi
+00002110: 7468 696e 2074 6865 2070 7265 6369 7369  thin the precisi
+00002120: 6f6e 2074 6f6c 6572 616e 6365 2c20 6176  on tolerance, av
+00002130: 6f69 6420 7468 6520 7573 6520 6f66 2063  oid the use of c
+00002140: 656e 736f 7273 0d0a 2020 2020 2020 2020  ensors..        
+00002150: 2864 665b 7269 6768 745f 626f 756e 645f  (df[right_bound_
+00002160: 636f 6c5d 202d 2064 665b 6d69 6470 6f69  col] - df[midpoi
+00002170: 6e74 5f63 6f6c 5d29 203c 3d20 6466 5b6d  nt_col]) <= df[m
+00002180: 6964 706f 696e 745f 636f 6c5d 202a 2070  idpoint_col] * p
+00002190: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
+000021a0: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
+000021b0: 720d 0a20 2020 2020 2020 205d 0d0a 2020  r..        ]..  
+000021c0: 2020 0d0a 2020 2020 6365 6e73 6f72 5f72    ..    censor_r
+000021d0: 6573 756c 7473 203d 205b 0d0a 2020 2020  esults = [..    
+000021e0: 2020 2020 2727 2c0d 0a20 2020 2020 2020      '',..       
+000021f0: 2027 270d 0a20 2020 2020 2020 205d 0d0a   ''..        ]..
+00002200: 2020 2020 0d0a 2020 2020 6e75 6d65 7269      ..    numeri
+00002210: 635f 7265 7375 6c74 7320 3d5b 0d0a 2020  c_results =[..  
+00002220: 2020 2020 2020 6466 5b6d 6964 706f 696e        df[midpoin
+00002230: 745f 636f 6c5d 2c0d 0a20 2020 2020 2020  t_col],..       
+00002240: 2064 665b 6d69 6470 6f69 6e74 5f63 6f6c   df[midpoint_col
+00002250: 5d0d 0a20 2020 2020 2020 205d 0d0a 2020  ]..        ]..  
+00002260: 2020 0d0a 2020 2020 2320 4966 2066 6f63    ..    # If foc
+00002270: 7573 6564 206f 6e20 7468 6520 6869 6768  used on the high
+00002280: 6573 7420 706f 7465 6e74 6961 6c20 7265  est potential re
+00002290: 7375 6c74 0d0a 2020 2020 6966 2066 6f63  sult..    if foc
+000022a0: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
+000022b0: 6c3a 0d0a 2020 2020 2020 2020 2320 5365  l:..        # Se
+000022c0: 7420 6365 6e73 6f72 2061 6e64 206e 756d  t censor and num
+000022d0: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
+000022e0: 666f 7220 6561 6368 2063 6f6e 6469 7469  for each conditi
+000022f0: 6f6e 0d0a 2020 2020 2020 2020 636f 6e64  on..        cond
+00002300: 6974 696f 6e73 202b 3d20 5b0d 0a20 2020  itions += [..   
+00002310: 2020 2020 2020 2020 2023 2049 6620 7468           # If th
+00002320: 6572 6520 6973 2061 6e20 696e 6669 6e69  ere is an infini
+00002330: 7465 2072 6967 6874 2062 6f75 6e64 2c20  te right bound, 
+00002340: 7468 6520 7265 7375 6c74 2069 7320 7269  the result is ri
+00002350: 6768 7420 6365 6e73 6f72 6564 0d0a 2020  ght censored..  
+00002360: 2020 2020 2020 2020 2020 2864 665b 7269            (df[ri
+00002370: 6768 745f 626f 756e 645f 636f 6c5d 203d  ght_bound_col] =
+00002380: 3d20 6e70 2e69 6e66 2920 2620 2864 665b  = np.inf) & (df[
+00002390: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d20  left_bound_col] 
+000023a0: 3e20 2d6e 702e 696e 6629 2026 2028 6466  > -np.inf) & (df
+000023b0: 5b6c 6566 745f 626f 756e 6461 7279 5f63  [left_boundary_c
+000023c0: 6f6c 5d20 3d3d 2027 4f70 656e 2729 2c0d  ol] == 'Open'),.
+000023d0: 0a20 2020 2020 2020 2020 2020 2028 6466  .            (df
+000023e0: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
+000023f0: 5d20 3d3d 206e 702e 696e 6629 2026 2028  ] == np.inf) & (
+00002400: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
+00002410: 6c5d 203e 202d 6e70 2e69 6e66 2920 2620  l] > -np.inf) & 
+00002420: 2864 665b 6c65 6674 5f62 6f75 6e64 6172  (df[left_boundar
+00002430: 795f 636f 6c5d 203d 3d20 2743 6c6f 7365  y_col] == 'Close
+00002440: 6427 292c 0d0a 2020 2020 2020 2020 2020  d'),..          
+00002450: 2020 2320 4f74 6865 7277 6973 652c 2074    # Otherwise, t
+00002460: 6865 2072 6573 756c 7420 7368 6f75 6c64  he result should
+00002470: 2062 6520 6c65 6674 2063 656e 736f 7265   be left censore
+00002480: 640d 0a20 2020 2020 2020 2020 2020 2028  d..            (
+00002490: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
+000024a0: 6f6c 5d20 3c20 6e70 2e69 6e66 2920 2620  ol] < np.inf) & 
+000024b0: 2864 665b 7269 6768 745f 626f 756e 6461  (df[right_bounda
+000024c0: 7279 5f63 6f6c 5d20 3d3d 2027 4f70 656e  ry_col] == 'Open
+000024d0: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
+000024e0: 2028 6466 5b72 6967 6874 5f62 6f75 6e64   (df[right_bound
+000024f0: 5f63 6f6c 5d20 3c20 6e70 2e69 6e66 2920  _col] < np.inf) 
+00002500: 2620 2864 665b 7269 6768 745f 626f 756e  & (df[right_boun
+00002510: 6461 7279 5f63 6f6c 5d20 3d3d 2027 436c  dary_col] == 'Cl
+00002520: 6f73 6564 2729 0d0a 2020 2020 2020 2020  osed')..        
+00002530: 2020 2020 5d0d 0a20 2020 2020 2020 200d      ]..        .
+00002540: 0a20 2020 2020 2020 2063 656e 736f 725f  .        censor_
+00002550: 7265 7375 6c74 7320 2b3d 205b 0d0a 2020  results += [..  
+00002560: 2020 2020 2020 2020 2020 273e 272c 0d0a            '>',..
+00002570: 2020 2020 2020 2020 2020 2020 27e2 89a5              '...
+00002580: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00002590: 273c 272c 0d0a 2020 2020 2020 2020 2020  '<',..          
+000025a0: 2020 27e2 89a4 270d 0a20 2020 2020 2020    '...'..       
+000025b0: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
+000025c0: 0d0a 2020 2020 2020 2020 6e75 6d65 7269  ..        numeri
+000025d0: 635f 7265 7375 6c74 7320 2b3d 205b 0d0a  c_results += [..
+000025e0: 2020 2020 2020 2020 2020 2020 6466 5b6c              df[l
+000025f0: 6566 745f 626f 756e 645f 636f 6c5d 2c0d  eft_bound_col],.
+00002600: 0a20 2020 2020 2020 2020 2020 2064 665b  .            df[
+00002610: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d2c  left_bound_col],
+00002620: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
+00002630: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
+00002640: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00002650: 6466 5b72 6967 6874 5f62 6f75 6e64 5f63  df[right_bound_c
+00002660: 6f6c 5d0d 0a20 2020 2020 2020 2020 2020  ol]..           
+00002670: 205d 0d0a 2020 2020 2320 456c 7365 2066   ]..    # Else f
+00002680: 6f63 7573 6564 206f 6e20 7468 6520 6c6f  ocused on the lo
+00002690: 7765 7374 2070 6f74 656e 7469 616c 2072  west potential r
+000026a0: 6573 756c 740d 0a20 2020 2065 6c73 653a  esult..    else:
+000026b0: 0d0a 2020 2020 2020 2020 2320 4465 7465  ..        # Dete
+000026c0: 726d 696e 6520 7468 6520 6c6f 7765 7220  rmine the lower 
+000026d0: 626f 756e 640d 0a20 2020 2020 2020 2069  bound..        i
+000026e0: 6620 696e 636c 7564 655f 6e65 6761 7469  f include_negati
+000026f0: 7665 5f69 6e74 6572 7661 6c3a 0d0a 2020  ve_interval:..  
+00002700: 2020 2020 2020 2020 2020 6c6f 7765 725f            lower_
+00002710: 626f 756e 6420 3d20 2d6e 702e 696e 660d  bound = -np.inf.
+00002720: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00002730: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
+00002740: 725f 626f 756e 6420 3d20 302e 300d 0a20  r_bound = 0.0.. 
+00002750: 2020 2020 2020 2023 2053 6574 2063 656e         # Set cen
+00002760: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
+00002770: 636f 6d70 6f6e 656e 7473 2066 6f72 2065  components for e
+00002780: 6163 6820 636f 6e64 6974 696f 6e0d 0a20  ach condition.. 
+00002790: 2020 2020 2020 2063 6f6e 6469 7469 6f6e         condition
+000027a0: 7320 2b3d 205b 0d0a 2020 2020 2020 2020  s += [..        
+000027b0: 2020 2020 2320 4966 2074 6865 206c 6566      # If the lef
+000027c0: 7420 626f 756e 6420 6973 2069 6465 6e74  t bound is ident
+000027d0: 6963 616c 2074 6f20 7468 6520 6c6f 7765  ical to the lowe
+000027e0: 7374 2070 6f74 656e 7469 616c 206c 6f77  st potential low
+000027f0: 6572 2062 6f75 6e64 2c0d 0a20 2020 2020  er bound,..     
+00002800: 2020 2020 2020 2023 2074 6865 6e20 7468         # then th
+00002810: 6520 7265 7375 6c74 2069 7320 6c65 6674  e result is left
+00002820: 2063 656e 736f 7265 640d 0a20 2020 2020   censored..     
+00002830: 2020 2020 2020 2028 6466 5b6c 6566 745f         (df[left_
+00002840: 626f 756e 645f 636f 6c5d 203d 3d20 6c6f  bound_col] == lo
+00002850: 7765 725f 626f 756e 6429 2026 2028 6466  wer_bound) & (df
+00002860: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
+00002870: 5d20 3c20 6e70 2e69 6e66 2920 2620 2864  ] < np.inf) & (d
+00002880: 665b 7269 6768 745f 626f 756e 6461 7279  f[right_boundary
+00002890: 5f63 6f6c 5d20 3d3d 2027 4f70 656e 2729  _col] == 'Open')
+000028a0: 2c0d 0a20 2020 2020 2020 2020 2020 2028  ,..            (
+000028b0: 6466 5b6c 6566 745f 626f 756e 645f 636f  df[left_bound_co
+000028c0: 6c5d 203d 3d20 6c6f 7765 725f 626f 756e  l] == lower_boun
+000028d0: 6429 2026 2028 6466 5b72 6967 6874 5f62  d) & (df[right_b
+000028e0: 6f75 6e64 5f63 6f6c 5d20 3c20 6e70 2e69  ound_col] < np.i
+000028f0: 6e66 2920 2620 2864 665b 7269 6768 745f  nf) & (df[right_
+00002900: 626f 756e 6461 7279 5f63 6f6c 5d20 3d3d  boundary_col] ==
+00002910: 2027 436c 6f73 6564 2729 2c0d 0a20 2020   'Closed'),..   
+00002920: 2020 2020 2020 2020 2023 204f 7468 6572           # Other
+00002930: 7769 7365 2c20 7468 6520 7265 7375 6c74  wise, the result
+00002940: 2073 686f 756c 6420 6265 2072 6967 6874   should be right
+00002950: 2063 656e 736f 7265 640d 0a20 2020 2020   censored..     
+00002960: 2020 2020 2020 2028 6466 5b6c 6566 745f         (df[left_
+00002970: 626f 756e 645f 636f 6c5d 203e 206c 6f77  bound_col] > low
+00002980: 6572 5f62 6f75 6e64 2920 2620 2864 665b  er_bound) & (df[
+00002990: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+000029a0: 6c5d 203d 3d20 274f 7065 6e27 292c 0d0a  l] == 'Open'),..
+000029b0: 2020 2020 2020 2020 2020 2020 2864 665b              (df[
+000029c0: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d20  left_bound_col] 
+000029d0: 3e20 6c6f 7765 725f 626f 756e 6429 2026  > lower_bound) &
+000029e0: 2028 6466 5b6c 6566 745f 626f 756e 6461   (df[left_bounda
+000029f0: 7279 5f63 6f6c 5d20 3d3d 2027 436c 6f73  ry_col] == 'Clos
+00002a00: 6564 2729 0d0a 2020 2020 2020 2020 2020  ed')..          
+00002a10: 2020 5d0d 0a20 2020 2020 2020 200d 0a20    ]..        .. 
+00002a20: 2020 2020 2020 2063 656e 736f 725f 7265         censor_re
+00002a30: 7375 6c74 7320 2b3d 205b 0d0a 2020 2020  sults += [..    
+00002a40: 2020 2020 2020 2020 273c 272c 0d0a 2020          '<',..  
+00002a50: 2020 2020 2020 2020 2020 27e2 89a4 272c            '...',
+00002a60: 0d0a 2020 2020 2020 2020 2020 2020 273e  ..            '>
+00002a70: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00002a80: 27e2 89a5 270d 0a20 2020 2020 2020 2020  '...'..         
+00002a90: 2020 205d 0d0a 2020 2020 2020 2020 0d0a     ]..        ..
+00002aa0: 2020 2020 2020 2020 6e75 6d65 7269 635f          numeric_
+00002ab0: 7265 7375 6c74 7320 2b3d 205b 0d0a 2020  results += [..  
+00002ac0: 2020 2020 2020 2020 2020 6466 5b72 6967            df[rig
+00002ad0: 6874 5f62 6f75 6e64 5f63 6f6c 5d2c 0d0a  ht_bound_col],..
+00002ae0: 2020 2020 2020 2020 2020 2020 6466 5b72              df[r
+00002af0: 6967 6874 5f62 6f75 6e64 5f63 6f6c 5d2c  ight_bound_col],
+00002b00: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
+00002b10: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
+00002b20: 2c0d 0a20 2020 2020 2020 2020 2020 2064  ,..            d
+00002b30: 665b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  f[left_bound_col
+00002b40: 5d0d 0a20 2020 2020 2020 2020 2020 205d  ]..            ]
+00002b50: 0d0a 2020 2020 0d0a 2020 2020 2320 4465  ..    ..    # De
+00002b60: 7465 726d 696e 6520 7468 6520 6365 6e73  termine the cens
+00002b70: 6f72 2061 6e64 206e 756d 6572 6963 2063  or and numeric c
+00002b80: 6f6d 706f 6e65 6e74 730d 0a20 2020 2023  omponents..    #
+00002b90: 2049 6620 6e6f 2063 6f6e 6469 7469 6f6e   If no condition
+00002ba0: 2069 7320 6d65 742c 2064 6566 6175 6c74   is met, default
+00002bb0: 2074 6f20 3c3e 2061 6e64 204e 614e 0d0a   to <> and NaN..
+00002bc0: 2020 2020 6466 5b63 656e 736f 725f 636f      df[censor_co
+00002bd0: 6c5d 203d 206e 702e 7365 6c65 6374 2863  l] = np.select(c
+00002be0: 6f6e 6469 7469 6f6e 732c 2063 656e 736f  onditions, censo
+00002bf0: 725f 7265 7375 6c74 732c 2027 3c3e 2729  r_results, '<>')
+00002c00: 0d0a 2020 2020 6466 5b6e 756d 6572 6963  ..    df[numeric
+00002c10: 5f63 6f6c 5d20 3d20 6e70 2e73 656c 6563  _col] = np.selec
+00002c20: 7428 636f 6e64 6974 696f 6e73 2c20 6e75  t(conditions, nu
+00002c30: 6d65 7269 635f 7265 7375 6c74 732c 206e  meric_results, n
+00002c40: 702e 6e61 6e29 0d0a 2020 2020 0d0a 2020  p.nan)..    ..  
+00002c50: 2020 7265 7475 726e 2064 660d 0a0d 0a23    return df....#
+00002c60: 2525 2520 496e 7465 7276 616c 2063 6f6d  %%% Interval com
+00002c70: 706f 6e65 6e74 7320 746f 2069 6e74 6572  ponents to inter
+00002c80: 7661 6c20 7374 7269 6e67 0d0a 0d0a 6465  val string....de
+00002c90: 6620 696e 7465 7276 616c 5f6e 6f74 6174  f interval_notat
+00002ca0: 696f 6e28 6466 2c0d 0a20 2020 2020 2020  ion(df,..       
+00002cb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00002cc0: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
+00002cd0: 673d 5472 7565 293a 0d0a 2020 2020 2727  g=True):..    ''
+00002ce0: 270d 0a20 2020 2054 6869 7320 6675 6e63  '..    This func
+00002cf0: 7469 6f6e 2063 7265 6174 6573 2061 2063  tion creates a c
+00002d00: 6f6c 756d 6e20 7468 6174 2063 6f6d 6269  olumn that combi
+00002d10: 6e65 7320 7468 6520 696e 7465 7276 616c  nes the interval
+00002d20: 2063 6f6d 706f 6e65 6e74 730d 0a20 2020   components..   
+00002d30: 2069 6e74 6f20 6120 7369 6e67 6c65 2074   into a single t
+00002d40: 6578 7420 6e6f 7461 7469 6f6e 2066 6f72  ext notation for
+00002d50: 2069 6e74 6572 7661 6c73 2e0d 0a0d 0a20   intervals..... 
+00002d60: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+00002d70: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+00002d80: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
+00002d90: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
+00002da0: 7261 6d65 2063 6f6e 7461 696e 696e 6720  rame containing 
+00002db0: 636f 6c75 6d6e 7320 666f 7220 6c65 6674  columns for left
+00002dc0: 2f72 6967 6874 2062 6f75 6e64 7320 616e  /right bounds an
+00002dd0: 6420 626f 756e 6461 7269 6573 0d0a 2020  d boundaries..  
+00002de0: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
+00002df0: 6469 6e67 203a 2062 6f6f 6c65 616e 2c20  ding : boolean, 
+00002e00: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+00002e10: 2020 4966 2054 7275 652c 2061 2072 6f75    If True, a rou
+00002e20: 6e64 696e 6720 6d65 7468 6f64 2069 7320  nding method is 
+00002e30: 6170 706c 6965 6420 746f 2072 6f75 6e64  applied to round
+00002e40: 2072 6573 756c 7473 2074 6f20 6861 7665   results to have
+00002e50: 206e 6f20 6d6f 7265 0d0a 2020 2020 2020   no more..      
+00002e60: 2020 6465 6369 6d61 6c73 2074 6861 6e20    decimals than 
+00002e70: 7768 6174 2063 616e 2062 6520 6d65 6173  what can be meas
+00002e80: 7572 6564 2e0d 0a20 2020 2020 2020 2054  ured...        T
+00002e90: 6865 2064 6566 6175 6c74 2069 7320 5472  he default is Tr
+00002ea0: 7565 2e0d 0a0d 0a20 2020 2052 6574 7572  ue.....    Retur
+00002eb0: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
+00002ec0: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
+00002ed0: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
+00002ee0: 6146 7261 6d65 2069 6465 6e74 6963 616c  aFrame identical
+00002ef0: 2074 6f20 696e 7470 7574 2077 6974 6820   to intput with 
+00002f00: 6164 6469 7469 6f6e 616c 2063 6f6c 756d  additional colum
+00002f10: 6e20 7769 7468 2063 6f6d 6269 6e65 640d  n with combined.
+00002f20: 0a20 2020 2020 2020 2069 6e74 6572 7661  .        interva
+00002f30: 6c20 6e6f 7461 7469 6f6e 0d0a 0d0a 2020  l notation....  
+00002f40: 2020 2727 270d 0a20 2020 200d 0a20 2020    '''..    ..   
+00002f50: 2023 2043 7265 6174 6520 6120 636f 7079   # Create a copy
+00002f60: 206f 6620 7468 6520 4461 7461 4672 616d   of the DataFram
+00002f70: 650d 0a20 2020 2064 6620 3d20 6466 2e63  e..    df = df.c
+00002f80: 6f70 7928 290d 0a20 2020 200d 0a20 2020  opy()..    ..   
+00002f90: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
+00002fa0: 206c 6566 7420 626f 756e 6461 7279 2073   left boundary s
+00002fb0: 796d 626f 6c0d 0a20 2020 2064 665b 696e  ymbol..    df[in
+00002fc0: 7465 7276 616c 5f63 6f6c 5d20 3d20 6e70  terval_col] = np
+00002fd0: 2e77 6865 7265 2864 665b 6c65 6674 5f62  .where(df[left_b
+00002fe0: 6f75 6e64 6172 795f 636f 6c5d 203d 3d20  oundary_col] == 
+00002ff0: 274f 7065 6e27 2c20 2728 272c 2027 5b27  'Open', '(', '['
+00003000: 290d 0a20 2020 200d 0a20 2020 2023 2049  )..    ..    # I
+00003010: 6e63 6f72 706f 7261 7465 206c 6566 7420  ncorporate left 
+00003020: 616e 6420 7269 6768 7420 626f 756e 6473  and right bounds
+00003030: 0d0a 2020 2020 6966 2070 7265 6369 7369  ..    if precisi
+00003040: 6f6e 5f72 6f75 6e64 696e 673a 0d0a 2020  on_rounding:..  
+00003050: 2020 2020 2020 6466 5b69 6e74 6572 7661        df[interva
+00003060: 6c5f 636f 6c5d 202b 3d20 6466 5b6c 6566  l_col] += df[lef
+00003070: 745f 626f 756e 645f 636f 6c5d 2e61 7070  t_bound_col].app
+00003080: 6c79 2873 7472 696e 675f 7072 6563 6973  ly(string_precis
+00003090: 696f 6e29 202b 2027 2c20 2720 2b20 6466  ion) + ', ' + df
+000030a0: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
+000030b0: 5d2e 6170 706c 7928 7374 7269 6e67 5f70  ].apply(string_p
+000030c0: 7265 6369 7369 6f6e 290d 0a20 2020 2065  recision)..    e
+000030d0: 6c73 653a 0d0a 2020 2020 2020 2020 6466  lse:..        df
+000030e0: 5b69 6e74 6572 7661 6c5f 636f 6c5d 202b  [interval_col] +
+000030f0: 3d20 6466 5b6c 6566 745f 626f 756e 645f  = df[left_bound_
+00003100: 636f 6c5d 2e61 7374 7970 6528 7374 7229  col].astype(str)
+00003110: 202b 2027 2c20 2720 2b20 6466 5b72 6967   + ', ' + df[rig
+00003120: 6874 5f62 6f75 6e64 5f63 6f6c 5d2e 6173  ht_bound_col].as
+00003130: 7479 7065 2873 7472 290d 0a20 2020 200d  type(str)..    .
+00003140: 0a20 2020 2023 2044 6574 6572 6d69 6e65  .    # Determine
+00003150: 2074 6865 2072 6967 6874 2062 6f75 6e64   the right bound
+00003160: 6172 7920 7379 6d62 6f6c 0d0a 2020 2020  ary symbol..    
+00003170: 6466 5b69 6e74 6572 7661 6c5f 636f 6c5d  df[interval_col]
+00003180: 202b 3d20 6e70 2e77 6865 7265 2864 665b   += np.where(df[
+00003190: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
+000031a0: 6f6c 5d2e 6973 696e 285b 274f 7065 6e27  ol].isin(['Open'
+000031b0: 5d29 2c20 2729 272c 2027 5d27 290d 0a20  ]), ')', ']').. 
+000031c0: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
+000031d0: 6466 0d0a 0d0a 0d0a 2325 2520 4d61 7869  df......#%% Maxi
+000031e0: 6d75 6d20 5265 7375 6c74 0d0a 0d0a 6465  mum Result....de
+000031f0: 6620 6d61 7869 6d75 6d5f 696e 7465 7276  f maximum_interv
+00003200: 616c 2864 662c 0d0a 2020 2020 2020 2020  al(df,..        
+00003210: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+00003220: 7570 6279 5f63 6f6c 7329 3a0d 0a20 2020  upby_cols):..   
+00003230: 2027 2727 0d0a 2020 2020 4120 6675 6e63   '''..    A func
+00003240: 7469 6f6e 2074 6861 7420 616e 616c 7973  tion that analys
+00003250: 6573 2074 6865 2069 6e74 6572 7661 6c20  es the interval 
+00003260: 6e6f 7461 7469 6f6e 2066 6f72 6d20 6f66  notation form of
+00003270: 2072 6573 756c 7473 2072 6574 7572 6e65   results returne
+00003280: 640d 0a20 2020 2066 726f 6d20 636f 6d70  d..    from comp
+00003290: 6f6e 656e 7473 5f74 6f5f 696e 7465 7276  onents_to_interv
+000032a0: 616c 2074 6f20 6765 6e65 7261 7465 2061  al to generate a
+000032b0: 206e 6577 2069 6e74 6572 7661 6c20 666f   new interval fo
+000032c0: 7220 7468 6520 6d61 7869 6d75 6d2e 2047  r the maximum. G
+000032d0: 726f 7570 730d 0a20 2020 206f 6620 7265  roups..    of re
+000032e0: 7375 6c74 7320 6361 6e20 6265 2064 6566  sults can be def
+000032f0: 696e 6564 2062 7920 696e 636c 7564 696e  ined by includin
+00003300: 6720 7468 6520 636f 6c75 6d6e 7320 7468  g the columns th
+00003310: 6174 2073 686f 756c 6420 6265 2075 7365  at should be use
+00003320: 6420 746f 0d0a 2020 2020 6372 6561 7465  d to..    create
+00003330: 2067 726f 7570 732e 0d0a 0d0a 2020 2020   groups.....    
+00003340: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+00003350: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+00003360: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
+00003370: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
+00003380: 6520 7468 6174 2063 6f6e 7461 696e 7320  e that contains 
+00003390: 7265 7375 6c74 7320 696e 2061 2073 7065  results in a spe
+000033a0: 6369 6669 6320 696e 7465 7276 616c 206e  cific interval n
+000033b0: 6f74 6174 696f 6e2e 0d0a 2020 2020 6772  otation...    gr
+000033c0: 6f75 7062 795f 636f 6c73 203a 206c 6973  oupby_cols : lis
+000033d0: 7420 6f66 2073 7472 696e 6773 0d0a 2020  t of strings..  
+000033e0: 2020 2020 2020 4c69 7374 206f 6620 636f        List of co
+000033f0: 6c75 6d6e 206e 616d 6573 2074 6861 7420  lumn names that 
+00003400: 7368 6f75 6c64 2062 6520 7573 6564 2074  should be used t
+00003410: 6f20 6372 6561 7465 2067 726f 7570 732e  o create groups.
+00003420: 0d0a 0d0a 2020 2020 5265 7475 726e 730d  ....    Returns.
+00003430: 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a 2020  .    -------..  
+00003440: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
+00003450: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
+00003460: 616d 6520 7468 6174 2068 6173 2074 6865  ame that has the
+00003470: 2069 6e74 6572 7661 6c20 666f 7220 7468   interval for th
+00003480: 6520 6d61 7869 6d75 6d20 2866 6f72 2065  e maximum (for e
+00003490: 6163 6820 6772 6f75 7020 6966 0d0a 2020  ach group if..  
+000034a0: 2020 2020 2020 636f 6c75 6d6e 206e 616d        column nam
+000034b0: 6573 2061 7265 2070 726f 7669 6465 6420  es are provided 
+000034c0: 666f 7220 6772 6f75 7069 6e67 290d 0a0d  for grouping)...
+000034d0: 0a20 2020 2027 2727 0d0a 2020 2020 0d0a  .    '''..    ..
+000034e0: 2020 2020 2320 4372 6561 7465 2061 2063      # Create a c
+000034f0: 6f70 7920 6f66 2074 6865 2044 6174 6146  opy of the DataF
+00003500: 7261 6d65 0d0a 2020 2020 6466 203d 2064  rame..    df = d
+00003510: 662e 636f 7079 2829 0d0a 2020 2020 0d0a  f.copy()..    ..
+00003520: 2020 2020 2320 4372 6561 7465 2063 6f6c      # Create col
+00003530: 756d 6e20 7468 6174 2069 6e64 6963 6174  umn that indicat
+00003540: 6573 2074 6865 2067 656e 6572 6174 6564  es the generated
+00003550: 2073 7461 7469 7374 6963 2061 6e64 2061   statistic and a
+00003560: 7070 656e 6420 746f 2067 726f 7570 696e  ppend to groupin
+00003570: 6720 6c69 7374 0d0a 2020 2020 6466 5b73  g list..    df[s
+00003580: 7461 745f 636f 6c5d 203d 2027 4d61 7869  tat_col] = 'Maxi
+00003590: 6d75 6d27 0d0a 2020 2020 6772 6f75 7062  mum'..    groupb
+000035a0: 795f 636f 6c73 2e61 7070 656e 6428 7374  y_cols.append(st
+000035b0: 6174 5f63 6f6c 290d 0a20 2020 200d 0a20  at_col)..    .. 
+000035c0: 2020 2023 2044 6574 6572 6d69 6e65 206c     # Determine l
+000035d0: 6566 7420 626f 756e 6420 616e 6420 626f  eft bound and bo
+000035e0: 756e 6461 7279 2066 6f72 206d 6178 696d  undary for maxim
+000035f0: 756d 2066 6f72 2065 6163 6820 6772 6f75  um for each grou
+00003600: 702e 0d0a 2020 2020 0d0a 2020 2020 2320  p...    ..    # 
+00003610: 436f 6e73 6964 6572 2074 6865 206d 6178  Consider the max
+00003620: 696d 756d 2062 6f75 6e64 2066 6f72 2065  imum bound for e
+00003630: 6163 6820 6c65 6674 2062 6f75 6e64 6172  ach left boundar
+00003640: 7920 6f70 7469 6f6e 2074 6f20 6465 7465  y option to dete
+00003650: 726d 696e 650d 0a20 2020 2023 2077 6865  rmine..    # whe
+00003660: 7468 6572 2074 6865 2062 6f75 6e64 2073  ther the bound s
+00003670: 686f 756c 6420 6265 206f 7065 6e20 6f72  hould be open or
+00003680: 2063 6c6f 7365 642e 0d0a 2020 2020 6c65   closed...    le
+00003690: 6674 203d 2064 662e 6772 6f75 7062 7928  ft = df.groupby(
+000036a0: 6772 6f75 7062 795f 636f 6c73 2b5b 6c65  groupby_cols+[le
+000036b0: 6674 5f62 6f75 6e64 6172 795f 636f 6c5d  ft_boundary_col]
+000036c0: 295b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  )[left_bound_col
+000036d0: 5d2e 6d61 7828 292e 756e 7374 6163 6b28  ].max().unstack(
+000036e0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+000036f0: 6c29 0d0a 2020 2020 2320 4372 6561 7465  l)..    # Create
+00003700: 206d 6973 7369 6e67 2063 6f6c 756d 6e73   missing columns
+00003710: 0d0a 2020 2020 666f 7220 6974 656d 2069  ..    for item i
+00003720: 6e20 5b27 4f70 656e 272c 2743 6c6f 7365  n ['Open','Close
+00003730: 6427 5d3a 0d0a 2020 2020 2020 2020 6966  d']:..        if
+00003740: 2069 7465 6d20 6e6f 7420 696e 206c 6566   item not in lef
+00003750: 742e 636f 6c75 6d6e 733a 0d0a 2020 2020  t.columns:..    
+00003760: 2020 2020 2020 2020 6c65 6674 5b69 7465          left[ite
+00003770: 6d5d 203d 206e 702e 6e61 6e0d 0a20 2020  m] = np.nan..   
+00003780: 2023 2055 7365 2074 6865 206d 6178 696d   # Use the maxim
+00003790: 756d 2063 6c6f 7365 6420 626f 756e 6461  um closed bounda
+000037a0: 7279 2069 6620 7468 6572 6520 6172 6520  ry if there are 
+000037b0: 6e6f 206f 7065 6e20 626f 756e 6461 7269  no open boundari
+000037c0: 6573 206f 720d 0a20 2020 2023 2069 6620  es or..    # if 
+000037d0: 7468 6520 636c 6f73 6564 2062 6f75 6e64  the closed bound
+000037e0: 6172 7920 6973 206c 6172 6765 7220 7468  ary is larger th
+000037f0: 616e 2074 6865 206c 6172 6765 7374 206f  an the largest o
+00003800: 7065 6e20 626f 756e 6461 7279 0d0a 2020  pen boundary..  
+00003810: 2020 636f 6e64 6974 696f 6e20 3d20 286c    condition = (l
+00003820: 6566 745b 2743 6c6f 7365 6427 5d20 3e20  eft['Closed'] > 
+00003830: 6c65 6674 5b27 4f70 656e 275d 2920 7c20  left['Open']) | 
+00003840: 286c 6566 745b 274f 7065 6e27 5d2e 6973  (left['Open'].is
+00003850: 6e61 2829 290d 0a20 2020 206c 6566 745b  na())..    left[
+00003860: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+00003870: 6c5d 203d 206e 702e 7768 6572 6528 636f  l] = np.where(co
+00003880: 6e64 6974 696f 6e2c 2743 6c6f 7365 6427  ndition,'Closed'
+00003890: 2c27 4f70 656e 2729 0d0a 2020 2020 6c65  ,'Open')..    le
+000038a0: 6674 5b6c 6566 745f 626f 756e 645f 636f  ft[left_bound_co
+000038b0: 6c5d 203d 206e 702e 7768 6572 6528 636f  l] = np.where(co
+000038c0: 6e64 6974 696f 6e2c 6c65 6674 5b27 436c  ndition,left['Cl
+000038d0: 6f73 6564 275d 2c6c 6566 745b 274f 7065  osed'],left['Ope
+000038e0: 6e27 5d29 0d0a 2020 2020 6c65 6674 203d  n'])..    left =
+000038f0: 206c 6566 745b 5b6c 6566 745f 626f 756e   left[[left_boun
+00003900: 6461 7279 5f63 6f6c 2c6c 6566 745f 626f  dary_col,left_bo
+00003910: 756e 645f 636f 6c5d 5d0d 0a20 2020 200d  und_col]]..    .
+00003920: 0a20 2020 2023 2044 6574 6572 6d69 6e65  .    # Determine
+00003930: 2072 6967 6874 2062 6f75 6e64 2061 6e64   right bound and
+00003940: 2062 6f75 6e64 6172 7920 666f 7220 6d61   boundary for ma
+00003950: 7869 6d75 6d20 666f 7220 6561 6368 2067  ximum for each g
+00003960: 726f 7570 2e0d 0a20 2020 200d 0a20 2020  roup...    ..   
+00003970: 2023 2043 6f6e 7369 6465 7220 7468 6520   # Consider the 
+00003980: 6d61 7869 6d75 6d20 626f 756e 6420 666f  maximum bound fo
+00003990: 7220 6561 6368 2072 6967 6874 2062 6f75  r each right bou
+000039a0: 6e64 6172 7920 6f70 7469 6f6e 2074 6f20  ndary option to 
+000039b0: 6465 7465 726d 696e 650d 0a20 2020 2023  determine..    #
+000039c0: 2077 6865 7468 6572 2074 6865 2062 6f75   whether the bou
+000039d0: 6e64 2073 686f 756c 6420 6265 206f 7065  nd should be ope
+000039e0: 6e20 6f72 2063 6c6f 7365 642e 0d0a 2020  n or closed...  
+000039f0: 2020 7269 6768 7420 3d20 6466 2e67 726f    right = df.gro
+00003a00: 7570 6279 2867 726f 7570 6279 5f63 6f6c  upby(groupby_col
+00003a10: 732b 5b72 6967 6874 5f62 6f75 6e64 6172  s+[right_boundar
+00003a20: 795f 636f 6c5d 295b 7269 6768 745f 626f  y_col])[right_bo
+00003a30: 756e 645f 636f 6c5d 2e6d 6178 2829 2e75  und_col].max().u
+00003a40: 6e73 7461 636b 2872 6967 6874 5f62 6f75  nstack(right_bou
+00003a50: 6e64 6172 795f 636f 6c29 0d0a 2020 2020  ndary_col)..    
+00003a60: 2320 4372 6561 7465 206d 6973 7369 6e67  # Create missing
+00003a70: 2063 6f6c 756d 6e73 0d0a 2020 2020 666f   columns..    fo
+00003a80: 7220 6974 656d 2069 6e20 5b27 4f70 656e  r item in ['Open
+00003a90: 272c 2743 6c6f 7365 6427 5d3a 0d0a 2020  ','Closed']:..  
+00003aa0: 2020 2020 2020 6966 2069 7465 6d20 6e6f        if item no
+00003ab0: 7420 696e 2072 6967 6874 2e63 6f6c 756d  t in right.colum
+00003ac0: 6e73 3a0d 0a20 2020 2020 2020 2020 2020  ns:..           
+00003ad0: 2072 6967 6874 5b69 7465 6d5d 203d 206e   right[item] = n
+00003ae0: 702e 6e61 6e0d 0a20 2020 2023 2055 7365  p.nan..    # Use
+00003af0: 2074 6865 206d 6178 696d 756d 2063 6c6f   the maximum clo
+00003b00: 7365 6420 626f 756e 6461 7279 2069 6620  sed boundary if 
+00003b10: 7468 6572 6520 6172 6520 6e6f 206f 7065  there are no ope
+00003b20: 6e20 626f 756e 6461 7269 6573 206f 720d  n boundaries or.
+00003b30: 0a20 2020 2023 2069 6620 7468 6520 636c  .    # if the cl
+00003b40: 6f73 6564 2062 6f75 6e64 6172 7920 6973  osed boundary is
+00003b50: 206c 6172 6765 7220 7468 616e 206f 7220   larger than or 
+00003b60: 6571 7561 6c20 746f 2074 6865 206c 6172  equal to the lar
+00003b70: 6765 7374 206f 7065 6e20 626f 756e 6461  gest open bounda
+00003b80: 7279 0d0a 2020 2020 636f 6e64 6974 696f  ry..    conditio
+00003b90: 6e20 3d20 2872 6967 6874 5b27 436c 6f73  n = (right['Clos
+00003ba0: 6564 275d 203e 3d20 7269 6768 745b 274f  ed'] >= right['O
+00003bb0: 7065 6e27 5d29 207c 2028 7269 6768 745b  pen']) | (right[
+00003bc0: 274f 7065 6e27 5d2e 6973 6e61 2829 290d  'Open'].isna()).
+00003bd0: 0a20 2020 2072 6967 6874 5b72 6967 6874  .    right[right
+00003be0: 5f62 6f75 6e64 5f63 6f6c 5d20 3d20 6e70  _bound_col] = np
+00003bf0: 2e77 6865 7265 2863 6f6e 6469 7469 6f6e  .where(condition
+00003c00: 2c72 6967 6874 5b27 436c 6f73 6564 275d  ,right['Closed']
+00003c10: 2c72 6967 6874 5b27 4f70 656e 275d 290d  ,right['Open']).
+00003c20: 0a20 2020 2072 6967 6874 5b72 6967 6874  .    right[right
+00003c30: 5f62 6f75 6e64 6172 795f 636f 6c5d 203d  _boundary_col] =
+00003c40: 206e 702e 7768 6572 6528 636f 6e64 6974   np.where(condit
+00003c50: 696f 6e2c 2743 6c6f 7365 6427 2c27 4f70  ion,'Closed','Op
+00003c60: 656e 2729 0d0a 2020 2020 7269 6768 7420  en')..    right 
+00003c70: 3d20 7269 6768 745b 5b72 6967 6874 5f62  = right[[right_b
+00003c80: 6f75 6e64 5f63 6f6c 2c72 6967 6874 5f62  ound_col,right_b
+00003c90: 6f75 6e64 6172 795f 636f 6c5d 5d0d 0a20  oundary_col]].. 
+00003ca0: 2020 200d 0a20 2020 2023 204d 6572 6765     ..    # Merge
+00003cb0: 2074 6865 2074 776f 2062 6f75 6e64 6172   the two boundar
+00003cc0: 6965 7320 746f 2063 7265 6174 6520 7468  ies to create th
+00003cd0: 6520 696e 7465 7276 616c 2066 6f72 2074  e interval for t
+00003ce0: 6865 206d 6178 696d 756d 0d0a 2020 2020  he maximum..    
+00003cf0: 2320 4368 6563 6b20 7468 6174 2074 6865  # Check that the
+00003d00: 206d 6572 6765 2069 7320 312d 746f 2d31   merge is 1-to-1
+00003d10: 0d0a 2020 2020 6466 203d 206c 6566 742e  ..    df = left.
+00003d20: 6d65 7267 6528 7269 6768 742c 2068 6f77  merge(right, how
+00003d30: 203d 2027 6f75 7465 7227 2c20 6f6e 203d   = 'outer', on =
+00003d40: 2067 726f 7570 6279 5f63 6f6c 732c 2076   groupby_cols, v
+00003d50: 616c 6964 6174 6520 3d20 2731 3a31 2729  alidate = '1:1')
+00003d60: 0d0a 2020 2020 0d0a 2020 2020 2320 5265  ..    ..    # Re
+00003d70: 7365 7420 696e 6465 780d 0a20 2020 2064  set index..    d
+00003d80: 6620 3d20 6466 2e72 6573 6574 5f69 6e64  f = df.reset_ind
+00003d90: 6578 2829 0d0a 2020 2020 0d0a 2020 2020  ex()..    ..    
+00003da0: 7265 7475 726e 2064 660d 0a0d 0a64 6566  return df....def
+00003db0: 206d 6178 696d 756d 2864 662c 0d0a 2020   maximum(df,..  
+00003dc0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00003dd0: 735f 636f 6c2c 0d0a 2020 2020 2020 2020  s_col,..        
+00003de0: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
+00003df0: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
+00003e00: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
+00003e10: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
+00003e20: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
+00003e30: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
+00003e40: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+00003e50: 705f 6365 6e73 6f72 203d 2030 2e32 352c  p_censor = 0.25,
+00003e60: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00003e70: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
+00003e80: 203d 2054 7275 6529 3a0d 0a20 2020 2027   = True):..    '
+00003e90: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
+00003ea0: 6f6e 2074 6861 7420 636f 6d62 696e 6573  on that combines
+00003eb0: 2074 6865 2072 656c 6576 616e 7420 6d61   the relevant ma
+00003ec0: 7869 6d75 6d20 616e 6420 7574 696c 6974  ximum and utilit
+00003ed0: 7920 6675 6e63 7469 6f6e 7320 746f 0d0a  y functions to..
+00003ee0: 2020 2020 6765 6e65 7261 7465 2074 6865      generate the
+00003ef0: 206d 6178 696d 6120 7265 7375 6c74 7320   maxima results 
+00003f00: 666f 7220 6772 6f75 7073 2077 6974 6869  for groups withi
+00003f10: 6e20 6120 4461 7461 4672 616d 652e 0d0a  n a DataFrame...
+00003f20: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+00003f30: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
+00003f40: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
+00003f50: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
+00003f60: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
+00003f70: 7461 696e 7320 6365 6e73 6f72 6564 206f  tains censored o
+00003f80: 7220 756e 6365 6e73 6f72 6564 2072 6573  r uncensored res
+00003f90: 756c 7473 0d0a 2020 2020 7265 7375 6c74  ults..    result
+00003fa0: 735f 636f 6c20 3a20 7374 7269 6e67 0d0a  s_col : string..
+00003fb0: 2020 2020 2020 2020 5468 6520 636f 6c75          The colu
+00003fc0: 6d6e 206e 616d 6520 666f 7220 7468 6520  mn name for the 
+00003fd0: 636f 6c75 6d6e 2074 6861 7420 636f 6e74  column that cont
+00003fe0: 6169 6e20 7468 6520 7265 7375 6c74 7320  ain the results 
+00003ff0: 6173 2074 6578 742e 0d0a 2020 2020 2020  as text...      
+00004000: 2020 4f6e 6c79 2066 6f75 7220 706f 7373    Only four poss
+00004010: 6962 6c65 2063 656e 736f 7273 2073 686f  ible censors sho
+00004020: 756c 6420 6265 2075 7365 6420 283c 2ce2  uld be used (<,.
+00004030: 89a4 2ce2 89a5 2c3e 292e 0d0a 2020 2020  ..,...,>)...    
+00004040: 6772 6f75 7062 795f 636f 6c73 203a 206c  groupby_cols : l
+00004050: 6973 7473 206f 6620 7374 7269 6e67 7320  ists of strings 
+00004060: 286f 7220 6c69 7374 206f 6620 6c69 7374  (or list of list
+00004070: 7329 2c20 6f70 7469 6f6e 616c 0d0a 2020  s), optional..  
+00004080: 2020 2020 2020 4c69 7374 206f 6620 636f        List of co
+00004090: 6c75 6d6e 206e 616d 6573 2074 6861 7420  lumn names that 
+000040a0: 7368 6f75 6c64 2062 6520 7573 6564 2074  should be used t
+000040b0: 6f20 6372 6561 7465 2067 726f 7570 732e  o create groups.
+000040c0: 2041 206d 6178 696d 756d 0d0a 2020 2020   A maximum..    
+000040d0: 2020 2020 7769 6c6c 2062 6520 666f 756e      will be foun
+000040e0: 6420 7769 7468 696e 2065 6163 6820 6772  d within each gr
+000040f0: 6f75 702e 204d 756c 7469 706c 6520 6c69  oup. Multiple li
+00004100: 7374 7320 6361 6e20 6265 2073 7570 706c  sts can be suppl
+00004110: 6965 6420 746f 0d0a 2020 2020 2020 2020  ied to..        
+00004120: 7065 7266 6f72 6d20 7365 7175 656e 7469  perform sequenti
+00004130: 616c 206d 6178 696d 6120 6265 666f 7265  al maxima before
+00004140: 2063 6f6e 7665 7274 696e 6720 696e 7465   converting inte
+00004150: 7276 616c 7320 746f 2061 2072 6573 756c  rvals to a resul
+00004160: 742e 0d0a 2020 2020 2020 2020 5468 6520  t...        The 
+00004170: 6465 6661 756c 7420 6973 204e 6f6e 652e  default is None.
+00004180: 0d0a 2020 2020 696e 636c 7564 655f 6e65  ..    include_ne
+00004190: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
+000041a0: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
+000041b0: 6e61 6c0d 0a20 2020 2020 2020 2049 6620  nal..        If 
+000041c0: 5472 7565 2c20 7468 656e 2061 6c6c 2070  True, then all p
+000041d0: 6f73 6974 6976 6520 616e 6420 6e65 6761  ositive and nega
+000041e0: 7469 7665 2076 616c 7565 7320 6172 6520  tive values are 
+000041f0: 636f 6e73 6964 6572 6564 0d0a 2020 2020  considered..    
+00004200: 2020 2020 652e 672e 2c20 3c30 2e35 2077      e.g., <0.5 w
+00004210: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
+00004220: 6420 746f 2028 2d6e 702e 696e 662c 3529  d to (-np.inf,5)
+00004230: 2e0d 0a20 2020 2020 2020 2049 6620 4661  ...        If Fa
+00004240: 6c73 652c 2074 6865 6e20 6f6e 6c79 206e  lse, then only n
+00004250: 6f6e 2d6e 6567 6174 6976 6520 7661 6c75  on-negative valu
+00004260: 6573 2061 7265 2063 6f6e 7369 6465 7265  es are considere
+00004270: 640d 0a20 2020 2020 2020 2065 2e67 2e2c  d..        e.g.,
+00004280: 203c 302e 3520 776f 756c 6420 6265 2063   <0.5 would be c
+00004290: 6f6e 7665 7274 6564 2074 6f20 5b30 2c35  onverted to [0,5
+000042a0: 292e 0d0a 2020 2020 2020 2020 5468 6973  )...        This
+000042b0: 2073 6574 7469 6e67 206f 6e6c 7920 6166   setting only af
+000042c0: 6665 6374 7320 7265 7375 6c74 7320 6966  fects results if
+000042d0: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
+000042e0: 6e74 6961 6c20 6973 2046 616c 7365 2e0d  ntial is False..
+000042f0: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
+00004300: 6175 6c74 2069 7320 4661 6c73 652e 0d0a  ault is False...
+00004310: 2020 2020 7072 6563 6973 696f 6e5f 746f      precision_to
+00004320: 6c65 7261 6e63 655f 746f 5f64 726f 705f  lerance_to_drop_
+00004330: 6365 6e73 6f72 203a 2066 6c6f 6174 2c20  censor : float, 
+00004340: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+00004350: 2020 5468 7265 7368 6f6c 6420 666f 7220    Threshold for 
+00004360: 7265 706f 7274 696e 6720 6365 6e73 6f72  reporting censor
+00004370: 6564 2076 7320 6e6f 6e2d 6365 6e73 6f72  ed vs non-censor
+00004380: 6564 2072 6573 756c 7473 2e0d 0a20 2020  ed results...   
+00004390: 2020 2020 2055 7369 6e67 2074 6865 2064       Using the d
+000043a0: 6566 6175 6c74 2c20 6120 7265 7375 6c74  efault, a result
+000043b0: 2074 6861 7420 6973 206b 6e6f 776e 2074   that is known t
+000043c0: 6f20 6265 2069 6e20 7468 6520 696e 7465  o be in the inte
+000043d0: 7276 616c 2028 302e 332c 2030 2e35 290d  rval (0.3, 0.5).
+000043e0: 0a20 2020 2020 2020 2077 6f75 6c64 2062  .        would b
+000043f0: 6520 7265 7475 726e 6564 2061 7320 302e  e returned as 0.
+00004400: 342c 2077 6865 7265 6173 2061 2074 6f6c  4, whereas a tol
+00004410: 6572 616e 6365 206f 6620 3020 776f 756c  erance of 0 woul
+00004420: 6420 7969 656c 6420 610d 0a20 2020 2020  d yield a..     
+00004430: 2020 2072 6573 756c 7420 6f66 203c 302e     result of <0.
+00004440: 3520 6f72 203e 302e 3320 6465 7065 6e64  5 or >0.3 depend
+00004450: 696e 6720 6f6e 2074 6865 2076 616c 7565  ing on the value
+00004460: 206f 6620 666f 6375 735f 6869 6768 6573   of focus_highes
+00004470: 745f 706f 7465 6e74 6961 6c2e 0d0a 2020  t_potential...  
+00004480: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
+00004490: 7420 6973 2030 2e32 352e 0d0a 2020 2020  t is 0.25...    
+000044a0: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
+000044b0: 6e67 203a 2062 6f6f 6c65 616e 2c20 6f70  ng : boolean, op
+000044c0: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
+000044d0: 4966 2054 7275 652c 2061 2072 6f75 6e64  If True, a round
+000044e0: 696e 6720 6d65 7468 6f64 2069 7320 6170  ing method is ap
+000044f0: 706c 6965 6420 746f 2072 6f75 6e64 2072  plied to round r
+00004500: 6573 756c 7473 2074 6f20 6861 7665 206e  esults to have n
+00004510: 6f20 6d6f 7265 0d0a 2020 2020 2020 2020  o more..        
+00004520: 6465 6369 6d61 6c73 2074 6861 6e20 7768  decimals than wh
+00004530: 6174 2063 616e 2062 6520 6d65 6173 7572  at can be measur
+00004540: 6564 2e0d 0a20 2020 2020 2020 2054 6865  ed...        The
+00004550: 2064 6566 6175 6c74 2069 7320 5472 7565   default is True
+00004560: 2e0d 0a0d 0a20 2020 2052 6574 7572 6e73  .....    Returns
+00004570: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20  ..    -------.. 
+00004580: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
+00004590: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
+000045a0: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
+000045b0: 6e73 2061 2063 6f6c 756d 6e20 7769 7468  ns a column with
+000045c0: 2074 6865 2072 656c 6576 616e 7420 6d61   the relevant ma
+000045d0: 7869 6d75 6d20 6f72 206d 6178 696d 610d  ximum or maxima.
+000045e0: 0a0d 0a20 2020 2027 2727 0d0a 2020 2020  ...    '''..    
+000045f0: 0d0a 2020 2020 2320 4372 6561 7465 2061  ..    # Create a
+00004600: 2063 6f70 7920 6f66 2074 6865 2044 6174   copy of the Dat
+00004610: 6146 7261 6d65 0d0a 2020 2020 6466 203d  aFrame..    df =
+00004620: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
+00004630: 0d0a 2020 2020 2320 5370 6c69 7420 7468  ..    # Split th
+00004640: 6520 7265 7375 6c74 2069 6e74 6f20 6365  e result into ce
+00004650: 6e73 6f72 2061 6e64 206e 756d 6572 6963  nsor and numeric
+00004660: 2063 6f6d 706f 6e65 6e74 730d 0a20 2020   components..   
+00004670: 2064 6620 3d20 7265 7375 6c74 5f74 6f5f   df = result_to_
+00004680: 636f 6d70 6f6e 656e 7473 2864 662c 7265  components(df,re
+00004690: 7375 6c74 735f 636f 6c29 0d0a 2020 2020  sults_col)..    
+000046a0: 0d0a 2020 2020 2320 436f 6e76 6572 7420  ..    # Convert 
+000046b0: 7468 6520 7265 7375 6c74 7320 6672 6f6d  the results from
+000046c0: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
+000046d0: 7269 6320 636f 6d70 6f6e 656e 7473 2074  ric components t
+000046e0: 6f20 616e 2069 6e74 6572 7661 6c20 7265  o an interval re
+000046f0: 7072 6573 656e 7461 7469 6f6e 0d0a 2020  presentation..  
+00004700: 2020 6466 203d 2063 6f6d 706f 6e65 6e74    df = component
+00004710: 735f 746f 5f69 6e74 6572 7661 6c28 6466  s_to_interval(df
+00004720: 2c20 696e 636c 7564 655f 6e65 6761 7469  , include_negati
+00004730: 7665 5f69 6e74 6572 7661 6c29 0d0a 2020  ve_interval)..  
+00004740: 2020 0d0a 2020 2020 2320 5573 696e 6720    ..    # Using 
+00004750: 7468 6520 696e 7465 7276 616c 732c 2064  the intervals, d
+00004760: 6574 6572 6d69 6e65 2074 6865 2072 616e  etermine the ran
+00004770: 6765 206f 6620 706f 7373 6962 6c65 206d  ge of possible m
+00004780: 6178 696d 610d 0a20 2020 200d 0a20 2020  axima..    ..   
+00004790: 2023 2049 6620 7468 6572 6520 6172 6520   # If there are 
+000047a0: 6e6f 2067 726f 7570 6279 2d63 6f6c 756d  no groupby-colum
+000047b0: 6e73 2c20 7468 656e 2074 616b 6520 6d61  ns, then take ma
+000047c0: 7820 6f66 2061 6c6c 2072 6573 756c 7473  x of all results
+000047d0: 0d0a 2020 2020 6966 206e 6f74 2067 726f  ..    if not gro
+000047e0: 7570 6279 5f63 6f6c 733a 0d0a 2020 2020  upby_cols:..    
+000047f0: 2020 2020 6466 203d 206d 6178 696d 756d      df = maximum
+00004800: 5f69 6e74 6572 7661 6c28 6466 2c20 6772  _interval(df, gr
+00004810: 6f75 7062 795f 636f 6c73 3d5b 5d29 0d0a  oupby_cols=[])..
+00004820: 2020 2020 2320 4966 2074 6865 2067 726f      # If the gro
+00004830: 7570 6279 5f63 6f6c 7320 6973 2061 206c  upby_cols is a l
+00004840: 6973 7420 6f66 206c 6973 7473 2c20 7468  ist of lists, th
+00004850: 656e 2070 6572 666f 726d 206d 756c 7469  en perform multi
+00004860: 706c 6520 6d61 7869 6d75 6d73 0d0a 2020  ple maximums..  
+00004870: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00004880: 6528 6772 6f75 7062 795f 636f 6c73 5b30  e(groupby_cols[0
+00004890: 5d2c 6c69 7374 293a 0d0a 2020 2020 2020  ],list):..      
+000048a0: 2020 666f 7220 6772 6f75 7069 6e67 2069    for grouping i
+000048b0: 6e20 6772 6f75 7062 795f 636f 6c73 3a0d  n groupby_cols:.
+000048c0: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
+000048d0: 7369 6e67 2074 6865 2069 6e74 6572 7661  sing the interva
+000048e0: 6c73 2c20 6465 7465 726d 696e 6520 7468  ls, determine th
+000048f0: 6520 7261 6e67 6520 6f66 2070 6f73 7369  e range of possi
+00004900: 626c 6520 6d61 7869 6d61 0d0a 2020 2020  ble maxima..    
+00004910: 2020 2020 2020 2020 6466 203d 206d 6178          df = max
+00004920: 696d 756d 5f69 6e74 6572 7661 6c28 6466  imum_interval(df
+00004930: 2c20 6772 6f75 7069 6e67 290d 0a20 2020  , grouping)..   
+00004940: 2023 2045 6c73 6520 7468 6520 6772 6f75   # Else the grou
+00004950: 7062 795f 636f 6c73 2069 7320 6120 6c69  pby_cols is a li
+00004960: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
+00004970: 6573 0d0a 2020 2020 656c 7365 3a0d 0a20  es..    else:.. 
+00004980: 2020 2020 2020 2064 6620 3d20 6d61 7869         df = maxi
+00004990: 6d75 6d5f 696e 7465 7276 616c 2864 662c  mum_interval(df,
+000049a0: 2067 726f 7570 6279 5f63 6f6c 7329 0d0a   groupby_cols)..
+000049b0: 2020 2020 0d0a 2020 2020 2320 436f 6e76      ..    # Conv
+000049c0: 6572 7420 7468 6520 696e 7465 7276 616c  ert the interval
+000049d0: 2066 6f72 2074 6865 206d 6178 696d 756d   for the maximum
+000049e0: 2069 6e74 6f20 6365 6e73 6f72 2061 6e64   into censor and
+000049f0: 206e 756d 6572 6963 206e 6f74 6174 696f   numeric notatio
+00004a00: 6e0d 0a20 2020 2064 6620 3d20 696e 7465  n..    df = inte
+00004a10: 7276 616c 5f74 6f5f 636f 6d70 6f6e 656e  rval_to_componen
+00004a20: 7473 2864 662c 0d0a 2020 2020 2020 2020  ts(df,..        
+00004a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a40: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
+00004a50: 6768 5f70 6f74 656e 7469 616c 203d 2054  gh_potential = T
+00004a60: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
+00004a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a80: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
+00004a90: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
+00004aa0: 3d20 696e 636c 7564 655f 6e65 6761 7469  = include_negati
+00004ab0: 7665 5f69 6e74 6572 7661 6c2c 0d0a 2020  ve_interval,..  
 00004ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ad0: 2020 2020 2070 7265 6369 7369 6f6e 5f74       precision_t
-00004ae0: 6f6c 6572 616e 6365 5f74 6f5f 6472 6f70  olerance_to_drop
-00004af0: 5f63 656e 736f 7220 3d20 7072 6563 6973  _censor = precis
-00004b00: 696f 6e5f 746f 6c65 7261 6e63 655f 746f  ion_tolerance_to
-00004b10: 5f64 726f 705f 6365 6e73 6f72 290d 0a20  _drop_censor).. 
-00004b20: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
-00004b30: 6520 696e 7465 7276 616c 206e 6f74 6174  e interval notat
-00004b40: 696f 6e20 666f 7220 7468 6520 6d61 7869  ion for the maxi
-00004b50: 6d75 6d0d 0a20 2020 2064 6620 3d20 696e  mum..    df = in
-00004b60: 7465 7276 616c 5f6e 6f74 6174 696f 6e28  terval_notation(
-00004b70: 6466 2c20 7072 6563 6973 696f 6e5f 726f  df, precision_ro
-00004b80: 756e 6469 6e67 290d 0a20 2020 200d 0a20  unding)..    .. 
-00004b90: 2020 2023 2043 6f6d 6269 6e65 2074 6865     # Combine the
-00004ba0: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
-00004bb0: 7269 6320 636f 6d70 6f6e 656e 7473 2069  ric components i
-00004bc0: 6e74 6f20 6120 7265 7375 6c74 0d0a 2020  nto a result..  
-00004bd0: 2020 6466 203d 2063 6f6d 706f 6e65 6e74    df = component
-00004be0: 735f 746f 5f72 6573 756c 7428 6466 2c20  s_to_result(df, 
-00004bf0: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
-00004c00: 6e67 290d 0a20 2020 200d 0a20 2020 2023  ng)..    ..    #
-00004c10: 2044 726f 7020 776f 726b 696e 6720 636f   Drop working co
-00004c20: 6c75 6d6e 730d 0a20 2020 2064 6620 3d20  lumns..    df = 
-00004c30: 6466 2e64 726f 7028 6466 2e66 696c 7465  df.drop(df.filte
-00004c40: 7228 7265 6765 783d 275f 5f27 292e 636f  r(regex='__').co
-00004c50: 6c75 6d6e 732c 2061 7869 733d 3129 0d0a  lumns, axis=1)..
-00004c60: 2020 2020 0d0a 2020 2020 2320 5265 6f72      ..    # Reor
-00004c70: 6465 7220 636f 6c75 6d6e 730d 0a20 2020  der columns..   
-00004c80: 2066 6f72 2063 6f6c 2069 6e20 5b73 7461   for col in [sta
-00004c90: 745f 636f 6c2c 7265 7375 6c74 5f63 6f6c  t_col,result_col
-00004ca0: 2c63 656e 736f 725f 636f 6c2c 6e75 6d65  ,censor_col,nume
-00004cb0: 7269 635f 636f 6c2c 696e 7465 7276 616c  ric_col,interval
-00004cc0: 5f63 6f6c 5d3a 0d0a 2020 2020 2020 2020  _col]:..        
-00004cd0: 6466 5b63 6f6c 5d20 3d20 6466 2e70 6f70  df[col] = df.pop
-00004ce0: 2863 6f6c 290d 0a20 2020 200d 0a20 2020  (col)..    ..   
-00004cf0: 2072 6574 7572 6e20 6466 0d0a 0d0a 2325   return df....#%
-00004d00: 2520 4d69 6e69 6d75 6d20 5265 7375 6c74  % Minimum Result
-00004d10: 0d0a 0d0a 6465 6620 6d69 6e69 6d75 6d5f  ....def minimum_
-00004d20: 696e 7465 7276 616c 2864 662c 0d0a 2020  interval(df,..  
-00004d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d40: 2020 2067 726f 7570 6279 5f63 6f6c 7329     groupby_cols)
-00004d50: 3a0d 0a20 2020 2027 2727 0d0a 2020 2020  :..    '''..    
-00004d60: 4120 6675 6e63 7469 6f6e 2074 6861 7420  A function that 
-00004d70: 616e 616c 7973 6573 2074 6865 2069 6e74  analyses the int
-00004d80: 6572 7661 6c20 6e6f 7461 7469 6f6e 2066  erval notation f
-00004d90: 6f72 6d20 6f66 2072 6573 756c 7473 2072  orm of results r
-00004da0: 6574 7572 6e65 640d 0a20 2020 2066 726f  eturned..    fro
-00004db0: 6d20 636f 6d70 6f6e 656e 7473 5f74 6f5f  m components_to_
-00004dc0: 696e 7465 7276 616c 2074 6f20 6765 6e65  interval to gene
-00004dd0: 7261 7465 2061 206e 6577 2069 6e74 6572  rate a new inter
-00004de0: 7661 6c20 666f 7220 7468 6520 6d69 6e69  val for the mini
-00004df0: 6d75 6d2e 2047 726f 7570 730d 0a20 2020  mum. Groups..   
-00004e00: 206f 6620 7265 7375 6c74 7320 6361 6e20   of results can 
-00004e10: 6265 2064 6566 696e 6564 2062 7920 696e  be defined by in
-00004e20: 636c 7564 696e 6720 7468 6520 636f 6c75  cluding the colu
-00004e30: 6d6e 7320 7468 6174 2073 686f 756c 6420  mns that should 
-00004e40: 6265 2075 7365 6420 746f 0d0a 2020 2020  be used to..    
-00004e50: 6372 6561 7465 2067 726f 7570 732e 0d0a  create groups...
-00004e60: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-00004e70: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
-00004e80: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
-00004e90: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
-00004ea0: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
-00004eb0: 7461 696e 7320 7265 7375 6c74 7320 696e  tains results in
-00004ec0: 2061 2073 7065 6369 6669 6320 696e 7465   a specific inte
-00004ed0: 7276 616c 206e 6f74 6174 696f 6e2e 0d0a  rval notation...
-00004ee0: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
-00004ef0: 203a 206c 6973 7420 6f66 2073 7472 696e   : list of strin
-00004f00: 6773 0d0a 2020 2020 2020 2020 4c69 7374  gs..        List
-00004f10: 206f 6620 636f 6c75 6d6e 206e 616d 6573   of column names
-00004f20: 2074 6861 7420 7368 6f75 6c64 2062 6520   that should be 
-00004f30: 7573 6564 2074 6f20 6372 6561 7465 2067  used to create g
-00004f40: 726f 7570 732e 0d0a 0d0a 2020 2020 5265  roups.....    Re
-00004f50: 7475 726e 730d 0a20 2020 202d 2d2d 2d2d  turns..    -----
-00004f60: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
-00004f70: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-00004f80: 4461 7461 4672 616d 6520 7468 6174 2068  DataFrame that h
-00004f90: 6173 2074 6865 2069 6e74 6572 7661 6c20  as the interval 
-00004fa0: 666f 7220 7468 6520 6d69 6e69 6d75 6d20  for the minimum 
-00004fb0: 2866 6f72 2065 6163 6820 6772 6f75 7020  (for each group 
-00004fc0: 6966 0d0a 2020 2020 2020 2020 636f 6c75  if..        colu
-00004fd0: 6d6e 206e 616d 6573 2061 7265 2070 726f  mn names are pro
-00004fe0: 7669 6465 6420 666f 7220 6772 6f75 7069  vided for groupi
-00004ff0: 6e67 290d 0a0d 0a20 2020 2027 2727 0d0a  ng)....    '''..
-00005000: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
-00005010: 7465 2061 2063 6f70 7920 6f66 2074 6865  te a copy of the
-00005020: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-00005030: 6466 203d 2064 662e 636f 7079 2829 0d0a  df = df.copy()..
-00005040: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
-00005050: 7465 2063 6f6c 756d 6e20 7468 6174 2069  te column that i
-00005060: 6e64 6963 6174 6573 2074 6865 2067 656e  ndicates the gen
-00005070: 6572 6174 6564 2073 7461 7469 7374 6963  erated statistic
-00005080: 2061 6e64 2061 7070 656e 6420 746f 2067   and append to g
-00005090: 726f 7570 696e 6720 6c69 7374 0d0a 2020  rouping list..  
-000050a0: 2020 6466 5b73 7461 745f 636f 6c5d 203d    df[stat_col] =
-000050b0: 2027 4d69 6e69 6d75 6d27 0d0a 2020 2020   'Minimum'..    
-000050c0: 6772 6f75 7062 795f 636f 6c73 2e61 7070  groupby_cols.app
-000050d0: 656e 6428 7374 6174 5f63 6f6c 290d 0a20  end(stat_col).. 
-000050e0: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
-000050f0: 6d69 6e65 206c 6566 7420 626f 756e 6420  mine left bound 
-00005100: 616e 6420 626f 756e 6461 7279 2066 6f72  and boundary for
-00005110: 206d 696e 696d 756d 2066 6f72 2065 6163   minimum for eac
-00005120: 6820 6772 6f75 702e 0d0a 2020 2020 0d0a  h group...    ..
-00005130: 2020 2020 2320 436f 6e73 6964 6572 2074      # Consider t
-00005140: 6865 206d 696e 696d 756d 2062 6f75 6e64  he minimum bound
-00005150: 2066 6f72 2065 6163 6820 6c65 6674 2062   for each left b
-00005160: 6f75 6e64 6172 7920 6f70 7469 6f6e 2074  oundary option t
-00005170: 6f20 6465 7465 726d 696e 650d 0a20 2020  o determine..   
-00005180: 2023 2077 6865 7468 6572 2074 6865 2062   # whether the b
-00005190: 6f75 6e64 2073 686f 756c 6420 6265 206f  ound should be o
-000051a0: 7065 6e20 6f72 2063 6c6f 7365 642e 0d0a  pen or closed...
-000051b0: 2020 2020 6c65 6674 203d 2064 662e 6772      left = df.gr
-000051c0: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
-000051d0: 6c73 2b5b 6c65 6674 5f62 6f75 6e64 6172  ls+[left_boundar
-000051e0: 795f 636f 6c5d 295b 6c65 6674 5f62 6f75  y_col])[left_bou
-000051f0: 6e64 5f63 6f6c 5d2e 6d69 6e28 292e 756e  nd_col].min().un
-00005200: 7374 6163 6b28 6c65 6674 5f62 6f75 6e64  stack(left_bound
-00005210: 6172 795f 636f 6c29 0d0a 2020 2020 2320  ary_col)..    # 
-00005220: 4372 6561 7465 206d 6973 7369 6e67 2063  Create missing c
-00005230: 6f6c 756d 6e73 0d0a 2020 2020 666f 7220  olumns..    for 
-00005240: 6974 656d 2069 6e20 5b27 4f70 656e 272c  item in ['Open',
-00005250: 2743 6c6f 7365 6427 5d3a 0d0a 2020 2020  'Closed']:..    
-00005260: 2020 2020 6966 2069 7465 6d20 6e6f 7420      if item not 
-00005270: 696e 206c 6566 742e 636f 6c75 6d6e 733a  in left.columns:
-00005280: 0d0a 2020 2020 2020 2020 2020 2020 6c65  ..            le
-00005290: 6674 5b69 7465 6d5d 203d 206e 702e 6e61  ft[item] = np.na
-000052a0: 6e0d 0a20 2020 2023 2055 7365 2074 6865  n..    # Use the
-000052b0: 206d 696e 696d 756d 2063 6c6f 7365 6420   minimum closed 
-000052c0: 626f 756e 6461 7279 2069 6620 7468 6572  boundary if ther
-000052d0: 6520 6172 6520 6e6f 206f 7065 6e20 626f  e are no open bo
-000052e0: 756e 6461 7269 6573 206f 720d 0a20 2020  undaries or..   
-000052f0: 2023 2069 6620 7468 6520 636c 6f73 6564   # if the closed
-00005300: 2062 6f75 6e64 6172 7920 6973 206c 6573   boundary is les
-00005310: 7320 7468 616e 206f 7220 6571 7561 6c20  s than or equal 
-00005320: 746f 2074 6865 206c 6561 7374 206f 7065  to the least ope
-00005330: 6e20 626f 756e 6461 7279 0d0a 2020 2020  n boundary..    
-00005340: 636f 6e64 6974 696f 6e20 3d20 286c 6566  condition = (lef
-00005350: 745b 2743 6c6f 7365 6427 5d20 3c3d 206c  t['Closed'] <= l
-00005360: 6566 745b 274f 7065 6e27 5d29 207c 2028  eft['Open']) | (
-00005370: 6c65 6674 5b27 4f70 656e 275d 2e69 736e  left['Open'].isn
-00005380: 6128 2929 0d0a 2020 2020 6c65 6674 5b6c  a())..    left[l
-00005390: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-000053a0: 5d20 3d20 6e70 2e77 6865 7265 2863 6f6e  ] = np.where(con
-000053b0: 6469 7469 6f6e 2c27 436c 6f73 6564 272c  dition,'Closed',
-000053c0: 274f 7065 6e27 290d 0a20 2020 206c 6566  'Open')..    lef
-000053d0: 745b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  t[left_bound_col
-000053e0: 5d20 3d20 6e70 2e77 6865 7265 2863 6f6e  ] = np.where(con
-000053f0: 6469 7469 6f6e 2c6c 6566 745b 2743 6c6f  dition,left['Clo
-00005400: 7365 6427 5d2c 6c65 6674 5b27 4f70 656e  sed'],left['Open
-00005410: 275d 290d 0a20 2020 206c 6566 7420 3d20  '])..    left = 
-00005420: 6c65 6674 5b5b 6c65 6674 5f62 6f75 6e64  left[[left_bound
-00005430: 6172 795f 636f 6c2c 6c65 6674 5f62 6f75  ary_col,left_bou
-00005440: 6e64 5f63 6f6c 5d5d 0d0a 2020 2020 0d0a  nd_col]]..    ..
-00005450: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
-00005460: 7269 6768 7420 626f 756e 6420 616e 6420  right bound and 
-00005470: 626f 756e 6461 7279 2066 6f72 206d 696e  boundary for min
-00005480: 696d 756d 2066 6f72 2065 6163 6820 6772  imum for each gr
-00005490: 6f75 702e 0d0a 2020 2020 0d0a 2020 2020  oup...    ..    
-000054a0: 2320 436f 6e73 6964 6572 2074 6865 206d  # Consider the m
-000054b0: 696e 696d 756d 2062 6f75 6e64 2066 6f72  inimum bound for
-000054c0: 2065 6163 6820 7269 6768 7420 626f 756e   each right boun
-000054d0: 6461 7279 206f 7074 696f 6e20 746f 2064  dary option to d
-000054e0: 6574 6572 6d69 6e65 0d0a 2020 2020 2320  etermine..    # 
-000054f0: 7768 6574 6865 7220 7468 6520 626f 756e  whether the boun
-00005500: 6420 7368 6f75 6c64 2062 6520 6f70 656e  d should be open
-00005510: 206f 7220 636c 6f73 6564 2e0d 0a20 2020   or closed...   
-00005520: 2072 6967 6874 203d 2064 662e 6772 6f75   right = df.grou
-00005530: 7062 7928 6772 6f75 7062 795f 636f 6c73  pby(groupby_cols
-00005540: 2b5b 7269 6768 745f 626f 756e 6461 7279  +[right_boundary
-00005550: 5f63 6f6c 5d29 5b72 6967 6874 5f62 6f75  _col])[right_bou
-00005560: 6e64 5f63 6f6c 5d2e 6d69 6e28 292e 756e  nd_col].min().un
-00005570: 7374 6163 6b28 7269 6768 745f 626f 756e  stack(right_boun
-00005580: 6461 7279 5f63 6f6c 290d 0a20 2020 2023  dary_col)..    #
-00005590: 2043 7265 6174 6520 6d69 7373 696e 6720   Create missing 
-000055a0: 636f 6c75 6d6e 730d 0a20 2020 2066 6f72  columns..    for
-000055b0: 2069 7465 6d20 696e 205b 274f 7065 6e27   item in ['Open'
-000055c0: 2c27 436c 6f73 6564 275d 3a0d 0a20 2020  ,'Closed']:..   
-000055d0: 2020 2020 2069 6620 6974 656d 206e 6f74       if item not
-000055e0: 2069 6e20 7269 6768 742e 636f 6c75 6d6e   in right.column
-000055f0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00005600: 7269 6768 745b 6974 656d 5d20 3d20 6e70  right[item] = np
-00005610: 2e6e 616e 0d0a 2020 2020 2320 5573 6520  .nan..    # Use 
-00005620: 7468 6520 6d69 6e69 6d75 6d20 636c 6f73  the minimum clos
-00005630: 6564 2062 6f75 6e64 6172 7920 6966 2074  ed boundary if t
-00005640: 6865 7265 2061 7265 206e 6f20 6f70 656e  here are no open
-00005650: 2062 6f75 6e64 6172 6965 7320 6f72 0d0a   boundaries or..
-00005660: 2020 2020 2320 6966 2074 6865 2063 6c6f      # if the clo
-00005670: 7365 6420 626f 756e 6461 7279 2069 7320  sed boundary is 
-00005680: 6c65 7373 2074 6861 6e20 7468 6520 6c65  less than the le
-00005690: 6173 7420 6f70 656e 2062 6f75 6e64 6172  ast open boundar
-000056a0: 790d 0a20 2020 2063 6f6e 6469 7469 6f6e  y..    condition
-000056b0: 203d 2028 7269 6768 745b 2743 6c6f 7365   = (right['Close
-000056c0: 6427 5d20 3c20 7269 6768 745b 274f 7065  d'] < right['Ope
-000056d0: 6e27 5d29 207c 2028 7269 6768 745b 274f  n']) | (right['O
-000056e0: 7065 6e27 5d2e 6973 6e61 2829 290d 0a20  pen'].isna()).. 
-000056f0: 2020 2072 6967 6874 5b72 6967 6874 5f62     right[right_b
-00005700: 6f75 6e64 5f63 6f6c 5d20 3d20 6e70 2e77  ound_col] = np.w
-00005710: 6865 7265 2863 6f6e 6469 7469 6f6e 2c72  here(condition,r
-00005720: 6967 6874 5b27 436c 6f73 6564 275d 2c72  ight['Closed'],r
-00005730: 6967 6874 5b27 4f70 656e 275d 290d 0a20  ight['Open']).. 
-00005740: 2020 2072 6967 6874 5b72 6967 6874 5f62     right[right_b
-00005750: 6f75 6e64 6172 795f 636f 6c5d 203d 206e  oundary_col] = n
-00005760: 702e 7768 6572 6528 636f 6e64 6974 696f  p.where(conditio
-00005770: 6e2c 2743 6c6f 7365 6427 2c27 4f70 656e  n,'Closed','Open
-00005780: 2729 0d0a 2020 2020 7269 6768 7420 3d20  ')..    right = 
-00005790: 7269 6768 745b 5b72 6967 6874 5f62 6f75  right[[right_bou
-000057a0: 6e64 5f63 6f6c 2c72 6967 6874 5f62 6f75  nd_col,right_bou
-000057b0: 6e64 6172 795f 636f 6c5d 5d0d 0a20 2020  ndary_col]]..   
-000057c0: 200d 0a20 2020 2023 204d 6572 6765 2074   ..    # Merge t
-000057d0: 6865 2074 776f 2062 6f75 6e64 6172 6965  he two boundarie
-000057e0: 7320 746f 2063 7265 6174 6520 7468 6520  s to create the 
-000057f0: 696e 7465 7276 616c 2066 6f72 2074 6865  interval for the
-00005800: 206d 696e 696d 756d 0d0a 2020 2020 2320   minimum..    # 
-00005810: 4368 6563 6b20 7468 6174 2074 6865 206d  Check that the m
-00005820: 6572 6765 2069 7320 312d 746f 2d31 0d0a  erge is 1-to-1..
-00005830: 2020 2020 6466 203d 206c 6566 742e 6d65      df = left.me
-00005840: 7267 6528 7269 6768 742c 2068 6f77 203d  rge(right, how =
-00005850: 2027 6f75 7465 7227 2c20 6f6e 203d 2067   'outer', on = g
-00005860: 726f 7570 6279 5f63 6f6c 732c 2076 616c  roupby_cols, val
-00005870: 6964 6174 6520 3d20 2731 3a31 2729 0d0a  idate = '1:1')..
-00005880: 2020 2020 0d0a 2020 2020 2320 5265 7365      ..    # Rese
-00005890: 7420 696e 6465 780d 0a20 2020 2064 6620  t index..    df 
-000058a0: 3d20 6466 2e72 6573 6574 5f69 6e64 6578  = df.reset_index
-000058b0: 2829 0d0a 2020 2020 0d0a 2020 2020 7265  ()..    ..    re
-000058c0: 7475 726e 2064 660d 0a0d 0a64 6566 206d  turn df....def m
-000058d0: 696e 696d 756d 2864 662c 0d0a 2020 2020  inimum(df,..    
-000058e0: 2020 2020 2020 2020 7265 7375 6c74 5f63          result_c
-000058f0: 6f6c 2c0d 0a20 2020 2020 2020 2020 2020  ol,..           
-00005900: 2067 726f 7570 6279 5f63 6f6c 7320 3d20   groupby_cols = 
-00005910: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-00005920: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
-00005930: 6976 655f 696e 7465 7276 616c 203d 2046  ive_interval = F
-00005940: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
-00005950: 2020 2070 7265 6369 7369 6f6e 5f74 6f6c     precision_tol
-00005960: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
-00005970: 656e 736f 7220 3d20 302e 3235 2c0d 0a20  ensor = 0.25,.. 
-00005980: 2020 2020 2020 2020 2020 2070 7265 6369             preci
-00005990: 7369 6f6e 5f72 6f75 6e64 696e 6720 3d20  sion_rounding = 
-000059a0: 5472 7565 293a 0d0a 2020 2020 2727 270d  True):..    '''.
-000059b0: 0a20 2020 2041 2066 756e 6374 696f 6e20  .    A function 
-000059c0: 7468 6174 2063 6f6d 6269 6e65 7320 7468  that combines th
-000059d0: 6520 7265 6c65 7661 6e74 206d 696e 696d  e relevant minim
-000059e0: 756d 2061 6e64 2075 7469 6c69 7479 2066  um and utility f
-000059f0: 756e 6374 696f 6e73 2074 6f0d 0a20 2020  unctions to..   
-00005a00: 2067 656e 6572 6174 6520 7468 6520 6d69   generate the mi
-00005a10: 6e69 6d61 2072 6573 756c 7473 2066 6f72  nima results for
-00005a20: 2067 726f 7570 7320 7769 7468 696e 2061   groups within a
-00005a30: 2044 6174 6146 7261 6d65 2e0d 0a0d 0a20   DataFrame..... 
-00005a40: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-00005a50: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-00005a60: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
-00005a70: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
-00005a80: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
-00005a90: 6e73 2063 656e 736f 7265 6420 6f72 2075  ns censored or u
-00005aa0: 6e63 656e 736f 7265 6420 7265 7375 6c74  ncensored result
-00005ab0: 730d 0a20 2020 2072 6573 756c 745f 636f  s..    result_co
-00005ac0: 6c20 3a20 7374 7269 6e67 0d0a 2020 2020  l : string..    
-00005ad0: 2020 2020 5468 6520 636f 6c75 6d6e 206e      The column n
-00005ae0: 616d 6520 666f 7220 7468 6520 636f 6c75  ame for the colu
-00005af0: 6d6e 2074 6861 7420 636f 6e74 6169 6e20  mn that contain 
-00005b00: 7468 6520 7265 7375 6c74 7320 6173 2074  the results as t
-00005b10: 6578 742e 0d0a 2020 2020 2020 2020 4f6e  ext...        On
-00005b20: 6c79 2066 6f75 7220 706f 7373 6962 6c65  ly four possible
-00005b30: 2063 656e 736f 7273 2073 686f 756c 6420   censors should 
-00005b40: 6265 2075 7365 6420 283c 2ce2 89a4 2ce2  be used (<,...,.
-00005b50: 89a5 2c3e 292e 0d0a 2020 2020 6772 6f75  ..,>)...    grou
-00005b60: 7062 795f 636f 6c73 203a 206c 6973 7473  pby_cols : lists
-00005b70: 206f 6620 7374 7269 6e67 7320 286f 7220   of strings (or 
-00005b80: 6c69 7374 206f 6620 6c69 7374 7329 2c20  list of lists), 
-00005b90: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00005ba0: 2020 4c69 7374 206f 6620 636f 6c75 6d6e    List of column
-00005bb0: 206e 616d 6573 2074 6861 7420 7368 6f75   names that shou
-00005bc0: 6c64 2062 6520 7573 6564 2074 6f20 6372  ld be used to cr
-00005bd0: 6561 7465 2067 726f 7570 732e 2041 206d  eate groups. A m
-00005be0: 696e 696d 756d 0d0a 2020 2020 2020 2020  inimum..        
-00005bf0: 7769 6c6c 2062 6520 666f 756e 6420 7769  will be found wi
-00005c00: 7468 696e 2065 6163 6820 6772 6f75 702e  thin each group.
-00005c10: 204d 756c 7469 706c 6520 6c69 7374 7320   Multiple lists 
-00005c20: 6361 6e20 6265 2073 7570 706c 6965 6420  can be supplied 
-00005c30: 746f 0d0a 2020 2020 2020 2020 7065 7266  to..        perf
-00005c40: 6f72 6d20 7365 7175 656e 7469 616c 206d  orm sequential m
-00005c50: 696e 696d 6120 6265 666f 7265 2063 6f6e  inima before con
-00005c60: 7665 7274 696e 6720 696e 7465 7276 616c  verting interval
-00005c70: 7320 746f 2061 2072 6573 756c 742e 0d0a  s to a result...
-00005c80: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
-00005c90: 756c 7420 6973 204e 6f6e 652e 0d0a 2020  ult is None...  
-00005ca0: 2020 696e 636c 7564 655f 6e65 6761 7469    include_negati
-00005cb0: 7665 5f69 6e74 6572 7661 6c20 3a20 626f  ve_interval : bo
-00005cc0: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
-00005cd0: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-00005ce0: 2c20 7468 656e 2061 6c6c 2070 6f73 6974  , then all posit
-00005cf0: 6976 6520 616e 6420 6e65 6761 7469 7665  ive and negative
-00005d00: 2076 616c 7565 7320 6172 6520 636f 6e73   values are cons
-00005d10: 6964 6572 6564 0d0a 2020 2020 2020 2020  idered..        
-00005d20: 652e 672e 2c20 3c30 2e35 2077 6f75 6c64  e.g., <0.5 would
-00005d30: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
-00005d40: 2028 2d6e 702e 696e 662c 3529 2e0d 0a20   (-np.inf,5)... 
-00005d50: 2020 2020 2020 2049 6620 4661 6c73 652c         If False,
-00005d60: 2074 6865 6e20 6f6e 6c79 206e 6f6e 2d6e   then only non-n
-00005d70: 6567 6174 6976 6520 7661 6c75 6573 2061  egative values a
-00005d80: 7265 2063 6f6e 7369 6465 7265 640d 0a20  re considered.. 
-00005d90: 2020 2020 2020 2065 2e67 2e2c 203c 302e         e.g., <0.
-00005da0: 3520 776f 756c 6420 6265 2063 6f6e 7665  5 would be conve
-00005db0: 7274 6564 2074 6f20 5b30 2c35 292e 0d0a  rted to [0,5)...
-00005dc0: 2020 2020 2020 2020 5468 6973 2073 6574          This set
-00005dd0: 7469 6e67 206f 6e6c 7920 6166 6665 6374  ting only affect
-00005de0: 7320 7265 7375 6c74 7320 6966 2066 6f63  s results if foc
-00005df0: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-00005e00: 6c20 6973 2046 616c 7365 2e0d 0a20 2020  l is False...   
-00005e10: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
-00005e20: 2069 7320 4661 6c73 652e 0d0a 2020 2020   is False...    
-00005e30: 7072 6563 6973 696f 6e5f 746f 6c65 7261  precision_tolera
-00005e40: 6e63 655f 746f 5f64 726f 705f 6365 6e73  nce_to_drop_cens
-00005e50: 6f72 203a 2066 6c6f 6174 2c20 6f70 7469  or : float, opti
-00005e60: 6f6e 616c 0d0a 2020 2020 2020 2020 5468  onal..        Th
-00005e70: 7265 7368 6f6c 6420 666f 7220 7265 706f  reshold for repo
-00005e80: 7274 696e 6720 6365 6e73 6f72 6564 2076  rting censored v
-00005e90: 7320 6e6f 6e2d 6365 6e73 6f72 6564 2072  s non-censored r
-00005ea0: 6573 756c 7473 2e0d 0a20 2020 2020 2020  esults...       
-00005eb0: 2055 7369 6e67 2074 6865 2064 6566 6175   Using the defau
-00005ec0: 6c74 2c20 6120 7265 7375 6c74 2074 6861  lt, a result tha
-00005ed0: 7420 6973 206b 6e6f 776e 2074 6f20 6265  t is known to be
-00005ee0: 2069 6e20 7468 6520 696e 7465 7276 616c   in the interval
-00005ef0: 2028 302e 332c 2030 2e35 290d 0a20 2020   (0.3, 0.5)..   
-00005f00: 2020 2020 2077 6f75 6c64 2062 6520 7265       would be re
-00005f10: 7475 726e 6564 2061 7320 302e 342c 2077  turned as 0.4, w
-00005f20: 6865 7265 6173 2061 2074 6f6c 6572 616e  hereas a toleran
-00005f30: 6365 206f 6620 3020 776f 756c 6420 7969  ce of 0 would yi
-00005f40: 656c 6420 610d 0a20 2020 2020 2020 2072  eld a..        r
-00005f50: 6573 756c 7420 6f66 203c 302e 3520 6f72  esult of <0.5 or
-00005f60: 203e 302e 3320 6465 7065 6e64 696e 6720   >0.3 depending 
-00005f70: 6f6e 2074 6865 2076 616c 7565 206f 6620  on the value of 
-00005f80: 666f 6375 735f 6869 6768 6573 745f 706f  focus_highest_po
-00005f90: 7465 6e74 6961 6c2e 0d0a 2020 2020 2020  tential...      
-00005fa0: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
-00005fb0: 2030 2e32 352e 0d0a 2020 2020 7072 6563   0.25...    prec
-00005fc0: 6973 696f 6e5f 726f 756e 6469 6e67 203a  ision_rounding :
-00005fd0: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
-00005fe0: 616c 0d0a 2020 2020 2020 2020 4966 2054  al..        If T
-00005ff0: 7275 652c 2061 2072 6f75 6e64 696e 6720  rue, a rounding 
-00006000: 6d65 7468 6f64 2069 7320 6170 706c 6965  method is applie
-00006010: 6420 746f 2072 6f75 6e64 2072 6573 756c  d to round resul
-00006020: 7473 2074 6f20 6861 7665 206e 6f20 6d6f  ts to have no mo
-00006030: 7265 0d0a 2020 2020 2020 2020 6465 6369  re..        deci
-00006040: 6d61 6c73 2074 6861 6e20 7768 6174 2063  mals than what c
-00006050: 616e 2062 6520 6d65 6173 7572 6564 2e0d  an be measured..
-00006060: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-00006070: 6175 6c74 2069 7320 5472 7565 2e0d 0a0d  ault is True....
-00006080: 0a20 2020 2052 6574 7572 6e73 0d0a 2020  .    Returns..  
-00006090: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064    -------..    d
-000060a0: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
-000060b0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-000060c0: 2074 6861 7420 636f 6e74 6169 6e73 2061   that contains a
-000060d0: 2063 6f6c 756d 6e20 7769 7468 2074 6865   column with the
-000060e0: 2072 656c 6576 616e 7420 6d69 6e69 6d75   relevant minimu
-000060f0: 6d20 6f72 206d 696e 696d 610d 0a0d 0a20  m or minima.... 
-00006100: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
-00006110: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
-00006120: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
-00006130: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
-00006140: 636f 7079 2829 0d0a 2020 2020 0d0a 2020  copy()..    ..  
-00006150: 2020 2320 5370 6c69 7420 7468 6520 7265    # Split the re
-00006160: 7375 6c74 2069 6e74 6f20 6365 6e73 6f72  sult into censor
-00006170: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-00006180: 706f 6e65 6e74 730d 0a20 2020 2064 6620  ponents..    df 
-00006190: 3d20 7265 7375 6c74 5f74 6f5f 636f 6d70  = result_to_comp
-000061a0: 6f6e 656e 7473 2864 662c 7265 7375 6c74  onents(df,result
-000061b0: 5f63 6f6c 290d 0a20 2020 200d 0a20 2020  _col)..    ..   
-000061c0: 2023 2043 6f6e 7665 7274 2074 6865 2072   # Convert the r
-000061d0: 6573 756c 7473 2066 726f 6d20 6365 6e73  esults from cens
-000061e0: 6f72 2061 6e64 206e 756d 6572 6963 2063  or and numeric c
-000061f0: 6f6d 706f 6e65 6e74 7320 746f 2061 6e20  omponents to an 
-00006200: 696e 7465 7276 616c 2072 6570 7265 7365  interval represe
-00006210: 6e74 6174 696f 6e0d 0a20 2020 2064 6620  ntation..    df 
-00006220: 3d20 636f 6d70 6f6e 656e 7473 5f74 6f5f  = components_to_
-00006230: 696e 7465 7276 616c 2864 662c 2069 6e63  interval(df, inc
-00006240: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
-00006250: 7465 7276 616c 290d 0a20 2020 200d 0a20  terval)..    .. 
-00006260: 2020 2023 2055 7369 6e67 2074 6865 2069     # Using the i
-00006270: 6e74 6572 7661 6c73 2c20 6465 7465 726d  ntervals, determ
-00006280: 696e 6520 7468 6520 7261 6e67 6520 6f66  ine the range of
-00006290: 2070 6f73 7369 626c 6520 6d69 6e69 6d61   possible minima
-000062a0: 0d0a 2020 2020 0d0a 2020 2020 2320 4966  ..    ..    # If
-000062b0: 2074 6865 7265 2061 7265 206e 6f20 6772   there are no gr
-000062c0: 6f75 7062 792d 636f 6c75 6d6e 732c 2074  oupby-columns, t
-000062d0: 6865 6e20 7461 6b65 206d 696e 206f 6620  hen take min of 
-000062e0: 616c 6c20 7265 7375 6c74 730d 0a20 2020  all results..   
-000062f0: 2069 6620 6e6f 7420 6772 6f75 7062 795f   if not groupby_
-00006300: 636f 6c73 3a0d 0a20 2020 2020 2020 2064  cols:..        d
-00006310: 6620 3d20 6d69 6e69 6d75 6d5f 696e 7465  f = minimum_inte
-00006320: 7276 616c 2864 662c 2067 726f 7570 6279  rval(df, groupby
-00006330: 5f63 6f6c 733d 5b5d 290d 0a20 2020 2023  _cols=[])..    #
-00006340: 2049 6620 7468 6520 6772 6f75 7062 795f   If the groupby_
-00006350: 636f 6c73 2069 7320 6120 6c69 7374 206f  cols is a list o
-00006360: 6620 6c69 7374 732c 2074 6865 6e20 7065  f lists, then pe
-00006370: 7266 6f72 6d20 6d75 6c74 6970 6c65 206d  rform multiple m
-00006380: 696e 696d 756d 730d 0a20 2020 2065 6c69  inimums..    eli
-00006390: 6620 6973 696e 7374 616e 6365 2867 726f  f isinstance(gro
-000063a0: 7570 6279 5f63 6f6c 735b 305d 2c6c 6973  upby_cols[0],lis
-000063b0: 7429 3a0d 0a20 2020 2020 2020 2066 6f72  t):..        for
-000063c0: 2067 726f 7570 696e 6720 696e 2067 726f   grouping in gro
-000063d0: 7570 6279 5f63 6f6c 733a 0d0a 2020 2020  upby_cols:..    
-000063e0: 2020 2020 2020 2020 2320 5573 696e 6720          # Using 
-000063f0: 7468 6520 696e 7465 7276 616c 732c 2064  the intervals, d
-00006400: 6574 6572 6d69 6e65 2074 6865 2072 616e  etermine the ran
-00006410: 6765 206f 6620 706f 7373 6962 6c65 206d  ge of possible m
-00006420: 6178 696d 610d 0a20 2020 2020 2020 2020  axima..         
-00006430: 2020 2064 6620 3d20 6d69 6e69 6d75 6d5f     df = minimum_
-00006440: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
-00006450: 7570 696e 6729 0d0a 2020 2020 2320 456c  uping)..    # El
-00006460: 7365 2074 6865 2067 726f 7570 6279 5f63  se the groupby_c
-00006470: 6f6c 7320 6973 2061 206c 6973 7420 6f66  ols is a list of
-00006480: 2063 6f6c 756d 6e20 6e61 6d65 730d 0a20   column names.. 
-00006490: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000064a0: 2020 6466 203d 206d 696e 696d 756d 5f69    df = minimum_i
-000064b0: 6e74 6572 7661 6c28 6466 2c20 6772 6f75  nterval(df, grou
-000064c0: 7062 795f 636f 6c73 290d 0a20 2020 200d  pby_cols)..    .
-000064d0: 0a20 2020 2023 2043 6f6e 7665 7274 2074  .    # Convert t
-000064e0: 6865 2069 6e74 6572 7661 6c20 666f 7220  he interval for 
-000064f0: 7468 6520 6d69 6e69 6d75 6d20 696e 746f  the minimum into
-00006500: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
-00006510: 7269 6320 6e6f 7461 7469 6f6e 0d0a 2020  ric notation..  
-00006520: 2020 6466 203d 2069 6e74 6572 7661 6c5f    df = interval_
-00006530: 746f 5f63 6f6d 706f 6e65 6e74 7328 6466  to_components(df
-00006540: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00004ad0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00004ae0: 6563 6973 696f 6e5f 746f 6c65 7261 6e63  ecision_toleranc
+00004af0: 655f 746f 5f64 726f 705f 6365 6e73 6f72  e_to_drop_censor
+00004b00: 203d 2070 7265 6369 7369 6f6e 5f74 6f6c   = precision_tol
+00004b10: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
+00004b20: 656e 736f 7229 0d0a 2020 2020 0d0a 2020  ensor)..    ..  
+00004b30: 2020 2320 4372 6561 7465 2069 6e74 6572    # Create inter
+00004b40: 7661 6c20 6e6f 7461 7469 6f6e 2066 6f72  val notation for
+00004b50: 2074 6865 206d 6178 696d 756d 0d0a 2020   the maximum..  
+00004b60: 2020 6466 203d 2069 6e74 6572 7661 6c5f    df = interval_
+00004b70: 6e6f 7461 7469 6f6e 2864 662c 2070 7265  notation(df, pre
+00004b80: 6369 7369 6f6e 5f72 6f75 6e64 696e 6729  cision_rounding)
+00004b90: 0d0a 2020 2020 0d0a 2020 2020 2320 436f  ..    ..    # Co
+00004ba0: 6d62 696e 6520 7468 6520 6365 6e73 6f72  mbine the censor
+00004bb0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
+00004bc0: 706f 6e65 6e74 7320 696e 746f 2061 2072  ponents into a r
+00004bd0: 6573 756c 740d 0a20 2020 2064 6620 3d20  esult..    df = 
+00004be0: 636f 6d70 6f6e 656e 7473 5f74 6f5f 7265  components_to_re
+00004bf0: 7375 6c74 2864 662c 2070 7265 6369 7369  sult(df, precisi
+00004c00: 6f6e 5f72 6f75 6e64 696e 6729 0d0a 2020  on_rounding)..  
+00004c10: 2020 0d0a 2020 2020 2320 4472 6f70 2077    ..    # Drop w
+00004c20: 6f72 6b69 6e67 2063 6f6c 756d 6e73 0d0a  orking columns..
+00004c30: 2020 2020 6466 203d 2064 662e 6472 6f70      df = df.drop
+00004c40: 2864 662e 6669 6c74 6572 2872 6567 6578  (df.filter(regex
+00004c50: 3d27 5f5f 2729 2e63 6f6c 756d 6e73 2c20  ='__').columns, 
+00004c60: 6178 6973 3d31 290d 0a20 2020 200d 0a20  axis=1)..    .. 
+00004c70: 2020 2023 2052 656f 7264 6572 2063 6f6c     # Reorder col
+00004c80: 756d 6e73 0d0a 2020 2020 666f 7220 636f  umns..    for co
+00004c90: 6c20 696e 205b 7374 6174 5f63 6f6c 2c72  l in [stat_col,r
+00004ca0: 6573 756c 745f 636f 6c2c 6365 6e73 6f72  esult_col,censor
+00004cb0: 5f63 6f6c 2c6e 756d 6572 6963 5f63 6f6c  _col,numeric_col
+00004cc0: 2c69 6e74 6572 7661 6c5f 636f 6c5d 3a0d  ,interval_col]:.
+00004cd0: 0a20 2020 2020 2020 2064 665b 636f 6c5d  .        df[col]
+00004ce0: 203d 2064 662e 706f 7028 636f 6c29 0d0a   = df.pop(col)..
+00004cf0: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
+00004d00: 2064 660d 0a0d 0a23 2525 204d 696e 696d   df....#%% Minim
+00004d10: 756d 2052 6573 756c 740d 0a0d 0a64 6566  um Result....def
+00004d20: 206d 696e 696d 756d 5f69 6e74 6572 7661   minimum_interva
+00004d30: 6c28 6466 2c0d 0a20 2020 2020 2020 2020  l(df,..         
+00004d40: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+00004d50: 7062 795f 636f 6c73 293a 0d0a 2020 2020  pby_cols):..    
+00004d60: 2727 270d 0a20 2020 2041 2066 756e 6374  '''..    A funct
+00004d70: 696f 6e20 7468 6174 2061 6e61 6c79 7365  ion that analyse
+00004d80: 7320 7468 6520 696e 7465 7276 616c 206e  s the interval n
+00004d90: 6f74 6174 696f 6e20 666f 726d 206f 6620  otation form of 
+00004da0: 7265 7375 6c74 7320 7265 7475 726e 6564  results returned
+00004db0: 0d0a 2020 2020 6672 6f6d 2063 6f6d 706f  ..    from compo
+00004dc0: 6e65 6e74 735f 746f 5f69 6e74 6572 7661  nents_to_interva
+00004dd0: 6c20 746f 2067 656e 6572 6174 6520 6120  l to generate a 
+00004de0: 6e65 7720 696e 7465 7276 616c 2066 6f72  new interval for
+00004df0: 2074 6865 206d 696e 696d 756d 2e20 4772   the minimum. Gr
+00004e00: 6f75 7073 0d0a 2020 2020 6f66 2072 6573  oups..    of res
+00004e10: 756c 7473 2063 616e 2062 6520 6465 6669  ults can be defi
+00004e20: 6e65 6420 6279 2069 6e63 6c75 6469 6e67  ned by including
+00004e30: 2074 6865 2063 6f6c 756d 6e73 2074 6861   the columns tha
+00004e40: 7420 7368 6f75 6c64 2062 6520 7573 6564  t should be used
+00004e50: 2074 6f0d 0a20 2020 2063 7265 6174 6520   to..    create 
+00004e60: 6772 6f75 7073 2e0d 0a0d 0a20 2020 2050  groups.....    P
+00004e70: 6172 616d 6574 6572 730d 0a20 2020 202d  arameters..    -
+00004e80: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+00004e90: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
+00004ea0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
+00004eb0: 2074 6861 7420 636f 6e74 6169 6e73 2072   that contains r
+00004ec0: 6573 756c 7473 2069 6e20 6120 7370 6563  esults in a spec
+00004ed0: 6966 6963 2069 6e74 6572 7661 6c20 6e6f  ific interval no
+00004ee0: 7461 7469 6f6e 2e0d 0a20 2020 2067 726f  tation...    gro
+00004ef0: 7570 6279 5f63 6f6c 7320 3a20 6c69 7374  upby_cols : list
+00004f00: 206f 6620 7374 7269 6e67 730d 0a20 2020   of strings..   
+00004f10: 2020 2020 204c 6973 7420 6f66 2063 6f6c       List of col
+00004f20: 756d 6e20 6e61 6d65 7320 7468 6174 2073  umn names that s
+00004f30: 686f 756c 6420 6265 2075 7365 6420 746f  hould be used to
+00004f40: 2063 7265 6174 6520 6772 6f75 7073 2e0d   create groups..
+00004f50: 0a0d 0a20 2020 2052 6574 7572 6e73 0d0a  ...    Returns..
+00004f60: 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020      -------..   
+00004f70: 2064 6620 3a20 4461 7461 4672 616d 650d   df : DataFrame.
+00004f80: 0a20 2020 2020 2020 2044 6174 6146 7261  .        DataFra
+00004f90: 6d65 2074 6861 7420 6861 7320 7468 6520  me that has the 
+00004fa0: 696e 7465 7276 616c 2066 6f72 2074 6865  interval for the
+00004fb0: 206d 696e 696d 756d 2028 666f 7220 6561   minimum (for ea
+00004fc0: 6368 2067 726f 7570 2069 660d 0a20 2020  ch group if..   
+00004fd0: 2020 2020 2063 6f6c 756d 6e20 6e61 6d65       column name
+00004fe0: 7320 6172 6520 7072 6f76 6964 6564 2066  s are provided f
+00004ff0: 6f72 2067 726f 7570 696e 6729 0d0a 0d0a  or grouping)....
+00005000: 2020 2020 2727 270d 0a20 2020 200d 0a20      '''..    .. 
+00005010: 2020 2023 2043 7265 6174 6520 6120 636f     # Create a co
+00005020: 7079 206f 6620 7468 6520 4461 7461 4672  py of the DataFr
+00005030: 616d 650d 0a20 2020 2064 6620 3d20 6466  ame..    df = df
+00005040: 2e63 6f70 7928 290d 0a20 2020 200d 0a20  .copy()..    .. 
+00005050: 2020 2023 2043 7265 6174 6520 636f 6c75     # Create colu
+00005060: 6d6e 2074 6861 7420 696e 6469 6361 7465  mn that indicate
+00005070: 7320 7468 6520 6765 6e65 7261 7465 6420  s the generated 
+00005080: 7374 6174 6973 7469 6320 616e 6420 6170  statistic and ap
+00005090: 7065 6e64 2074 6f20 6772 6f75 7069 6e67  pend to grouping
+000050a0: 206c 6973 740d 0a20 2020 2064 665b 7374   list..    df[st
+000050b0: 6174 5f63 6f6c 5d20 3d20 274d 696e 696d  at_col] = 'Minim
+000050c0: 756d 270d 0a20 2020 2067 726f 7570 6279  um'..    groupby
+000050d0: 5f63 6f6c 732e 6170 7065 6e64 2873 7461  _cols.append(sta
+000050e0: 745f 636f 6c29 0d0a 2020 2020 0d0a 2020  t_col)..    ..  
+000050f0: 2020 2320 4465 7465 726d 696e 6520 6c65    # Determine le
+00005100: 6674 2062 6f75 6e64 2061 6e64 2062 6f75  ft bound and bou
+00005110: 6e64 6172 7920 666f 7220 6d69 6e69 6d75  ndary for minimu
+00005120: 6d20 666f 7220 6561 6368 2067 726f 7570  m for each group
+00005130: 2e0d 0a20 2020 200d 0a20 2020 2023 2043  ...    ..    # C
+00005140: 6f6e 7369 6465 7220 7468 6520 6d69 6e69  onsider the mini
+00005150: 6d75 6d20 626f 756e 6420 666f 7220 6561  mum bound for ea
+00005160: 6368 206c 6566 7420 626f 756e 6461 7279  ch left boundary
+00005170: 206f 7074 696f 6e20 746f 2064 6574 6572   option to deter
+00005180: 6d69 6e65 0d0a 2020 2020 2320 7768 6574  mine..    # whet
+00005190: 6865 7220 7468 6520 626f 756e 6420 7368  her the bound sh
+000051a0: 6f75 6c64 2062 6520 6f70 656e 206f 7220  ould be open or 
+000051b0: 636c 6f73 6564 2e0d 0a20 2020 206c 6566  closed...    lef
+000051c0: 7420 3d20 6466 2e67 726f 7570 6279 2867  t = df.groupby(g
+000051d0: 726f 7570 6279 5f63 6f6c 732b 5b6c 6566  roupby_cols+[lef
+000051e0: 745f 626f 756e 6461 7279 5f63 6f6c 5d29  t_boundary_col])
+000051f0: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
+00005200: 2e6d 696e 2829 2e75 6e73 7461 636b 286c  .min().unstack(l
+00005210: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
+00005220: 290d 0a20 2020 2023 2043 7265 6174 6520  )..    # Create 
+00005230: 6d69 7373 696e 6720 636f 6c75 6d6e 730d  missing columns.
+00005240: 0a20 2020 2066 6f72 2069 7465 6d20 696e  .    for item in
+00005250: 205b 274f 7065 6e27 2c27 436c 6f73 6564   ['Open','Closed
+00005260: 275d 3a0d 0a20 2020 2020 2020 2069 6620  ']:..        if 
+00005270: 6974 656d 206e 6f74 2069 6e20 6c65 6674  item not in left
+00005280: 2e63 6f6c 756d 6e73 3a0d 0a20 2020 2020  .columns:..     
+00005290: 2020 2020 2020 206c 6566 745b 6974 656d         left[item
+000052a0: 5d20 3d20 6e70 2e6e 616e 0d0a 2020 2020  ] = np.nan..    
+000052b0: 2320 5573 6520 7468 6520 6d69 6e69 6d75  # Use the minimu
+000052c0: 6d20 636c 6f73 6564 2062 6f75 6e64 6172  m closed boundar
+000052d0: 7920 6966 2074 6865 7265 2061 7265 206e  y if there are n
+000052e0: 6f20 6f70 656e 2062 6f75 6e64 6172 6965  o open boundarie
+000052f0: 7320 6f72 0d0a 2020 2020 2320 6966 2074  s or..    # if t
+00005300: 6865 2063 6c6f 7365 6420 626f 756e 6461  he closed bounda
+00005310: 7279 2069 7320 6c65 7373 2074 6861 6e20  ry is less than 
+00005320: 6f72 2065 7175 616c 2074 6f20 7468 6520  or equal to the 
+00005330: 6c65 6173 7420 6f70 656e 2062 6f75 6e64  least open bound
+00005340: 6172 790d 0a20 2020 2063 6f6e 6469 7469  ary..    conditi
+00005350: 6f6e 203d 2028 6c65 6674 5b27 436c 6f73  on = (left['Clos
+00005360: 6564 275d 203c 3d20 6c65 6674 5b27 4f70  ed'] <= left['Op
+00005370: 656e 275d 2920 7c20 286c 6566 745b 274f  en']) | (left['O
+00005380: 7065 6e27 5d2e 6973 6e61 2829 290d 0a20  pen'].isna()).. 
+00005390: 2020 206c 6566 745b 6c65 6674 5f62 6f75     left[left_bou
+000053a0: 6e64 6172 795f 636f 6c5d 203d 206e 702e  ndary_col] = np.
+000053b0: 7768 6572 6528 636f 6e64 6974 696f 6e2c  where(condition,
+000053c0: 2743 6c6f 7365 6427 2c27 4f70 656e 2729  'Closed','Open')
+000053d0: 0d0a 2020 2020 6c65 6674 5b6c 6566 745f  ..    left[left_
+000053e0: 626f 756e 645f 636f 6c5d 203d 206e 702e  bound_col] = np.
+000053f0: 7768 6572 6528 636f 6e64 6974 696f 6e2c  where(condition,
+00005400: 6c65 6674 5b27 436c 6f73 6564 275d 2c6c  left['Closed'],l
+00005410: 6566 745b 274f 7065 6e27 5d29 0d0a 2020  eft['Open'])..  
+00005420: 2020 6c65 6674 203d 206c 6566 745b 5b6c    left = left[[l
+00005430: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
+00005440: 2c6c 6566 745f 626f 756e 645f 636f 6c5d  ,left_bound_col]
+00005450: 5d0d 0a20 2020 200d 0a20 2020 2023 2044  ]..    ..    # D
+00005460: 6574 6572 6d69 6e65 2072 6967 6874 2062  etermine right b
+00005470: 6f75 6e64 2061 6e64 2062 6f75 6e64 6172  ound and boundar
+00005480: 7920 666f 7220 6d69 6e69 6d75 6d20 666f  y for minimum fo
+00005490: 7220 6561 6368 2067 726f 7570 2e0d 0a20  r each group... 
+000054a0: 2020 200d 0a20 2020 2023 2043 6f6e 7369     ..    # Consi
+000054b0: 6465 7220 7468 6520 6d69 6e69 6d75 6d20  der the minimum 
+000054c0: 626f 756e 6420 666f 7220 6561 6368 2072  bound for each r
+000054d0: 6967 6874 2062 6f75 6e64 6172 7920 6f70  ight boundary op
+000054e0: 7469 6f6e 2074 6f20 6465 7465 726d 696e  tion to determin
+000054f0: 650d 0a20 2020 2023 2077 6865 7468 6572  e..    # whether
+00005500: 2074 6865 2062 6f75 6e64 2073 686f 756c   the bound shoul
+00005510: 6420 6265 206f 7065 6e20 6f72 2063 6c6f  d be open or clo
+00005520: 7365 642e 0d0a 2020 2020 7269 6768 7420  sed...    right 
+00005530: 3d20 6466 2e67 726f 7570 6279 2867 726f  = df.groupby(gro
+00005540: 7570 6279 5f63 6f6c 732b 5b72 6967 6874  upby_cols+[right
+00005550: 5f62 6f75 6e64 6172 795f 636f 6c5d 295b  _boundary_col])[
+00005560: 7269 6768 745f 626f 756e 645f 636f 6c5d  right_bound_col]
+00005570: 2e6d 696e 2829 2e75 6e73 7461 636b 2872  .min().unstack(r
+00005580: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+00005590: 6c29 0d0a 2020 2020 2320 4372 6561 7465  l)..    # Create
+000055a0: 206d 6973 7369 6e67 2063 6f6c 756d 6e73   missing columns
+000055b0: 0d0a 2020 2020 666f 7220 6974 656d 2069  ..    for item i
+000055c0: 6e20 5b27 4f70 656e 272c 2743 6c6f 7365  n ['Open','Close
+000055d0: 6427 5d3a 0d0a 2020 2020 2020 2020 6966  d']:..        if
+000055e0: 2069 7465 6d20 6e6f 7420 696e 2072 6967   item not in rig
+000055f0: 6874 2e63 6f6c 756d 6e73 3a0d 0a20 2020  ht.columns:..   
+00005600: 2020 2020 2020 2020 2072 6967 6874 5b69           right[i
+00005610: 7465 6d5d 203d 206e 702e 6e61 6e0d 0a20  tem] = np.nan.. 
+00005620: 2020 2023 2055 7365 2074 6865 206d 696e     # Use the min
+00005630: 696d 756d 2063 6c6f 7365 6420 626f 756e  imum closed boun
+00005640: 6461 7279 2069 6620 7468 6572 6520 6172  dary if there ar
+00005650: 6520 6e6f 206f 7065 6e20 626f 756e 6461  e no open bounda
+00005660: 7269 6573 206f 720d 0a20 2020 2023 2069  ries or..    # i
+00005670: 6620 7468 6520 636c 6f73 6564 2062 6f75  f the closed bou
+00005680: 6e64 6172 7920 6973 206c 6573 7320 7468  ndary is less th
+00005690: 616e 2074 6865 206c 6561 7374 206f 7065  an the least ope
+000056a0: 6e20 626f 756e 6461 7279 0d0a 2020 2020  n boundary..    
+000056b0: 636f 6e64 6974 696f 6e20 3d20 2872 6967  condition = (rig
+000056c0: 6874 5b27 436c 6f73 6564 275d 203c 2072  ht['Closed'] < r
+000056d0: 6967 6874 5b27 4f70 656e 275d 2920 7c20  ight['Open']) | 
+000056e0: 2872 6967 6874 5b27 4f70 656e 275d 2e69  (right['Open'].i
+000056f0: 736e 6128 2929 0d0a 2020 2020 7269 6768  sna())..    righ
+00005700: 745b 7269 6768 745f 626f 756e 645f 636f  t[right_bound_co
+00005710: 6c5d 203d 206e 702e 7768 6572 6528 636f  l] = np.where(co
+00005720: 6e64 6974 696f 6e2c 7269 6768 745b 2743  ndition,right['C
+00005730: 6c6f 7365 6427 5d2c 7269 6768 745b 274f  losed'],right['O
+00005740: 7065 6e27 5d29 0d0a 2020 2020 7269 6768  pen'])..    righ
+00005750: 745b 7269 6768 745f 626f 756e 6461 7279  t[right_boundary
+00005760: 5f63 6f6c 5d20 3d20 6e70 2e77 6865 7265  _col] = np.where
+00005770: 2863 6f6e 6469 7469 6f6e 2c27 436c 6f73  (condition,'Clos
+00005780: 6564 272c 274f 7065 6e27 290d 0a20 2020  ed','Open')..   
+00005790: 2072 6967 6874 203d 2072 6967 6874 5b5b   right = right[[
+000057a0: 7269 6768 745f 626f 756e 645f 636f 6c2c  right_bound_col,
+000057b0: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
+000057c0: 6f6c 5d5d 0d0a 2020 2020 0d0a 2020 2020  ol]]..    ..    
+000057d0: 2320 4d65 7267 6520 7468 6520 7477 6f20  # Merge the two 
+000057e0: 626f 756e 6461 7269 6573 2074 6f20 6372  boundaries to cr
+000057f0: 6561 7465 2074 6865 2069 6e74 6572 7661  eate the interva
+00005800: 6c20 666f 7220 7468 6520 6d69 6e69 6d75  l for the minimu
+00005810: 6d0d 0a20 2020 2023 2043 6865 636b 2074  m..    # Check t
+00005820: 6861 7420 7468 6520 6d65 7267 6520 6973  hat the merge is
+00005830: 2031 2d74 6f2d 310d 0a20 2020 2064 6620   1-to-1..    df 
+00005840: 3d20 6c65 6674 2e6d 6572 6765 2872 6967  = left.merge(rig
+00005850: 6874 2c20 686f 7720 3d20 276f 7574 6572  ht, how = 'outer
+00005860: 272c 206f 6e20 3d20 6772 6f75 7062 795f  ', on = groupby_
+00005870: 636f 6c73 2c20 7661 6c69 6461 7465 203d  cols, validate =
+00005880: 2027 313a 3127 290d 0a20 2020 200d 0a20   '1:1')..    .. 
+00005890: 2020 2023 2052 6573 6574 2069 6e64 6578     # Reset index
+000058a0: 0d0a 2020 2020 6466 203d 2064 662e 7265  ..    df = df.re
+000058b0: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
+000058c0: 200d 0a20 2020 2072 6574 7572 6e20 6466   ..    return df
+000058d0: 0d0a 0d0a 6465 6620 6d69 6e69 6d75 6d28  ....def minimum(
+000058e0: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
+000058f0: 2072 6573 756c 7473 5f63 6f6c 2c0d 0a20   results_col,.. 
+00005900: 2020 2020 2020 2020 2020 2067 726f 7570             group
+00005910: 6279 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d  by_cols = None,.
+00005920: 0a20 2020 2020 2020 2020 2020 2069 6e63  .            inc
+00005930: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
+00005940: 7465 7276 616c 203d 2046 616c 7365 2c0d  terval = False,.
+00005950: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00005960: 6369 7369 6f6e 5f74 6f6c 6572 616e 6365  cision_tolerance
+00005970: 5f74 6f5f 6472 6f70 5f63 656e 736f 7220  _to_drop_censor 
+00005980: 3d20 302e 3235 2c0d 0a20 2020 2020 2020  = 0.25,..       
+00005990: 2020 2020 2070 7265 6369 7369 6f6e 5f72       precision_r
+000059a0: 6f75 6e64 696e 6720 3d20 5472 7565 293a  ounding = True):
+000059b0: 0d0a 2020 2020 2727 270d 0a20 2020 2041  ..    '''..    A
+000059c0: 2066 756e 6374 696f 6e20 7468 6174 2063   function that c
+000059d0: 6f6d 6269 6e65 7320 7468 6520 7265 6c65  ombines the rele
+000059e0: 7661 6e74 206d 696e 696d 756d 2061 6e64  vant minimum and
+000059f0: 2075 7469 6c69 7479 2066 756e 6374 696f   utility functio
+00005a00: 6e73 2074 6f0d 0a20 2020 2067 656e 6572  ns to..    gener
+00005a10: 6174 6520 7468 6520 6d69 6e69 6d61 2072  ate the minima r
+00005a20: 6573 756c 7473 2066 6f72 2067 726f 7570  esults for group
+00005a30: 7320 7769 7468 696e 2061 2044 6174 6146  s within a DataF
+00005a40: 7261 6d65 2e0d 0a0d 0a20 2020 2050 6172  rame.....    Par
+00005a50: 616d 6574 6572 730d 0a20 2020 202d 2d2d  ameters..    ---
+00005a60: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
+00005a70: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
+00005a80: 2020 2020 2044 6174 6146 7261 6d65 2074       DataFrame t
+00005a90: 6861 7420 636f 6e74 6169 6e73 2063 656e  hat contains cen
+00005aa0: 736f 7265 6420 6f72 2075 6e63 656e 736f  sored or uncenso
+00005ab0: 7265 6420 7265 7375 6c74 730d 0a20 2020  red results..   
+00005ac0: 2072 6573 756c 7473 5f63 6f6c 203a 2073   results_col : s
+00005ad0: 7472 696e 670d 0a20 2020 2020 2020 2054  tring..        T
+00005ae0: 6865 2063 6f6c 756d 6e20 6e61 6d65 2066  he column name f
+00005af0: 6f72 2074 6865 2063 6f6c 756d 6e20 7468  or the column th
+00005b00: 6174 2063 6f6e 7461 696e 2074 6865 2072  at contain the r
+00005b10: 6573 756c 7473 2061 7320 7465 7874 2e0d  esults as text..
+00005b20: 0a20 2020 2020 2020 204f 6e6c 7920 666f  .        Only fo
+00005b30: 7572 2070 6f73 7369 626c 6520 6365 6e73  ur possible cens
+00005b40: 6f72 7320 7368 6f75 6c64 2062 6520 7573  ors should be us
+00005b50: 6564 2028 3c2c e289 a42c e289 a52c 3e29  ed (<,...,...,>)
+00005b60: 2e0d 0a20 2020 2067 726f 7570 6279 5f63  ...    groupby_c
+00005b70: 6f6c 7320 3a20 6c69 7374 7320 6f66 2073  ols : lists of s
+00005b80: 7472 696e 6773 2028 6f72 206c 6973 7420  trings (or list 
+00005b90: 6f66 206c 6973 7473 292c 206f 7074 696f  of lists), optio
+00005ba0: 6e61 6c0d 0a20 2020 2020 2020 204c 6973  nal..        Lis
+00005bb0: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
+00005bc0: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
+00005bd0: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
+00005be0: 6772 6f75 7073 2e20 4120 6d69 6e69 6d75  groups. A minimu
+00005bf0: 6d0d 0a20 2020 2020 2020 2077 696c 6c20  m..        will 
+00005c00: 6265 2066 6f75 6e64 2077 6974 6869 6e20  be found within 
+00005c10: 6561 6368 2067 726f 7570 2e20 4d75 6c74  each group. Mult
+00005c20: 6970 6c65 206c 6973 7473 2063 616e 2062  iple lists can b
+00005c30: 6520 7375 7070 6c69 6564 2074 6f0d 0a20  e supplied to.. 
+00005c40: 2020 2020 2020 2070 6572 666f 726d 2073         perform s
+00005c50: 6571 7565 6e74 6961 6c20 6d69 6e69 6d61  equential minima
+00005c60: 2062 6566 6f72 6520 636f 6e76 6572 7469   before converti
+00005c70: 6e67 2069 6e74 6572 7661 6c73 2074 6f20  ng intervals to 
+00005c80: 6120 7265 7375 6c74 2e0d 0a20 2020 2020  a result...     
+00005c90: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
+00005ca0: 7320 4e6f 6e65 2e0d 0a20 2020 2069 6e63  s None...    inc
+00005cb0: 6c75 6465 5f6e 6567 6174 6976 655f 696e  lude_negative_in
+00005cc0: 7465 7276 616c 203a 2062 6f6f 6c65 616e  terval : boolean
+00005cd0: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+00005ce0: 2020 2020 4966 2054 7275 652c 2074 6865      If True, the
+00005cf0: 6e20 616c 6c20 706f 7369 7469 7665 2061  n all positive a
+00005d00: 6e64 206e 6567 6174 6976 6520 7661 6c75  nd negative valu
+00005d10: 6573 2061 7265 2063 6f6e 7369 6465 7265  es are considere
+00005d20: 640d 0a20 2020 2020 2020 2065 2e67 2e2c  d..        e.g.,
+00005d30: 203c 302e 3520 776f 756c 6420 6265 2063   <0.5 would be c
+00005d40: 6f6e 7665 7274 6564 2074 6f20 282d 6e70  onverted to (-np
+00005d50: 2e69 6e66 2c35 292e 0d0a 2020 2020 2020  .inf,5)...      
+00005d60: 2020 4966 2046 616c 7365 2c20 7468 656e    If False, then
+00005d70: 206f 6e6c 7920 6e6f 6e2d 6e65 6761 7469   only non-negati
+00005d80: 7665 2076 616c 7565 7320 6172 6520 636f  ve values are co
+00005d90: 6e73 6964 6572 6564 0d0a 2020 2020 2020  nsidered..      
+00005da0: 2020 652e 672e 2c20 3c30 2e35 2077 6f75    e.g., <0.5 wou
+00005db0: 6c64 2062 6520 636f 6e76 6572 7465 6420  ld be converted 
+00005dc0: 746f 205b 302c 3529 2e0d 0a20 2020 2020  to [0,5)...     
+00005dd0: 2020 2054 6869 7320 7365 7474 696e 6720     This setting 
+00005de0: 6f6e 6c79 2061 6666 6563 7473 2072 6573  only affects res
+00005df0: 756c 7473 2069 6620 666f 6375 735f 6869  ults if focus_hi
+00005e00: 6768 5f70 6f74 656e 7469 616c 2069 7320  gh_potential is 
+00005e10: 4661 6c73 652e 0d0a 2020 2020 2020 2020  False...        
+00005e20: 5468 6520 6465 6661 756c 7420 6973 2046  The default is F
+00005e30: 616c 7365 2e0d 0a20 2020 2070 7265 6369  alse...    preci
+00005e40: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
+00005e50: 6f5f 6472 6f70 5f63 656e 736f 7220 3a20  o_drop_censor : 
+00005e60: 666c 6f61 742c 206f 7074 696f 6e61 6c0d  float, optional.
+00005e70: 0a20 2020 2020 2020 2054 6872 6573 686f  .        Thresho
+00005e80: 6c64 2066 6f72 2072 6570 6f72 7469 6e67  ld for reporting
+00005e90: 2063 656e 736f 7265 6420 7673 206e 6f6e   censored vs non
+00005ea0: 2d63 656e 736f 7265 6420 7265 7375 6c74  -censored result
+00005eb0: 732e 0d0a 2020 2020 2020 2020 5573 696e  s...        Usin
+00005ec0: 6720 7468 6520 6465 6661 756c 742c 2061  g the default, a
+00005ed0: 2072 6573 756c 7420 7468 6174 2069 7320   result that is 
+00005ee0: 6b6e 6f77 6e20 746f 2062 6520 696e 2074  known to be in t
+00005ef0: 6865 2069 6e74 6572 7661 6c20 2830 2e33  he interval (0.3
+00005f00: 2c20 302e 3529 0d0a 2020 2020 2020 2020  , 0.5)..        
+00005f10: 776f 756c 6420 6265 2072 6574 7572 6e65  would be returne
+00005f20: 6420 6173 2030 2e34 2c20 7768 6572 6561  d as 0.4, wherea
+00005f30: 7320 6120 746f 6c65 7261 6e63 6520 6f66  s a tolerance of
+00005f40: 2030 2077 6f75 6c64 2079 6965 6c64 2061   0 would yield a
+00005f50: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00005f60: 206f 6620 3c30 2e35 206f 7220 3e30 2e33   of <0.5 or >0.3
+00005f70: 2064 6570 656e 6469 6e67 206f 6e20 7468   depending on th
+00005f80: 6520 7661 6c75 6520 6f66 2066 6f63 7573  e value of focus
+00005f90: 5f68 6967 6865 7374 5f70 6f74 656e 7469  _highest_potenti
+00005fa0: 616c 2e0d 0a20 2020 2020 2020 2054 6865  al...        The
+00005fb0: 2064 6566 6175 6c74 2069 7320 302e 3235   default is 0.25
+00005fc0: 2e0d 0a20 2020 2070 7265 6369 7369 6f6e  ...    precision
+00005fd0: 5f72 6f75 6e64 696e 6720 3a20 626f 6f6c  _rounding : bool
+00005fe0: 6561 6e2c 206f 7074 696f 6e61 6c0d 0a20  ean, optional.. 
+00005ff0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00006000: 6120 726f 756e 6469 6e67 206d 6574 686f  a rounding metho
+00006010: 6420 6973 2061 7070 6c69 6564 2074 6f20  d is applied to 
+00006020: 726f 756e 6420 7265 7375 6c74 7320 746f  round results to
+00006030: 2068 6176 6520 6e6f 206d 6f72 650d 0a20   have no more.. 
+00006040: 2020 2020 2020 2064 6563 696d 616c 7320         decimals 
+00006050: 7468 616e 2077 6861 7420 6361 6e20 6265  than what can be
+00006060: 206d 6561 7375 7265 642e 0d0a 2020 2020   measured...    
+00006070: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
+00006080: 6973 2054 7275 652e 0d0a 0d0a 2020 2020  is True.....    
+00006090: 5265 7475 726e 730d 0a20 2020 202d 2d2d  Returns..    ---
+000060a0: 2d2d 2d2d 0d0a 2020 2020 6466 203a 2044  ----..    df : D
+000060b0: 6174 6146 7261 6d65 0d0a 2020 2020 2020  ataFrame..      
+000060c0: 2020 4461 7461 4672 616d 6520 7468 6174    DataFrame that
+000060d0: 2063 6f6e 7461 696e 7320 6120 636f 6c75   contains a colu
+000060e0: 6d6e 2077 6974 6820 7468 6520 7265 6c65  mn with the rele
+000060f0: 7661 6e74 206d 696e 696d 756d 206f 7220  vant minimum or 
+00006100: 6d69 6e69 6d61 0d0a 0d0a 2020 2020 2727  minima....    ''
+00006110: 270d 0a20 2020 200d 0a20 2020 2023 2043  '..    ..    # C
+00006120: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
+00006130: 7468 6520 4461 7461 4672 616d 650d 0a20  the DataFrame.. 
+00006140: 2020 2064 6620 3d20 6466 2e63 6f70 7928     df = df.copy(
+00006150: 290d 0a20 2020 200d 0a20 2020 2023 2053  )..    ..    # S
+00006160: 706c 6974 2074 6865 2072 6573 756c 7420  plit the result 
+00006170: 696e 746f 2063 656e 736f 7220 616e 6420  into censor and 
+00006180: 6e75 6d65 7269 6320 636f 6d70 6f6e 656e  numeric componen
+00006190: 7473 0d0a 2020 2020 6466 203d 2072 6573  ts..    df = res
+000061a0: 756c 745f 746f 5f63 6f6d 706f 6e65 6e74  ult_to_component
+000061b0: 7328 6466 2c72 6573 756c 7473 5f63 6f6c  s(df,results_col
+000061c0: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
+000061d0: 6f6e 7665 7274 2074 6865 2072 6573 756c  onvert the resul
+000061e0: 7473 2066 726f 6d20 6365 6e73 6f72 2061  ts from censor a
+000061f0: 6e64 206e 756d 6572 6963 2063 6f6d 706f  nd numeric compo
+00006200: 6e65 6e74 7320 746f 2061 6e20 696e 7465  nents to an inte
+00006210: 7276 616c 2072 6570 7265 7365 6e74 6174  rval representat
+00006220: 696f 6e0d 0a20 2020 2064 6620 3d20 636f  ion..    df = co
+00006230: 6d70 6f6e 656e 7473 5f74 6f5f 696e 7465  mponents_to_inte
+00006240: 7276 616c 2864 662c 2069 6e63 6c75 6465  rval(df, include
+00006250: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
+00006260: 616c 290d 0a20 2020 200d 0a20 2020 2023  al)..    ..    #
+00006270: 2055 7369 6e67 2074 6865 2069 6e74 6572   Using the inter
+00006280: 7661 6c73 2c20 6465 7465 726d 696e 6520  vals, determine 
+00006290: 7468 6520 7261 6e67 6520 6f66 2070 6f73  the range of pos
+000062a0: 7369 626c 6520 6d69 6e69 6d61 0d0a 2020  sible minima..  
+000062b0: 2020 0d0a 2020 2020 2320 4966 2074 6865    ..    # If the
+000062c0: 7265 2061 7265 206e 6f20 6772 6f75 7062  re are no groupb
+000062d0: 792d 636f 6c75 6d6e 732c 2074 6865 6e20  y-columns, then 
+000062e0: 7461 6b65 206d 696e 206f 6620 616c 6c20  take min of all 
+000062f0: 7265 7375 6c74 730d 0a20 2020 2069 6620  results..    if 
+00006300: 6e6f 7420 6772 6f75 7062 795f 636f 6c73  not groupby_cols
+00006310: 3a0d 0a20 2020 2020 2020 2064 6620 3d20  :..        df = 
+00006320: 6d69 6e69 6d75 6d5f 696e 7465 7276 616c  minimum_interval
+00006330: 2864 662c 2067 726f 7570 6279 5f63 6f6c  (df, groupby_col
+00006340: 733d 5b5d 290d 0a20 2020 2023 2049 6620  s=[])..    # If 
+00006350: 7468 6520 6772 6f75 7062 795f 636f 6c73  the groupby_cols
+00006360: 2069 7320 6120 6c69 7374 206f 6620 6c69   is a list of li
+00006370: 7374 732c 2074 6865 6e20 7065 7266 6f72  sts, then perfor
+00006380: 6d20 6d75 6c74 6970 6c65 206d 696e 696d  m multiple minim
+00006390: 756d 730d 0a20 2020 2065 6c69 6620 6973  ums..    elif is
+000063a0: 696e 7374 616e 6365 2867 726f 7570 6279  instance(groupby
+000063b0: 5f63 6f6c 735b 305d 2c6c 6973 7429 3a0d  _cols[0],list):.
+000063c0: 0a20 2020 2020 2020 2066 6f72 2067 726f  .        for gro
+000063d0: 7570 696e 6720 696e 2067 726f 7570 6279  uping in groupby
+000063e0: 5f63 6f6c 733a 0d0a 2020 2020 2020 2020  _cols:..        
+000063f0: 2020 2020 2320 5573 696e 6720 7468 6520      # Using the 
+00006400: 696e 7465 7276 616c 732c 2064 6574 6572  intervals, deter
+00006410: 6d69 6e65 2074 6865 2072 616e 6765 206f  mine the range o
+00006420: 6620 706f 7373 6962 6c65 206d 6178 696d  f possible maxim
+00006430: 610d 0a20 2020 2020 2020 2020 2020 2064  a..            d
+00006440: 6620 3d20 6d69 6e69 6d75 6d5f 696e 7465  f = minimum_inte
+00006450: 7276 616c 2864 662c 2067 726f 7570 696e  rval(df, groupin
+00006460: 6729 0d0a 2020 2020 2320 456c 7365 2074  g)..    # Else t
+00006470: 6865 2067 726f 7570 6279 5f63 6f6c 7320  he groupby_cols 
+00006480: 6973 2061 206c 6973 7420 6f66 2063 6f6c  is a list of col
+00006490: 756d 6e20 6e61 6d65 730d 0a20 2020 2065  umn names..    e
+000064a0: 6c73 653a 0d0a 2020 2020 2020 2020 6466  lse:..        df
+000064b0: 203d 206d 696e 696d 756d 5f69 6e74 6572   = minimum_inter
+000064c0: 7661 6c28 6466 2c20 6772 6f75 7062 795f  val(df, groupby_
+000064d0: 636f 6c73 290d 0a20 2020 200d 0a20 2020  cols)..    ..   
+000064e0: 2023 2043 6f6e 7665 7274 2074 6865 2069   # Convert the i
+000064f0: 6e74 6572 7661 6c20 666f 7220 7468 6520  nterval for the 
+00006500: 6d69 6e69 6d75 6d20 696e 746f 2063 656e  minimum into cen
+00006510: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
+00006520: 6e6f 7461 7469 6f6e 0d0a 2020 2020 6466  notation..    df
+00006530: 203d 2069 6e74 6572 7661 6c5f 746f 5f63   = interval_to_c
+00006540: 6f6d 706f 6e65 6e74 7328 6466 2c0d 0a20  omponents(df,.. 
 00006550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006560: 2020 2066 6f63 7573 5f68 6967 685f 706f     focus_high_po
-00006570: 7465 6e74 6961 6c20 3d20 4661 6c73 652c  tential = False,
-00006580: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006560: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00006570: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
+00006580: 6961 6c20 3d20 4661 6c73 652c 0d0a 2020  ial = False,..  
 00006590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065a0: 2020 696e 636c 7564 655f 6e65 6761 7469    include_negati
-000065b0: 7665 5f69 6e74 6572 7661 6c20 3d20 696e  ve_interval = in
-000065c0: 636c 7564 655f 6e65 6761 7469 7665 5f69  clude_negative_i
-000065d0: 6e74 6572 7661 6c2c 0d0a 2020 2020 2020  nterval,..      
-000065e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065f0: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00006600: 696f 6e5f 746f 6c65 7261 6e63 655f 746f  ion_tolerance_to
-00006610: 5f64 726f 705f 6365 6e73 6f72 203d 2070  _drop_censor = p
-00006620: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-00006630: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-00006640: 7229 0d0a 2020 2020 0d0a 2020 2020 2320  r)..    ..    # 
-00006650: 4372 6561 7465 2069 6e74 6572 7661 6c20  Create interval 
-00006660: 6e6f 7461 7469 6f6e 2066 6f72 2074 6865  notation for the
-00006670: 206d 696e 696d 756d 0d0a 2020 2020 6466   minimum..    df
-00006680: 203d 2069 6e74 6572 7661 6c5f 6e6f 7461   = interval_nota
-00006690: 7469 6f6e 2864 662c 2070 7265 6369 7369  tion(df, precisi
-000066a0: 6f6e 5f72 6f75 6e64 696e 6729 0d0a 2020  on_rounding)..  
-000066b0: 2020 0d0a 2020 2020 2320 436f 6d62 696e    ..    # Combin
-000066c0: 6520 7468 6520 6365 6e73 6f72 2061 6e64  e the censor and
-000066d0: 206e 756d 6572 6963 2063 6f6d 706f 6e65   numeric compone
-000066e0: 6e74 7320 696e 746f 2061 2072 6573 756c  nts into a resul
-000066f0: 740d 0a20 2020 2064 6620 3d20 636f 6d70  t..    df = comp
-00006700: 6f6e 656e 7473 5f74 6f5f 7265 7375 6c74  onents_to_result
-00006710: 2864 662c 2070 7265 6369 7369 6f6e 5f72  (df, precision_r
-00006720: 6f75 6e64 696e 6729 0d0a 2020 2020 0d0a  ounding)..    ..
-00006730: 2020 2020 2320 4472 6f70 2077 6f72 6b69      # Drop worki
-00006740: 6e67 2063 6f6c 756d 6e73 0d0a 2020 2020  ng columns..    
-00006750: 6466 203d 2064 662e 6472 6f70 2864 662e  df = df.drop(df.
-00006760: 6669 6c74 6572 2872 6567 6578 3d27 5f5f  filter(regex='__
-00006770: 2729 2e63 6f6c 756d 6e73 2c20 6178 6973  ').columns, axis
-00006780: 3d31 290d 0a20 2020 200d 0a20 2020 2023  =1)..    ..    #
-00006790: 2052 656f 7264 6572 2063 6f6c 756d 6e73   Reorder columns
-000067a0: 0d0a 2020 2020 666f 7220 636f 6c20 696e  ..    for col in
-000067b0: 205b 7374 6174 5f63 6f6c 2c72 6573 756c   [stat_col,resul
-000067c0: 745f 636f 6c2c 6365 6e73 6f72 5f63 6f6c  t_col,censor_col
-000067d0: 2c6e 756d 6572 6963 5f63 6f6c 2c69 6e74  ,numeric_col,int
-000067e0: 6572 7661 6c5f 636f 6c5d 3a0d 0a20 2020  erval_col]:..   
-000067f0: 2020 2020 2064 665b 636f 6c5d 203d 2064       df[col] = d
-00006800: 662e 706f 7028 636f 6c29 0d0a 2020 2020  f.pop(col)..    
-00006810: 0d0a 2020 2020 7265 7475 726e 2064 660d  ..    return df.
-00006820: 0a0d 0a23 2525 2041 7665 7261 6765 2052  ...#%% Average R
-00006830: 6573 756c 740d 0a0d 0a64 6566 2061 7665  esult....def ave
-00006840: 7261 6765 5f69 6e74 6572 7661 6c28 6466  rage_interval(df
-00006850: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00006860: 2020 2020 2020 2020 6772 6f75 7062 795f          groupby_
-00006870: 636f 6c73 293a 0d0a 2020 2020 2727 270d  cols):..    '''.
-00006880: 0a20 2020 2041 2066 756e 6374 696f 6e20  .    A function 
-00006890: 7468 6174 2061 6e61 6c79 7365 7320 7468  that analyses th
-000068a0: 6520 696e 7465 7276 616c 206e 6f74 6174  e interval notat
-000068b0: 696f 6e20 666f 726d 206f 6620 7265 7375  ion form of resu
-000068c0: 6c74 7320 7265 7475 726e 6564 0d0a 2020  lts returned..  
-000068d0: 2020 6672 6f6d 2063 6f6d 706f 6e65 6e74    from component
-000068e0: 735f 746f 5f69 6e74 6572 7661 6c20 746f  s_to_interval to
-000068f0: 2067 656e 6572 6174 6520 6120 6e65 7720   generate a new 
-00006900: 696e 7465 7276 616c 2066 6f72 2074 6865  interval for the
-00006910: 2061 7665 7261 6765 2e20 4772 6f75 7073   average. Groups
-00006920: 0d0a 2020 2020 6f66 2072 6573 756c 7473  ..    of results
-00006930: 2063 616e 2062 6520 6465 6669 6e65 6420   can be defined 
-00006940: 6279 2069 6e63 6c75 6469 6e67 2074 6865  by including the
-00006950: 2063 6f6c 756d 6e73 2074 6861 7420 7368   columns that sh
-00006960: 6f75 6c64 2062 6520 7573 6564 2074 6f0d  ould be used to.
-00006970: 0a20 2020 2063 7265 6174 6520 6772 6f75  .    create grou
-00006980: 7073 2e0d 0a0d 0a20 2020 2050 6172 616d  ps.....    Param
-00006990: 6574 6572 730d 0a20 2020 202d 2d2d 2d2d  eters..    -----
-000069a0: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
-000069b0: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
-000069c0: 2020 2044 6174 6146 7261 6d65 2074 6861     DataFrame tha
-000069d0: 7420 636f 6e74 6169 6e73 2072 6573 756c  t contains resul
-000069e0: 7473 2069 6e20 6120 7370 6563 6966 6963  ts in a specific
-000069f0: 2069 6e74 6572 7661 6c20 6e6f 7461 7469   interval notati
-00006a00: 6f6e 2e0d 0a20 2020 2067 726f 7570 6279  on...    groupby
-00006a10: 5f63 6f6c 7320 3a20 6c69 7374 206f 6620  _cols : list of 
-00006a20: 7374 7269 6e67 730d 0a20 2020 2020 2020  strings..       
-00006a30: 204c 6973 7420 6f66 2063 6f6c 756d 6e20   List of column 
-00006a40: 6e61 6d65 7320 7468 6174 2073 686f 756c  names that shoul
-00006a50: 6420 6265 2075 7365 6420 746f 2063 7265  d be used to cre
-00006a60: 6174 6520 6772 6f75 7073 2e0d 0a0d 0a20  ate groups..... 
-00006a70: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
-00006a80: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-00006a90: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-00006aa0: 2020 2020 2044 6174 6146 7261 6d65 2074       DataFrame t
-00006ab0: 6861 7420 6861 7320 7468 6520 696e 7465  hat has the inte
-00006ac0: 7276 616c 2066 6f72 2074 6865 2061 7665  rval for the ave
-00006ad0: 7261 6765 2028 666f 7220 6561 6368 2067  rage (for each g
-00006ae0: 726f 7570 2069 660d 0a20 2020 2020 2020  roup if..       
-00006af0: 2063 6f6c 756d 6e20 6e61 6d65 7320 6172   column names ar
-00006b00: 6520 7072 6f76 6964 6564 2066 6f72 2067  e provided for g
-00006b10: 726f 7570 696e 6729 0d0a 0d0a 2020 2020  rouping)....    
-00006b20: 2727 270d 0a20 2020 200d 0a20 2020 2023  '''..    ..    #
-00006b30: 2043 7265 6174 6520 6120 636f 7079 206f   Create a copy o
-00006b40: 6620 7468 6520 4461 7461 4672 616d 650d  f the DataFrame.
-00006b50: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
-00006b60: 7928 290d 0a20 2020 200d 0a20 2020 2023  y()..    ..    #
-00006b70: 2043 7265 6174 6520 636f 6c75 6d6e 2074   Create column t
-00006b80: 6861 7420 696e 6469 6361 7465 7320 7468  hat indicates th
-00006b90: 6520 6765 6e65 7261 7465 6420 7374 6174  e generated stat
-00006ba0: 6973 7469 6320 616e 6420 6170 7065 6e64  istic and append
-00006bb0: 2074 6f20 6772 6f75 7069 6e67 206c 6973   to grouping lis
-00006bc0: 740d 0a20 2020 2064 665b 7374 6174 5f63  t..    df[stat_c
-00006bd0: 6f6c 5d20 3d20 2741 7665 7261 6765 270d  ol] = 'Average'.
-00006be0: 0a20 2020 2067 726f 7570 6279 5f63 6f6c  .    groupby_col
-00006bf0: 732e 6170 7065 6e64 2873 7461 745f 636f  s.append(stat_co
-00006c00: 6c29 0d0a 2020 2020 0d0a 2020 2020 2320  l)..    ..    # 
-00006c10: 4368 616e 6765 206e 6f74 6174 696f 6e20  Change notation 
-00006c20: 6f66 2027 436c 6f73 6564 2720 616e 6420  of 'Closed' and 
-00006c30: 274f 7065 6e27 2062 6f75 6e64 6172 6965  'Open' boundarie
-00006c40: 7320 746f 2030 2061 6e64 2031 2c20 7265  s to 0 and 1, re
-00006c50: 7370 6563 7469 7665 6c79 0d0a 2020 2020  spectively..    
-00006c60: 2320 5468 6520 7072 6573 656e 6365 206f  # The presence o
-00006c70: 6620 616e 7920 6f70 656e 2062 6f75 6e64  f any open bound
-00006c80: 6172 6965 7320 6f6e 206f 6e65 2073 6964  aries on one sid
-00006c90: 6520 656e 7375 7265 2074 6861 7420 7468  e ensure that th
-00006ca0: 6520 696e 7465 7276 616c 2066 6f72 2074  e interval for t
-00006cb0: 6865 2061 7665 7261 6765 2069 7320 616c  he average is al
-00006cc0: 736f 0d0a 2020 2020 2320 6f70 656e 206f  so..    # open o
-00006cd0: 6e20 7468 6174 2073 6964 650d 0a20 2020  n that side..   
-00006ce0: 2064 665b 5b6c 6566 745f 626f 756e 6461   df[[left_bounda
-00006cf0: 7279 5f63 6f6c 2c72 6967 6874 5f62 6f75  ry_col,right_bou
-00006d00: 6e64 6172 795f 636f 6c5d 5d20 3d20 6466  ndary_col]] = df
-00006d10: 5b5b 6c65 6674 5f62 6f75 6e64 6172 795f  [[left_boundary_
-00006d20: 636f 6c2c 7269 6768 745f 626f 756e 6461  col,right_bounda
-00006d30: 7279 5f63 6f6c 5d5d 2e72 6570 6c61 6365  ry_col]].replace
-00006d40: 285b 2743 6c6f 7365 6427 2c27 4f70 656e  (['Closed','Open
-00006d50: 275d 2c20 5b30 2c31 5d29 0d0a 2020 2020  '], [0,1])..    
-00006d60: 0d0a 2020 2020 2320 4765 7420 7468 6520  ..    # Get the 
-00006d70: 6c65 6674 2f72 6967 6874 2062 6f75 6e64  left/right bound
-00006d80: 7320 6f66 2074 6865 2061 7665 7261 6765  s of the average
-00006d90: 2062 7920 6176 6572 6167 696e 6720 626f   by averaging bo
-00006da0: 756e 6473 2077 6974 6869 6e20 7468 6520  unds within the 
-00006db0: 6772 6f75 700d 0a20 2020 2023 2044 6574  group..    # Det
-00006dc0: 6572 6d69 6e65 2077 6865 7468 6572 2061  ermine whether a
-00006dd0: 6e79 204f 7065 6e20 286e 6f77 2076 616c  ny Open (now val
-00006de0: 7565 206f 6620 3129 2062 6f75 6e64 6172  ue of 1) boundar
-00006df0: 6965 7320 6578 6973 742e 2049 6620 7468  ies exist. If th
-00006e00: 6572 6520 6172 650d 0a20 2020 2023 2061  ere are..    # a
-00006e10: 6e79 206f 7065 6e20 626f 756e 6461 7269  ny open boundari
-00006e20: 6573 2075 7365 6420 696e 2074 6865 2061  es used in the a
-00006e30: 7665 7261 6765 2c20 7468 656e 2074 6865  verage, then the
-00006e40: 2072 6573 756c 7469 6e67 2061 7665 7261   resulting avera
-00006e50: 6765 2077 696c 6c20 6265 206f 7065 6e0d  ge will be open.
-00006e60: 0a20 2020 2064 6620 3d20 6466 2e67 726f  .    df = df.gro
-00006e70: 7570 6279 2867 726f 7570 6279 5f63 6f6c  upby(groupby_col
-00006e80: 7329 2e61 6767 282a 2a7b 0d0a 2020 2020  s).agg(**{..    
-00006e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ea0: 2020 2020 2020 2020 6c65 6674 5f62 6f75          left_bou
-00006eb0: 6e64 6172 795f 636f 6c3a 2028 6c65 6674  ndary_col: (left
-00006ec0: 5f62 6f75 6e64 6172 795f 636f 6c2c 2027  _boundary_col, '
-00006ed0: 6d61 7827 292c 0d0a 2020 2020 2020 2020  max'),..        
-00006ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ef0: 2020 2020 275f 5f4d 696e 696d 756d 5f5f      '__Minimum__
-00006f00: 273a 2028 6c65 6674 5f62 6f75 6e64 5f63  ': (left_bound_c
-00006f10: 6f6c 2c27 6d69 6e27 292c 0d0a 2020 2020  ol,'min'),..    
-00006f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f30: 2020 2020 2020 2020 6c65 6674 5f62 6f75          left_bou
-00006f40: 6e64 5f63 6f6c 3a20 286c 6566 745f 626f  nd_col: (left_bo
-00006f50: 756e 645f 636f 6c2c 276d 6561 6e27 292c  und_col,'mean'),
-00006f60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006f70: 2020 2020 2020 2020 2020 2020 2020 7269                ri
-00006f80: 6768 745f 626f 756e 645f 636f 6c3a 2028  ght_bound_col: (
-00006f90: 7269 6768 745f 626f 756e 645f 636f 6c2c  right_bound_col,
-00006fa0: 276d 6561 6e27 292c 0d0a 2020 2020 2020  'mean'),..      
-00006fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fc0: 2020 2020 2020 275f 5f4d 6178 696d 756d        '__Maximum
-00006fd0: 5f5f 273a 2028 7269 6768 745f 626f 756e  __': (right_boun
-00006fe0: 645f 636f 6c2c 276d 6178 2729 2c0d 0a20  d_col,'max'),.. 
-00006ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007000: 2020 2020 2020 2020 2020 2072 6967 6874             right
-00007010: 5f62 6f75 6e64 6172 795f 636f 6c3a 2028  _boundary_col: (
-00007020: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
-00007030: 6f6c 2c27 6d61 7827 290d 0a20 2020 2020  ol,'max')..     
-00007040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007050: 2020 2020 2020 207d 290d 0a20 2020 200d         })..    .
-00007060: 0a20 2020 2023 2052 6570 6c61 6365 2069  .    # Replace i
-00007070: 6e74 6567 6572 7320 7769 7468 2074 6578  ntegers with tex
-00007080: 7420 666f 7220 626f 756e 6461 7269 6573  t for boundaries
-00007090: 0d0a 2020 2020 6466 5b5b 6c65 6674 5f62  ..    df[[left_b
-000070a0: 6f75 6e64 6172 795f 636f 6c2c 7269 6768  oundary_col,righ
-000070b0: 745f 626f 756e 6461 7279 5f63 6f6c 5d5d  t_boundary_col]]
-000070c0: 203d 2064 665b 5b6c 6566 745f 626f 756e   = df[[left_boun
-000070d0: 6461 7279 5f63 6f6c 2c72 6967 6874 5f62  dary_col,right_b
-000070e0: 6f75 6e64 6172 795f 636f 6c5d 5d2e 7265  oundary_col]].re
-000070f0: 706c 6163 6528 5b30 2c31 5d2c 205b 2743  place([0,1], ['C
-00007100: 6c6f 7365 6427 2c27 4f70 656e 275d 290d  losed','Open']).
-00007110: 0a20 2020 200d 0a20 2020 2023 204d 6561  .    ..    # Mea
-00007120: 6e73 2077 6974 6820 696e 6669 6e69 7465  ns with infinite
-00007130: 2076 616c 7565 7320 7072 6f64 7563 6520   values produce 
-00007140: 6e61 6e20 7661 6c75 6573 2072 6174 6865  nan values rathe
-00007150: 7220 7468 616e 206e 702e 696e 6620 7661  r than np.inf va
-00007160: 6c75 6573 0d0a 2020 2020 2320 436f 6e76  lues..    # Conv
-00007170: 6572 7420 6e61 6e20 746f 2069 6e66 206f  ert nan to inf o
-00007180: 6e6c 7920 6966 2069 6e66 696e 6974 6520  nly if infinite 
-00007190: 7661 6c75 6573 2061 7265 2069 6e63 6c75  values are inclu
-000071a0: 6465 6420 696e 2074 6865 206d 6561 6e0d  ded in the mean.
-000071b0: 0a20 2020 2064 665b 6c65 6674 5f62 6f75  .    df[left_bou
-000071c0: 6e64 5f63 6f6c 5d20 3d20 6e70 2e77 6865  nd_col] = np.whe
-000071d0: 7265 2864 665b 275f 5f4d 696e 696d 756d  re(df['__Minimum
-000071e0: 5f5f 275d 203d 3d20 2d6e 702e 696e 662c  __'] == -np.inf,
-000071f0: 202d 6e70 2e69 6e66 2c20 6466 5b6c 6566   -np.inf, df[lef
-00007200: 745f 626f 756e 645f 636f 6c5d 290d 0a20  t_bound_col]).. 
-00007210: 2020 2064 665b 7269 6768 745f 626f 756e     df[right_boun
-00007220: 645f 636f 6c5d 203d 206e 702e 7768 6572  d_col] = np.wher
-00007230: 6528 6466 5b27 5f5f 4d61 7869 6d75 6d5f  e(df['__Maximum_
-00007240: 5f27 5d20 3d3d 206e 702e 696e 662c 206e  _'] == np.inf, n
-00007250: 702e 696e 662c 2064 665b 7269 6768 745f  p.inf, df[right_
-00007260: 626f 756e 645f 636f 6c5d 290d 0a20 2020  bound_col])..   
-00007270: 200d 0a20 2020 2023 2052 6573 6574 2069   ..    # Reset i
-00007280: 6e64 6578 0d0a 2020 2020 6466 203d 2064  ndex..    df = d
-00007290: 662e 7265 7365 745f 696e 6465 7828 290d  f.reset_index().
-000072a0: 0a20 2020 200d 0a20 2020 2072 6574 7572  .    ..    retur
-000072b0: 6e20 6466 0d0a 0d0a 6465 6620 6176 6572  n df....def aver
-000072c0: 6167 6528 6466 2c0d 0a20 2020 2020 2020  age(df,..       
-000072d0: 2020 2020 2072 6573 756c 745f 636f 6c2c       result_col,
-000072e0: 0d0a 2020 2020 2020 2020 2020 2020 6772  ..            gr
-000072f0: 6f75 7062 795f 636f 6c73 203d 204e 6f6e  oupby_cols = Non
-00007300: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00007310: 666f 6375 735f 6869 6768 5f70 6f74 656e  focus_high_poten
-00007320: 7469 616c 203d 2054 7275 652c 0d0a 2020  tial = True,..  
-00007330: 2020 2020 2020 2020 2020 696e 636c 7564            includ
-00007340: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-00007350: 7661 6c20 3d20 4661 6c73 652c 0d0a 2020  val = False,..  
-00007360: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00007370: 696f 6e5f 746f 6c65 7261 6e63 655f 746f  ion_tolerance_to
-00007380: 5f64 726f 705f 6365 6e73 6f72 203d 2030  _drop_censor = 0
-00007390: 2e32 352c 0d0a 2020 2020 2020 2020 2020  .25,..          
-000073a0: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
-000073b0: 6469 6e67 203d 2054 7275 6529 3a0d 0a20  ding = True):.. 
-000073c0: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
-000073d0: 6e63 7469 6f6e 2074 6861 7420 636f 6d62  nction that comb
-000073e0: 696e 6573 2074 6865 2072 656c 6576 616e  ines the relevan
-000073f0: 7420 6176 6572 6167 6520 616e 6420 7574  t average and ut
-00007400: 696c 6974 7920 6675 6e63 7469 6f6e 7320  ility functions 
-00007410: 746f 0d0a 2020 2020 6765 6e65 7261 7465  to..    generate
-00007420: 2074 6865 2061 7665 7261 6765 2072 6573   the average res
-00007430: 756c 7473 2066 6f72 2067 726f 7570 7320  ults for groups 
-00007440: 7769 7468 696e 2061 2044 6174 6146 7261  within a DataFra
-00007450: 6d65 2e0d 0a0d 0a20 2020 2050 6172 616d  me.....    Param
-00007460: 6574 6572 730d 0a20 2020 202d 2d2d 2d2d  eters..    -----
-00007470: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
-00007480: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
-00007490: 2020 2044 6174 6146 7261 6d65 2074 6861     DataFrame tha
-000074a0: 7420 636f 6e74 6169 6e73 2063 656e 736f  t contains censo
-000074b0: 7265 6420 6f72 2075 6e63 656e 736f 7265  red or uncensore
-000074c0: 6420 7265 7375 6c74 730d 0a20 2020 2072  d results..    r
-000074d0: 6573 756c 745f 636f 6c20 3a20 7374 7269  esult_col : stri
-000074e0: 6e67 0d0a 2020 2020 2020 2020 5468 6520  ng..        The 
-000074f0: 636f 6c75 6d6e 206e 616d 6520 666f 7220  column name for 
-00007500: 7468 6520 636f 6c75 6d6e 2074 6861 7420  the column that 
-00007510: 636f 6e74 6169 6e20 7468 6520 7265 7375  contain the resu
-00007520: 6c74 7320 6173 2074 6578 742e 0d0a 2020  lts as text...  
-00007530: 2020 2020 2020 4f6e 6c79 2066 6f75 7220        Only four 
-00007540: 706f 7373 6962 6c65 2063 656e 736f 7273  possible censors
-00007550: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
-00007560: 283c 2ce2 89a4 2ce2 89a5 2c3e 292e 0d0a  (<,...,...,>)...
-00007570: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
-00007580: 203a 206c 6973 7473 206f 6620 7374 7269   : lists of stri
-00007590: 6e67 7320 286f 7220 6c69 7374 206f 6620  ngs (or list of 
-000075a0: 6c69 7374 7329 2c20 6f70 7469 6f6e 616c  lists), optional
-000075b0: 0d0a 2020 2020 2020 2020 4c69 7374 206f  ..        List o
-000075c0: 6620 636f 6c75 6d6e 206e 616d 6573 2074  f column names t
-000075d0: 6861 7420 7368 6f75 6c64 2062 6520 7573  hat should be us
-000075e0: 6564 2074 6f20 6372 6561 7465 2067 726f  ed to create gro
-000075f0: 7570 732e 2041 6e20 6176 6572 6167 650d  ups. An average.
-00007600: 0a20 2020 2020 2020 2077 696c 6c20 6265  .        will be
-00007610: 2066 6f75 6e64 2077 6974 6869 6e20 6561   found within ea
-00007620: 6368 2067 726f 7570 2e20 4d75 6c74 6970  ch group. Multip
-00007630: 6c65 206c 6973 7473 2063 616e 2062 6520  le lists can be 
-00007640: 7375 7070 6c69 6564 2074 6f0d 0a20 2020  supplied to..   
-00007650: 2020 2020 2070 6572 666f 726d 2073 6571       perform seq
-00007660: 7565 6e74 6961 6c20 6176 6572 6167 696e  uential averagin
-00007670: 6720 6265 666f 7265 2063 6f6e 7665 7274  g before convert
-00007680: 696e 6720 696e 7465 7276 616c 7320 746f  ing intervals to
-00007690: 2061 2072 6573 756c 742e 0d0a 2020 2020   a result...    
-000076a0: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-000076b0: 6973 204e 6f6e 652e 0d0a 2020 2020 666f  is None...    fo
-000076c0: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
-000076d0: 616c 203a 2062 6f6f 6c65 616e 2c20 6f70  al : boolean, op
-000076e0: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
-000076f0: 4966 2054 7275 652c 2074 6865 6e20 696e  If True, then in
-00007700: 666f 726d 6174 696f 6e20 6f6e 2074 6865  formation on the
-00007710: 2068 6967 6865 7374 2070 6f74 656e 7469   highest potenti
-00007720: 616c 2072 6573 756c 7420 7769 6c6c 2062  al result will b
-00007730: 650d 0a20 2020 2020 2020 2066 6f63 7573  e..        focus
-00007740: 6564 206f 7665 7220 7468 6520 6c6f 7765  ed over the lowe
-00007750: 7374 2070 6f74 656e 7469 616c 2072 6573  st potential res
-00007760: 756c 742e 0d0a 2020 2020 696e 636c 7564  ult...    includ
-00007770: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-00007780: 7661 6c20 3a20 626f 6f6c 6561 6e2c 206f  val : boolean, o
-00007790: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-000077a0: 2049 6620 5472 7565 2c20 7468 656e 2061   If True, then a
-000077b0: 6c6c 2070 6f73 6974 6976 6520 616e 6420  ll positive and 
-000077c0: 6e65 6761 7469 7665 2076 616c 7565 7320  negative values 
-000077d0: 6172 6520 636f 6e73 6964 6572 6564 0d0a  are considered..
-000077e0: 2020 2020 2020 2020 652e 672e 2c20 3c30          e.g., <0
-000077f0: 2e35 2077 6f75 6c64 2062 6520 636f 6e76  .5 would be conv
-00007800: 6572 7465 6420 746f 2028 2d6e 702e 696e  erted to (-np.in
-00007810: 662c 3529 2e0d 0a20 2020 2020 2020 2049  f,5)...        I
-00007820: 6620 4661 6c73 652c 2074 6865 6e20 6f6e  f False, then on
-00007830: 6c79 206e 6f6e 2d6e 6567 6174 6976 6520  ly non-negative 
-00007840: 7661 6c75 6573 2061 7265 2063 6f6e 7369  values are consi
-00007850: 6465 7265 640d 0a20 2020 2020 2020 2065  dered..        e
-00007860: 2e67 2e2c 203c 302e 3520 776f 756c 6420  .g., <0.5 would 
-00007870: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
-00007880: 5b30 2c35 292e 0d0a 2020 2020 2020 2020  [0,5)...        
-00007890: 5468 6973 2073 6574 7469 6e67 206f 6e6c  This setting onl
-000078a0: 7920 6166 6665 6374 7320 7265 7375 6c74  y affects result
-000078b0: 7320 6966 2066 6f63 7573 5f68 6967 685f  s if focus_high_
-000078c0: 706f 7465 6e74 6961 6c20 6973 2046 616c  potential is Fal
-000078d0: 7365 2e0d 0a20 2020 2020 2020 2054 6865  se...        The
-000078e0: 2064 6566 6175 6c74 2069 7320 4661 6c73   default is Fals
-000078f0: 652e 0d0a 2020 2020 7072 6563 6973 696f  e...    precisio
-00007900: 6e5f 746f 6c65 7261 6e63 655f 746f 5f64  n_tolerance_to_d
-00007910: 726f 705f 6365 6e73 6f72 203a 2066 6c6f  rop_censor : flo
-00007920: 6174 2c20 6f70 7469 6f6e 616c 0d0a 2020  at, optional..  
-00007930: 2020 2020 2020 5468 7265 7368 6f6c 6420        Threshold 
-00007940: 666f 7220 7265 706f 7274 696e 6720 6365  for reporting ce
-00007950: 6e73 6f72 6564 2076 7320 6e6f 6e2d 6365  nsored vs non-ce
-00007960: 6e73 6f72 6564 2072 6573 756c 7473 2e0d  nsored results..
-00007970: 0a20 2020 2020 2020 2055 7369 6e67 2074  .        Using t
-00007980: 6865 2064 6566 6175 6c74 2c20 6120 7265  he default, a re
-00007990: 7375 6c74 2074 6861 7420 6973 206b 6e6f  sult that is kno
-000079a0: 776e 2074 6f20 6265 2069 6e20 7468 6520  wn to be in the 
-000079b0: 696e 7465 7276 616c 2028 302e 332c 2030  interval (0.3, 0
-000079c0: 2e35 290d 0a20 2020 2020 2020 2077 6f75  .5)..        wou
-000079d0: 6c64 2062 6520 7265 7475 726e 6564 2061  ld be returned a
-000079e0: 7320 302e 342c 2077 6865 7265 6173 2061  s 0.4, whereas a
-000079f0: 2074 6f6c 6572 616e 6365 206f 6620 3020   tolerance of 0 
-00007a00: 776f 756c 6420 7969 656c 6420 610d 0a20  would yield a.. 
-00007a10: 2020 2020 2020 2072 6573 756c 7420 6f66         result of
-00007a20: 203c 302e 3520 6f72 203e 302e 3320 6465   <0.5 or >0.3 de
-00007a30: 7065 6e64 696e 6720 6f6e 2074 6865 2076  pending on the v
-00007a40: 616c 7565 206f 6620 666f 6375 735f 6869  alue of focus_hi
-00007a50: 6768 6573 745f 706f 7465 6e74 6961 6c2e  ghest_potential.
-00007a60: 0d0a 2020 2020 2020 2020 5468 6520 6465  ..        The de
-00007a70: 6661 756c 7420 6973 2030 2e32 352e 0d0a  fault is 0.25...
-00007a80: 2020 2020 7072 6563 6973 696f 6e5f 726f      precision_ro
-00007a90: 756e 6469 6e67 203a 2062 6f6f 6c65 616e  unding : boolean
-00007aa0: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
-00007ab0: 2020 2020 4966 2054 7275 652c 2061 2072      If True, a r
-00007ac0: 6f75 6e64 696e 6720 6d65 7468 6f64 2069  ounding method i
-00007ad0: 7320 6170 706c 6965 6420 746f 2072 6f75  s applied to rou
-00007ae0: 6e64 2072 6573 756c 7473 2074 6f20 6861  nd results to ha
-00007af0: 7665 206e 6f20 6d6f 7265 0d0a 2020 2020  ve no more..    
-00007b00: 2020 2020 6465 6369 6d61 6c73 2074 6861      decimals tha
-00007b10: 6e20 7768 6174 2063 616e 2062 6520 6d65  n what can be me
-00007b20: 6173 7572 6564 2e0d 0a20 2020 2020 2020  asured...       
-00007b30: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-00007b40: 5472 7565 2e0d 0a0d 0a20 2020 2052 6574  True.....    Ret
-00007b50: 7572 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d  urns..    ------
-00007b60: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
-00007b70: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
-00007b80: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
-00007b90: 6e74 6169 6e73 2063 616c 6375 6c61 7465  ntains calculate
-00007ba0: 6420 6176 6572 6167 6573 0d0a 0d0a 2020  d averages....  
-00007bb0: 2020 2727 270d 0a20 2020 200d 0a20 2020    '''..    ..   
-00007bc0: 2023 2043 7265 6174 6520 6120 636f 7079   # Create a copy
-00007bd0: 206f 6620 7468 6520 4461 7461 4672 616d   of the DataFram
-00007be0: 650d 0a20 2020 2064 6620 3d20 6466 2e63  e..    df = df.c
-00007bf0: 6f70 7928 290d 0a20 2020 200d 0a20 2020  opy()..    ..   
-00007c00: 2023 2053 706c 6974 2074 6865 2072 6573   # Split the res
-00007c10: 756c 7420 696e 746f 2063 656e 736f 7220  ult into censor 
-00007c20: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
-00007c30: 6f6e 656e 7473 0d0a 2020 2020 6466 203d  onents..    df =
-00007c40: 2072 6573 756c 745f 746f 5f63 6f6d 706f   result_to_compo
-00007c50: 6e65 6e74 7328 6466 2c72 6573 756c 745f  nents(df,result_
-00007c60: 636f 6c29 0d0a 2020 2020 0d0a 2020 2020  col)..    ..    
-00007c70: 2320 436f 6e76 6572 7420 7468 6520 7265  # Convert the re
-00007c80: 7375 6c74 7320 6672 6f6d 2063 656e 736f  sults from censo
-00007c90: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
-00007ca0: 6d70 6f6e 656e 7473 2074 6f20 616e 2069  mponents to an i
-00007cb0: 6e74 6572 7661 6c20 7265 7072 6573 656e  nterval represen
-00007cc0: 7461 7469 6f6e 0d0a 2020 2020 6466 203d  tation..    df =
-00007cd0: 2063 6f6d 706f 6e65 6e74 735f 746f 5f69   components_to_i
-00007ce0: 6e74 6572 7661 6c28 6466 2c20 696e 636c  nterval(df, incl
-00007cf0: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
-00007d00: 6572 7661 6c29 0d0a 2020 2020 0d0a 2020  erval)..    ..  
-00007d10: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
-00007d20: 7465 7276 616c 732c 2064 6574 6572 6d69  tervals, determi
-00007d30: 6e65 2074 6865 2072 616e 6765 206f 6620  ne the range of 
-00007d40: 706f 7373 6962 6c65 2061 7665 7261 6765  possible average
-00007d50: 730d 0a20 2020 200d 0a20 2020 2023 2049  s..    ..    # I
-00007d60: 6620 7468 6572 6520 6172 6520 6e6f 2067  f there are no g
-00007d70: 726f 7570 6279 2d63 6f6c 756d 6e73 2c20  roupby-columns, 
-00007d80: 7468 656e 2074 616b 6520 6176 6572 6167  then take averag
-00007d90: 6520 6f66 2061 6c6c 2072 6573 756c 7473  e of all results
-00007da0: 0d0a 2020 2020 6966 206e 6f74 2067 726f  ..    if not gro
-00007db0: 7570 6279 5f63 6f6c 733a 0d0a 2020 2020  upby_cols:..    
-00007dc0: 2020 2020 6466 203d 2061 7665 7261 6765      df = average
-00007dd0: 5f69 6e74 6572 7661 6c28 6466 2c20 6772  _interval(df, gr
-00007de0: 6f75 7062 795f 636f 6c73 3d5b 5d29 0d0a  oupby_cols=[])..
-00007df0: 2020 2020 2320 4966 2074 6865 2067 726f      # If the gro
-00007e00: 7570 6279 5f63 6f6c 7320 6973 2061 206c  upby_cols is a l
-00007e10: 6973 7420 6f66 206c 6973 7473 2c20 7468  ist of lists, th
-00007e20: 656e 2070 6572 666f 726d 206d 756c 7469  en perform multi
-00007e30: 706c 6520 6176 6572 6167 6573 0d0a 2020  ple averages..  
-00007e40: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00007e50: 6528 6772 6f75 7062 795f 636f 6c73 5b30  e(groupby_cols[0
-00007e60: 5d2c 6c69 7374 293a 0d0a 2020 2020 2020  ],list):..      
-00007e70: 2020 666f 7220 6772 6f75 7069 6e67 2069    for grouping i
-00007e80: 6e20 6772 6f75 7062 795f 636f 6c73 3a0d  n groupby_cols:.
-00007e90: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
-00007ea0: 7369 6e67 2074 6865 2069 6e74 6572 7661  sing the interva
-00007eb0: 6c73 2c20 6465 7465 726d 696e 6520 7468  ls, determine th
-00007ec0: 6520 7261 6e67 6520 6f66 2070 6f73 7369  e range of possi
-00007ed0: 626c 6520 6d61 7869 6d61 0d0a 2020 2020  ble maxima..    
-00007ee0: 2020 2020 2020 2020 6466 203d 2061 7665          df = ave
-00007ef0: 7261 6765 5f69 6e74 6572 7661 6c28 6466  rage_interval(df
-00007f00: 2c20 6772 6f75 7069 6e67 290d 0a20 2020  , grouping)..   
-00007f10: 2023 2045 6c73 6520 7468 6520 6772 6f75   # Else the grou
-00007f20: 7062 795f 636f 6c73 2069 7320 6120 6c69  pby_cols is a li
-00007f30: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
-00007f40: 6573 0d0a 2020 2020 656c 7365 3a0d 0a20  es..    else:.. 
-00007f50: 2020 2020 2020 2064 6620 3d20 6176 6572         df = aver
-00007f60: 6167 655f 696e 7465 7276 616c 2864 662c  age_interval(df,
-00007f70: 2067 726f 7570 6279 5f63 6f6c 7329 0d0a   groupby_cols)..
-00007f80: 2020 2020 0d0a 2020 2020 2320 436f 6e76      ..    # Conv
-00007f90: 6572 7420 7468 6520 696e 7465 7276 616c  ert the interval
-00007fa0: 2066 6f72 2074 6865 2061 7665 7261 6765   for the average
-00007fb0: 2069 6e74 6f20 6365 6e73 6f72 2061 6e64   into censor and
-00007fc0: 206e 756d 6572 6963 206e 6f74 6174 696f   numeric notatio
-00007fd0: 6e0d 0a20 2020 2064 6620 3d20 696e 7465  n..    df = inte
-00007fe0: 7276 616c 5f74 6f5f 636f 6d70 6f6e 656e  rval_to_componen
-00007ff0: 7473 2864 662c 0d0a 2020 2020 2020 2020  ts(df,..        
-00008000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008010: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
-00008020: 6768 5f70 6f74 656e 7469 616c 203d 2066  gh_potential = f
-00008030: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
-00008040: 6961 6c2c 0d0a 2020 2020 2020 2020 2020  ial,..          
-00008050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008060: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
-00008070: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
-00008080: 3d20 696e 636c 7564 655f 6e65 6761 7469  = include_negati
-00008090: 7665 5f69 6e74 6572 7661 6c2c 0d0a 2020  ve_interval,..  
-000080a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080b0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000080c0: 6563 6973 696f 6e5f 746f 6c65 7261 6e63  ecision_toleranc
-000080d0: 655f 746f 5f64 726f 705f 6365 6e73 6f72  e_to_drop_censor
-000080e0: 203d 2070 7265 6369 7369 6f6e 5f74 6f6c   = precision_tol
-000080f0: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
-00008100: 656e 736f 7229 0d0a 2020 2020 0d0a 2020  ensor)..    ..  
-00008110: 2020 2320 4372 6561 7465 2069 6e74 6572    # Create inter
-00008120: 7661 6c20 6e6f 7461 7469 6f6e 2066 6f72  val notation for
-00008130: 2074 6865 2061 7665 7261 6765 0d0a 2020   the average..  
-00008140: 2020 6466 203d 2069 6e74 6572 7661 6c5f    df = interval_
-00008150: 6e6f 7461 7469 6f6e 2864 662c 2070 7265  notation(df, pre
-00008160: 6369 7369 6f6e 5f72 6f75 6e64 696e 6729  cision_rounding)
-00008170: 0d0a 2020 2020 0d0a 2020 2020 2320 436f  ..    ..    # Co
-00008180: 6d62 696e 6520 7468 6520 6365 6e73 6f72  mbine the censor
-00008190: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
-000081a0: 706f 6e65 6e74 7320 696e 746f 2061 2072  ponents into a r
-000081b0: 6573 756c 740d 0a20 2020 2064 6620 3d20  esult..    df = 
-000081c0: 636f 6d70 6f6e 656e 7473 5f74 6f5f 7265  components_to_re
-000081d0: 7375 6c74 2864 662c 2070 7265 6369 7369  sult(df, precisi
-000081e0: 6f6e 5f72 6f75 6e64 696e 6729 0d0a 2020  on_rounding)..  
-000081f0: 2020 0d0a 2020 2020 2320 4472 6f70 2077    ..    # Drop w
-00008200: 6f72 6b69 6e67 2063 6f6c 756d 6e73 0d0a  orking columns..
-00008210: 2020 2020 6466 203d 2064 662e 6472 6f70      df = df.drop
-00008220: 2864 662e 6669 6c74 6572 2872 6567 6578  (df.filter(regex
-00008230: 3d27 5f5f 2729 2e63 6f6c 756d 6e73 2c20  ='__').columns, 
-00008240: 6178 6973 3d31 290d 0a20 2020 200d 0a20  axis=1)..    .. 
-00008250: 2020 2023 2052 656f 7264 6572 2063 6f6c     # Reorder col
-00008260: 756d 6e73 0d0a 2020 2020 666f 7220 636f  umns..    for co
-00008270: 6c20 696e 205b 7374 6174 5f63 6f6c 2c72  l in [stat_col,r
-00008280: 6573 756c 745f 636f 6c2c 6365 6e73 6f72  esult_col,censor
-00008290: 5f63 6f6c 2c6e 756d 6572 6963 5f63 6f6c  _col,numeric_col
-000082a0: 2c69 6e74 6572 7661 6c5f 636f 6c5d 3a0d  ,interval_col]:.
-000082b0: 0a20 2020 2020 2020 2064 665b 636f 6c5d  .        df[col]
-000082c0: 203d 2064 662e 706f 7028 636f 6c29 0d0a   = df.pop(col)..
-000082d0: 2020 2020 0d0a 2020 2020 7265 7475 726e      ..    return
-000082e0: 2064 660d 0a0d 0a23 2525 2050 6572 6365   df....#%% Perce
-000082f0: 6e74 696c 6520 5265 7375 6c74 0d0a 0d0a  ntile Result....
-00008300: 6465 6620 7065 7263 656e 7469 6c65 5f69  def percentile_i
-00008310: 6e74 6572 7661 6c28 6466 2c0d 0a20 2020  nterval(df,..   
-00008320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008330: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
-00008340: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-00008350: 2020 2020 2020 2020 2020 2020 7065 7263              perc
-00008360: 656e 7469 6c65 2c0d 0a20 2020 2020 2020  entile,..       
-00008370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008380: 206d 6574 686f 6420 3d20 2768 617a 656e   method = 'hazen
-00008390: 2729 3a0d 0a20 2020 2027 2727 0d0a 2020  '):..    '''..  
-000083a0: 2020 4120 6675 6e63 7469 6f6e 2074 6861    A function tha
-000083b0: 7420 616e 616c 7973 6573 2074 6865 2069  t analyses the i
-000083c0: 6e74 6572 7661 6c20 6e6f 7461 7469 6f6e  nterval notation
-000083d0: 2066 6f72 6d20 6f66 2072 6573 756c 7473   form of results
-000083e0: 2072 6574 7572 6e65 640d 0a20 2020 2066   returned..    f
-000083f0: 726f 6d20 636f 6d70 6f6e 656e 7473 5f74  rom components_t
-00008400: 6f5f 696e 7465 7276 616c 2074 6f20 6765  o_interval to ge
-00008410: 6e65 7261 7465 2061 206e 6577 2069 6e74  nerate a new int
-00008420: 6572 7661 6c20 666f 7220 7065 7263 656e  erval for percen
-00008430: 7469 6c65 732e 2047 726f 7570 730d 0a20  tiles. Groups.. 
-00008440: 2020 206f 6620 7265 7375 6c74 7320 6361     of results ca
-00008450: 6e20 6265 2064 6566 696e 6564 2062 7920  n be defined by 
-00008460: 696e 636c 7564 696e 6720 7468 6520 636f  including the co
-00008470: 6c75 6d6e 7320 7468 6174 2073 686f 756c  lumns that shoul
-00008480: 6420 6265 2075 7365 6420 746f 0d0a 2020  d be used to..  
-00008490: 2020 6372 6561 7465 2067 726f 7570 732e    create groups.
-000084a0: 0d0a 0d0a 2020 2020 5061 7261 6d65 7465  ....    Paramete
-000084b0: 7273 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d  rs..    --------
-000084c0: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
-000084d0: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-000084e0: 4461 7461 4672 616d 6520 7468 6174 2063  DataFrame that c
-000084f0: 6f6e 7461 696e 7320 7265 7375 6c74 7320  ontains results 
-00008500: 696e 2061 2073 7065 6369 6669 6320 696e  in a specific in
-00008510: 7465 7276 616c 206e 6f74 6174 696f 6e2e  terval notation.
-00008520: 0d0a 2020 2020 6772 6f75 7062 795f 636f  ..    groupby_co
-00008530: 6c73 203a 206c 6973 7420 6f66 2073 7472  ls : list of str
-00008540: 696e 6773 0d0a 2020 2020 2020 2020 4c69  ings..        Li
-00008550: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
-00008560: 6573 2074 6861 7420 7368 6f75 6c64 2062  es that should b
-00008570: 6520 7573 6564 2074 6f20 6372 6561 7465  e used to create
-00008580: 2067 726f 7570 732e 0d0a 2020 2020 7065   groups...    pe
-00008590: 7263 656e 7469 6c65 203a 2066 6c6f 6174  rcentile : float
-000085a0: 0d0a 2020 2020 2020 2020 5468 6520 6465  ..        The de
-000085b0: 7369 7265 6420 7065 7263 656e 7469 6c65  sired percentile
-000085c0: 2e20 5661 6c75 6573 2073 686f 756c 6420  . Values should 
-000085d0: 6265 2062 6574 7765 656e 2030 2061 6e64  be between 0 and
-000085e0: 2031 3030 2e0d 0a20 2020 206d 6574 686f   100...    metho
-000085f0: 6420 3a20 7374 7269 6e67 0d0a 2020 2020  d : string..    
-00008600: 2020 2020 5468 6520 7065 7263 656e 7469      The percenti
-00008610: 6c65 206d 6574 686f 642e 2054 6865 206f  le method. The o
-00008620: 7074 696f 6e73 2061 6e64 2064 6566 696e  ptions and defin
-00008630: 6974 696f 6e73 2063 6f6d 6520 6672 6f6d  itions come from
-00008640: 3a0d 0a20 2020 2020 2020 2020 2020 2068  :..            h
-00008650: 7474 7073 3a2f 2f65 6e76 6972 6f6e 6d65  ttps://environme
-00008660: 6e74 2e67 6f76 742e 6e7a 2f61 7373 6574  nt.govt.nz/asset
-00008670: 732f 5075 626c 6963 6174 696f 6e73 2f46  s/Publications/F
-00008680: 696c 6573 2f68 617a 656e 2d70 6572 6365  iles/hazen-perce
-00008690: 6e74 696c 652d 6361 6c63 756c 6174 6f72  ntile-calculator
-000086a0: 2d32 2e78 6c73 0d0a 2020 2020 2020 2020  -2.xls..        
-000086b0: 2020 2020 4f70 7469 6f6e 7320 696e 636c      Options incl
-000086c0: 7564 6520 7468 6520 666f 6c6c 6f77 696e  ude the followin
-000086d0: 672c 206f 7264 6572 6564 2066 726f 6d20  g, ordered from 
-000086e0: 6c61 7267 6573 7420 746f 2073 6d61 6c6c  largest to small
-000086f0: 6573 7420 7265 7375 6c74 2e0d 0a20 2020  est result...   
-00008700: 2020 2020 2020 2020 202d 2077 6569 6261           - weiba
-00008710: 6c6c 0d0a 2020 2020 2020 2020 2020 2020  ll..            
-00008720: 2d20 7475 6b65 790d 0a20 2020 2020 2020  - tukey..       
-00008730: 2020 2020 202d 2062 6c6f 6d0d 0a20 2020       - blom..   
-00008740: 2020 2020 2020 2020 202d 2068 617a 656e           - hazen
-00008750: 0d0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-00008760: 6578 6365 6c0d 0a20 2020 2020 2020 2054  excel..        T
-00008770: 6865 2064 6566 6175 6c74 2069 7320 6861  he default is ha
-00008780: 7a65 6e2e 0d0a 0d0a 2020 2020 5265 7475  zen.....    Retu
-00008790: 726e 730d 0a20 2020 202d 2d2d 2d2d 2d2d  rns..    -------
-000087a0: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
-000087b0: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
-000087c0: 7461 4672 616d 6520 7468 6174 2068 6173  taFrame that has
-000087d0: 2074 6865 2069 6e74 6572 7661 6c20 666f   the interval fo
-000087e0: 7220 7468 6520 7065 7263 656e 7469 6c65  r the percentile
-000087f0: 2028 666f 7220 6561 6368 2067 726f 7570   (for each group
-00008800: 2069 660d 0a20 2020 2020 2020 2063 6f6c   if..        col
-00008810: 756d 6e20 6e61 6d65 7320 6172 6520 7072  umn names are pr
-00008820: 6f76 6964 6564 2066 6f72 2067 726f 7570  ovided for group
-00008830: 696e 6729 0d0a 0d0a 2020 2020 2727 270d  ing)....    '''.
-00008840: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
-00008850: 6174 6520 6120 636f 7079 206f 6620 7468  ate a copy of th
-00008860: 6520 4461 7461 4672 616d 650d 0a20 2020  e DataFrame..   
-00008870: 2064 6620 3d20 6466 2e63 6f70 7928 290d   df = df.copy().
-00008880: 0a20 2020 200d 0a20 2020 2023 2043 6865  .    ..    # Che
-00008890: 636b 2074 6865 2070 6572 6365 6e74 696c  ck the percentil
-000088a0: 6520 6973 2062 6574 7765 656e 2030 2061  e is between 0 a
-000088b0: 6e64 2031 0d0a 2020 2020 6966 2070 6572  nd 1..    if per
-000088c0: 6365 6e74 696c 6520 3c20 3020 6f72 2070  centile < 0 or p
-000088d0: 6572 6365 6e74 696c 6520 3e20 3130 303a  ercentile > 100:
-000088e0: 0d0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
-000088f0: 5661 6c75 6545 7272 6f72 2866 2750 6572  ValueError(f'Per
-00008900: 6365 6e74 696c 6520 6f75 7420 6f66 2072  centile out of r
-00008910: 616e 6765 2e20 4174 7465 6d70 7465 6420  ange. Attempted 
-00008920: 7065 7263 656e 7469 6c65 3a20 7b70 6572  percentile: {per
-00008930: 6365 6e74 696c 657d 2729 0d0a 2020 2020  centile}')..    
-00008940: 0d0a 2020 2020 2320 4372 6561 7465 2063  ..    # Create c
-00008950: 6f6c 756d 6e20 7468 6174 2069 6e64 6963  olumn that indic
-00008960: 6174 6573 2074 6865 2067 656e 6572 6174  ates the generat
-00008970: 6564 2073 7461 7469 7374 6963 2061 6e64  ed statistic and
-00008980: 2061 7070 656e 6420 746f 2067 726f 7570   append to group
-00008990: 696e 6720 6c69 7374 0d0a 2020 2020 6466  ing list..    df
-000089a0: 5b73 7461 745f 636f 6c5d 203d 2066 2750  [stat_col] = f'P
-000089b0: 6572 6365 6e74 696c 652d 7b70 6572 6365  ercentile-{perce
-000089c0: 6e74 696c 657d 270d 0a20 2020 2067 726f  ntile}'..    gro
-000089d0: 7570 6279 5f63 6f6c 732e 6170 7065 6e64  upby_cols.append
-000089e0: 2873 7461 745f 636f 6c29 0d0a 2020 2020  (stat_col)..    
-000089f0: 0d0a 2020 2020 2320 436f 6e76 6572 7420  ..    # Convert 
-00008a00: 7065 7263 656e 7469 6c65 2074 6f20 6265  percentile to be
-00008a10: 2062 6574 7765 656e 2030 2061 6e64 2031   between 0 and 1
-00008a20: 0d0a 2020 2020 7065 7263 656e 7469 6c65  ..    percentile
-00008a30: 203d 2070 6572 6365 6e74 696c 652f 3130   = percentile/10
-00008a40: 300d 0a20 2020 200d 0a20 2020 2023 2044  0..    ..    # D
-00008a50: 6574 6572 6d69 6e65 2073 697a 6520 6f66  etermine size of
-00008a60: 2065 6163 6820 6772 6f75 700d 0a20 2020   each group..   
-00008a70: 2064 665b 275f 5f53 697a 655f 5f27 5d20   df['__Size__'] 
-00008a80: 3d20 6466 2e67 726f 7570 6279 2867 726f  = df.groupby(gro
-00008a90: 7570 6279 5f63 6f6c 7329 2e74 7261 6e73  upby_cols).trans
-00008aa0: 666f 726d 2827 7369 7a65 2729 0d0a 2020  form('size')..  
-00008ab0: 2020 0d0a 2020 2020 2320 5365 7420 7661    ..    # Set va
-00008ac0: 6c75 6573 2066 6f72 2070 6572 6365 6e74  lues for percent
-00008ad0: 696c 6520 6d65 7468 6f64 730d 0a20 2020  ile methods..   
-00008ae0: 206d 6574 686f 645f 6469 6374 203d 207b   method_dict = {
-00008af0: 2777 6569 6261 6c6c 273a 302e 302c 2027  'weiball':0.0, '
-00008b00: 7475 6b65 7927 3a31 2f33 2c20 2762 6c6f  tukey':1/3, 'blo
-00008b10: 6d27 3a33 2f38 2c20 2768 617a 656e 273a  m':3/8, 'hazen':
-00008b20: 312f 322c 2027 6578 6365 6c27 3a31 2e30  1/2, 'excel':1.0
-00008b30: 7d0d 0a20 2020 2023 2068 7474 7073 3a2f  }..    # https:/
-00008b40: 2f65 6e2e 7769 6b69 7065 6469 612e 6f72  /en.wikipedia.or
-00008b50: 672f 7769 6b69 2f50 6572 6365 6e74 696c  g/wiki/Percentil
-00008b60: 650d 0a20 2020 2043 203d 206d 6574 686f  e..    C = metho
-00008b70: 645f 6469 6374 5b6d 6574 686f 645d 0d0a  d_dict[method]..
-00008b80: 2020 2020 0d0a 2020 2020 2320 4361 6c63      ..    # Calc
-00008b90: 756c 6174 6520 6d69 6e69 6d75 6d20 6461  ulate minimum da
-00008ba0: 7461 2073 697a 6520 666f 7220 7065 7263  ta size for perc
-00008bb0: 656e 7469 6c65 206d 6574 686f 6420 746f  entile method to
-00008bc0: 200d 0a20 2020 2023 2065 6e73 7572 6520   ..    # ensure 
-00008bd0: 7261 6e6b 2069 7320 6174 206c 6561 7374  rank is at least
-00008be0: 2031 2061 6e64 206e 6f20 6d6f 7265 2074   1 and no more t
-00008bf0: 6861 6e20 6c65 6e28 6461 7461 290d 0a20  han len(data).. 
-00008c00: 2020 206d 696e 696d 756d 5f73 697a 6520     minimum_size 
-00008c10: 3d20 726f 756e 6428 4320 2b20 2831 2d43  = round(C + (1-C
-00008c20: 292a 6d61 7828 2831 2d70 6572 6365 6e74  )*max((1-percent
-00008c30: 696c 6529 2f70 6572 6365 6e74 696c 652c  ile)/percentile,
-00008c40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c60: 2020 2020 2020 2020 2070 6572 6365 6e74           percent
-00008c70: 696c 652f 2831 2d70 6572 6365 6e74 696c  ile/(1-percentil
-00008c80: 6529 292c 3130 290d 0a20 2020 200d 0a20  e)),10)..    .. 
-00008c90: 2020 2023 204f 6e6c 7920 636f 6e73 6964     # Only consid
-00008ca0: 6572 2067 726f 7570 7320 7468 6174 206d  er groups that m
-00008cb0: 6565 7420 7468 6520 6d69 6e69 6d75 6d20  eet the minimum 
-00008cc0: 7369 7a65 2072 6571 7569 7265 6d65 6e74  size requirement
-00008cd0: 0d0a 2020 2020 6466 203d 2064 665b 6466  ..    df = df[df
-00008ce0: 5b27 5f5f 5369 7a65 5f5f 275d 203e 3d20  ['__Size__'] >= 
-00008cf0: 6d69 6e69 6d75 6d5f 7369 7a65 5d0d 0a20  minimum_size].. 
-00008d00: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
-00008d10: 6d69 6e65 206c 6566 7420 626f 756e 6420  mine left bound 
-00008d20: 616e 6420 626f 756e 6461 7279 2066 6f72  and boundary for
-00008d30: 2065 6163 6820 6772 6f75 700d 0a20 2020   each group..   
-00008d40: 200d 0a20 2020 2023 2043 6861 6e67 6520   ..    # Change 
-00008d50: 6e6f 7461 7469 6f6e 206f 6620 2743 6c6f  notation of 'Clo
-00008d60: 7365 6427 2061 6e64 2027 4f70 656e 2720  sed' and 'Open' 
-00008d70: 626f 756e 6461 7269 6573 2074 6f20 3020  boundaries to 0 
-00008d80: 616e 6420 312c 2072 6573 7065 6374 6976  and 1, respectiv
-00008d90: 656c 790d 0a20 2020 2023 2055 7365 2030  ely..    # Use 0
-00008da0: 2066 6f72 2063 6c6f 7365 6420 746f 2065   for closed to e
-00008db0: 6e73 7572 6520 7468 6174 2063 6c6f 7365  nsure that close
-00008dc0: 6420 626f 756e 6461 7269 6573 2061 7265  d boundaries are
-00008dd0: 2073 6f72 7465 6420 6c65 7373 2074 6861   sorted less tha
-00008de0: 6e20 6f70 656e 0d0a 2020 2020 2320 626f  n open..    # bo
-00008df0: 756e 6461 7269 6573 2077 6865 6e20 7468  undaries when th
-00008e00: 6520 6c65 6674 2062 6f75 6e64 2069 7320  e left bound is 
-00008e10: 7469 6564 0d0a 2020 2020 6466 5b6c 6566  tied..    df[lef
-00008e20: 745f 626f 756e 6461 7279 5f63 6f6c 5d20  t_boundary_col] 
-00008e30: 3d20 6466 5b6c 6566 745f 626f 756e 6461  = df[left_bounda
-00008e40: 7279 5f63 6f6c 5d2e 7265 706c 6163 6528  ry_col].replace(
-00008e50: 5b27 436c 6f73 6564 272c 274f 7065 6e27  ['Closed','Open'
-00008e60: 5d2c 205b 302c 315d 290d 0a20 2020 200d  ], [0,1])..    .
-00008e70: 0a20 2020 2023 2053 6f72 7420 6c65 6674  .    # Sort left
-00008e80: 2062 6f75 6e64 2076 616c 7565 730d 0a20   bound values.. 
-00008e90: 2020 206c 6566 7420 3d20 6466 2e63 6f70     left = df.cop
-00008ea0: 7928 295b 6772 6f75 7062 795f 636f 6c73  y()[groupby_cols
-00008eb0: 2b5b 275f 5f53 697a 655f 5f27 2c6c 6566  +['__Size__',lef
-00008ec0: 745f 626f 756e 6461 7279 5f63 6f6c 2c6c  t_boundary_col,l
-00008ed0: 6566 745f 626f 756e 645f 636f 6c5d 5d2e  eft_bound_col]].
-00008ee0: 736f 7274 5f76 616c 7565 7328 6279 3d5b  sort_values(by=[
-00008ef0: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 2c6c  left_bound_col,l
-00008f00: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-00008f10: 5d29 0d0a 2020 2020 0d0a 2020 2020 2320  ])..    ..    # 
-00008f20: 4164 6420 696e 6465 7820 666f 7220 6561  Add index for ea
-00008f30: 6368 2067 726f 7570 0d0a 2020 2020 6c65  ch group..    le
-00008f40: 6674 5b27 5f5f 496e 6465 785f 5f27 5d20  ft['__Index__'] 
-00008f50: 3d20 6c65 6674 2e67 726f 7570 6279 2867  = left.groupby(g
-00008f60: 726f 7570 6279 5f63 6f6c 7329 2e63 756d  roupby_cols).cum
-00008f70: 636f 756e 7428 2920 2b20 310d 0a20 2020  count() + 1..   
-00008f80: 200d 0a20 2020 2023 2044 6574 6572 6d69   ..    # Determi
-00008f90: 6e65 2074 6865 2072 616e 6b20 696e 2065  ne the rank in e
-00008fa0: 6163 6820 6772 6f75 7020 666f 7220 7468  ach group for th
-00008fb0: 6520 7065 7263 656e 7469 6c65 0d0a 2020  e percentile..  
-00008fc0: 2020 6c65 6674 5b27 5f5f 5261 6e6b 5f5f    left['__Rank__
-00008fd0: 275d 203d 2072 6f75 6e64 2843 202b 2070  '] = round(C + p
-00008fe0: 6572 6365 6e74 696c 652a 286c 6566 745b  ercentile*(left[
-00008ff0: 275f 5f53 697a 655f 5f27 5d20 2b20 3120  '__Size__'] + 1 
-00009000: 2d20 322a 4329 2c38 290d 0a20 2020 200d  - 2*C),8)..    .
-00009010: 0a20 2020 2023 2047 656e 6572 6174 6520  .    # Generate 
-00009020: 7072 6f78 696d 6974 7920 6f66 2065 6163  proximity of eac
-00009030: 6820 7265 7375 6c74 2074 6f20 7065 7263  h result to perc
-00009040: 656e 7469 6c65 2072 616e 6b20 7573 696e  entile rank usin
-00009050: 6720 7468 6520 696e 6465 780d 0a20 2020  g the index..   
-00009060: 206c 6566 745b 275f 5f50 726f 7869 6d69   left['__Proximi
-00009070: 7479 5f5f 275d 203d 2030 0d0a 2020 2020  ty__'] = 0..    
-00009080: 0d0a 2020 2020 636f 6e64 6974 696f 6e73  ..    conditions
-00009090: 203d 205b 0d0a 2020 2020 2020 2020 2320   = [..        # 
-000090a0: 4966 2074 6865 2070 6572 6365 6e74 696c  If the percentil
-000090b0: 6520 7261 6e6b 2069 7320 6120 7768 6f6c  e rank is a whol
-000090c0: 6520 6e75 6d62 6572 2c20 7468 656e 2075  e number, then u
-000090d0: 7365 2074 6861 7420 696e 6465 7820 7265  se that index re
-000090e0: 7375 6c74 0d0a 2020 2020 2020 2020 286c  sult..        (l
-000090f0: 6566 745b 275f 5f52 616e 6b5f 5f27 5d20  eft['__Rank__'] 
-00009100: 3d3d 206c 6566 745b 275f 5f49 6e64 6578  == left['__Index
-00009110: 5f5f 275d 292c 0d0a 2020 2020 2020 2020  __']),..        
-00009120: 2320 4966 2074 6865 2070 6572 6365 6e74  # If the percent
-00009130: 696c 6520 7261 6e6b 2069 7320 6c65 7373  ile rank is less
-00009140: 2074 6861 6e20 3120 6162 6f76 6520 7468   than 1 above th
-00009150: 6520 696e 6465 7820 7661 6c75 652c 0d0a  e index value,..
-00009160: 2020 2020 2020 2020 2320 7468 656e 2061          # then a
-00009170: 7373 6967 6e20 7468 6520 6170 7072 6f70  ssign the approp
-00009180: 7269 6174 6520 636f 6e74 7269 6275 7469  riate contributi
-00009190: 6f6e 2074 6f20 7468 6174 2069 6e64 6578  on to that index
-000091a0: 2076 616c 7565 0d0a 2020 2020 2020 2020   value..        
-000091b0: 286c 6566 745b 275f 5f52 616e 6b5f 5f27  (left['__Rank__'
-000091c0: 5d20 2d20 6c65 6674 5b27 5f5f 496e 6465  ] - left['__Inde
-000091d0: 785f 5f27 5d29 2e62 6574 7765 656e 2830  x__']).between(0
-000091e0: 2c31 2c69 6e63 6c75 7369 7665 3d27 6e65  ,1,inclusive='ne
-000091f0: 6974 6865 7227 292c 0d0a 2020 2020 2020  ither'),..      
-00009200: 2020 2320 4966 2074 6865 2070 6572 6365    # If the perce
-00009210: 6e74 696c 6520 7261 6e6b 2069 7320 6c65  ntile rank is le
-00009220: 7373 2074 6861 6e20 3120 6265 6c6f 7720  ss than 1 below 
-00009230: 7468 6520 696e 6465 7820 7661 6c75 652c  the index value,
-00009240: 0d0a 2020 2020 2020 2020 2320 7468 656e  ..        # then
-00009250: 2061 7373 6967 6e20 7468 6520 6170 7072   assign the appr
-00009260: 6f70 7269 6174 6520 636f 6e74 7269 6275  opriate contribu
-00009270: 7469 6f6e 2074 6f20 7468 6174 2069 6e64  tion to that ind
-00009280: 6578 2076 616c 7565 0d0a 2020 2020 2020  ex value..      
-00009290: 2020 286c 6566 745b 275f 5f49 6e64 6578    (left['__Index
-000092a0: 5f5f 275d 202d 206c 6566 745b 275f 5f52  __'] - left['__R
-000092b0: 616e 6b5f 5f27 5d29 2e62 6574 7765 656e  ank__']).between
-000092c0: 2830 2c31 2c69 6e63 6c75 7369 7665 3d27  (0,1,inclusive='
-000092d0: 6e65 6974 6865 7227 290d 0a20 2020 2020  neither')..     
-000092e0: 2020 205d 0d0a 2020 2020 0d0a 2020 2020     ]..    ..    
-000092f0: 7265 7375 6c74 7320 3d20 5b0d 0a20 2020  results = [..   
-00009300: 2020 2020 2031 2c0d 0a20 2020 2020 2020       1,..       
-00009310: 2031 202d 2028 6c65 6674 5b27 5f5f 5261   1 - (left['__Ra
-00009320: 6e6b 5f5f 275d 202d 206c 6566 745b 275f  nk__'] - left['_
-00009330: 5f49 6e64 6578 5f5f 275d 292c 0d0a 2020  _Index__']),..  
-00009340: 2020 2020 2020 3120 2d20 286c 6566 745b        1 - (left[
-00009350: 275f 5f49 6e64 6578 5f5f 275d 202d 206c  '__Index__'] - l
-00009360: 6566 745b 275f 5f52 616e 6b5f 5f27 5d29  eft['__Rank__'])
-00009370: 2c0d 0a20 2020 2020 2020 205d 0d0a 2020  ,..        ]..  
-00009380: 2020 0d0a 2020 2020 6c65 6674 5b27 5f5f    ..    left['__
-00009390: 5072 6f78 696d 6974 795f 5f27 5d20 3d20  Proximity__'] = 
-000093a0: 6e70 2e73 656c 6563 7428 636f 6e64 6974  np.select(condit
-000093b0: 696f 6e73 2c20 7265 7375 6c74 732c 206e  ions, results, n
-000093c0: 702e 6e61 6e29 0d0a 2020 2020 0d0a 2020  p.nan)..    ..  
-000093d0: 2020 2320 4472 6f70 206e 6f6e 2d63 6f6e    # Drop non-con
-000093e0: 7472 6962 7574 696e 6720 726f 7773 0d0a  tributing rows..
-000093f0: 2020 2020 6c65 6674 203d 206c 6566 745b      left = left[
-00009400: 6c65 6674 5b27 5f5f 5072 6f78 696d 6974  left['__Proximit
-00009410: 795f 5f27 5d20 3e20 305d 0d0a 2020 2020  y__'] > 0]..    
-00009420: 0d0a 2020 2020 2320 4361 6c63 756c 6174  ..    # Calculat
-00009430: 6520 636f 6e74 7269 6275 7469 6f6e 2066  e contribution f
-00009440: 6f72 2069 6e64 6578 2076 616c 7565 7320  or index values 
-00009450: 7468 6174 2063 6f6e 7472 6962 7574 6520  that contribute 
-00009460: 746f 2074 6865 2072 6573 756c 740d 0a20  to the result.. 
-00009470: 2020 206c 6566 745b 275f 5f43 6f6e 7472     left['__Contr
-00009480: 6962 7574 696f 6e5f 5f27 5d20 3d20 6c65  ibution__'] = le
-00009490: 6674 5b27 5f5f 5072 6f78 696d 6974 795f  ft['__Proximity_
-000094a0: 5f27 5d20 2a20 6c65 6674 5b6c 6566 745f  _'] * left[left_
-000094b0: 626f 756e 645f 636f 6c5d 0d0a 2020 2020  bound_col]..    
-000094c0: 0d0a 2020 2020 2320 4465 7465 726d 696e  ..    # Determin
-000094d0: 6520 6c65 6674 2062 6f75 6e64 2061 6e64  e left bound and
-000094e0: 2062 6f75 6e64 6172 7920 7573 696e 6720   boundary using 
-000094f0: 7468 6520 7375 6d20 6f66 2074 6865 2063  the sum of the c
-00009500: 6f6e 7472 6962 7574 696f 6e73 0d0a 2020  ontributions..  
-00009510: 2020 2320 616e 6420 616e 206f 7065 6e20    # and an open 
-00009520: 626f 756e 6461 7279 2069 6620 616e 7920  boundary if any 
-00009530: 6f66 2074 6865 2063 6f6e 7472 6962 7574  of the contribut
-00009540: 696e 6720 7661 6c75 6573 2069 7320 6f70  ing values is op
-00009550: 656e 0d0a 2020 2020 6c65 6674 203d 206c  en..    left = l
-00009560: 6566 742e 6772 6f75 7062 7928 6772 6f75  eft.groupby(grou
-00009570: 7062 795f 636f 6c73 292e 6167 6728 2a2a  pby_cols).agg(**
-00009580: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
-00009590: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000095a0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
-000095b0: 3a20 286c 6566 745f 626f 756e 6461 7279  : (left_boundary
-000095c0: 5f63 6f6c 2c20 276d 6178 2729 2c0d 0a20  _col, 'max'),.. 
-000095d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095e0: 2020 2020 2020 2020 2020 206c 6566 745f             left_
-000095f0: 626f 756e 645f 636f 6c3a 2028 275f 5f43  bound_col: ('__C
-00009600: 6f6e 7472 6962 7574 696f 6e5f 5f27 2c27  ontribution__','
-00009610: 7375 6d27 292c 0d0a 2020 2020 2020 2020  sum'),..        
-00009620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009630: 2020 2020 275f 5f4d 696e 696d 756d 5f5f      '__Minimum__
-00009640: 273a 2028 275f 5f43 6f6e 7472 6962 7574  ': ('__Contribut
-00009650: 696f 6e5f 5f27 2c27 6d69 6e27 290d 0a20  ion__','min').. 
-00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009670: 2020 2020 2020 2020 2020 207d 290d 0a20             }).. 
-00009680: 2020 200d 0a20 2020 2023 2052 6570 6c61     ..    # Repla
-00009690: 6365 2074 6865 206e 756d 6572 6963 2076  ce the numeric v
-000096a0: 616c 7565 2066 6f72 2074 6865 2062 6f75  alue for the bou
-000096b0: 6e64 6172 790d 0a20 2020 206c 6566 745b  ndary..    left[
-000096c0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
-000096d0: 6c5d 203d 206c 6566 745b 6c65 6674 5f62  l] = left[left_b
-000096e0: 6f75 6e64 6172 795f 636f 6c5d 2e72 6570  oundary_col].rep
-000096f0: 6c61 6365 285b 302c 315d 2c20 5b27 436c  lace([0,1], ['Cl
-00009700: 6f73 6564 272c 274f 7065 6e27 5d29 0d0a  osed','Open'])..
-00009710: 2020 2020 0d0a 2020 2020 2320 4d65 616e      ..    # Mean
-00009720: 7320 7769 7468 2069 6e66 696e 6974 6520  s with infinite 
-00009730: 7661 6c75 6573 2070 726f 6475 6365 206e  values produce n
-00009740: 616e 2076 616c 7565 7320 7261 7468 6572  an values rather
-00009750: 2074 6861 6e20 6e70 2e69 6e66 2076 616c   than np.inf val
-00009760: 7565 730d 0a20 2020 2023 2043 6f6e 7665  ues..    # Conve
-00009770: 7274 206e 616e 2074 6f20 696e 6620 6f6e  rt nan to inf on
-00009780: 6c79 2069 6620 696e 6669 6e69 7465 2076  ly if infinite v
-00009790: 616c 7565 7320 6172 6520 696e 636c 7564  alues are includ
-000097a0: 6564 2069 6e20 7468 6520 6d65 616e 0d0a  ed in the mean..
-000097b0: 2020 2020 6c65 6674 5b6c 6566 745f 626f      left[left_bo
-000097c0: 756e 645f 636f 6c5d 203d 206e 702e 7768  und_col] = np.wh
-000097d0: 6572 6528 6c65 6674 5b27 5f5f 4d69 6e69  ere(left['__Mini
-000097e0: 6d75 6d5f 5f27 5d20 3d3d 202d 6e70 2e69  mum__'] == -np.i
-000097f0: 6e66 2c20 2d6e 702e 696e 662c 206c 6566  nf, -np.inf, lef
-00009800: 745b 6c65 6674 5f62 6f75 6e64 5f63 6f6c  t[left_bound_col
-00009810: 5d29 0d0a 2020 2020 0d0a 2020 2020 2320  ])..    ..    # 
-00009820: 4465 7465 726d 696e 6520 7269 6768 7420  Determine right 
-00009830: 626f 756e 6420 616e 6420 626f 756e 6461  bound and bounda
-00009840: 7279 2066 6f72 2065 6163 6820 6772 6f75  ry for each grou
-00009850: 700d 0a20 2020 200d 0a20 2020 2023 2043  p..    ..    # C
-00009860: 6861 6e67 6520 6e6f 7461 7469 6f6e 206f  hange notation o
-00009870: 6620 2743 6c6f 7365 6427 2061 6e64 2027  f 'Closed' and '
-00009880: 4f70 656e 2720 626f 756e 6461 7269 6573  Open' boundaries
-00009890: 2074 6f20 3120 616e 6420 302c 2072 6573   to 1 and 0, res
-000098a0: 7065 6374 6976 656c 790d 0a20 2020 2023  pectively..    #
-000098b0: 2055 7365 2031 2066 6f72 2063 6c6f 7365   Use 1 for close
-000098c0: 6420 746f 2065 6e73 7572 6520 7468 6174  d to ensure that
-000098d0: 2063 6c6f 7365 6420 626f 756e 6461 7269   closed boundari
-000098e0: 6573 2061 7265 2073 6f72 7465 6420 6c61  es are sorted la
-000098f0: 7267 6572 2074 6861 6e20 6f70 656e 0d0a  rger than open..
-00009900: 2020 2020 2320 626f 756e 6461 7269 6573      # boundaries
-00009910: 2077 6865 6e20 7468 6520 7269 6768 7420   when the right 
-00009920: 626f 756e 6420 6973 2074 6965 640d 0a20  bound is tied.. 
-00009930: 2020 2064 665b 7269 6768 745f 626f 756e     df[right_boun
-00009940: 6461 7279 5f63 6f6c 5d20 3d20 6466 5b72  dary_col] = df[r
-00009950: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
-00009960: 6c5d 2e72 6570 6c61 6365 285b 2743 6c6f  l].replace(['Clo
-00009970: 7365 6427 2c27 4f70 656e 275d 2c20 5b31  sed','Open'], [1
-00009980: 2c30 5d29 0d0a 2020 2020 0d0a 2020 2020  ,0])..    ..    
-00009990: 2320 536f 7274 2072 6967 6874 2062 6f75  # Sort right bou
-000099a0: 6e64 2076 616c 7565 730d 0a20 2020 2072  nd values..    r
-000099b0: 6967 6874 203d 2064 662e 636f 7079 2829  ight = df.copy()
-000099c0: 5b67 726f 7570 6279 5f63 6f6c 732b 5b27  [groupby_cols+['
-000099d0: 5f5f 5369 7a65 5f5f 272c 7269 6768 745f  __Size__',right_
-000099e0: 626f 756e 6461 7279 5f63 6f6c 2c72 6967  boundary_col,rig
-000099f0: 6874 5f62 6f75 6e64 5f63 6f6c 5d5d 2e73  ht_bound_col]].s
-00009a00: 6f72 745f 7661 6c75 6573 2862 793d 5b72  ort_values(by=[r
-00009a10: 6967 6874 5f62 6f75 6e64 5f63 6f6c 2c72  ight_bound_col,r
-00009a20: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
-00009a30: 6c5d 290d 0a20 2020 200d 0a20 2020 2023  l])..    ..    #
-00009a40: 2041 6464 2069 6e64 6578 2066 6f72 2065   Add index for e
-00009a50: 6163 6820 6772 6f75 700d 0a20 2020 2072  ach group..    r
-00009a60: 6967 6874 5b27 5f5f 496e 6465 785f 5f27  ight['__Index__'
-00009a70: 5d20 3d20 7269 6768 742e 6772 6f75 7062  ] = right.groupb
-00009a80: 7928 6772 6f75 7062 795f 636f 6c73 292e  y(groupby_cols).
-00009a90: 6375 6d63 6f75 6e74 2829 202b 2031 0d0a  cumcount() + 1..
-00009aa0: 2020 2020 0d0a 2020 2020 2320 4465 7465      ..    # Dete
-00009ab0: 726d 696e 6520 7468 6520 7261 6e6b 2069  rmine the rank i
-00009ac0: 6e20 6561 6368 2067 726f 7570 2066 6f72  n each group for
-00009ad0: 2074 6865 2070 6572 6365 6e74 696c 650d   the percentile.
-00009ae0: 0a20 2020 2072 6967 6874 5b27 5f5f 5261  .    right['__Ra
-00009af0: 6e6b 5f5f 275d 203d 2072 6f75 6e64 2843  nk__'] = round(C
-00009b00: 202b 2070 6572 6365 6e74 696c 652a 2872   + percentile*(r
-00009b10: 6967 6874 5b27 5f5f 5369 7a65 5f5f 275d  ight['__Size__']
-00009b20: 202b 2031 202d 2032 2a43 292c 3829 0d0a   + 1 - 2*C),8)..
-00009b30: 2020 2020 0d0a 2020 2020 2320 4765 6e65      ..    # Gene
-00009b40: 7261 7465 2070 726f 7869 6d69 7479 206f  rate proximity o
-00009b50: 6620 6561 6368 2072 6573 756c 7420 746f  f each result to
-00009b60: 2070 6572 6365 6e74 696c 6520 7261 6e6b   percentile rank
-00009b70: 2075 7369 6e67 2074 6865 2069 6e64 6578   using the index
-00009b80: 0d0a 2020 2020 7269 6768 745b 275f 5f50  ..    right['__P
-00009b90: 726f 7869 6d69 7479 5f5f 275d 203d 2030  roximity__'] = 0
-00009ba0: 0d0a 2020 2020 0d0a 2020 2020 636f 6e64  ..    ..    cond
-00009bb0: 6974 696f 6e73 203d 205b 0d0a 2020 2020  itions = [..    
-00009bc0: 2020 2020 2320 4966 2074 6865 2070 6572      # If the per
-00009bd0: 6365 6e74 696c 6520 7261 6e6b 2069 7320  centile rank is 
-00009be0: 6120 7768 6f6c 6520 6e75 6d62 6572 2c20  a whole number, 
-00009bf0: 7468 656e 2075 7365 2074 6861 7420 696e  then use that in
-00009c00: 6465 7820 7265 7375 6c74 0d0a 2020 2020  dex result..    
-00009c10: 2020 2020 2872 6967 6874 5b27 5f5f 5261      (right['__Ra
-00009c20: 6e6b 5f5f 275d 203d 3d20 7269 6768 745b  nk__'] == right[
-00009c30: 275f 5f49 6e64 6578 5f5f 275d 292c 0d0a  '__Index__']),..
-00009c40: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-00009c50: 2070 6572 6365 6e74 696c 6520 7261 6e6b   percentile rank
-00009c60: 2069 7320 6c65 7373 2074 6861 6e20 3120   is less than 1 
-00009c70: 6162 6f76 6520 7468 6520 696e 6465 7820  above the index 
-00009c80: 7661 6c75 652c 0d0a 2020 2020 2020 2020  value,..        
-00009c90: 2320 7468 656e 2061 7373 6967 6e20 7468  # then assign th
-00009ca0: 6520 6170 7072 6f70 7269 6174 6520 636f  e appropriate co
-00009cb0: 6e74 7269 6275 7469 6f6e 2074 6f20 7468  ntribution to th
-00009cc0: 6174 2069 6e64 6578 2076 616c 7565 0d0a  at index value..
-00009cd0: 2020 2020 2020 2020 2872 6967 6874 5b27          (right['
-00009ce0: 5f5f 5261 6e6b 5f5f 275d 202d 2072 6967  __Rank__'] - rig
-00009cf0: 6874 5b27 5f5f 496e 6465 785f 5f27 5d29  ht['__Index__'])
-00009d00: 2e62 6574 7765 656e 2830 2c31 2c69 6e63  .between(0,1,inc
-00009d10: 6c75 7369 7665 3d27 6e65 6974 6865 7227  lusive='neither'
-00009d20: 292c 0d0a 2020 2020 2020 2020 2320 4966  ),..        # If
-00009d30: 2074 6865 2070 6572 6365 6e74 696c 6520   the percentile 
-00009d40: 7261 6e6b 2069 7320 6c65 7373 2074 6861  rank is less tha
-00009d50: 6e20 3120 6265 6c6f 7720 7468 6520 696e  n 1 below the in
-00009d60: 6465 7820 7661 6c75 652c 0d0a 2020 2020  dex value,..    
-00009d70: 2020 2020 2320 7468 656e 2061 7373 6967      # then assig
-00009d80: 6e20 7468 6520 6170 7072 6f70 7269 6174  n the appropriat
-00009d90: 6520 636f 6e74 7269 6275 7469 6f6e 2074  e contribution t
-00009da0: 6f20 7468 6174 2069 6e64 6578 2076 616c  o that index val
-00009db0: 7565 0d0a 2020 2020 2020 2020 2872 6967  ue..        (rig
-00009dc0: 6874 5b27 5f5f 496e 6465 785f 5f27 5d20  ht['__Index__'] 
-00009dd0: 2d20 7269 6768 745b 275f 5f52 616e 6b5f  - right['__Rank_
-00009de0: 5f27 5d29 2e62 6574 7765 656e 2830 2c31  _']).between(0,1
-00009df0: 2c69 6e63 6c75 7369 7665 3d27 6e65 6974  ,inclusive='neit
-00009e00: 6865 7227 290d 0a20 2020 2020 2020 205d  her')..        ]
-00009e10: 0d0a 2020 2020 0d0a 2020 2020 7265 7375  ..    ..    resu
-00009e20: 6c74 7320 3d20 5b0d 0a20 2020 2020 2020  lts = [..       
-00009e30: 2031 2c0d 0a20 2020 2020 2020 2031 202d   1,..        1 -
-00009e40: 2028 7269 6768 745b 275f 5f52 616e 6b5f   (right['__Rank_
-00009e50: 5f27 5d20 2d20 7269 6768 745b 275f 5f49  _'] - right['__I
-00009e60: 6e64 6578 5f5f 275d 292c 0d0a 2020 2020  ndex__']),..    
-00009e70: 2020 2020 3120 2d20 2872 6967 6874 5b27      1 - (right['
-00009e80: 5f5f 496e 6465 785f 5f27 5d20 2d20 7269  __Index__'] - ri
-00009e90: 6768 745b 275f 5f52 616e 6b5f 5f27 5d29  ght['__Rank__'])
-00009ea0: 2c0d 0a20 2020 2020 2020 205d 0d0a 2020  ,..        ]..  
-00009eb0: 2020 0d0a 2020 2020 7269 6768 745b 275f    ..    right['_
-00009ec0: 5f50 726f 7869 6d69 7479 5f5f 275d 203d  _Proximity__'] =
-00009ed0: 206e 702e 7365 6c65 6374 2863 6f6e 6469   np.select(condi
-00009ee0: 7469 6f6e 732c 2072 6573 756c 7473 2c20  tions, results, 
-00009ef0: 6e70 2e6e 616e 290d 0a20 2020 200d 0a20  np.nan)..    .. 
-00009f00: 2020 2023 2044 726f 7020 6e6f 6e2d 636f     # Drop non-co
-00009f10: 6e74 7269 6275 7469 6e67 2072 6f77 730d  ntributing rows.
-00009f20: 0a20 2020 2072 6967 6874 203d 2072 6967  .    right = rig
-00009f30: 6874 5b72 6967 6874 5b27 5f5f 5072 6f78  ht[right['__Prox
-00009f40: 696d 6974 795f 5f27 5d20 3e20 305d 0d0a  imity__'] > 0]..
-00009f50: 2020 2020 0d0a 2020 2020 2320 4361 6c63      ..    # Calc
-00009f60: 756c 6174 6520 636f 6e74 7269 6275 7469  ulate contributi
-00009f70: 6f6e 2066 6f72 2069 6e64 6578 2076 616c  on for index val
-00009f80: 7565 7320 7468 6174 2063 6f6e 7472 6962  ues that contrib
-00009f90: 7574 6520 746f 2074 6865 2072 6573 756c  ute to the resul
-00009fa0: 740d 0a20 2020 2072 6967 6874 5b27 5f5f  t..    right['__
-00009fb0: 436f 6e74 7269 6275 7469 6f6e 5f5f 275d  Contribution__']
-00009fc0: 203d 2072 6967 6874 5b27 5f5f 5072 6f78   = right['__Prox
-00009fd0: 696d 6974 795f 5f27 5d20 2a20 7269 6768  imity__'] * righ
-00009fe0: 745b 7269 6768 745f 626f 756e 645f 636f  t[right_bound_co
-00009ff0: 6c5d 0d0a 2020 2020 0d0a 2020 2020 2320  l]..    ..    # 
-0000a000: 4465 7465 726d 696e 6520 7269 6768 7420  Determine right 
-0000a010: 626f 756e 6420 616e 6420 626f 756e 6461  bound and bounda
-0000a020: 7279 2075 7369 6e67 2074 6865 2073 756d  ry using the sum
-0000a030: 206f 6620 7468 6520 636f 6e74 7269 6275   of the contribu
-0000a040: 7469 6f6e 730d 0a20 2020 2023 2061 6e64  tions..    # and
-0000a050: 2061 6e20 6f70 656e 2062 6f75 6e64 6172   an open boundar
-0000a060: 7920 6966 2061 6e79 206f 6620 7468 6520  y if any of the 
-0000a070: 636f 6e74 7269 6275 7469 6e67 2076 616c  contributing val
-0000a080: 7565 7320 6973 206f 7065 6e0d 0a20 2020  ues is open..   
-0000a090: 2072 6967 6874 203d 2072 6967 6874 2e67   right = right.g
-0000a0a0: 726f 7570 6279 2867 726f 7570 6279 5f63  roupby(groupby_c
-0000a0b0: 6f6c 7329 2e61 6767 282a 2a7b 0d0a 2020  ols).agg(**{..  
-0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0d0: 2020 2020 2020 2020 2020 7269 6768 745f            right_
-0000a0e0: 626f 756e 645f 636f 6c3a 2028 275f 5f43  bound_col: ('__C
-0000a0f0: 6f6e 7472 6962 7574 696f 6e5f 5f27 2c27  ontribution__','
-0000a100: 7375 6d27 292c 0d0a 2020 2020 2020 2020  sum'),..        
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2020 2020 7269 6768 745f 626f 756e 6461      right_bounda
-0000a130: 7279 5f63 6f6c 3a20 2872 6967 6874 5f62  ry_col: (right_b
-0000a140: 6f75 6e64 6172 795f 636f 6c2c 2027 6d69  oundary_col, 'mi
-0000a150: 6e27 292c 0d0a 2020 2020 2020 2020 2020  n'),..          
-0000a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a170: 2020 275f 5f4d 6178 696d 756d 5f5f 273a    '__Maximum__':
-0000a180: 2028 275f 5f43 6f6e 7472 6962 7574 696f   ('__Contributio
-0000a190: 6e5f 5f27 2c27 6d61 7827 290d 0a20 2020  n__','max')..   
-0000a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1b0: 2020 2020 2020 2020 207d 290d 0a20 2020           })..   
-0000a1c0: 200d 0a20 2020 2023 2052 6570 6c61 6365   ..    # Replace
-0000a1d0: 2074 6865 206e 756d 6572 6963 2076 616c   the numeric val
-0000a1e0: 7565 2066 6f72 2074 6865 2062 6f75 6e64  ue for the bound
-0000a1f0: 6172 790d 0a20 2020 2072 6967 6874 5b72  ary..    right[r
-0000a200: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
-0000a210: 6c5d 203d 2072 6967 6874 5b72 6967 6874  l] = right[right
-0000a220: 5f62 6f75 6e64 6172 795f 636f 6c5d 2e72  _boundary_col].r
-0000a230: 6570 6c61 6365 285b 312c 305d 2c20 5b27  eplace([1,0], ['
-0000a240: 436c 6f73 6564 272c 274f 7065 6e27 5d29  Closed','Open'])
-0000a250: 0d0a 2020 2020 0d0a 2020 2020 2320 4d65  ..    ..    # Me
-0000a260: 616e 7320 7769 7468 2069 6e66 696e 6974  ans with infinit
-0000a270: 6520 7661 6c75 6573 2070 726f 6475 6365  e values produce
-0000a280: 206e 616e 2076 616c 7565 7320 7261 7468   nan values rath
-0000a290: 6572 2074 6861 6e20 6e70 2e69 6e66 2076  er than np.inf v
-0000a2a0: 616c 7565 730d 0a20 2020 2023 2043 6f6e  alues..    # Con
-0000a2b0: 7665 7274 206e 616e 2074 6f20 696e 6620  vert nan to inf 
-0000a2c0: 6f6e 6c79 2069 6620 696e 6669 6e69 7465  only if infinite
-0000a2d0: 2076 616c 7565 7320 6172 6520 696e 636c   values are incl
-0000a2e0: 7564 6564 2069 6e20 7468 6520 6d65 616e  uded in the mean
-0000a2f0: 0d0a 2020 2020 7269 6768 745b 7269 6768  ..    right[righ
-0000a300: 745f 626f 756e 645f 636f 6c5d 203d 206e  t_bound_col] = n
-0000a310: 702e 7768 6572 6528 7269 6768 745b 275f  p.where(right['_
-0000a320: 5f4d 6178 696d 756d 5f5f 275d 203d 3d20  _Maximum__'] == 
-0000a330: 6e70 2e69 6e66 2c20 6e70 2e69 6e66 2c20  np.inf, np.inf, 
-0000a340: 7269 6768 745b 7269 6768 745f 626f 756e  right[right_boun
-0000a350: 645f 636f 6c5d 290d 0a20 2020 200d 0a20  d_col])..    .. 
-0000a360: 2020 2023 204d 6572 6765 2074 6865 2074     # Merge the t
-0000a370: 776f 2062 6f75 6e64 6172 6965 7320 746f  wo boundaries to
-0000a380: 2063 7265 6174 6520 7468 6520 696e 7465   create the inte
-0000a390: 7276 616c 2066 6f72 2074 6865 2070 6572  rval for the per
-0000a3a0: 6365 6e74 696c 650d 0a20 2020 2023 2043  centile..    # C
-0000a3b0: 6865 636b 2074 6861 7420 7468 6520 6d65  heck that the me
-0000a3c0: 7267 6520 6973 2031 2d74 6f2d 310d 0a20  rge is 1-to-1.. 
-0000a3d0: 2020 2064 6620 3d20 6c65 6674 2e6d 6572     df = left.mer
-0000a3e0: 6765 2872 6967 6874 2c20 686f 7720 3d20  ge(right, how = 
-0000a3f0: 276f 7574 6572 272c 206f 6e20 3d20 6772  'outer', on = gr
-0000a400: 6f75 7062 795f 636f 6c73 2c20 7661 6c69  oupby_cols, vali
-0000a410: 6461 7465 203d 2027 313a 3127 290d 0a20  date = '1:1').. 
-0000a420: 2020 200d 0a20 2020 2023 2052 6573 6574     ..    # Reset
-0000a430: 2069 6e64 6578 0d0a 2020 2020 6466 203d   index..    df =
-0000a440: 2064 662e 7265 7365 745f 696e 6465 7828   df.reset_index(
-0000a450: 290d 0a20 2020 200d 0a20 2020 2072 6574  )..    ..    ret
-0000a460: 7572 6e20 6466 0d0a 0d0a 6465 6620 7065  urn df....def pe
-0000a470: 7263 656e 7469 6c65 2864 662c 0d0a 2020  rcentile(df,..  
-0000a480: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000a490: 756c 745f 636f 6c2c 0d0a 2020 2020 2020  ult_col,..      
-0000a4a0: 2020 2020 2020 2020 2070 6572 6365 6e74           percent
-0000a4b0: 696c 652c 0d0a 2020 2020 2020 2020 2020  ile,..          
-0000a4c0: 2020 2020 206d 6574 686f 6420 3d20 2768       method = 'h
-0000a4d0: 617a 656e 272c 0d0a 2020 2020 2020 2020  azen',..        
-0000a4e0: 2020 2020 2020 2067 726f 7570 6279 5f63         groupby_c
-0000a4f0: 6f6c 7320 3d20 4e6f 6e65 2c0d 0a20 2020  ols = None,..   
-0000a500: 2020 2020 2020 2020 2020 2020 666f 6375              focu
-0000a510: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
-0000a520: 203d 2054 7275 652c 0d0a 2020 2020 2020   = True,..      
-0000a530: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
-0000a540: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
-0000a550: 616c 203d 2046 616c 7365 2c0d 0a20 2020  al = False,..   
-0000a560: 2020 2020 2020 2020 2020 2020 7072 6563              prec
-0000a570: 6973 696f 6e5f 746f 6c65 7261 6e63 655f  ision_tolerance_
-0000a580: 746f 5f64 726f 705f 6365 6e73 6f72 203d  to_drop_censor =
-0000a590: 2030 2e32 352c 0d0a 2020 2020 2020 2020   0.25,..        
-0000a5a0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-0000a5b0: 5f72 6f75 6e64 696e 6720 3d20 5472 7565  _rounding = True
-0000a5c0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
-0000a5d0: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
-0000a5e0: 2063 6f6d 6269 6e65 7320 7468 6520 7265   combines the re
-0000a5f0: 6c65 7661 6e74 2070 6572 6365 6e74 696c  levant percentil
-0000a600: 6520 616e 6420 7574 696c 6974 7920 6675  e and utility fu
-0000a610: 6e63 7469 6f6e 7320 746f 0d0a 2020 2020  nctions to..    
-0000a620: 6765 6e65 7261 7465 2074 6865 2070 6572  generate the per
-0000a630: 6365 6e69 746c 6520 7265 7375 6c74 7320  cenitle results 
-0000a640: 666f 7220 6772 6f75 7073 2077 6974 6869  for groups withi
-0000a650: 6e20 6120 4461 7461 4672 616d 652e 0d0a  n a DataFrame...
-0000a660: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-0000a670: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
-0000a680: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
-0000a690: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
-0000a6a0: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
-0000a6b0: 7461 696e 7320 6365 6e73 6f72 6564 206f  tains censored o
-0000a6c0: 7220 756e 6365 6e73 6f72 6564 2072 6573  r uncensored res
-0000a6d0: 756c 7473 0d0a 2020 2020 7265 7375 6c74  ults..    result
-0000a6e0: 5f63 6f6c 203a 2073 7472 696e 670d 0a20  _col : string.. 
-0000a6f0: 2020 2020 2020 2054 6865 2063 6f6c 756d         The colum
-0000a700: 6e20 6e61 6d65 2066 6f72 2074 6865 2063  n name for the c
-0000a710: 6f6c 756d 6e20 7468 6174 2063 6f6e 7461  olumn that conta
-0000a720: 696e 2074 6865 2072 6573 756c 7473 2061  in the results a
-0000a730: 7320 7465 7874 2e0d 0a20 2020 2020 2020  s text...       
-0000a740: 204f 6e6c 7920 666f 7572 2070 6f73 7369   Only four possi
-0000a750: 626c 6520 6365 6e73 6f72 7320 7368 6f75  ble censors shou
-0000a760: 6c64 2062 6520 7573 6564 2028 3c2c e289  ld be used (<,..
-0000a770: a42c e289 a52c 3e29 2e0d 0a20 2020 2070  .,...,>)...    p
-0000a780: 6572 6365 6e74 696c 6520 3a20 666c 6f61  ercentile : floa
-0000a790: 740d 0a20 2020 2020 2020 2054 6865 2064  t..        The d
-0000a7a0: 6573 6972 6564 2070 6572 6365 6e74 696c  esired percentil
-0000a7b0: 652e 2056 616c 7565 7320 7368 6f75 6c64  e. Values should
-0000a7c0: 2062 6520 6265 7477 6565 6e20 3020 616e   be between 0 an
-0000a7d0: 6420 3130 302e 0d0a 2020 2020 6d65 7468  d 100...    meth
-0000a7e0: 6f64 203a 2073 7472 696e 670d 0a20 2020  od : string..   
-0000a7f0: 2020 2020 2054 6865 2070 6572 6365 6e74       The percent
-0000a800: 696c 6520 6d65 7468 6f64 2e20 5468 6520  ile method. The 
-0000a810: 6f70 7469 6f6e 7320 616e 6420 6465 6669  options and defi
-0000a820: 6e69 7469 6f6e 7320 636f 6d65 2066 726f  nitions come fro
-0000a830: 6d3a 0d0a 2020 2020 2020 2020 2020 2020  m:..            
-0000a840: 6874 7470 733a 2f2f 656e 7669 726f 6e6d  https://environm
-0000a850: 656e 742e 676f 7674 2e6e 7a2f 6173 7365  ent.govt.nz/asse
-0000a860: 7473 2f50 7562 6c69 6361 7469 6f6e 732f  ts/Publications/
-0000a870: 4669 6c65 732f 6861 7a65 6e2d 7065 7263  Files/hazen-perc
-0000a880: 656e 7469 6c65 2d63 616c 6375 6c61 746f  entile-calculato
-0000a890: 722d 322e 786c 730d 0a20 2020 2020 2020  r-2.xls..       
-0000a8a0: 2020 2020 204f 7074 696f 6e73 2069 6e63       Options inc
-0000a8b0: 6c75 6465 2074 6865 2066 6f6c 6c6f 7769  lude the followi
-0000a8c0: 6e67 2c20 6f72 6465 7265 6420 6672 6f6d  ng, ordered from
-0000a8d0: 206c 6172 6765 7374 2074 6f20 736d 616c   largest to smal
-0000a8e0: 6c65 7374 2072 6573 756c 742e 0d0a 2020  lest result...  
-0000a8f0: 2020 2020 2020 2020 2020 2d20 7765 6962            - weib
-0000a900: 616c 6c0d 0a20 2020 2020 2020 2020 2020  all..           
-0000a910: 202d 2074 756b 6579 0d0a 2020 2020 2020   - tukey..      
-0000a920: 2020 2020 2020 2d20 626c 6f6d 0d0a 2020        - blom..  
-0000a930: 2020 2020 2020 2020 2020 2d20 6861 7a65            - haze
-0000a940: 6e0d 0a20 2020 2020 2020 2020 2020 202d  n..            -
-0000a950: 2065 7863 656c 0d0a 2020 2020 2020 2020   excel..        
-0000a960: 5468 6520 6465 6661 756c 7420 6973 2068  The default is h
-0000a970: 617a 656e 2e0d 0a20 2020 2067 726f 7570  azen...    group
-0000a980: 6279 5f63 6f6c 7320 3a20 6c69 7374 7320  by_cols : lists 
-0000a990: 6f66 2073 7472 696e 6773 2028 6f72 206c  of strings (or l
-0000a9a0: 6973 7420 6f66 206c 6973 7473 292c 206f  ist of lists), o
-0000a9b0: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-0000a9c0: 204c 6973 7420 6f66 2063 6f6c 756d 6e20   List of column 
-0000a9d0: 6e61 6d65 7320 7468 6174 2073 686f 756c  names that shoul
-0000a9e0: 6420 6265 2075 7365 6420 746f 2063 7265  d be used to cre
-0000a9f0: 6174 6520 6772 6f75 7073 2e20 4120 7065  ate groups. A pe
-0000aa00: 7263 656e 7469 6c65 0d0a 2020 2020 2020  rcentile..      
-0000aa10: 2020 7769 6c6c 2062 6520 666f 756e 6420    will be found 
-0000aa20: 7769 7468 696e 2065 6163 6820 6772 6f75  within each grou
-0000aa30: 702e 204d 756c 7469 706c 6520 6c69 7374  p. Multiple list
-0000aa40: 7320 6361 6e20 6265 2073 7570 706c 6965  s can be supplie
-0000aa50: 6420 746f 0d0a 2020 2020 2020 2020 7065  d to..        pe
-0000aa60: 7266 6f72 6d20 7365 7175 656e 7469 616c  rform sequential
-0000aa70: 206d 6564 6961 6e20 7065 7263 656e 7469   median percenti
-0000aa80: 6c65 7320 6265 666f 7265 2063 616c 6375  les before calcu
-0000aa90: 6c61 7469 6e67 2061 2070 6572 6365 6e74  lating a percent
-0000aaa0: 696c 650d 0a20 2020 2020 2020 206f 7665  ile..        ove
-0000aab0: 7220 7468 6520 6669 6e61 6c20 6772 6f75  r the final grou
-0000aac0: 7069 6e67 2e0d 0a20 2020 2020 2020 2054  ping...        T
-0000aad0: 6865 2064 6566 6175 6c74 2069 7320 4e6f  he default is No
-0000aae0: 6e65 2e0d 0a20 2020 2066 6f63 7573 5f68  ne...    focus_h
-0000aaf0: 6967 685f 706f 7465 6e74 6961 6c20 3a20  igh_potential : 
-0000ab00: 626f 6f6c 6561 6e2c 206f 7074 696f 6e61  boolean, optiona
-0000ab10: 6c0d 0a20 2020 2020 2020 2049 6620 5472  l..        If Tr
-0000ab20: 7565 2c20 7468 656e 2069 6e66 6f72 6d61  ue, then informa
-0000ab30: 7469 6f6e 206f 6e20 7468 6520 6869 6768  tion on the high
-0000ab40: 6573 7420 706f 7465 6e74 6961 6c20 7265  est potential re
-0000ab50: 7375 6c74 2077 696c 6c20 6265 0d0a 2020  sult will be..  
-0000ab60: 2020 2020 2020 666f 6375 7365 6420 6f76        focused ov
-0000ab70: 6572 2074 6865 206c 6f77 6573 7420 706f  er the lowest po
-0000ab80: 7465 6e74 6961 6c20 7265 7375 6c74 2e0d  tential result..
-0000ab90: 0a20 2020 2069 6e63 6c75 6465 5f6e 6567  .    include_neg
-0000aba0: 6174 6976 655f 696e 7465 7276 616c 203a  ative_interval :
-0000abb0: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
-0000abc0: 616c 0d0a 2020 2020 2020 2020 4966 2054  al..        If T
-0000abd0: 7275 652c 2074 6865 6e20 616c 6c20 706f  rue, then all po
-0000abe0: 7369 7469 7665 2061 6e64 206e 6567 6174  sitive and negat
-0000abf0: 6976 6520 7661 6c75 6573 2061 7265 2063  ive values are c
-0000ac00: 6f6e 7369 6465 7265 640d 0a20 2020 2020  onsidered..     
-0000ac10: 2020 2065 2e67 2e2c 203c 302e 3520 776f     e.g., <0.5 wo
-0000ac20: 756c 6420 6265 2063 6f6e 7665 7274 6564  uld be converted
-0000ac30: 2074 6f20 282d 6e70 2e69 6e66 2c35 292e   to (-np.inf,5).
-0000ac40: 0d0a 2020 2020 2020 2020 4966 2046 616c  ..        If Fal
-0000ac50: 7365 2c20 7468 656e 206f 6e6c 7920 6e6f  se, then only no
-0000ac60: 6e2d 6e65 6761 7469 7665 2076 616c 7565  n-negative value
-0000ac70: 7320 6172 6520 636f 6e73 6964 6572 6564  s are considered
-0000ac80: 0d0a 2020 2020 2020 2020 652e 672e 2c20  ..        e.g., 
-0000ac90: 3c30 2e35 2077 6f75 6c64 2062 6520 636f  <0.5 would be co
-0000aca0: 6e76 6572 7465 6420 746f 205b 302c 3529  nverted to [0,5)
-0000acb0: 2e0d 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-0000acc0: 7365 7474 696e 6720 6f6e 6c79 2061 6666  setting only aff
-0000acd0: 6563 7473 2072 6573 756c 7473 2069 6620  ects results if 
-0000ace0: 666f 6375 735f 6869 6768 5f70 6f74 656e  focus_high_poten
-0000acf0: 7469 616c 2069 7320 4661 6c73 652e 0d0a  tial is False...
-0000ad00: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
-0000ad10: 756c 7420 6973 2046 616c 7365 2e0d 0a20  ult is False... 
-0000ad20: 2020 2070 7265 6369 7369 6f6e 5f74 6f6c     precision_tol
-0000ad30: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
-0000ad40: 656e 736f 7220 3a20 666c 6f61 742c 206f  ensor : float, o
-0000ad50: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-0000ad60: 2054 6872 6573 686f 6c64 2066 6f72 2072   Threshold for r
-0000ad70: 6570 6f72 7469 6e67 2063 656e 736f 7265  eporting censore
-0000ad80: 6420 7673 206e 6f6e 2d63 656e 736f 7265  d vs non-censore
-0000ad90: 6420 7265 7375 6c74 732e 0d0a 2020 2020  d results...    
-0000ada0: 2020 2020 5573 696e 6720 7468 6520 6465      Using the de
-0000adb0: 6661 756c 742c 2061 2072 6573 756c 7420  fault, a result 
-0000adc0: 7468 6174 2069 7320 6b6e 6f77 6e20 746f  that is known to
-0000add0: 2062 6520 696e 2074 6865 2069 6e74 6572   be in the inter
-0000ade0: 7661 6c20 2830 2e33 2c20 302e 3529 0d0a  val (0.3, 0.5)..
-0000adf0: 2020 2020 2020 2020 776f 756c 6420 6265          would be
-0000ae00: 2072 6574 7572 6e65 6420 6173 2030 2e34   returned as 0.4
-0000ae10: 2c20 7768 6572 6561 7320 6120 746f 6c65  , whereas a tole
-0000ae20: 7261 6e63 6520 6f66 2030 2077 6f75 6c64  rance of 0 would
-0000ae30: 2079 6965 6c64 2061 0d0a 2020 2020 2020   yield a..      
-0000ae40: 2020 7265 7375 6c74 206f 6620 3c30 2e35    result of <0.5
-0000ae50: 206f 7220 3e30 2e33 2064 6570 656e 6469   or >0.3 dependi
-0000ae60: 6e67 206f 6e20 7468 6520 7661 6c75 6520  ng on the value 
-0000ae70: 6f66 2066 6f63 7573 5f68 6967 6865 7374  of focus_highest
-0000ae80: 5f70 6f74 656e 7469 616c 2e0d 0a20 2020  _potential...   
-0000ae90: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
-0000aea0: 2069 7320 302e 3235 2e0d 0a20 2020 2070   is 0.25...    p
-0000aeb0: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
-0000aec0: 6720 3a20 626f 6f6c 6561 6e2c 206f 7074  g : boolean, opt
-0000aed0: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
-0000aee0: 6620 5472 7565 2c20 6120 726f 756e 6469  f True, a roundi
-0000aef0: 6e67 206d 6574 686f 6420 6973 2061 7070  ng method is app
-0000af00: 6c69 6564 2074 6f20 726f 756e 6420 7265  lied to round re
-0000af10: 7375 6c74 7320 746f 2068 6176 6520 6e6f  sults to have no
-0000af20: 206d 6f72 650d 0a20 2020 2020 2020 2064   more..        d
-0000af30: 6563 696d 616c 7320 7468 616e 2077 6861  ecimals than wha
-0000af40: 7420 6361 6e20 6265 206d 6561 7375 7265  t can be measure
-0000af50: 642e 0d0a 2020 2020 2020 2020 5468 6520  d...        The 
-0000af60: 6465 6661 756c 7420 6973 2054 7275 652e  default is True.
-0000af70: 0d0a 0d0a 2020 2020 5265 7475 726e 730d  ....    Returns.
-0000af80: 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a 2020  .    -------..  
-0000af90: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-0000afa0: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
-0000afb0: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
-0000afc0: 7320 6361 6c63 756c 6174 6564 2070 6572  s calculated per
-0000afd0: 6365 6e74 696c 6573 0d0a 0d0a 2020 2020  centiles....    
-0000afe0: 2727 270d 0a20 2020 200d 0a20 2020 2023  '''..    ..    #
-0000aff0: 2043 7265 6174 6520 6120 636f 7079 206f   Create a copy o
-0000b000: 6620 7468 6520 4461 7461 4672 616d 650d  f the DataFrame.
-0000b010: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
-0000b020: 7928 290d 0a20 2020 200d 0a20 2020 2023  y()..    ..    #
-0000b030: 2053 706c 6974 2074 6865 2072 6573 756c   Split the resul
-0000b040: 7420 696e 746f 2063 656e 736f 7220 616e  t into censor an
-0000b050: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
-0000b060: 656e 7473 0d0a 2020 2020 6466 203d 2072  ents..    df = r
-0000b070: 6573 756c 745f 746f 5f63 6f6d 706f 6e65  esult_to_compone
-0000b080: 6e74 7328 6466 2c72 6573 756c 745f 636f  nts(df,result_co
-0000b090: 6c29 0d0a 2020 2020 0d0a 2020 2020 2320  l)..    ..    # 
-0000b0a0: 436f 6e76 6572 7420 7468 6520 7265 7375  Convert the resu
-0000b0b0: 6c74 7320 6672 6f6d 2063 656e 736f 7220  lts from censor 
-0000b0c0: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
-0000b0d0: 6f6e 656e 7473 2074 6f20 616e 2069 6e74  onents to an int
-0000b0e0: 6572 7661 6c20 7265 7072 6573 656e 7461  erval representa
-0000b0f0: 7469 6f6e 0d0a 2020 2020 6466 203d 2063  tion..    df = c
-0000b100: 6f6d 706f 6e65 6e74 735f 746f 5f69 6e74  omponents_to_int
-0000b110: 6572 7661 6c28 6466 2c20 696e 636c 7564  erval(df, includ
-0000b120: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-0000b130: 7661 6c29 0d0a 2020 2020 0d0a 2020 2020  val)..    ..    
-0000b140: 2320 5573 696e 6720 7468 6520 696e 7465  # Using the inte
-0000b150: 7276 616c 732c 2064 6574 6572 6d69 6e65  rvals, determine
-0000b160: 2074 6865 2072 616e 6765 206f 6620 706f   the range of po
-0000b170: 7373 6962 6c65 2070 6572 6365 6e74 696c  ssible percentil
-0000b180: 6573 0d0a 2020 2020 0d0a 2020 2020 2320  es..    ..    # 
-0000b190: 4966 2074 6865 7265 2061 7265 206e 6f20  If there are no 
-0000b1a0: 6772 6f75 7062 792d 636f 6c75 6d6e 732c  groupby-columns,
-0000b1b0: 2074 6865 6e20 7461 6b65 2070 6572 6365   then take perce
-0000b1c0: 6e74 696c 6520 6f66 2061 6c6c 2072 6573  ntile of all res
-0000b1d0: 756c 7473 0d0a 2020 2020 6966 206e 6f74  ults..    if not
-0000b1e0: 2067 726f 7570 6279 5f63 6f6c 733a 0d0a   groupby_cols:..
-0000b1f0: 2020 2020 2020 2020 6466 203d 2070 6572          df = per
-0000b200: 6365 6e74 696c 655f 696e 7465 7276 616c  centile_interval
-0000b210: 2864 662c 2067 726f 7570 6279 5f63 6f6c  (df, groupby_col
-0000b220: 733d 5b5d 2c0d 0a20 2020 2020 2020 2020  s=[],..         
-0000b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b240: 2020 2020 2020 2020 7065 7263 656e 7469          percenti
-0000b250: 6c65 3d70 6572 6365 6e74 696c 652c 0d0a  le=percentile,..
-0000b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b280: 206d 6574 686f 643d 6d65 7468 6f64 290d   method=method).
-0000b290: 0a20 2020 2023 2049 6620 7468 6520 6772  .    # If the gr
-0000b2a0: 6f75 7062 795f 636f 6c73 2069 7320 6120  oupby_cols is a 
-0000b2b0: 6c69 7374 206f 6620 6c69 7374 732c 2074  list of lists, t
-0000b2c0: 6865 6e20 7065 7266 6f72 6d20 6d75 6c74  hen perform mult
-0000b2d0: 6970 6c65 2070 6572 6365 6e74 696c 6573  iple percentiles
-0000b2e0: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
-0000b2f0: 7461 6e63 6528 6772 6f75 7062 795f 636f  tance(groupby_co
-0000b300: 6c73 5b30 5d2c 6c69 7374 293a 0d0a 2020  ls[0],list):..  
-0000b310: 2020 2020 2020 666f 7220 6772 6f75 7069        for groupi
-0000b320: 6e67 2069 6e20 6772 6f75 7062 795f 636f  ng in groupby_co
-0000b330: 6c73 3a0d 0a20 2020 2020 2020 2020 2020  ls:..           
-0000b340: 2023 204f 6e6c 7920 6170 706c 7920 7065   # Only apply pe
-0000b350: 7263 656e 7469 6c65 2074 6f20 6669 6e61  rcentile to fina
-0000b360: 6c20 6772 6f75 7069 6e67 0d0a 2020 2020  l grouping..    
-0000b370: 2020 2020 2020 2020 6966 2067 726f 7570          if group
-0000b380: 696e 6720 3d3d 2067 726f 7570 6279 5f63  ing == groupby_c
-0000b390: 6f6c 735b 2d31 5d3a 0d0a 2020 2020 2020  ols[-1]:..      
-0000b3a0: 2020 2020 2020 2020 2020 2320 5573 696e            # Usin
-0000b3b0: 6720 7468 6520 696e 7465 7276 616c 732c  g the intervals,
-0000b3c0: 2064 6574 6572 6d69 6e65 2074 6865 2072   determine the r
-0000b3d0: 616e 6765 206f 6620 706f 7373 6962 6c65  ange of possible
-0000b3e0: 2070 6572 6365 6e74 696c 6573 0d0a 2020   percentiles..  
-0000b3f0: 2020 2020 2020 2020 2020 2020 2020 6466                df
-0000b400: 203d 2070 6572 6365 6e74 696c 655f 696e   = percentile_in
-0000b410: 7465 7276 616c 2864 662c 2067 726f 7570  terval(df, group
-0000b420: 696e 672c 2070 6572 6365 6e74 696c 652c  ing, percentile,
-0000b430: 206d 6574 686f 6429 0d0a 2020 2020 2020   method)..      
-0000b440: 2020 2020 2020 2320 4170 706c 7920 6d65        # Apply me
-0000b450: 6469 616e 2074 6f20 616c 6c20 7072 696f  dian to all prio
-0000b460: 7220 6772 6f75 7069 6e67 730d 0a20 2020  r groupings..   
-0000b470: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-0000b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b490: 2320 5573 696e 6720 7468 6520 696e 7465  # Using the inte
-0000b4a0: 7276 616c 732c 2064 6574 6572 6d69 6e65  rvals, determine
-0000b4b0: 2074 6865 2072 616e 6765 206f 6620 706f   the range of po
-0000b4c0: 7373 6962 6c65 206d 6564 6961 6e73 0d0a  ssible medians..
-0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4e0: 6466 203d 2070 6572 6365 6e74 696c 655f  df = percentile_
-0000b4f0: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
-0000b500: 7570 696e 672c 2035 302c 206d 6574 686f  uping, 50, metho
-0000b510: 6429 0d0a 2020 2020 2320 456c 7365 2074  d)..    # Else t
-0000b520: 6865 2067 726f 7570 6279 5f63 6f6c 7320  he groupby_cols 
-0000b530: 6973 2061 206c 6973 7420 6f66 2063 6f6c  is a list of col
-0000b540: 756d 6e20 6e61 6d65 730d 0a20 2020 2065  umn names..    e
-0000b550: 6c73 653a 0d0a 2020 2020 2020 2020 6466  lse:..        df
-0000b560: 203d 2070 6572 6365 6e74 696c 655f 696e   = percentile_in
-0000b570: 7465 7276 616c 2864 662c 2067 726f 7570  terval(df, group
-0000b580: 6279 5f63 6f6c 732c 2070 6572 6365 6e74  by_cols, percent
-0000b590: 696c 652c 206d 6574 686f 6429 0d0a 2020  ile, method)..  
-0000b5a0: 2020 0d0a 2020 2020 2320 436f 6e76 6572    ..    # Conver
-0000b5b0: 7420 7468 6520 696e 7465 7276 616c 2066  t the interval f
-0000b5c0: 6f72 2074 6865 206d 696e 696d 756d 2069  or the minimum i
-0000b5d0: 6e74 6f20 6365 6e73 6f72 2061 6e64 206e  nto censor and n
-0000b5e0: 756d 6572 6963 206e 6f74 6174 696f 6e0d  umeric notation.
-0000b5f0: 0a20 2020 2064 6620 3d20 696e 7465 7276  .    df = interv
-0000b600: 616c 5f74 6f5f 636f 6d70 6f6e 656e 7473  al_to_components
-0000b610: 2864 662c 0d0a 2020 2020 2020 2020 2020  (df,..          
-0000b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b630: 2020 2020 2020 666f 6375 735f 6869 6768        focus_high
-0000b640: 5f70 6f74 656e 7469 616c 203d 2066 6f63  _potential = foc
-0000b650: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-0000b660: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-0000b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b680: 2020 2020 696e 636c 7564 655f 6e65 6761      include_nega
-0000b690: 7469 7665 5f69 6e74 6572 7661 6c20 3d20  tive_interval = 
-0000b6a0: 696e 636c 7564 655f 6e65 6761 7469 7665  include_negative
-0000b6b0: 5f69 6e74 6572 7661 6c2c 0d0a 2020 2020  _interval,..    
-0000b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6d0: 2020 2020 2020 2020 2020 2020 7072 6563              prec
-0000b6e0: 6973 696f 6e5f 746f 6c65 7261 6e63 655f  ision_tolerance_
-0000b6f0: 746f 5f64 726f 705f 6365 6e73 6f72 203d  to_drop_censor =
-0000b700: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
-0000b710: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
-0000b720: 736f 7229 0d0a 2020 2020 0d0a 2020 2020  sor)..    ..    
-0000b730: 2320 4372 6561 7465 2069 6e74 6572 7661  # Create interva
-0000b740: 6c20 6e6f 7461 7469 6f6e 2066 6f72 2074  l notation for t
-0000b750: 6865 2070 6572 6365 6e74 696c 650d 0a20  he percentile.. 
-0000b760: 2020 2064 6620 3d20 696e 7465 7276 616c     df = interval
-0000b770: 5f6e 6f74 6174 696f 6e28 6466 2c20 7072  _notation(df, pr
-0000b780: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
-0000b790: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
-0000b7a0: 6f6d 6269 6e65 2074 6865 2063 656e 736f  ombine the censo
-0000b7b0: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
-0000b7c0: 6d70 6f6e 656e 7473 2069 6e74 6f20 6120  mponents into a 
-0000b7d0: 7265 7375 6c74 0d0a 2020 2020 6466 203d  result..    df =
-0000b7e0: 2063 6f6d 706f 6e65 6e74 735f 746f 5f72   components_to_r
-0000b7f0: 6573 756c 7428 6466 2c20 7072 6563 6973  esult(df, precis
-0000b800: 696f 6e5f 726f 756e 6469 6e67 290d 0a20  ion_rounding).. 
-0000b810: 2020 200d 0a20 2020 2023 2044 726f 7020     ..    # Drop 
-0000b820: 776f 726b 696e 6720 636f 6c75 6d6e 730d  working columns.
-0000b830: 0a20 2020 2064 6620 3d20 6466 2e64 726f  .    df = df.dro
-0000b840: 7028 6466 2e66 696c 7465 7228 7265 6765  p(df.filter(rege
-0000b850: 783d 275f 5f27 292e 636f 6c75 6d6e 732c  x='__').columns,
-0000b860: 2061 7869 733d 3129 0d0a 2020 2020 0d0a   axis=1)..    ..
-0000b870: 2020 2020 2320 5265 6f72 6465 7220 636f      # Reorder co
-0000b880: 6c75 6d6e 730d 0a20 2020 2066 6f72 2063  lumns..    for c
-0000b890: 6f6c 2069 6e20 5b73 7461 745f 636f 6c2c  ol in [stat_col,
-0000b8a0: 7265 7375 6c74 5f63 6f6c 2c63 656e 736f  result_col,censo
-0000b8b0: 725f 636f 6c2c 6e75 6d65 7269 635f 636f  r_col,numeric_co
-0000b8c0: 6c2c 696e 7465 7276 616c 5f63 6f6c 5d3a  l,interval_col]:
-0000b8d0: 0d0a 2020 2020 2020 2020 6466 5b63 6f6c  ..        df[col
-0000b8e0: 5d20 3d20 6466 2e70 6f70 2863 6f6c 290d  ] = df.pop(col).
-0000b8f0: 0a20 2020 200d 0a20 2020 2072 6574 7572  .    ..    retur
-0000b900: 6e20 6466 0d0a 0d0a 6465 6620 6d65 6469  n df....def medi
-0000b910: 616e 2864 662c 0d0a 2020 2020 2020 2020  an(df,..        
-0000b920: 2020 2072 6573 756c 745f 636f 6c2c 0d0a     result_col,..
-0000b930: 2020 2020 2020 2020 2020 2067 726f 7570             group
-0000b940: 6279 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d  by_cols = None,.
-0000b950: 0a20 2020 2020 2020 2020 2020 666f 6375  .           focu
-0000b960: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
-0000b970: 203d 2054 7275 652c 0d0a 2020 2020 2020   = True,..      
-0000b980: 2020 2020 2069 6e63 6c75 6465 5f6e 6567       include_neg
-0000b990: 6174 6976 655f 696e 7465 7276 616c 203d  ative_interval =
-0000b9a0: 2046 616c 7365 2c0d 0a20 2020 2020 2020   False,..       
-0000b9b0: 2020 2020 7072 6563 6973 696f 6e5f 746f      precision_to
-0000b9c0: 6c65 7261 6e63 655f 746f 5f64 726f 705f  lerance_to_drop_
-0000b9d0: 6365 6e73 6f72 203d 2030 2e32 352c 0d0a  censor = 0.25,..
-0000b9e0: 2020 2020 2020 2020 2020 2070 7265 6369             preci
-0000b9f0: 7369 6f6e 5f72 6f75 6e64 696e 6720 3d20  sion_rounding = 
-0000ba00: 5472 7565 293a 0d0a 2020 2020 2727 270d  True):..    '''.
-0000ba10: 0a20 2020 2041 2066 756e 6374 696f 6e20  .    A function 
-0000ba20: 7468 6174 2067 656e 6572 6174 6573 206d  that generates m
-0000ba30: 6564 6961 6e20 7265 7375 6c74 7320 666f  edian results fo
-0000ba40: 7220 6772 6f75 7073 2077 6974 6869 6e20  r groups within 
-0000ba50: 6120 4461 7461 4672 616d 652e 0d0a 0d0a  a DataFrame.....
-0000ba60: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-0000ba70: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
-0000ba80: 2020 2020 6466 203a 2044 6174 6146 7261      df : DataFra
-0000ba90: 6d65 0d0a 2020 2020 2020 2020 4461 7461  me..        Data
-0000baa0: 4672 616d 6520 7468 6174 2063 6f6e 7461  Frame that conta
-0000bab0: 696e 7320 6365 6e73 6f72 6564 206f 7220  ins censored or 
-0000bac0: 756e 6365 6e73 6f72 6564 2072 6573 756c  uncensored resul
-0000bad0: 7473 0d0a 2020 2020 7265 7375 6c74 5f63  ts..    result_c
-0000bae0: 6f6c 203a 2073 7472 696e 670d 0a20 2020  ol : string..   
-0000baf0: 2020 2020 2054 6865 2063 6f6c 756d 6e20       The column 
-0000bb00: 6e61 6d65 2066 6f72 2074 6865 2063 6f6c  name for the col
-0000bb10: 756d 6e20 7468 6174 2063 6f6e 7461 696e  umn that contain
-0000bb20: 2074 6865 2072 6573 756c 7473 2061 7320   the results as 
-0000bb30: 7465 7874 2e0d 0a20 2020 2020 2020 204f  text...        O
-0000bb40: 6e6c 7920 666f 7572 2070 6f73 7369 626c  nly four possibl
-0000bb50: 6520 6365 6e73 6f72 7320 7368 6f75 6c64  e censors should
-0000bb60: 2062 6520 7573 6564 2028 3c2c e289 a42c   be used (<,...,
-0000bb70: e289 a52c 3e29 2e0d 0a20 2020 2067 726f  ...,>)...    gro
-0000bb80: 7570 6279 5f63 6f6c 7320 3a20 6c69 7374  upby_cols : list
-0000bb90: 7320 6f66 2073 7472 696e 6773 2028 6f72  s of strings (or
-0000bba0: 206c 6973 7420 6f66 206c 6973 7473 292c   list of lists),
-0000bbb0: 206f 7074 696f 6e61 6c0d 0a20 2020 2020   optional..     
-0000bbc0: 2020 204c 6973 7420 6f66 2063 6f6c 756d     List of colum
-0000bbd0: 6e20 6e61 6d65 7320 7468 6174 2073 686f  n names that sho
-0000bbe0: 756c 6420 6265 2075 7365 6420 746f 2063  uld be used to c
-0000bbf0: 7265 6174 6520 6772 6f75 7073 2e20 4120  reate groups. A 
-0000bc00: 6d65 6469 616e 0d0a 2020 2020 2020 2020  median..        
-0000bc10: 7769 6c6c 2062 6520 666f 756e 6420 7769  will be found wi
-0000bc20: 7468 696e 2065 6163 6820 6772 6f75 702e  thin each group.
-0000bc30: 204d 756c 7469 706c 6520 6c69 7374 7320   Multiple lists 
-0000bc40: 6361 6e20 6265 2073 7570 706c 6965 6420  can be supplied 
-0000bc50: 746f 0d0a 2020 2020 2020 2020 7065 7266  to..        perf
-0000bc60: 6f72 6d20 7365 7175 656e 7469 616c 206d  orm sequential m
-0000bc70: 6564 6961 6e20 7065 7263 656e 7469 6c65  edian percentile
-0000bc80: 7320 6265 666f 7265 2063 616c 6375 6c61  s before calcula
-0000bc90: 7469 6e67 2061 206d 6564 6961 6e0d 0a20  ting a median.. 
-0000bca0: 2020 2020 2020 206f 7665 7220 7468 6520         over the 
-0000bcb0: 6669 6e61 6c20 6772 6f75 7069 6e67 2e0d  final grouping..
-0000bcc0: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
-0000bcd0: 6175 6c74 2069 7320 4e6f 6e65 2e0d 0a20  ault is None... 
-0000bce0: 2020 2066 6f63 7573 5f68 6967 685f 706f     focus_high_po
-0000bcf0: 7465 6e74 6961 6c20 3a20 626f 6f6c 6561  tential : boolea
-0000bd00: 6e2c 206f 7074 696f 6e61 6c0d 0a20 2020  n, optional..   
-0000bd10: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-0000bd20: 656e 2069 6e66 6f72 6d61 7469 6f6e 206f  en information o
-0000bd30: 6e20 7468 6520 6869 6768 6573 7420 706f  n the highest po
-0000bd40: 7465 6e74 6961 6c20 7265 7375 6c74 2077  tential result w
-0000bd50: 696c 6c20 6265 0d0a 2020 2020 2020 2020  ill be..        
-0000bd60: 666f 6375 7365 6420 6f76 6572 2074 6865  focused over the
-0000bd70: 206c 6f77 6573 7420 706f 7465 6e74 6961   lowest potentia
-0000bd80: 6c20 7265 7375 6c74 2e0d 0a20 2020 2069  l result...    i
-0000bd90: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
-0000bda0: 696e 7465 7276 616c 203a 2062 6f6f 6c65  interval : boole
-0000bdb0: 616e 2c20 6f70 7469 6f6e 616c 0d0a 2020  an, optional..  
-0000bdc0: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-0000bdd0: 6865 6e20 616c 6c20 706f 7369 7469 7665  hen all positive
-0000bde0: 2061 6e64 206e 6567 6174 6976 6520 7661   and negative va
-0000bdf0: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
-0000be00: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
-0000be10: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
-0000be20: 2063 6f6e 7665 7274 6564 2074 6f20 282d   converted to (-
-0000be30: 6e70 2e69 6e66 2c35 292e 0d0a 2020 2020  np.inf,5)...    
-0000be40: 2020 2020 4966 2046 616c 7365 2c20 7468      If False, th
-0000be50: 656e 206f 6e6c 7920 6e6f 6e2d 6e65 6761  en only non-nega
-0000be60: 7469 7665 2076 616c 7565 7320 6172 6520  tive values are 
-0000be70: 636f 6e73 6964 6572 6564 0d0a 2020 2020  considered..    
-0000be80: 2020 2020 652e 672e 2c20 3c30 2e35 2077      e.g., <0.5 w
-0000be90: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
-0000bea0: 6420 746f 205b 302c 3529 2e0d 0a20 2020  d to [0,5)...   
-0000beb0: 2020 2020 2054 6869 7320 7365 7474 696e       This settin
-0000bec0: 6720 6f6e 6c79 2061 6666 6563 7473 2072  g only affects r
-0000bed0: 6573 756c 7473 2069 6620 666f 6375 735f  esults if focus_
-0000bee0: 6869 6768 5f70 6f74 656e 7469 616c 2069  high_potential i
-0000bef0: 7320 4661 6c73 652e 0d0a 2020 2020 2020  s False...      
-0000bf00: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
-0000bf10: 2046 616c 7365 2e0d 0a20 2020 2070 7265   False...    pre
-0000bf20: 6369 7369 6f6e 5f74 6f6c 6572 616e 6365  cision_tolerance
-0000bf30: 5f74 6f5f 6472 6f70 5f63 656e 736f 7220  _to_drop_censor 
-0000bf40: 3a20 666c 6f61 742c 206f 7074 696f 6e61  : float, optiona
-0000bf50: 6c0d 0a20 2020 2020 2020 2054 6872 6573  l..        Thres
-0000bf60: 686f 6c64 2066 6f72 2072 6570 6f72 7469  hold for reporti
-0000bf70: 6e67 2063 656e 736f 7265 6420 7673 206e  ng censored vs n
-0000bf80: 6f6e 2d63 656e 736f 7265 6420 7265 7375  on-censored resu
-0000bf90: 6c74 732e 0d0a 2020 2020 2020 2020 5573  lts...        Us
-0000bfa0: 696e 6720 7468 6520 6465 6661 756c 742c  ing the default,
-0000bfb0: 2061 2072 6573 756c 7420 7468 6174 2069   a result that i
-0000bfc0: 7320 6b6e 6f77 6e20 746f 2062 6520 696e  s known to be in
-0000bfd0: 2074 6865 2069 6e74 6572 7661 6c20 2830   the interval (0
-0000bfe0: 2e33 2c20 302e 3529 0d0a 2020 2020 2020  .3, 0.5)..      
-0000bff0: 2020 776f 756c 6420 6265 2072 6574 7572    would be retur
-0000c000: 6e65 6420 6173 2030 2e34 2c20 7768 6572  ned as 0.4, wher
-0000c010: 6561 7320 6120 746f 6c65 7261 6e63 6520  eas a tolerance 
-0000c020: 6f66 2030 2077 6f75 6c64 2079 6965 6c64  of 0 would yield
-0000c030: 2061 0d0a 2020 2020 2020 2020 7265 7375   a..        resu
-0000c040: 6c74 206f 6620 3c30 2e35 206f 7220 3e30  lt of <0.5 or >0
-0000c050: 2e33 2064 6570 656e 6469 6e67 206f 6e20  .3 depending on 
-0000c060: 7468 6520 7661 6c75 6520 6f66 2066 6f63  the value of foc
-0000c070: 7573 5f68 6967 6865 7374 5f70 6f74 656e  us_highest_poten
-0000c080: 7469 616c 2e0d 0a20 2020 2020 2020 2054  tial...        T
-0000c090: 6865 2064 6566 6175 6c74 2069 7320 302e  he default is 0.
-0000c0a0: 3235 2e0d 0a20 2020 2070 7265 6369 7369  25...    precisi
-0000c0b0: 6f6e 5f72 6f75 6e64 696e 6720 3a20 626f  on_rounding : bo
-0000c0c0: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
-0000c0d0: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-0000c0e0: 2c20 6120 726f 756e 6469 6e67 206d 6574  , a rounding met
-0000c0f0: 686f 6420 6973 2061 7070 6c69 6564 2074  hod is applied t
-0000c100: 6f20 726f 756e 6420 7265 7375 6c74 7320  o round results 
-0000c110: 746f 2068 6176 6520 6e6f 206d 6f72 650d  to have no more.
-0000c120: 0a20 2020 2020 2020 2064 6563 696d 616c  .        decimal
-0000c130: 7320 7468 616e 2077 6861 7420 6361 6e20  s than what can 
-0000c140: 6265 206d 6561 7375 7265 642e 0d0a 2020  be measured...  
-0000c150: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-0000c160: 7420 6973 2054 7275 652e 0d0a 0d0a 2020  t is True.....  
-0000c170: 2020 5265 7475 726e 730d 0a20 2020 202d    Returns..    -
-0000c180: 2d2d 2d2d 2d2d 0d0a 2020 2020 6466 203a  ------..    df :
-0000c190: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-0000c1a0: 2020 2020 4461 7461 4672 616d 6520 7468      DataFrame th
-0000c1b0: 6174 2063 6f6e 7461 696e 7320 6361 6c63  at contains calc
-0000c1c0: 756c 6174 6564 2070 6572 6365 6e74 696c  ulated percentil
-0000c1d0: 6573 0d0a 0d0a 2020 2020 2727 270d 0a20  es....    '''.. 
-0000c1e0: 2020 200d 0a20 2020 2023 2043 7265 6174     ..    # Creat
-0000c1f0: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
-0000c200: 4461 7461 4672 616d 650d 0a20 2020 2064  DataFrame..    d
-0000c210: 6620 3d20 6466 2e63 6f70 7928 290d 0a20  f = df.copy().. 
-0000c220: 2020 200d 0a20 2020 2023 2043 616c 6c20     ..    # Call 
-0000c230: 7065 7263 656e 7469 6c65 2066 756e 6374  percentile funct
-0000c240: 696f 6e20 7769 7468 2070 6572 6365 6e74  ion with percent
-0000c250: 696c 6520 3d20 3530 0d0a 2020 2020 6466  ile = 50..    df
-0000c260: 203d 2070 6572 6365 6e74 696c 6528 6466   = percentile(df
-0000c270: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c280: 2020 2020 2020 2072 6573 756c 745f 636f         result_co
-0000c290: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-0000c2a0: 2020 2020 2020 2020 3530 2c0d 0a20 2020          50,..   
-0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2c0: 2067 726f 7570 6279 5f63 6f6c 7320 3d20   groupby_cols = 
-0000c2d0: 6772 6f75 7062 795f 636f 6c73 2c0d 0a20  groupby_cols,.. 
-0000c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2f0: 2020 2066 6f63 7573 5f68 6967 685f 706f     focus_high_po
-0000c300: 7465 6e74 6961 6c20 3d20 666f 6375 735f  tential = focus_
-0000c310: 6869 6768 5f70 6f74 656e 7469 616c 2c0d  high_potential,.
-0000c320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c330: 2020 2020 2069 6e63 6c75 6465 5f6e 6567       include_neg
-0000c340: 6174 6976 655f 696e 7465 7276 616c 203d  ative_interval =
-0000c350: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
-0000c360: 655f 696e 7465 7276 616c 2c0d 0a20 2020  e_interval,..   
-0000c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c380: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
-0000c390: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
-0000c3a0: 736f 7220 3d20 7072 6563 6973 696f 6e5f  sor = precision_
-0000c3b0: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
-0000c3c0: 705f 6365 6e73 6f72 2c0d 0a20 2020 2020  p_censor,..     
-0000c3d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000c3e0: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
-0000c3f0: 6720 3d20 7072 6563 6973 696f 6e5f 726f  g = precision_ro
-0000c400: 756e 6469 6e67 290d 0a20 2020 200d 0a20  unding)..    .. 
-0000c410: 2020 2072 6574 7572 6e20 6466 0d0a 0d0a     return df....
-0000c420: 2325 2520 5065 7263 656e 7420 4578 6365  #%% Percent Exce
-0000c430: 6564 616e 6365 2052 6573 756c 740d 0a0d  edance Result...
-0000c440: 0a64 6566 2070 6572 6365 6e74 5f65 7863  .def percent_exc
-0000c450: 6565 6461 6e63 655f 6173 7365 7373 6d65  eedance_assessme
-0000c460: 6e74 2864 662c 0d0a 2020 2020 2020 2020  nt(df,..        
-0000c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c480: 2020 2020 2020 2020 2020 7468 7265 7368            thresh
-0000c490: 6f6c 642c 0d0a 2020 2020 2020 2020 2020  old,..          
-0000c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4b0: 2020 2020 2020 2020 636f 756e 745f 7468          count_th
-0000c4c0: 7265 7368 6f6c 645f 6173 5f65 7863 6565  reshold_as_excee
-0000c4d0: 6461 6e63 653d 4661 6c73 6529 3a0d 0a20  dance=False):.. 
-0000c4e0: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
-0000c4f0: 6e63 7469 6f6e 2074 6861 7420 616e 616c  nction that anal
-0000c500: 7973 6573 2074 6865 2069 6e74 6572 7661  yses the interva
-0000c510: 6c20 6e6f 7461 7469 6f6e 2066 6f72 6d20  l notation form 
-0000c520: 6f66 2072 6573 756c 7473 2072 6574 7572  of results retur
-0000c530: 6e65 640d 0a20 2020 2066 726f 6d20 636f  ned..    from co
-0000c540: 6d70 6f6e 656e 7473 5f74 6f5f 696e 7465  mponents_to_inte
-0000c550: 7276 616c 2061 6e64 2064 6574 6572 6d69  rval and determi
-0000c560: 6e65 7320 7768 6574 6865 7220 7468 6520  nes whether the 
-0000c570: 7265 7375 6c74 2069 7320 616e 0d0a 2020  result is an..  
-0000c580: 2020 6578 6365 6564 616e 6365 206f 7220    exceedance or 
-0000c590: 6e6f 742e 0d0a 0d0a 2020 2020 5061 7261  not.....    Para
-0000c5a0: 6d65 7465 7273 0d0a 2020 2020 2d2d 2d2d  meters..    ----
-0000c5b0: 2d2d 2d2d 2d2d 0d0a 2020 2020 6466 203a  ------..    df :
-0000c5c0: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-0000c5d0: 2020 2020 4461 7461 4672 616d 6520 7468      DataFrame th
-0000c5e0: 6174 2063 6f6e 7461 696e 7320 7265 7375  at contains resu
-0000c5f0: 6c74 7320 696e 2061 2073 7065 6369 6669  lts in a specifi
-0000c600: 6320 696e 7465 7276 616c 206e 6f74 6174  c interval notat
-0000c610: 696f 6e2e 0d0a 2020 2020 7468 7265 7368  ion...    thresh
-0000c620: 6f6c 6420 3a20 666c 6f61 740d 0a20 2020  old : float..   
-0000c630: 2020 2020 2054 6865 2074 6872 6573 686f       The thresho
-0000c640: 6c64 206f 6620 696e 7465 7265 7374 2e0d  ld of interest..
-0000c650: 0a20 2020 2063 6f75 6e74 5f74 6872 6573  .    count_thres
-0000c660: 686f 6c64 5f61 735f 6578 6365 6564 616e  hold_as_exceedan
-0000c670: 6365 203a 2062 6f6f 6c65 616e 0d0a 2020  ce : boolean..  
-0000c680: 2020 2020 2020 5365 7420 6173 2054 7275        Set as Tru
-0000c690: 6520 6966 2074 6865 2074 6872 6573 686f  e if the thresho
-0000c6a0: 6c64 2076 616c 7565 2073 686f 756c 6420  ld value should 
-0000c6b0: 6265 2063 6f75 6e74 6564 2061 7320 616e  be counted as an
-0000c6c0: 2065 7863 6565 6461 6e63 652e 0d0a 2020   exceedance...  
-0000c6d0: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-0000c6e0: 7420 6973 2046 616c 7365 2e0d 0a0d 0a20  t is False..... 
-0000c6f0: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
-0000c700: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064 6620  -------..    df 
-0000c710: 3a20 4461 7461 4672 616d 650d 0a20 2020  : DataFrame..   
-0000c720: 2020 2020 2044 6174 6146 7261 6d65 2074       DataFrame t
-0000c730: 6861 7420 6861 7320 616e 2065 7863 6565  hat has an excee
-0000c740: 6461 6e63 6520 6173 7365 7373 6d65 6e74  dance assessment
-0000c750: 2066 6f72 2065 6163 6820 7265 7375 6c74   for each result
-0000c760: 2e0d 0a0d 0a20 2020 2027 2727 0d0a 2020  .....    '''..  
-0000c770: 2020 0d0a 2020 2020 2320 4372 6561 7465    ..    # Create
-0000c780: 2061 2063 6f70 7920 6f66 2074 6865 2044   a copy of the D
-0000c790: 6174 6146 7261 6d65 0d0a 2020 2020 6466  ataFrame..    df
-0000c7a0: 203d 2064 662e 636f 7079 2829 0d0a 2020   = df.copy()..  
-0000c7b0: 2020 0d0a 2020 2020 2320 4368 6563 6b20    ..    # Check 
-0000c7c0: 7468 6174 2069 6e70 7574 2069 7320 696e  that input is in
-0000c7d0: 7465 6765 7220 6f72 2066 6c6f 6174 0d0a  teger or float..
-0000c7e0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-0000c7f0: 7461 6e63 6528 7468 7265 7368 6f6c 642c  tance(threshold,
-0000c800: 2028 696e 742c 2066 6c6f 6174 2929 3a0d   (int, float)):.
-0000c810: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-0000c820: 616c 7565 4572 726f 7228 2774 6872 6573  alueError('thres
-0000c830: 686f 6c64 2069 6e70 7574 206e 6565 6473  hold input needs
-0000c840: 2074 6f20 6265 2069 6e74 6567 6572 206f   to be integer o
-0000c850: 7220 666c 6f61 7420 7479 7065 2e27 290d  r float type.').
-0000c860: 0a20 2020 200d 0a20 2020 2023 2053 6574  .    ..    # Set
-0000c870: 2063 6f6e 6469 7469 6f6e 7320 6465 7065   conditions depe
-0000c880: 6e64 696e 6720 6f6e 2077 6865 7468 6572  nding on whether
-0000c890: 2074 6865 2074 6872 6573 686f 6c64 2069   the threshold i
-0000c8a0: 7320 616e 2065 7863 6565 6461 6e63 650d  s an exceedance.
-0000c8b0: 0a20 2020 2069 6620 636f 756e 745f 7468  .    if count_th
-0000c8c0: 7265 7368 6f6c 645f 6173 5f65 7863 6565  reshold_as_excee
-0000c8d0: 6461 6e63 653a 0d0a 2020 2020 2020 2020  dance:..        
-0000c8e0: 2320 5365 7420 636f 6e64 6974 696f 6e73  # Set conditions
-0000c8f0: 2066 6f72 2065 7863 6565 6461 6e63 6573   for exceedances
-0000c900: 2061 6e64 206e 6f6e 2d65 7863 6565 6461   and non-exceeda
-0000c910: 6e63 6573 0d0a 2020 2020 2020 2020 636f  nces..        co
-0000c920: 6e64 6974 696f 6e73 203d 205b 0d0a 2020  nditions = [..  
-0000c930: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
-0000c940: 6865 206c 6566 7420 626f 756e 6420 6973  he left bound is
-0000c950: 2067 7265 6174 6572 2074 6861 6e20 6f72   greater than or
-0000c960: 2065 7175 616c 2074 6f20 7468 6520 7468   equal to the th
-0000c970: 7265 7368 6f6c 6420 7468 616e 2065 7863  reshold than exc
-0000c980: 6565 6461 6e63 650d 0a20 2020 2020 2020  eedance..       
-0000c990: 2020 2020 2028 6466 5b6c 6566 745f 626f       (df[left_bo
-0000c9a0: 756e 645f 636f 6c5d 203e 3d20 7468 7265  und_col] >= thre
-0000c9b0: 7368 6f6c 6429 2c0d 0a20 2020 2020 2020  shold),..       
-0000c9c0: 2020 2020 2023 2049 6620 7468 6520 7269       # If the ri
-0000c9d0: 6768 7420 626f 756e 6420 6973 206c 6573  ght bound is les
-0000c9e0: 7320 7468 616e 2074 6865 2074 7265 7368  s than the tresh
-0000c9f0: 6f6c 6420 7468 616e 206e 6f6e 2d65 7863  old than non-exc
-0000ca00: 6565 6461 6e63 650d 0a20 2020 2020 2020  eedance..       
-0000ca10: 2020 2020 2028 6466 5b72 6967 6874 5f62       (df[right_b
-0000ca20: 6f75 6e64 5f63 6f6c 5d20 3c20 7468 7265  ound_col] < thre
-0000ca30: 7368 6f6c 6429 0d0a 2020 2020 2020 2020  shold)..        
-0000ca40: 2020 2020 5d0d 0a20 2020 2065 6c73 653a      ]..    else:
-0000ca50: 0d0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-0000ca60: 636f 6e64 6974 696f 6e73 2066 6f72 2065  conditions for e
-0000ca70: 7863 6565 6461 6e63 6573 2061 6e64 206e  xceedances and n
-0000ca80: 6f6e 2d65 7863 6565 6461 6e63 6573 0d0a  on-exceedances..
-0000ca90: 2020 2020 2020 2020 636f 6e64 6974 696f          conditio
-0000caa0: 6e73 203d 205b 0d0a 2020 2020 2020 2020  ns = [..        
-0000cab0: 2020 2020 2320 4966 2074 6865 206c 6566      # If the lef
-0000cac0: 7420 626f 756e 6420 6973 2067 7265 6174  t bound is great
-0000cad0: 6572 2074 6861 6e20 7468 6520 7468 7265  er than the thre
-0000cae0: 7368 6f6c 6420 7468 616e 2065 7863 6565  shold than excee
-0000caf0: 6461 6e63 650d 0a20 2020 2020 2020 2020  dance..         
-0000cb00: 2020 2028 6466 5b6c 6566 745f 626f 756e     (df[left_boun
-0000cb10: 645f 636f 6c5d 203e 2074 6872 6573 686f  d_col] > thresho
-0000cb20: 6c64 292c 0d0a 2020 2020 2020 2020 2020  ld),..          
-0000cb30: 2020 2320 4966 2074 6865 2072 6967 6874    # If the right
-0000cb40: 2062 6f75 6e64 2069 7320 6c65 7373 2074   bound is less t
-0000cb50: 6861 6e20 6f72 2065 7175 616c 2074 6f20  han or equal to 
-0000cb60: 7468 6520 7472 6573 686f 6c64 2074 6861  the treshold tha
-0000cb70: 6e20 6e6f 6e2d 6578 6365 6564 616e 6365  n non-exceedance
-0000cb80: 0d0a 2020 2020 2020 2020 2020 2020 2864  ..            (d
-0000cb90: 665b 7269 6768 745f 626f 756e 645f 636f  f[right_bound_co
-0000cba0: 6c5d 203c 3d20 7468 7265 7368 6f6c 6429  l] <= threshold)
-0000cbb0: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
-0000cbc0: 0a20 2020 2023 2045 7863 6565 6461 6e63  .    # Exceedanc
-0000cbd0: 6573 2061 7265 2069 6e64 6963 6174 6564  es are indicated
-0000cbe0: 2062 7920 696e 7465 6765 7273 0d0a 2020   by integers..  
-0000cbf0: 2020 2320 2831 3d65 7863 6565 6461 6e63    # (1=exceedanc
-0000cc00: 652c 2030 3d6e 6f6e 2d65 7863 6565 6461  e, 0=non-exceeda
-0000cc10: 6e63 6529 0d0a 2020 2020 7265 7375 6c74  nce)..    result
-0000cc20: 7320 3d20 5b0d 0a20 2020 2020 2020 2031  s = [..        1
-0000cc30: 2c0d 0a20 2020 2020 2020 2030 0d0a 2020  ,..        0..  
-0000cc40: 2020 2020 2020 5d0d 0a20 2020 2023 2044        ]..    # D
-0000cc50: 6566 6175 6c74 2065 7863 6565 6461 6e63  efault exceedanc
-0000cc60: 6520 286e 702e 6e61 6e3d 756e 6b6e 6f77  e (np.nan=unknow
-0000cc70: 6e29 0d0a 2020 2020 6466 5b27 5f5f 4578  n)..    df['__Ex
-0000cc80: 6365 6564 616e 6365 5f5f 275d 203d 206e  ceedance__'] = n
-0000cc90: 702e 7365 6c65 6374 2863 6f6e 6469 7469  p.select(conditi
-0000cca0: 6f6e 732c 2072 6573 756c 7473 2c20 6e70  ons, results, np
-0000ccb0: 2e6e 616e 290d 0a20 2020 200d 0a20 2020  .nan)..    ..   
-0000ccc0: 2072 6574 7572 6e20 6466 0d0a 0d0a 6465   return df....de
-0000ccd0: 6620 7065 7263 656e 745f 6578 6365 6564  f percent_exceed
-0000cce0: 616e 6365 2864 662c 0d0a 2020 2020 2020  ance(df,..      
-0000ccf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd00: 2072 6573 756c 745f 636f 6c2c 0d0a 2020   result_col,..  
-0000cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd20: 2020 2020 2074 6872 6573 686f 6c64 2c0d       threshold,.
-0000cd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cd40: 2020 2020 2020 2020 636f 756e 745f 7468          count_th
-0000cd50: 7265 7368 6f6c 645f 6173 5f65 7863 6565  reshold_as_excee
-0000cd60: 6461 6e63 653d 4661 6c73 652c 0d0a 2020  dance=False,..  
-0000cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd80: 2020 2020 2067 726f 7570 6279 5f63 6f6c       groupby_col
-0000cd90: 7320 3d20 4e6f 6e65 2c0d 0a20 2020 2020  s = None,..     
-0000cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cdb0: 2020 696e 636c 7564 655f 6e65 6761 7469    include_negati
-0000cdc0: 7665 5f69 6e74 6572 7661 6c20 3d20 4661  ve_interval = Fa
-0000cdd0: 6c73 6529 3a0d 0a20 2020 2027 2727 0d0a  lse):..    '''..
-0000cde0: 2020 2020 4120 6675 6e63 7469 6f6e 2074      A function t
-0000cdf0: 6861 7420 636f 6d62 696e 6573 2074 6865  hat combines the
-0000ce00: 2072 656c 6576 616e 7420 7065 7263 656e   relevant percen
-0000ce10: 7469 6c65 2061 6e64 2075 7469 6c69 7479  tile and utility
-0000ce20: 2066 756e 6374 696f 6e73 2074 6f0d 0a20   functions to.. 
-0000ce30: 2020 2067 656e 6572 6174 6520 7468 6520     generate the 
-0000ce40: 7065 7263 656e 6974 6c65 2072 6573 756c  percenitle resul
-0000ce50: 7473 2066 6f72 2067 726f 7570 7320 7769  ts for groups wi
-0000ce60: 7468 696e 2061 2044 6174 6146 7261 6d65  thin a DataFrame
-0000ce70: 2e0d 0a0d 0a20 2020 2050 6172 616d 6574  .....    Paramet
-0000ce80: 6572 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ers..    -------
-0000ce90: 2d2d 2d0d 0a20 2020 2064 6620 3a20 4461  ---..    df : Da
-0000cea0: 7461 4672 616d 650d 0a20 2020 2020 2020  taFrame..       
-0000ceb0: 2044 6174 6146 7261 6d65 2074 6861 7420   DataFrame that 
-0000cec0: 636f 6e74 6169 6e73 2063 656e 736f 7265  contains censore
-0000ced0: 6420 6f72 2075 6e63 656e 736f 7265 6420  d or uncensored 
-0000cee0: 7265 7375 6c74 730d 0a20 2020 2072 6573  results..    res
-0000cef0: 756c 745f 636f 6c20 3a20 7374 7269 6e67  ult_col : string
-0000cf00: 0d0a 2020 2020 2020 2020 5468 6520 636f  ..        The co
-0000cf10: 6c75 6d6e 206e 616d 6520 666f 7220 7468  lumn name for th
-0000cf20: 6520 636f 6c75 6d6e 2074 6861 7420 636f  e column that co
-0000cf30: 6e74 6169 6e20 7468 6520 7265 7375 6c74  ntain the result
-0000cf40: 7320 6173 2074 6578 742e 0d0a 2020 2020  s as text...    
-0000cf50: 2020 2020 4f6e 6c79 2066 6f75 7220 706f      Only four po
-0000cf60: 7373 6962 6c65 2063 656e 736f 7273 2073  ssible censors s
-0000cf70: 686f 756c 6420 6265 2075 7365 6420 283c  hould be used (<
-0000cf80: 2ce2 89a4 2ce2 89a5 2c3e 292e 0d0a 2020  ,...,...,>)...  
-0000cf90: 2020 7468 7265 7368 6f6c 6420 3a20 666c    threshold : fl
-0000cfa0: 6f61 740d 0a20 2020 2020 2020 2054 6865  oat..        The
-0000cfb0: 2074 6872 6573 686f 6c64 206f 6620 696e   threshold of in
-0000cfc0: 7465 7265 7374 2e0d 0a20 2020 2063 6f75  terest...    cou
-0000cfd0: 6e74 5f74 6872 6573 686f 6c64 5f61 735f  nt_threshold_as_
-0000cfe0: 6578 6365 6564 616e 6365 203a 2062 6f6f  exceedance : boo
-0000cff0: 6c65 616e 0d0a 2020 2020 2020 2020 5365  lean..        Se
-0000d000: 7420 6173 2054 7275 6520 6966 2074 6865  t as True if the
-0000d010: 2074 6872 6573 686f 6c64 2076 616c 7565   threshold value
-0000d020: 2073 686f 756c 6420 6265 2063 6f75 6e74   should be count
-0000d030: 6564 2061 7320 616e 2065 7863 6565 6461  ed as an exceeda
-0000d040: 6e63 652e 0d0a 2020 2020 2020 2020 5468  nce...        Th
-0000d050: 6520 6465 6661 756c 7420 6973 2046 616c  e default is Fal
-0000d060: 7365 2e0d 0a20 2020 2067 726f 7570 6279  se...    groupby
-0000d070: 5f63 6f6c 7320 3a20 6c69 7374 7320 6f66  _cols : lists of
-0000d080: 2073 7472 696e 6773 2028 6f72 206c 6973   strings (or lis
-0000d090: 7420 6f66 2074 776f 206c 6973 7473 292c  t of two lists),
-0000d0a0: 206f 7074 696f 6e61 6c0d 0a20 2020 2020   optional..     
-0000d0b0: 2020 204c 6973 7420 6f66 2063 6f6c 756d     List of colum
-0000d0c0: 6e20 6e61 6d65 7320 7468 6174 2073 686f  n names that sho
-0000d0d0: 756c 6420 6265 2075 7365 6420 746f 2063  uld be used to c
-0000d0e0: 7265 6174 6520 6772 6f75 7073 2e20 5065  reate groups. Pe
-0000d0f0: 7263 656e 7461 6765 0d0a 2020 2020 2020  rcentage..      
-0000d100: 2020 6f66 2065 7863 6565 6461 6e63 6573    of exceedances
-0000d110: 2077 696c 6c20 6265 2066 6f75 6e64 2077   will be found w
-0000d120: 6974 6869 6e20 6561 6368 2067 726f 7570  ithin each group
-0000d130: 2e20 5477 6f20 6c69 7374 7320 6361 6e20  . Two lists can 
-0000d140: 6265 0d0a 2020 2020 2020 2020 7375 7070  be..        supp
-0000d150: 6c69 6564 2074 6f20 6669 7273 7420 6669  lied to first fi
-0000d160: 6e64 2074 6865 206d 6178 696d 756d 2077  nd the maximum w
-0000d170: 6974 6869 6e20 6561 6368 2067 726f 7570  ithin each group
-0000d180: 2062 6566 6f72 650d 0a20 2020 2020 2020   before..       
-0000d190: 2064 6574 6572 6d69 6e69 6e67 2074 6865   determining the
-0000d1a0: 2070 6572 6365 6e74 6167 6520 6f66 2065   percentage of e
-0000d1b0: 7863 6565 6461 6e63 6573 206f 7665 7220  xceedances over 
-0000d1c0: 7468 6520 7365 636f 6e64 2067 726f 7570  the second group
-0000d1d0: 696e 672e 0d0a 2020 2020 2020 2020 5468  ing...        Th
-0000d1e0: 6520 6465 6661 756c 7420 6973 204e 6f6e  e default is Non
-0000d1f0: 652e 0d0a 2020 2020 696e 636c 7564 655f  e...    include_
-0000d200: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
-0000d210: 6c20 3a20 626f 6f6c 6561 6e2c 206f 7074  l : boolean, opt
-0000d220: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
-0000d230: 6620 5472 7565 2c20 7468 656e 2061 6c6c  f True, then all
-0000d240: 2070 6f73 6974 6976 6520 616e 6420 6e65   positive and ne
-0000d250: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
-0000d260: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
-0000d270: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
-0000d280: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
-0000d290: 7465 6420 746f 2028 2d6e 702e 696e 662c  ted to (-np.inf,
-0000d2a0: 3529 2e0d 0a20 2020 2020 2020 2049 6620  5)...        If 
-0000d2b0: 4661 6c73 652c 2074 6865 6e20 6f6e 6c79  False, then only
-0000d2c0: 206e 6f6e 2d6e 6567 6174 6976 6520 7661   non-negative va
-0000d2d0: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
-0000d2e0: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
-0000d2f0: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
-0000d300: 2063 6f6e 7665 7274 6564 2074 6f20 5b30   converted to [0
-0000d310: 2c35 292e 0d0a 2020 2020 2020 2020 5468  ,5)...        Th
-0000d320: 6973 2073 6574 7469 6e67 206f 6e6c 7920  is setting only 
-0000d330: 6166 6665 6374 7320 7265 7375 6c74 7320  affects results 
-0000d340: 6966 2066 6f63 7573 5f68 6967 685f 706f  if focus_high_po
-0000d350: 7465 6e74 6961 6c20 6973 2046 616c 7365  tential is False
-0000d360: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
-0000d370: 6566 6175 6c74 2069 7320 4661 6c73 652e  efault is False.
-0000d380: 0d0a 0d0a 2020 2020 5265 7475 726e 730d  ....    Returns.
-0000d390: 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a 2020  .    -------..  
-0000d3a0: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-0000d3b0: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
-0000d3c0: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
-0000d3d0: 7320 6361 6c63 756c 6174 6564 2070 6572  s calculated per
-0000d3e0: 6365 6e74 696c 6573 0d0a 0d0a 2020 2020  centiles....    
-0000d3f0: 2727 270d 0a20 2020 200d 0a20 2020 2023  '''..    ..    #
-0000d400: 2043 7265 6174 6520 6120 636f 7079 206f   Create a copy o
-0000d410: 6620 7468 6520 4461 7461 4672 616d 650d  f the DataFrame.
-0000d420: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
-0000d430: 7928 290d 0a20 2020 200d 0a20 2020 2023  y()..    ..    #
-0000d440: 2053 706c 6974 2074 6865 2072 6573 756c   Split the resul
-0000d450: 7420 696e 746f 2063 656e 736f 7220 616e  t into censor an
-0000d460: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
-0000d470: 656e 7473 0d0a 2020 2020 6466 203d 2072  ents..    df = r
-0000d480: 6573 756c 745f 746f 5f63 6f6d 706f 6e65  esult_to_compone
-0000d490: 6e74 7328 6466 2c72 6573 756c 745f 636f  nts(df,result_co
-0000d4a0: 6c29 0d0a 2020 2020 0d0a 2020 2020 2320  l)..    ..    # 
-0000d4b0: 436f 6e76 6572 7420 7468 6520 7265 7375  Convert the resu
-0000d4c0: 6c74 7320 6672 6f6d 2063 656e 736f 7220  lts from censor 
-0000d4d0: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
-0000d4e0: 6f6e 656e 7473 2074 6f20 616e 2069 6e74  onents to an int
-0000d4f0: 6572 7661 6c20 7265 7072 6573 656e 7461  erval representa
-0000d500: 7469 6f6e 0d0a 2020 2020 6466 203d 2063  tion..    df = c
-0000d510: 6f6d 706f 6e65 6e74 735f 746f 5f69 6e74  omponents_to_int
-0000d520: 6572 7661 6c28 6466 2c20 696e 636c 7564  erval(df, includ
-0000d530: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
-0000d540: 7661 6c29 0d0a 2020 2020 0d0a 2020 2020  val)..    ..    
-0000d550: 2320 4173 7365 7373 2065 7863 6565 6461  # Assess exceeda
-0000d560: 6e63 6573 0d0a 2020 2020 6466 203d 2070  nces..    df = p
-0000d570: 6572 6365 6e74 5f65 7863 6565 6461 6e63  ercent_exceedanc
-0000d580: 655f 6173 7365 7373 6d65 6e74 2864 662c  e_assessment(df,
-0000d590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5b0: 2020 2020 2020 2020 2074 6872 6573 686f           thresho
-0000d5c0: 6c64 3d74 6872 6573 686f 6c64 2c0d 0a20  ld=threshold,.. 
-0000d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5f0: 2020 2020 2020 636f 756e 745f 7468 7265        count_thre
-0000d600: 7368 6f6c 645f 6173 5f65 7863 6565 6461  shold_as_exceeda
-0000d610: 6e63 653d 636f 756e 745f 7468 7265 7368  nce=count_thresh
-0000d620: 6f6c 645f 6173 5f65 7863 6565 6461 6e63  old_as_exceedanc
-0000d630: 6529 0d0a 2020 2020 0d0a 2020 2020 2320  e)..    ..    # 
-0000d640: 4966 2074 6865 7265 2061 7265 206e 6f20  If there are no 
-0000d650: 6772 6f75 7062 792d 636f 6c75 6d6e 732c  groupby-columns,
-0000d660: 2074 6865 6e20 6361 6c63 756c 6174 6520   then calculate 
-0000d670: 7065 7263 656e 7420 6578 6365 6564 616e  percent exceedan
-0000d680: 6365 7320 6f66 2061 6c6c 2072 6573 756c  ces of all resul
-0000d690: 7473 0d0a 2020 2020 6966 206e 6f74 2067  ts..    if not g
-0000d6a0: 726f 7570 6279 5f63 6f6c 733a 0d0a 2020  roupby_cols:..  
-0000d6b0: 2020 2020 2020 6466 203d 2064 662e 6167        df = df.ag
-0000d6c0: 6728 2a2a 7b0d 0a20 2020 2020 2020 2020  g(**{..         
-0000d6d0: 2020 2020 2020 2065 7863 6565 6461 6e63         exceedanc
-0000d6e0: 6573 5f63 6f6c 3a20 2827 5f5f 4578 6365  es_col: ('__Exce
-0000d6f0: 6564 616e 6365 5f5f 272c 2773 756d 2729  edance__','sum')
-0000d700: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000d710: 2020 2027 5f5f 4465 7465 726d 696e 6564     '__Determined
-0000d720: 4578 6365 6564 616e 6365 735f 5f27 3a20  Exceedances__': 
-0000d730: 2827 5f5f 4578 6365 6564 616e 6365 5f5f  ('__Exceedance__
-0000d740: 272c 2763 6f75 6e74 2729 2c0d 0a20 2020  ','count'),..   
-0000d750: 2020 2020 2020 2020 2020 2020 2027 5f5f               '__
-0000d760: 546f 7461 6c43 6f75 6e74 5f5f 273a 2028  TotalCount__': (
-0000d770: 275f 5f45 7863 6565 6461 6e63 655f 5f27  '__Exceedance__'
-0000d780: 2c27 7369 7a65 2729 0d0a 2020 2020 2020  ,'size')..      
-0000d790: 2020 2020 2020 2020 2020 7d29 2e74 7261            }).tra
-0000d7a0: 6e73 706f 7365 2829 2e72 6573 6574 5f69  nspose().reset_i
-0000d7b0: 6e64 6578 2864 726f 703d 5472 7565 290d  ndex(drop=True).
-0000d7c0: 0a20 2020 2023 2049 6620 7468 6520 6772  .    # If the gr
-0000d7d0: 6f75 7062 795f 636f 6c73 2069 7320 6120  oupby_cols is a 
-0000d7e0: 6c69 7374 206f 6620 6c69 7374 732c 2074  list of lists, t
-0000d7f0: 6865 6e20 6173 7365 7373 206d 6178 696d  hen assess maxim
-0000d800: 756d 7320 666f 7220 6669 7273 7420 6772  ums for first gr
-0000d810: 6f75 7069 6e67 0d0a 2020 2020 2320 616e  ouping..    # an
-0000d820: 6420 7065 7263 656e 7461 6765 206f 6620  d percentage of 
-0000d830: 6578 6365 6564 616e 6365 7320 666f 7220  exceedances for 
-0000d840: 7468 6520 7365 636f 6e64 2067 726f 7570  the second group
-0000d850: 696e 670d 0a20 2020 2065 6c69 6620 2869  ing..    elif (i
-0000d860: 7369 6e73 7461 6e63 6528 6772 6f75 7062  sinstance(groupb
-0000d870: 795f 636f 6c73 5b30 5d2c 6c69 7374 2929  y_cols[0],list))
-0000d880: 2026 2028 6c65 6e28 6772 6f75 7062 795f   & (len(groupby_
-0000d890: 636f 6c73 2920 213d 2032 293a 0d0a 2020  cols) != 2):..  
-0000d8a0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000d8b0: 6545 7272 6f72 2827 5477 6f20 6c69 7374  eError('Two list
-0000d8c0: 7320 6d75 7374 2062 6520 696e 636c 7564  s must be includ
-0000d8d0: 6564 2066 6f72 2067 726f 7570 6279 5f63  ed for groupby_c
-0000d8e0: 6f6c 7320 7468 6174 2069 7320 6120 6c69  ols that is a li
-0000d8f0: 7374 206f 6620 6c69 7374 732e 2729 0d0a  st of lists.')..
-0000d900: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-0000d910: 6e63 6528 6772 6f75 7062 795f 636f 6c73  nce(groupby_cols
-0000d920: 5b30 5d2c 6c69 7374 293a 0d0a 2020 2020  [0],list):..    
-0000d930: 2020 2020 2320 5573 6520 6d61 7869 6d75      # Use maximu
-0000d940: 6d20 7769 7468 696e 2065 6163 6820 6772  m within each gr
-0000d950: 6f75 7020 666f 7220 6669 7273 7420 6772  oup for first gr
-0000d960: 6f75 7069 6e67 0d0a 2020 2020 2020 2020  ouping..        
-0000d970: 6466 203d 2064 662e 6772 6f75 7062 7928  df = df.groupby(
-0000d980: 6772 6f75 7062 795f 636f 6c73 5b30 5d29  groupby_cols[0])
-0000d990: 5b27 5f5f 4578 6365 6564 616e 6365 5f5f  ['__Exceedance__
-0000d9a0: 275d 2e6d 6178 2829 2e72 6573 6574 5f69  '].max().reset_i
-0000d9b0: 6e64 6578 2829 0d0a 2020 2020 2020 2020  ndex()..        
-0000d9c0: 2320 5573 6520 7365 636f 6e64 2067 726f  # Use second gro
-0000d9d0: 7570 696e 6720 666f 7220 7065 7263 656e  uping for percen
-0000d9e0: 7461 6765 206f 6620 6578 6365 6564 616e  tage of exceedan
-0000d9f0: 6365 730d 0a20 2020 2020 2020 2064 6620  ces..        df 
-0000da00: 3d20 6466 2e67 726f 7570 6279 2867 726f  = df.groupby(gro
-0000da10: 7570 6279 5f63 6f6c 735b 315d 292e 6167  upby_cols[1]).ag
-0000da20: 6728 2a2a 7b0d 0a20 2020 2020 2020 2020  g(**{..         
-0000da30: 2020 2020 2020 2065 7863 6565 6461 6e63         exceedanc
-0000da40: 6573 5f63 6f6c 3a20 2827 5f5f 4578 6365  es_col: ('__Exce
-0000da50: 6564 616e 6365 5f5f 272c 2773 756d 2729  edance__','sum')
-0000da60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000da70: 2020 2027 5f5f 4465 7465 726d 696e 6564     '__Determined
-0000da80: 4578 6365 6564 616e 6365 735f 5f27 3a20  Exceedances__': 
-0000da90: 2827 5f5f 4578 6365 6564 616e 6365 5f5f  ('__Exceedance__
-0000daa0: 272c 2763 6f75 6e74 2729 2c0d 0a20 2020  ','count'),..   
-0000dab0: 2020 2020 2020 2020 2020 2020 2027 5f5f               '__
-0000dac0: 546f 7461 6c43 6f75 6e74 5f5f 273a 2028  TotalCount__': (
-0000dad0: 275f 5f45 7863 6565 6461 6e63 655f 5f27  '__Exceedance__'
-0000dae0: 2c27 7369 7a65 2729 0d0a 2020 2020 2020  ,'size')..      
-0000daf0: 2020 2020 2020 2020 2020 7d29 0d0a 2020            })..  
-0000db00: 2020 2320 456c 7365 2074 6865 2067 726f    # Else the gro
-0000db10: 7570 6279 5f63 6f6c 7320 6973 2061 206c  upby_cols is a l
-0000db20: 6973 7420 6f66 2063 6f6c 756d 6e20 6e61  ist of column na
-0000db30: 6d65 730d 0a20 2020 2065 6c73 653a 0d0a  mes..    else:..
-0000db40: 2020 2020 2020 2020 6466 203d 2064 662e          df = df.
-0000db50: 6772 6f75 7062 7928 6772 6f75 7062 795f  groupby(groupby_
-0000db60: 636f 6c73 292e 6167 6728 2a2a 7b0d 0a20  cols).agg(**{.. 
-0000db70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000db80: 7863 6565 6461 6e63 6573 5f63 6f6c 3a20  xceedances_col: 
-0000db90: 2827 5f5f 4578 6365 6564 616e 6365 5f5f  ('__Exceedance__
-0000dba0: 272c 2773 756d 2729 2c0d 0a20 2020 2020  ','sum'),..     
-0000dbb0: 2020 2020 2020 2020 2020 2027 5f5f 4465             '__De
-0000dbc0: 7465 726d 696e 6564 4578 6365 6564 616e  terminedExceedan
-0000dbd0: 6365 735f 5f27 3a20 2827 5f5f 4578 6365  ces__': ('__Exce
-0000dbe0: 6564 616e 6365 5f5f 272c 2763 6f75 6e74  edance__','count
-0000dbf0: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
-0000dc00: 2020 2020 2027 5f5f 546f 7461 6c43 6f75       '__TotalCou
-0000dc10: 6e74 5f5f 273a 2028 275f 5f45 7863 6565  nt__': ('__Excee
-0000dc20: 6461 6e63 655f 5f27 2c27 7369 7a65 2729  dance__','size')
-0000dc30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dc40: 2020 7d29 0d0a 2020 2020 0d0a 2020 2020    })..    ..    
-0000dc50: 2320 4465 7465 726d 696e 6520 636f 756e  # Determine coun
-0000dc60: 7473 2061 6e64 2063 616c 6375 6c61 7465  ts and calculate
-0000dc70: 2070 6572 6365 6e74 6167 650d 0a20 2020   percentage..   
-0000dc80: 2064 665b 6e6f 6e5f 6578 6365 6564 616e   df[non_exceedan
-0000dc90: 6365 735f 636f 6c5d 203d 2064 665b 275f  ces_col] = df['_
-0000dca0: 5f44 6574 6572 6d69 6e65 6445 7863 6565  _DeterminedExcee
-0000dcb0: 6461 6e63 6573 5f5f 275d 202d 2064 665b  dances__'] - df[
-0000dcc0: 6578 6365 6564 616e 6365 735f 636f 6c5d  exceedances_col]
-0000dcd0: 0d0a 2020 2020 6466 5b69 676e 6f72 6564  ..    df[ignored
-0000dce0: 5f63 6f6c 5d20 3d20 6466 5b27 5f5f 546f  _col] = df['__To
-0000dcf0: 7461 6c43 6f75 6e74 5f5f 275d 2d64 665b  talCount__']-df[
-0000dd00: 275f 5f44 6574 6572 6d69 6e65 6445 7863  '__DeterminedExc
-0000dd10: 6565 6461 6e63 6573 5f5f 275d 0d0a 2020  eedances__']..  
-0000dd20: 2020 6466 5b70 6572 6365 6e74 5f65 7863    df[percent_exc
-0000dd30: 6565 6461 6e63 6573 5f63 6f6c 5d20 3d20  eedances_col] = 
-0000dd40: 6466 5b65 7863 6565 6461 6e63 6573 5f63  df[exceedances_c
-0000dd50: 6f6c 5d20 2f20 6466 5b27 5f5f 4465 7465  ol] / df['__Dete
-0000dd60: 726d 696e 6564 4578 6365 6564 616e 6365  rminedExceedance
-0000dd70: 735f 5f27 5d20 2a20 3130 300d 0a20 2020  s__'] * 100..   
-0000dd80: 200d 0a20 2020 2023 2044 726f 7020 776f   ..    # Drop wo
-0000dd90: 726b 696e 6720 636f 6c75 6d6e 730d 0a20  rking columns.. 
-0000dda0: 2020 2064 6620 3d20 6466 2e64 726f 7028     df = df.drop(
-0000ddb0: 6466 2e66 696c 7465 7228 7265 6765 783d  df.filter(regex=
-0000ddc0: 275f 5f27 292e 636f 6c75 6d6e 732c 2061  '__').columns, a
-0000ddd0: 7869 733d 3129 0d0a 2020 2020 0d0a 2020  xis=1)..    ..  
-0000dde0: 2020 2320 5265 6f72 6465 7220 636f 6c75    # Reorder colu
-0000ddf0: 6d6e 730d 0a20 2020 2066 6f72 2063 6f6c  mns..    for col
-0000de00: 2069 6e20 5b70 6572 6365 6e74 5f65 7863   in [percent_exc
-0000de10: 6565 6461 6e63 6573 5f63 6f6c 2c65 7863  eedances_col,exc
-0000de20: 6565 6461 6e63 6573 5f63 6f6c 2c6e 6f6e  eedances_col,non
-0000de30: 5f65 7863 6565 6461 6e63 6573 5f63 6f6c  _exceedances_col
-0000de40: 2c69 676e 6f72 6564 5f63 6f6c 5d3a 0d0a  ,ignored_col]:..
-0000de50: 2020 2020 2020 2020 6466 5b63 6f6c 5d20          df[col] 
-0000de60: 3d20 6466 2e70 6f70 2863 6f6c 290d 0a20  = df.pop(col).. 
-0000de70: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
-0000de80: 6466 0d0a 0d0a 2325 2520 4164 6469 7469  df....#%% Additi
-0000de90: 6f6e 0d0a 0d0a 6465 6620 6164 645f 696e  on....def add_in
-0000dea0: 7465 7276 616c 7328 6466 2c0d 0a20 2020  tervals(df,..   
-0000deb0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000dec0: 726f 7570 6279 5f63 6f6c 7329 3a0d 0a20  roupby_cols):.. 
-0000ded0: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
-0000dee0: 6e63 7469 6f6e 2074 6861 7420 6164 6473  nction that adds
-0000def0: 2074 6865 2069 6e74 6572 7661 6c20 6e6f   the interval no
-0000df00: 7461 7469 6f6e 2066 6f72 6d20 6f66 2072  tation form of r
-0000df10: 6573 756c 7473 2072 6574 7572 6e65 640d  esults returned.
-0000df20: 0a20 2020 2066 726f 6d20 636f 6d70 6f6e  .    from compon
-0000df30: 656e 7473 5f74 6f5f 696e 7465 7276 616c  ents_to_interval
-0000df40: 2074 6f20 6765 6e65 7261 7465 2061 206e   to generate a n
-0000df50: 6577 2069 6e74 6572 7661 6c20 666f 7220  ew interval for 
-0000df60: 7468 6520 7375 6d2e 2047 726f 7570 730d  the sum. Groups.
-0000df70: 0a20 2020 206f 6620 7265 7375 6c74 7320  .    of results 
-0000df80: 6361 6e20 6265 2064 6566 696e 6564 2062  can be defined b
-0000df90: 7920 696e 636c 7564 696e 6720 7468 6520  y including the 
-0000dfa0: 636f 6c75 6d6e 7320 7468 6174 2073 686f  columns that sho
-0000dfb0: 756c 6420 6265 2075 7365 6420 746f 0d0a  uld be used to..
-0000dfc0: 2020 2020 6372 6561 7465 2067 726f 7570      create group
-0000dfd0: 732e 0d0a 0d0a 2020 2020 5061 7261 6d65  s.....    Parame
-0000dfe0: 7465 7273 0d0a 2020 2020 2d2d 2d2d 2d2d  ters..    ------
-0000dff0: 2d2d 2d2d 0d0a 2020 2020 6466 203a 2044  ----..    df : D
-0000e000: 6174 6146 7261 6d65 0d0a 2020 2020 2020  ataFrame..      
-0000e010: 2020 4461 7461 4672 616d 6520 7468 6174    DataFrame that
-0000e020: 2063 6f6e 7461 696e 7320 7265 7375 6c74   contains result
-0000e030: 7320 696e 2061 2073 7065 6369 6669 6320  s in a specific 
-0000e040: 696e 7465 7276 616c 206e 6f74 6174 696f  interval notatio
-0000e050: 6e2e 0d0a 2020 2020 6772 6f75 7062 795f  n...    groupby_
-0000e060: 636f 6c73 203a 206c 6973 7420 6f66 2073  cols : list of s
-0000e070: 7472 696e 6773 0d0a 2020 2020 2020 2020  trings..        
-0000e080: 4c69 7374 206f 6620 636f 6c75 6d6e 206e  List of column n
-0000e090: 616d 6573 2074 6861 7420 7368 6f75 6c64  ames that should
-0000e0a0: 2062 6520 7573 6564 2074 6f20 6372 6561   be used to crea
-0000e0b0: 7465 2067 726f 7570 732e 0d0a 0d0a 2020  te groups.....  
-0000e0c0: 2020 5265 7475 726e 730d 0a20 2020 202d    Returns..    -
-0000e0d0: 2d2d 2d2d 2d2d 0d0a 2020 2020 6466 203a  ------..    df :
-0000e0e0: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-0000e0f0: 2020 2020 4461 7461 4672 616d 6520 7468      DataFrame th
-0000e100: 6174 2068 6173 2074 6865 2069 6e74 6572  at has the inter
-0000e110: 7661 6c20 666f 7220 7468 6520 7375 6d20  val for the sum 
-0000e120: 2866 6f72 2065 6163 6820 6772 6f75 7020  (for each group 
-0000e130: 6966 0d0a 2020 2020 2020 2020 636f 6c75  if..        colu
-0000e140: 6d6e 206e 616d 6573 2061 7265 2070 726f  mn names are pro
-0000e150: 7669 6465 6420 666f 7220 6772 6f75 7069  vided for groupi
-0000e160: 6e67 290d 0a0d 0a20 2020 2027 2727 0d0a  ng)....    '''..
-0000e170: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
-0000e180: 7465 2061 2063 6f70 7920 6f66 2074 6865  te a copy of the
-0000e190: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-0000e1a0: 6466 203d 2064 662e 636f 7079 2829 0d0a  df = df.copy()..
-0000e1b0: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
-0000e1c0: 7465 2063 6f6c 756d 6e20 7468 6174 2069  te column that i
-0000e1d0: 6e64 6963 6174 6573 2074 6865 2067 656e  ndicates the gen
-0000e1e0: 6572 6174 6564 2073 7461 7469 7374 6963  erated statistic
-0000e1f0: 2061 6e64 2061 7070 656e 6420 746f 2067   and append to g
-0000e200: 726f 7570 696e 6720 6c69 7374 0d0a 2020  rouping list..  
-0000e210: 2020 6466 5b73 7461 745f 636f 6c5d 203d    df[stat_col] =
-0000e220: 2027 5375 6d27 0d0a 2020 2020 6772 6f75   'Sum'..    grou
-0000e230: 7062 795f 636f 6c73 2e61 7070 656e 6428  pby_cols.append(
-0000e240: 7374 6174 5f63 6f6c 290d 0a20 2020 200d  stat_col)..    .
-0000e250: 0a20 2020 2023 2043 6861 6e67 6520 6e6f  .    # Change no
-0000e260: 7461 7469 6f6e 206f 6620 2743 6c6f 7365  tation of 'Close
-0000e270: 6427 2061 6e64 2027 4f70 656e 2720 626f  d' and 'Open' bo
-0000e280: 756e 6461 7269 6573 2074 6f20 3020 616e  undaries to 0 an
-0000e290: 6420 312c 2072 6573 7065 6374 6976 656c  d 1, respectivel
-0000e2a0: 790d 0a20 2020 2023 2054 6865 2070 7265  y..    # The pre
-0000e2b0: 7365 6e63 6520 6f66 2061 6e79 206f 7065  sence of any ope
-0000e2c0: 6e20 626f 756e 6461 7269 6573 206f 6e20  n boundaries on 
-0000e2d0: 6f6e 6520 7369 6465 2065 6e73 7572 6520  one side ensure 
-0000e2e0: 7468 6174 2074 6865 2069 6e74 6572 7661  that the interva
-0000e2f0: 6c20 666f 7220 7468 6520 7375 6d20 6973  l for the sum is
-0000e300: 2061 6c73 6f0d 0a20 2020 2023 206f 7065   also..    # ope
-0000e310: 6e20 6f6e 2074 6861 7420 7369 6465 0d0a  n on that side..
-0000e320: 2020 2020 6466 5b5b 6c65 6674 5f62 6f75      df[[left_bou
-0000e330: 6e64 6172 795f 636f 6c2c 7269 6768 745f  ndary_col,right_
-0000e340: 626f 756e 6461 7279 5f63 6f6c 5d5d 203d  boundary_col]] =
-0000e350: 2064 665b 5b6c 6566 745f 626f 756e 6461   df[[left_bounda
-0000e360: 7279 5f63 6f6c 2c72 6967 6874 5f62 6f75  ry_col,right_bou
-0000e370: 6e64 6172 795f 636f 6c5d 5d2e 7265 706c  ndary_col]].repl
-0000e380: 6163 6528 5b27 436c 6f73 6564 272c 274f  ace(['Closed','O
-0000e390: 7065 6e27 5d2c 205b 302c 315d 290d 0a20  pen'], [0,1]).. 
-0000e3a0: 2020 200d 0a20 2020 2023 2047 6574 2074     ..    # Get t
-0000e3b0: 6865 206c 6566 742f 7269 6768 7420 626f  he left/right bo
-0000e3c0: 756e 6473 206f 6620 7468 6520 7375 6d20  unds of the sum 
-0000e3d0: 6279 2061 6464 696e 6720 626f 756e 6473  by adding bounds
-0000e3e0: 2077 6974 6869 6e20 7468 6520 6772 6f75   within the grou
-0000e3f0: 700d 0a20 2020 2023 2044 6574 6572 6d69  p..    # Determi
-0000e400: 6e65 2077 6865 7468 6572 2061 6e79 204f  ne whether any O
-0000e410: 7065 6e20 286e 6f77 2076 616c 7565 206f  pen (now value o
-0000e420: 6620 3129 2062 6f75 6e64 6172 6965 7320  f 1) boundaries 
-0000e430: 6578 6973 742e 2049 6620 7468 6572 6520  exist. If there 
-0000e440: 6172 650d 0a20 2020 2023 2061 6e79 206f  are..    # any o
-0000e450: 7065 6e20 626f 756e 6461 7269 6573 2075  pen boundaries u
-0000e460: 7365 6420 696e 2074 6865 2073 756d 2c20  sed in the sum, 
-0000e470: 7468 656e 2074 6865 2072 6573 756c 7469  then the resulti
-0000e480: 6e67 2073 756d 2077 696c 6c20 6265 206f  ng sum will be o
-0000e490: 7065 6e0d 0a20 2020 2064 6620 3d20 6466  pen..    df = df
-0000e4a0: 2e67 726f 7570 6279 2867 726f 7570 6279  .groupby(groupby
-0000e4b0: 5f63 6f6c 7329 2e61 6767 282a 2a7b 0d0a  _cols).agg(**{..
-0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4d0: 2020 2020 2020 2020 2020 2020 6c65 6674              left
-0000e4e0: 5f62 6f75 6e64 6172 795f 636f 6c3a 2028  _boundary_col: (
-0000e4f0: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
-0000e500: 6c2c 2027 6d61 7827 292c 0d0a 2020 2020  l, 'max'),..    
-0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e520: 2020 2020 2020 2020 275f 5f4d 696e 696d          '__Minim
-0000e530: 756d 5f5f 273a 2028 6c65 6674 5f62 6f75  um__': (left_bou
-0000e540: 6e64 5f63 6f6c 2c27 6d69 6e27 292c 0d0a  nd_col,'min'),..
-0000e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e560: 2020 2020 2020 2020 2020 2020 6c65 6674              left
-0000e570: 5f62 6f75 6e64 5f63 6f6c 3a20 286c 6566  _bound_col: (lef
-0000e580: 745f 626f 756e 645f 636f 6c2c 2773 756d  t_bound_col,'sum
-0000e590: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
-0000e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5b0: 2072 6967 6874 5f62 6f75 6e64 5f63 6f6c   right_bound_col
-0000e5c0: 3a20 2872 6967 6874 5f62 6f75 6e64 5f63  : (right_bound_c
-0000e5d0: 6f6c 2c27 7375 6d27 292c 0d0a 2020 2020  ol,'sum'),..    
-0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5f0: 2020 2020 2020 2020 275f 5f4d 6178 696d          '__Maxim
-0000e600: 756d 5f5f 273a 2028 7269 6768 745f 626f  um__': (right_bo
-0000e610: 756e 645f 636f 6c2c 276d 6178 2729 2c0d  und_col,'max'),.
-0000e620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e630: 2020 2020 2020 2020 2020 2020 2072 6967               rig
-0000e640: 6874 5f62 6f75 6e64 6172 795f 636f 6c3a  ht_boundary_col:
-0000e650: 2028 7269 6768 745f 626f 756e 6461 7279   (right_boundary
-0000e660: 5f63 6f6c 2c27 6d61 7827 290d 0a20 2020  _col,'max')..   
-0000e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e680: 2020 2020 2020 2020 207d 290d 0a20 2020           })..   
-0000e690: 200d 0a20 2020 2023 2052 6570 6c61 6365   ..    # Replace
-0000e6a0: 2069 6e74 6567 6572 7320 7769 7468 2074   integers with t
-0000e6b0: 6578 7420 666f 7220 626f 756e 6461 7269  ext for boundari
-0000e6c0: 6573 0d0a 2020 2020 6466 5b5b 6c65 6674  es..    df[[left
-0000e6d0: 5f62 6f75 6e64 6172 795f 636f 6c2c 7269  _boundary_col,ri
-0000e6e0: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
-0000e6f0: 5d5d 203d 2064 665b 5b6c 6566 745f 626f  ]] = df[[left_bo
-0000e700: 756e 6461 7279 5f63 6f6c 2c72 6967 6874  undary_col,right
-0000e710: 5f62 6f75 6e64 6172 795f 636f 6c5d 5d2e  _boundary_col]].
-0000e720: 7265 706c 6163 6528 5b30 2c31 5d2c 205b  replace([0,1], [
-0000e730: 2743 6c6f 7365 6427 2c27 4f70 656e 275d  'Closed','Open']
-0000e740: 290d 0a20 2020 200d 0a20 2020 2023 2053  )..    ..    # S
-0000e750: 756d 7320 7769 7468 2069 6e66 696e 6974  ums with infinit
-0000e760: 6520 7661 6c75 6573 2070 726f 6475 6365  e values produce
-0000e770: 206e 616e 2076 616c 7565 7320 7261 7468   nan values rath
-0000e780: 6572 2074 6861 6e20 6e70 2e69 6e66 2076  er than np.inf v
-0000e790: 616c 7565 730d 0a20 2020 2023 2043 6f6e  alues..    # Con
-0000e7a0: 7665 7274 206e 616e 2074 6f20 696e 6620  vert nan to inf 
-0000e7b0: 6f6e 6c79 2069 6620 696e 6669 6e69 7465  only if infinite
-0000e7c0: 2076 616c 7565 7320 6172 6520 696e 636c   values are incl
-0000e7d0: 7564 6564 2069 6e20 7468 6520 7375 6d0d  uded in the sum.
-0000e7e0: 0a20 2020 2064 665b 6c65 6674 5f62 6f75  .    df[left_bou
-0000e7f0: 6e64 5f63 6f6c 5d20 3d20 6e70 2e77 6865  nd_col] = np.whe
-0000e800: 7265 2864 665b 275f 5f4d 696e 696d 756d  re(df['__Minimum
-0000e810: 5f5f 275d 203d 3d20 2d6e 702e 696e 662c  __'] == -np.inf,
-0000e820: 202d 6e70 2e69 6e66 2c20 6466 5b6c 6566   -np.inf, df[lef
-0000e830: 745f 626f 756e 645f 636f 6c5d 290d 0a20  t_bound_col]).. 
-0000e840: 2020 2064 665b 7269 6768 745f 626f 756e     df[right_boun
-0000e850: 645f 636f 6c5d 203d 206e 702e 7768 6572  d_col] = np.wher
-0000e860: 6528 6466 5b27 5f5f 4d61 7869 6d75 6d5f  e(df['__Maximum_
-0000e870: 5f27 5d20 3d3d 206e 702e 696e 662c 206e  _'] == np.inf, n
-0000e880: 702e 696e 662c 2064 665b 7269 6768 745f  p.inf, df[right_
-0000e890: 626f 756e 645f 636f 6c5d 290d 0a20 2020  bound_col])..   
-0000e8a0: 200d 0a20 2020 2023 2052 6573 6574 2069   ..    # Reset i
-0000e8b0: 6e64 6578 0d0a 2020 2020 6466 203d 2064  ndex..    df = d
-0000e8c0: 662e 7265 7365 745f 696e 6465 7828 290d  f.reset_index().
-0000e8d0: 0a20 2020 200d 0a20 2020 2072 6574 7572  .    ..    retur
-0000e8e0: 6e20 6466 0d0a 0d0a 6465 6620 6164 6469  n df....def addi
-0000e8f0: 7469 6f6e 2864 662c 0d0a 2020 2020 2020  tion(df,..      
-0000e900: 2020 2020 2020 2072 6573 756c 745f 636f         result_co
-0000e910: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-0000e920: 2067 726f 7570 6279 5f63 6f6c 7320 3d20   groupby_cols = 
-0000e930: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-0000e940: 2020 2020 666f 6375 735f 6869 6768 5f70      focus_high_p
-0000e950: 6f74 656e 7469 616c 203d 2054 7275 652c  otential = True,
-0000e960: 0d0a 2020 2020 2020 2020 2020 2020 2069  ..             i
-0000e970: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
-0000e980: 696e 7465 7276 616c 203d 2046 616c 7365  interval = False
-0000e990: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000e9a0: 7072 6563 6973 696f 6e5f 746f 6c65 7261  precision_tolera
-0000e9b0: 6e63 655f 746f 5f64 726f 705f 6365 6e73  nce_to_drop_cens
-0000e9c0: 6f72 203d 2030 2e32 352c 0d0a 2020 2020  or = 0.25,..    
-0000e9d0: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
-0000e9e0: 6f6e 5f72 6f75 6e64 696e 6720 3d20 5472  on_rounding = Tr
-0000e9f0: 7565 293a 0d0a 2020 2020 2727 270d 0a20  ue):..    '''.. 
-0000ea00: 2020 2041 2066 756e 6374 696f 6e20 7468     A function th
-0000ea10: 6174 2063 6f6d 6269 6e65 7320 7468 6520  at combines the 
-0000ea20: 7265 6c65 7661 6e74 2061 6464 6974 696f  relevant additio
-0000ea30: 6e20 616e 6420 7574 696c 6974 7920 6675  n and utility fu
-0000ea40: 6e63 7469 6f6e 7320 746f 0d0a 2020 2020  nctions to..    
-0000ea50: 7375 6d20 7265 7375 6c74 7320 666f 7220  sum results for 
-0000ea60: 6772 6f75 7073 2077 6974 6869 6e20 6120  groups within a 
-0000ea70: 4461 7461 4672 616d 652e 0d0a 0d0a 2020  DataFrame.....  
-0000ea80: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-0000ea90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-0000eaa0: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
-0000eab0: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
-0000eac0: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
-0000ead0: 7320 6365 6e73 6f72 6564 206f 7220 756e  s censored or un
-0000eae0: 6365 6e73 6f72 6564 2072 6573 756c 7473  censored results
-0000eaf0: 0d0a 2020 2020 7265 7375 6c74 5f63 6f6c  ..    result_col
-0000eb00: 203a 2073 7472 696e 670d 0a20 2020 2020   : string..     
-0000eb10: 2020 2054 6865 2063 6f6c 756d 6e20 6e61     The column na
-0000eb20: 6d65 2066 6f72 2074 6865 2063 6f6c 756d  me for the colum
-0000eb30: 6e20 7468 6174 2063 6f6e 7461 696e 2074  n that contain t
-0000eb40: 6865 2072 6573 756c 7473 2061 7320 7465  he results as te
-0000eb50: 7874 2e0d 0a20 2020 2020 2020 204f 6e6c  xt...        Onl
-0000eb60: 7920 666f 7572 2070 6f73 7369 626c 6520  y four possible 
-0000eb70: 6365 6e73 6f72 7320 7368 6f75 6c64 2062  censors should b
-0000eb80: 6520 7573 6564 2028 3c2c e289 a42c e289  e used (<,...,..
-0000eb90: a52c 3e29 2e0d 0a20 2020 2067 726f 7570  .,>)...    group
-0000eba0: 6279 5f63 6f6c 7320 3a20 6c69 7374 7320  by_cols : lists 
-0000ebb0: 6f66 2073 7472 696e 6773 2028 6f72 206c  of strings (or l
-0000ebc0: 6973 7420 6f66 206c 6973 7473 292c 206f  ist of lists), o
-0000ebd0: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
-0000ebe0: 204c 6973 7420 6f66 2063 6f6c 756d 6e20   List of column 
-0000ebf0: 6e61 6d65 7320 7468 6174 2073 686f 756c  names that shoul
-0000ec00: 6420 6265 2075 7365 6420 746f 2063 7265  d be used to cre
-0000ec10: 6174 6520 6772 6f75 7073 2e20 416e 2061  ate groups. An a
-0000ec20: 7665 7261 6765 0d0a 2020 2020 2020 2020  verage..        
-0000ec30: 7769 6c6c 2062 6520 666f 756e 6420 7769  will be found wi
-0000ec40: 7468 696e 2065 6163 6820 6772 6f75 702e  thin each group.
-0000ec50: 204d 756c 7469 706c 6520 6c69 7374 7320   Multiple lists 
-0000ec60: 6361 6e20 6265 2073 7570 706c 6965 6420  can be supplied 
-0000ec70: 746f 0d0a 2020 2020 2020 2020 7065 7266  to..        perf
-0000ec80: 6f72 6d20 7365 7175 656e 7469 616c 2061  orm sequential a
-0000ec90: 7665 7261 6769 6e67 2062 6566 6f72 6520  veraging before 
-0000eca0: 636f 6e76 6572 7469 6e67 2069 6e74 6572  converting inter
-0000ecb0: 7661 6c73 2074 6f20 6120 7265 7375 6c74  vals to a result
-0000ecc0: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
-0000ecd0: 6566 6175 6c74 2069 7320 4e6f 6e65 2e0d  efault is None..
-0000ece0: 0a20 2020 2066 6f63 7573 5f68 6967 685f  .    focus_high_
-0000ecf0: 706f 7465 6e74 6961 6c20 3a20 626f 6f6c  potential : bool
-0000ed00: 6561 6e2c 206f 7074 696f 6e61 6c0d 0a20  ean, optional.. 
-0000ed10: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-0000ed20: 7468 656e 2069 6e66 6f72 6d61 7469 6f6e  then information
-0000ed30: 206f 6e20 7468 6520 6869 6768 6573 7420   on the highest 
-0000ed40: 706f 7465 6e74 6961 6c20 7265 7375 6c74  potential result
-0000ed50: 2077 696c 6c20 6265 0d0a 2020 2020 2020   will be..      
-0000ed60: 2020 666f 6375 7365 6420 6f76 6572 2074    focused over t
-0000ed70: 6865 206c 6f77 6573 7420 706f 7465 6e74  he lowest potent
-0000ed80: 6961 6c20 7265 7375 6c74 2e0d 0a20 2020  ial result...   
-0000ed90: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
-0000eda0: 655f 696e 7465 7276 616c 203a 2062 6f6f  e_interval : boo
-0000edb0: 6c65 616e 2c20 6f70 7469 6f6e 616c 0d0a  lean, optional..
-0000edc0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-0000edd0: 2074 6865 6e20 616c 6c20 706f 7369 7469   then all positi
-0000ede0: 7665 2061 6e64 206e 6567 6174 6976 6520  ve and negative 
-0000edf0: 7661 6c75 6573 2061 7265 2063 6f6e 7369  values are consi
-0000ee00: 6465 7265 640d 0a20 2020 2020 2020 2065  dered..        e
-0000ee10: 2e67 2e2c 203c 302e 3520 776f 756c 6420  .g., <0.5 would 
-0000ee20: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
-0000ee30: 282d 6e70 2e69 6e66 2c35 292e 0d0a 2020  (-np.inf,5)...  
-0000ee40: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-0000ee50: 7468 656e 206f 6e6c 7920 6e6f 6e2d 6e65  then only non-ne
-0000ee60: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
-0000ee70: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
-0000ee80: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
-0000ee90: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
-0000eea0: 7465 6420 746f 205b 302c 3529 2e0d 0a20  ted to [0,5)... 
-0000eeb0: 2020 2020 2020 2054 6869 7320 7365 7474         This sett
-0000eec0: 696e 6720 6f6e 6c79 2061 6666 6563 7473  ing only affects
-0000eed0: 2072 6573 756c 7473 2069 6620 666f 6375   results if focu
-0000eee0: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
-0000eef0: 2069 7320 4661 6c73 652e 0d0a 2020 2020   is False...    
-0000ef00: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-0000ef10: 6973 2046 616c 7365 2e0d 0a20 2020 2070  is False...    p
-0000ef20: 7265 6369 7369 6f6e 5f74 6f6c 6572 616e  recision_toleran
-0000ef30: 6365 5f74 6f5f 6472 6f70 5f63 656e 736f  ce_to_drop_censo
-0000ef40: 7220 3a20 666c 6f61 742c 206f 7074 696f  r : float, optio
-0000ef50: 6e61 6c0d 0a20 2020 2020 2020 2054 6872  nal..        Thr
-0000ef60: 6573 686f 6c64 2066 6f72 2072 6570 6f72  eshold for repor
-0000ef70: 7469 6e67 2063 656e 736f 7265 6420 7673  ting censored vs
-0000ef80: 206e 6f6e 2d63 656e 736f 7265 6420 7265   non-censored re
-0000ef90: 7375 6c74 732e 0d0a 2020 2020 2020 2020  sults...        
-0000efa0: 5573 696e 6720 7468 6520 6465 6661 756c  Using the defaul
-0000efb0: 742c 2061 2072 6573 756c 7420 7468 6174  t, a result that
-0000efc0: 2069 7320 6b6e 6f77 6e20 746f 2062 6520   is known to be 
-0000efd0: 696e 2074 6865 2069 6e74 6572 7661 6c20  in the interval 
-0000efe0: 2830 2e33 2c20 302e 3529 0d0a 2020 2020  (0.3, 0.5)..    
-0000eff0: 2020 2020 776f 756c 6420 6265 2072 6574      would be ret
-0000f000: 7572 6e65 6420 6173 2030 2e34 2c20 7768  urned as 0.4, wh
-0000f010: 6572 6561 7320 6120 746f 6c65 7261 6e63  ereas a toleranc
-0000f020: 6520 6f66 2030 2077 6f75 6c64 2079 6965  e of 0 would yie
-0000f030: 6c64 2061 0d0a 2020 2020 2020 2020 7265  ld a..        re
-0000f040: 7375 6c74 206f 6620 3c30 2e35 206f 7220  sult of <0.5 or 
-0000f050: 3e30 2e33 2064 6570 656e 6469 6e67 206f  >0.3 depending o
-0000f060: 6e20 7468 6520 7661 6c75 6520 6f66 2066  n the value of f
-0000f070: 6f63 7573 5f68 6967 6865 7374 5f70 6f74  ocus_highest_pot
-0000f080: 656e 7469 616c 2e0d 0a20 2020 2020 2020  ential...       
-0000f090: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
-0000f0a0: 302e 3235 2e0d 0a20 2020 2070 7265 6369  0.25...    preci
-0000f0b0: 7369 6f6e 5f72 6f75 6e64 696e 6720 3a20  sion_rounding : 
-0000f0c0: 626f 6f6c 6561 6e2c 206f 7074 696f 6e61  boolean, optiona
-0000f0d0: 6c0d 0a20 2020 2020 2020 2049 6620 5472  l..        If Tr
-0000f0e0: 7565 2c20 6120 726f 756e 6469 6e67 206d  ue, a rounding m
-0000f0f0: 6574 686f 6420 6973 2061 7070 6c69 6564  ethod is applied
-0000f100: 2074 6f20 726f 756e 6420 7265 7375 6c74   to round result
-0000f110: 7320 746f 2068 6176 6520 6e6f 206d 6f72  s to have no mor
-0000f120: 650d 0a20 2020 2020 2020 2064 6563 696d  e..        decim
-0000f130: 616c 7320 7468 616e 2077 6861 7420 6361  als than what ca
-0000f140: 6e20 6265 206d 6561 7375 7265 642e 0d0a  n be measured...
-0000f150: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
-0000f160: 756c 7420 6973 2054 7275 652e 0d0a 0d0a  ult is True.....
-0000f170: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-0000f180: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 6466   -------..    df
-0000f190: 203a 2044 6174 6146 7261 6d65 0d0a 2020   : DataFrame..  
-0000f1a0: 2020 2020 2020 4461 7461 4672 616d 6520        DataFrame 
-0000f1b0: 7468 6174 2063 6f6e 7461 696e 7320 6361  that contains ca
-0000f1c0: 6c63 756c 6174 6564 2061 7665 7261 6765  lculated average
-0000f1d0: 730d 0a0d 0a20 2020 2027 2727 0d0a 2020  s....    '''..  
-0000f1e0: 2020 0d0a 2020 2020 2320 4372 6561 7465    ..    # Create
-0000f1f0: 2061 2063 6f70 7920 6f66 2074 6865 2044   a copy of the D
-0000f200: 6174 6146 7261 6d65 0d0a 2020 2020 6466  ataFrame..    df
-0000f210: 203d 2064 662e 636f 7079 2829 0d0a 2020   = df.copy()..  
-0000f220: 2020 0d0a 2020 2020 2320 5370 6c69 7420    ..    # Split 
-0000f230: 7468 6520 7265 7375 6c74 2069 6e74 6f20  the result into 
-0000f240: 6365 6e73 6f72 2061 6e64 206e 756d 6572  censor and numer
-0000f250: 6963 2063 6f6d 706f 6e65 6e74 730d 0a20  ic components.. 
-0000f260: 2020 2064 6620 3d20 7265 7375 6c74 5f74     df = result_t
-0000f270: 6f5f 636f 6d70 6f6e 656e 7473 2864 662c  o_components(df,
-0000f280: 7265 7375 6c74 5f63 6f6c 290d 0a20 2020  result_col)..   
-0000f290: 200d 0a20 2020 2023 2043 6f6e 7665 7274   ..    # Convert
-0000f2a0: 2074 6865 2072 6573 756c 7473 2066 726f   the results fro
-0000f2b0: 6d20 6365 6e73 6f72 2061 6e64 206e 756d  m censor and num
-0000f2c0: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
-0000f2d0: 746f 2061 6e20 696e 7465 7276 616c 2072  to an interval r
-0000f2e0: 6570 7265 7365 6e74 6174 696f 6e0d 0a20  epresentation.. 
-0000f2f0: 2020 2064 6620 3d20 636f 6d70 6f6e 656e     df = componen
-0000f300: 7473 5f74 6f5f 696e 7465 7276 616c 2864  ts_to_interval(d
-0000f310: 662c 2069 6e63 6c75 6465 5f6e 6567 6174  f, include_negat
-0000f320: 6976 655f 696e 7465 7276 616c 290d 0a20  ive_interval).. 
-0000f330: 2020 200d 0a20 2020 2023 2055 7369 6e67     ..    # Using
-0000f340: 2074 6865 2069 6e74 6572 7661 6c73 2c20   the intervals, 
-0000f350: 6465 7465 726d 696e 6520 7468 6520 7261  determine the ra
-0000f360: 6e67 6520 6f66 2070 6f73 7369 626c 6520  nge of possible 
-0000f370: 6176 6572 6167 6573 0d0a 2020 2020 0d0a  averages..    ..
-0000f380: 2020 2020 2320 4966 2074 6865 7265 2061      # If there a
-0000f390: 7265 206e 6f20 6772 6f75 7062 792d 636f  re no groupby-co
-0000f3a0: 6c75 6d6e 732c 2074 6865 6e20 7461 6b65  lumns, then take
-0000f3b0: 2061 7665 7261 6765 206f 6620 616c 6c20   average of all 
-0000f3c0: 7265 7375 6c74 730d 0a20 2020 2069 6620  results..    if 
-0000f3d0: 6e6f 7420 6772 6f75 7062 795f 636f 6c73  not groupby_cols
-0000f3e0: 3a0d 0a20 2020 2020 2020 2064 6620 3d20  :..        df = 
-0000f3f0: 6164 645f 696e 7465 7276 616c 7328 6466  add_intervals(df
-0000f400: 2c20 6772 6f75 7062 795f 636f 6c73 3d5b  , groupby_cols=[
-0000f410: 5d29 0d0a 2020 2020 2320 4966 2074 6865  ])..    # If the
-0000f420: 2067 726f 7570 6279 5f63 6f6c 7320 6973   groupby_cols is
-0000f430: 2061 206c 6973 7420 6f66 206c 6973 7473   a list of lists
-0000f440: 2c20 7468 656e 2070 6572 666f 726d 206d  , then perform m
-0000f450: 756c 7469 706c 6520 6176 6572 6167 6573  ultiple averages
-0000f460: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
-0000f470: 7461 6e63 6528 6772 6f75 7062 795f 636f  tance(groupby_co
-0000f480: 6c73 5b30 5d2c 6c69 7374 293a 0d0a 2020  ls[0],list):..  
-0000f490: 2020 2020 2020 666f 7220 6772 6f75 7069        for groupi
-0000f4a0: 6e67 2069 6e20 6772 6f75 7062 795f 636f  ng in groupby_co
-0000f4b0: 6c73 3a0d 0a20 2020 2020 2020 2020 2020  ls:..           
-0000f4c0: 2023 2055 7369 6e67 2074 6865 2069 6e74   # Using the int
-0000f4d0: 6572 7661 6c73 2c20 6465 7465 726d 696e  ervals, determin
-0000f4e0: 6520 7468 6520 7261 6e67 6520 6f66 2070  e the range of p
-0000f4f0: 6f73 7369 626c 6520 6d61 7869 6d61 0d0a  ossible maxima..
-0000f500: 2020 2020 2020 2020 2020 2020 6466 203d              df =
-0000f510: 2061 6464 5f69 6e74 6572 7661 6c73 2864   add_intervals(d
-0000f520: 662c 2067 726f 7570 696e 6729 0d0a 2020  f, grouping)..  
-0000f530: 2020 2320 456c 7365 2074 6865 2067 726f    # Else the gro
-0000f540: 7570 6279 5f63 6f6c 7320 6973 2061 206c  upby_cols is a l
-0000f550: 6973 7420 6f66 2063 6f6c 756d 6e20 6e61  ist of column na
-0000f560: 6d65 730d 0a20 2020 2065 6c73 653a 0d0a  mes..    else:..
-0000f570: 2020 2020 2020 2020 6466 203d 2061 6464          df = add
-0000f580: 5f69 6e74 6572 7661 6c73 2864 662c 2067  _intervals(df, g
-0000f590: 726f 7570 6279 5f63 6f6c 7329 0d0a 2020  roupby_cols)..  
-0000f5a0: 2020 0d0a 2020 2020 2320 436f 6e76 6572    ..    # Conver
-0000f5b0: 7420 7468 6520 696e 7465 7276 616c 2066  t the interval f
-0000f5c0: 6f72 2074 6865 2061 7665 7261 6765 2069  or the average i
-0000f5d0: 6e74 6f20 6365 6e73 6f72 2061 6e64 206e  nto censor and n
-0000f5e0: 756d 6572 6963 206e 6f74 6174 696f 6e0d  umeric notation.
-0000f5f0: 0a20 2020 2064 6620 3d20 696e 7465 7276  .    df = interv
-0000f600: 616c 5f74 6f5f 636f 6d70 6f6e 656e 7473  al_to_components
-0000f610: 2864 662c 0d0a 2020 2020 2020 2020 2020  (df,..          
-0000f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f630: 2020 2020 2020 666f 6375 735f 6869 6768        focus_high
-0000f640: 5f70 6f74 656e 7469 616c 203d 2066 6f63  _potential = foc
-0000f650: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
-0000f660: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-0000f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f680: 2020 2020 696e 636c 7564 655f 6e65 6761      include_nega
-0000f690: 7469 7665 5f69 6e74 6572 7661 6c20 3d20  tive_interval = 
-0000f6a0: 696e 636c 7564 655f 6e65 6761 7469 7665  include_negative
-0000f6b0: 5f69 6e74 6572 7661 6c2c 0d0a 2020 2020  _interval,..    
-0000f6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6d0: 2020 2020 2020 2020 2020 2020 7072 6563              prec
-0000f6e0: 6973 696f 6e5f 746f 6c65 7261 6e63 655f  ision_tolerance_
-0000f6f0: 746f 5f64 726f 705f 6365 6e73 6f72 203d  to_drop_censor =
-0000f700: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
-0000f710: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
-0000f720: 736f 7229 0d0a 2020 2020 0d0a 2020 2020  sor)..    ..    
-0000f730: 2320 4372 6561 7465 2069 6e74 6572 7661  # Create interva
-0000f740: 6c20 6e6f 7461 7469 6f6e 2066 6f72 2074  l notation for t
-0000f750: 6865 2061 7665 7261 6765 0d0a 2020 2020  he average..    
-0000f760: 6466 203d 2069 6e74 6572 7661 6c5f 6e6f  df = interval_no
-0000f770: 7461 7469 6f6e 2864 662c 2070 7265 6369  tation(df, preci
-0000f780: 7369 6f6e 5f72 6f75 6e64 696e 6729 0d0a  sion_rounding)..
-0000f790: 2020 2020 0d0a 2020 2020 2320 436f 6d62      ..    # Comb
-0000f7a0: 696e 6520 7468 6520 6365 6e73 6f72 2061  ine the censor a
-0000f7b0: 6e64 206e 756d 6572 6963 2063 6f6d 706f  nd numeric compo
-0000f7c0: 6e65 6e74 7320 696e 746f 2061 2072 6573  nents into a res
-0000f7d0: 756c 740d 0a20 2020 2064 6620 3d20 636f  ult..    df = co
-0000f7e0: 6d70 6f6e 656e 7473 5f74 6f5f 7265 7375  mponents_to_resu
-0000f7f0: 6c74 2864 662c 2070 7265 6369 7369 6f6e  lt(df, precision
-0000f800: 5f72 6f75 6e64 696e 6729 0d0a 2020 2020  _rounding)..    
-0000f810: 0d0a 2020 2020 2320 4472 6f70 2077 6f72  ..    # Drop wor
-0000f820: 6b69 6e67 2063 6f6c 756d 6e73 0d0a 2020  king columns..  
-0000f830: 2020 6466 203d 2064 662e 6472 6f70 2864    df = df.drop(d
-0000f840: 662e 6669 6c74 6572 2872 6567 6578 3d27  f.filter(regex='
-0000f850: 5f5f 2729 2e63 6f6c 756d 6e73 2c20 6178  __').columns, ax
-0000f860: 6973 3d31 290d 0a20 2020 200d 0a20 2020  is=1)..    ..   
-0000f870: 2023 2052 656f 7264 6572 2063 6f6c 756d   # Reorder colum
-0000f880: 6e73 0d0a 2020 2020 666f 7220 636f 6c20  ns..    for col 
-0000f890: 696e 205b 7374 6174 5f63 6f6c 2c72 6573  in [stat_col,res
-0000f8a0: 756c 745f 636f 6c2c 6365 6e73 6f72 5f63  ult_col,censor_c
-0000f8b0: 6f6c 2c6e 756d 6572 6963 5f63 6f6c 2c69  ol,numeric_col,i
-0000f8c0: 6e74 6572 7661 6c5f 636f 6c5d 3a0d 0a20  nterval_col]:.. 
-0000f8d0: 2020 2020 2020 2064 665b 636f 6c5d 203d         df[col] =
-0000f8e0: 2064 662e 706f 7028 636f 6c29 0d0a 2020   df.pop(col)..  
-0000f8f0: 2020 0d0a 2020 2020 7265 7475 726e 2064    ..    return d
-0000f900: 660d 0a                                  f..
+000065a0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000065b0: 636c 7564 655f 6e65 6761 7469 7665 5f69  clude_negative_i
+000065c0: 6e74 6572 7661 6c20 3d20 696e 636c 7564  nterval = includ
+000065d0: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
+000065e0: 7661 6c2c 0d0a 2020 2020 2020 2020 2020  val,..          
+000065f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006600: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
+00006610: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+00006620: 705f 6365 6e73 6f72 203d 2070 7265 6369  p_censor = preci
+00006630: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
+00006640: 6f5f 6472 6f70 5f63 656e 736f 7229 0d0a  o_drop_censor)..
+00006650: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
+00006660: 7465 2069 6e74 6572 7661 6c20 6e6f 7461  te interval nota
+00006670: 7469 6f6e 2066 6f72 2074 6865 206d 696e  tion for the min
+00006680: 696d 756d 0d0a 2020 2020 6466 203d 2069  imum..    df = i
+00006690: 6e74 6572 7661 6c5f 6e6f 7461 7469 6f6e  nterval_notation
+000066a0: 2864 662c 2070 7265 6369 7369 6f6e 5f72  (df, precision_r
+000066b0: 6f75 6e64 696e 6729 0d0a 2020 2020 0d0a  ounding)..    ..
+000066c0: 2020 2020 2320 436f 6d62 696e 6520 7468      # Combine th
+000066d0: 6520 6365 6e73 6f72 2061 6e64 206e 756d  e censor and num
+000066e0: 6572 6963 2063 6f6d 706f 6e65 6e74 7320  eric components 
+000066f0: 696e 746f 2061 2072 6573 756c 740d 0a20  into a result.. 
+00006700: 2020 2064 6620 3d20 636f 6d70 6f6e 656e     df = componen
+00006710: 7473 5f74 6f5f 7265 7375 6c74 2864 662c  ts_to_result(df,
+00006720: 2070 7265 6369 7369 6f6e 5f72 6f75 6e64   precision_round
+00006730: 696e 6729 0d0a 2020 2020 0d0a 2020 2020  ing)..    ..    
+00006740: 2320 4472 6f70 2077 6f72 6b69 6e67 2063  # Drop working c
+00006750: 6f6c 756d 6e73 0d0a 2020 2020 6466 203d  olumns..    df =
+00006760: 2064 662e 6472 6f70 2864 662e 6669 6c74   df.drop(df.filt
+00006770: 6572 2872 6567 6578 3d27 5f5f 2729 2e63  er(regex='__').c
+00006780: 6f6c 756d 6e73 2c20 6178 6973 3d31 290d  olumns, axis=1).
+00006790: 0a20 2020 200d 0a20 2020 2023 2052 656f  .    ..    # Reo
+000067a0: 7264 6572 2063 6f6c 756d 6e73 0d0a 2020  rder columns..  
+000067b0: 2020 666f 7220 636f 6c20 696e 205b 7374    for col in [st
+000067c0: 6174 5f63 6f6c 2c72 6573 756c 745f 636f  at_col,result_co
+000067d0: 6c2c 6365 6e73 6f72 5f63 6f6c 2c6e 756d  l,censor_col,num
+000067e0: 6572 6963 5f63 6f6c 2c69 6e74 6572 7661  eric_col,interva
+000067f0: 6c5f 636f 6c5d 3a0d 0a20 2020 2020 2020  l_col]:..       
+00006800: 2064 665b 636f 6c5d 203d 2064 662e 706f   df[col] = df.po
+00006810: 7028 636f 6c29 0d0a 2020 2020 0d0a 2020  p(col)..    ..  
+00006820: 2020 7265 7475 726e 2064 660d 0a0d 0a23    return df....#
+00006830: 2525 2041 7665 7261 6765 2052 6573 756c  %% Average Resul
+00006840: 740d 0a0d 0a64 6566 2061 7665 7261 6765  t....def average
+00006850: 5f69 6e74 6572 7661 6c28 6466 2c0d 0a20  _interval(df,.. 
+00006860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006870: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
+00006880: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
+00006890: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
+000068a0: 2061 6e61 6c79 7365 7320 7468 6520 696e   analyses the in
+000068b0: 7465 7276 616c 206e 6f74 6174 696f 6e20  terval notation 
+000068c0: 666f 726d 206f 6620 7265 7375 6c74 7320  form of results 
+000068d0: 7265 7475 726e 6564 0d0a 2020 2020 6672  returned..    fr
+000068e0: 6f6d 2063 6f6d 706f 6e65 6e74 735f 746f  om components_to
+000068f0: 5f69 6e74 6572 7661 6c20 746f 2067 656e  _interval to gen
+00006900: 6572 6174 6520 6120 6e65 7720 696e 7465  erate a new inte
+00006910: 7276 616c 2066 6f72 2074 6865 2061 7665  rval for the ave
+00006920: 7261 6765 2e20 4772 6f75 7073 0d0a 2020  rage. Groups..  
+00006930: 2020 6f66 2072 6573 756c 7473 2063 616e    of results can
+00006940: 2062 6520 6465 6669 6e65 6420 6279 2069   be defined by i
+00006950: 6e63 6c75 6469 6e67 2074 6865 2063 6f6c  ncluding the col
+00006960: 756d 6e73 2074 6861 7420 7368 6f75 6c64  umns that should
+00006970: 2062 6520 7573 6564 2074 6f0d 0a20 2020   be used to..   
+00006980: 2063 7265 6174 6520 6772 6f75 7073 2e0d   create groups..
+00006990: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+000069a0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
+000069b0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+000069c0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+000069d0: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
+000069e0: 6e74 6169 6e73 2072 6573 756c 7473 2069  ntains results i
+000069f0: 6e20 6120 7370 6563 6966 6963 2069 6e74  n a specific int
+00006a00: 6572 7661 6c20 6e6f 7461 7469 6f6e 2e0d  erval notation..
+00006a10: 0a20 2020 2067 726f 7570 6279 5f63 6f6c  .    groupby_col
+00006a20: 7320 3a20 6c69 7374 206f 6620 7374 7269  s : list of stri
+00006a30: 6e67 730d 0a20 2020 2020 2020 204c 6973  ngs..        Lis
+00006a40: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
+00006a50: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
+00006a60: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
+00006a70: 6772 6f75 7073 2e0d 0a0d 0a20 2020 2052  groups.....    R
+00006a80: 6574 7572 6e73 0d0a 2020 2020 2d2d 2d2d  eturns..    ----
+00006a90: 2d2d 2d0d 0a20 2020 2064 6620 3a20 4461  ---..    df : Da
+00006aa0: 7461 4672 616d 650d 0a20 2020 2020 2020  taFrame..       
+00006ab0: 2044 6174 6146 7261 6d65 2074 6861 7420   DataFrame that 
+00006ac0: 6861 7320 7468 6520 696e 7465 7276 616c  has the interval
+00006ad0: 2066 6f72 2074 6865 2061 7665 7261 6765   for the average
+00006ae0: 2028 666f 7220 6561 6368 2067 726f 7570   (for each group
+00006af0: 2069 660d 0a20 2020 2020 2020 2063 6f6c   if..        col
+00006b00: 756d 6e20 6e61 6d65 7320 6172 6520 7072  umn names are pr
+00006b10: 6f76 6964 6564 2066 6f72 2067 726f 7570  ovided for group
+00006b20: 696e 6729 0d0a 0d0a 2020 2020 2727 270d  ing)....    '''.
+00006b30: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
+00006b40: 6174 6520 6120 636f 7079 206f 6620 7468  ate a copy of th
+00006b50: 6520 4461 7461 4672 616d 650d 0a20 2020  e DataFrame..   
+00006b60: 2064 6620 3d20 6466 2e63 6f70 7928 290d   df = df.copy().
+00006b70: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
+00006b80: 6174 6520 636f 6c75 6d6e 2074 6861 7420  ate column that 
+00006b90: 696e 6469 6361 7465 7320 7468 6520 6765  indicates the ge
+00006ba0: 6e65 7261 7465 6420 7374 6174 6973 7469  nerated statisti
+00006bb0: 6320 616e 6420 6170 7065 6e64 2074 6f20  c and append to 
+00006bc0: 6772 6f75 7069 6e67 206c 6973 740d 0a20  grouping list.. 
+00006bd0: 2020 2064 665b 7374 6174 5f63 6f6c 5d20     df[stat_col] 
+00006be0: 3d20 2741 7665 7261 6765 270d 0a20 2020  = 'Average'..   
+00006bf0: 2067 726f 7570 6279 5f63 6f6c 732e 6170   groupby_cols.ap
+00006c00: 7065 6e64 2873 7461 745f 636f 6c29 0d0a  pend(stat_col)..
+00006c10: 2020 2020 0d0a 2020 2020 2320 4368 616e      ..    # Chan
+00006c20: 6765 206e 6f74 6174 696f 6e20 6f66 2027  ge notation of '
+00006c30: 436c 6f73 6564 2720 616e 6420 274f 7065  Closed' and 'Ope
+00006c40: 6e27 2062 6f75 6e64 6172 6965 7320 746f  n' boundaries to
+00006c50: 2030 2061 6e64 2031 2c20 7265 7370 6563   0 and 1, respec
+00006c60: 7469 7665 6c79 0d0a 2020 2020 2320 5468  tively..    # Th
+00006c70: 6520 7072 6573 656e 6365 206f 6620 616e  e presence of an
+00006c80: 7920 6f70 656e 2062 6f75 6e64 6172 6965  y open boundarie
+00006c90: 7320 6f6e 206f 6e65 2073 6964 6520 656e  s on one side en
+00006ca0: 7375 7265 2074 6861 7420 7468 6520 696e  sure that the in
+00006cb0: 7465 7276 616c 2066 6f72 2074 6865 2061  terval for the a
+00006cc0: 7665 7261 6765 2069 7320 616c 736f 0d0a  verage is also..
+00006cd0: 2020 2020 2320 6f70 656e 206f 6e20 7468      # open on th
+00006ce0: 6174 2073 6964 650d 0a20 2020 2064 665b  at side..    df[
+00006cf0: 5b6c 6566 745f 626f 756e 6461 7279 5f63  [left_boundary_c
+00006d00: 6f6c 2c72 6967 6874 5f62 6f75 6e64 6172  ol,right_boundar
+00006d10: 795f 636f 6c5d 5d20 3d20 6466 5b5b 6c65  y_col]] = df[[le
+00006d20: 6674 5f62 6f75 6e64 6172 795f 636f 6c2c  ft_boundary_col,
+00006d30: 7269 6768 745f 626f 756e 6461 7279 5f63  right_boundary_c
+00006d40: 6f6c 5d5d 2e72 6570 6c61 6365 285b 2743  ol]].replace(['C
+00006d50: 6c6f 7365 6427 2c27 4f70 656e 275d 2c20  losed','Open'], 
+00006d60: 5b30 2c31 5d29 0d0a 2020 2020 0d0a 2020  [0,1])..    ..  
+00006d70: 2020 2320 4765 7420 7468 6520 6c65 6674    # Get the left
+00006d80: 2f72 6967 6874 2062 6f75 6e64 7320 6f66  /right bounds of
+00006d90: 2074 6865 2061 7665 7261 6765 2062 7920   the average by 
+00006da0: 6176 6572 6167 696e 6720 626f 756e 6473  averaging bounds
+00006db0: 2077 6974 6869 6e20 7468 6520 6772 6f75   within the grou
+00006dc0: 700d 0a20 2020 2023 2044 6574 6572 6d69  p..    # Determi
+00006dd0: 6e65 2077 6865 7468 6572 2061 6e79 204f  ne whether any O
+00006de0: 7065 6e20 286e 6f77 2076 616c 7565 206f  pen (now value o
+00006df0: 6620 3129 2062 6f75 6e64 6172 6965 7320  f 1) boundaries 
+00006e00: 6578 6973 742e 2049 6620 7468 6572 6520  exist. If there 
+00006e10: 6172 650d 0a20 2020 2023 2061 6e79 206f  are..    # any o
+00006e20: 7065 6e20 626f 756e 6461 7269 6573 2075  pen boundaries u
+00006e30: 7365 6420 696e 2074 6865 2061 7665 7261  sed in the avera
+00006e40: 6765 2c20 7468 656e 2074 6865 2072 6573  ge, then the res
+00006e50: 756c 7469 6e67 2061 7665 7261 6765 2077  ulting average w
+00006e60: 696c 6c20 6265 206f 7065 6e0d 0a20 2020  ill be open..   
+00006e70: 2064 6620 3d20 6466 2e67 726f 7570 6279   df = df.groupby
+00006e80: 2867 726f 7570 6279 5f63 6f6c 7329 2e61  (groupby_cols).a
+00006e90: 6767 282a 2a7b 0d0a 2020 2020 2020 2020  gg(**{..        
+00006ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006eb0: 2020 2020 6c65 6674 5f62 6f75 6e64 6172      left_boundar
+00006ec0: 795f 636f 6c3a 2028 6c65 6674 5f62 6f75  y_col: (left_bou
+00006ed0: 6e64 6172 795f 636f 6c2c 2027 6d61 7827  ndary_col, 'max'
+00006ee0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00006ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f00: 275f 5f4d 696e 696d 756d 5f5f 273a 2028  '__Minimum__': (
+00006f10: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 2c27  left_bound_col,'
+00006f20: 6d69 6e27 292c 0d0a 2020 2020 2020 2020  min'),..        
+00006f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f40: 2020 2020 6c65 6674 5f62 6f75 6e64 5f63      left_bound_c
+00006f50: 6f6c 3a20 286c 6566 745f 626f 756e 645f  ol: (left_bound_
+00006f60: 636f 6c2c 276d 6561 6e27 292c 0d0a 2020  col,'mean'),..  
+00006f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f80: 2020 2020 2020 2020 2020 7269 6768 745f            right_
+00006f90: 626f 756e 645f 636f 6c3a 2028 7269 6768  bound_col: (righ
+00006fa0: 745f 626f 756e 645f 636f 6c2c 276d 6561  t_bound_col,'mea
+00006fb0: 6e27 292c 0d0a 2020 2020 2020 2020 2020  n'),..          
+00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fd0: 2020 275f 5f4d 6178 696d 756d 5f5f 273a    '__Maximum__':
+00006fe0: 2028 7269 6768 745f 626f 756e 645f 636f   (right_bound_co
+00006ff0: 6c2c 276d 6178 2729 2c0d 0a20 2020 2020  l,'max'),..     
+00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007010: 2020 2020 2020 2072 6967 6874 5f62 6f75         right_bou
+00007020: 6e64 6172 795f 636f 6c3a 2028 7269 6768  ndary_col: (righ
+00007030: 745f 626f 756e 6461 7279 5f63 6f6c 2c27  t_boundary_col,'
+00007040: 6d61 7827 290d 0a20 2020 2020 2020 2020  max')..         
+00007050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007060: 2020 207d 290d 0a20 2020 200d 0a20 2020     })..    ..   
+00007070: 2023 2052 6570 6c61 6365 2069 6e74 6567   # Replace integ
+00007080: 6572 7320 7769 7468 2074 6578 7420 666f  ers with text fo
+00007090: 7220 626f 756e 6461 7269 6573 0d0a 2020  r boundaries..  
+000070a0: 2020 6466 5b5b 6c65 6674 5f62 6f75 6e64    df[[left_bound
+000070b0: 6172 795f 636f 6c2c 7269 6768 745f 626f  ary_col,right_bo
+000070c0: 756e 6461 7279 5f63 6f6c 5d5d 203d 2064  undary_col]] = d
+000070d0: 665b 5b6c 6566 745f 626f 756e 6461 7279  f[[left_boundary
+000070e0: 5f63 6f6c 2c72 6967 6874 5f62 6f75 6e64  _col,right_bound
+000070f0: 6172 795f 636f 6c5d 5d2e 7265 706c 6163  ary_col]].replac
+00007100: 6528 5b30 2c31 5d2c 205b 2743 6c6f 7365  e([0,1], ['Close
+00007110: 6427 2c27 4f70 656e 275d 290d 0a20 2020  d','Open'])..   
+00007120: 200d 0a20 2020 2023 204d 6561 6e73 2077   ..    # Means w
+00007130: 6974 6820 696e 6669 6e69 7465 2076 616c  ith infinite val
+00007140: 7565 7320 7072 6f64 7563 6520 6e61 6e20  ues produce nan 
+00007150: 7661 6c75 6573 2072 6174 6865 7220 7468  values rather th
+00007160: 616e 206e 702e 696e 6620 7661 6c75 6573  an np.inf values
+00007170: 0d0a 2020 2020 2320 436f 6e76 6572 7420  ..    # Convert 
+00007180: 6e61 6e20 746f 2069 6e66 206f 6e6c 7920  nan to inf only 
+00007190: 6966 2069 6e66 696e 6974 6520 7661 6c75  if infinite valu
+000071a0: 6573 2061 7265 2069 6e63 6c75 6465 6420  es are included 
+000071b0: 696e 2074 6865 206d 6561 6e0d 0a20 2020  in the mean..   
+000071c0: 2064 665b 6c65 6674 5f62 6f75 6e64 5f63   df[left_bound_c
+000071d0: 6f6c 5d20 3d20 6e70 2e77 6865 7265 2864  ol] = np.where(d
+000071e0: 665b 275f 5f4d 696e 696d 756d 5f5f 275d  f['__Minimum__']
+000071f0: 203d 3d20 2d6e 702e 696e 662c 202d 6e70   == -np.inf, -np
+00007200: 2e69 6e66 2c20 6466 5b6c 6566 745f 626f  .inf, df[left_bo
+00007210: 756e 645f 636f 6c5d 290d 0a20 2020 2064  und_col])..    d
+00007220: 665b 7269 6768 745f 626f 756e 645f 636f  f[right_bound_co
+00007230: 6c5d 203d 206e 702e 7768 6572 6528 6466  l] = np.where(df
+00007240: 5b27 5f5f 4d61 7869 6d75 6d5f 5f27 5d20  ['__Maximum__'] 
+00007250: 3d3d 206e 702e 696e 662c 206e 702e 696e  == np.inf, np.in
+00007260: 662c 2064 665b 7269 6768 745f 626f 756e  f, df[right_boun
+00007270: 645f 636f 6c5d 290d 0a20 2020 200d 0a20  d_col])..    .. 
+00007280: 2020 2023 2052 6573 6574 2069 6e64 6578     # Reset index
+00007290: 0d0a 2020 2020 6466 203d 2064 662e 7265  ..    df = df.re
+000072a0: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
+000072b0: 200d 0a20 2020 2072 6574 7572 6e20 6466   ..    return df
+000072c0: 0d0a 0d0a 6465 6620 6176 6572 6167 6528  ....def average(
+000072d0: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
+000072e0: 2072 6573 756c 7473 5f63 6f6c 2c0d 0a20   results_col,.. 
+000072f0: 2020 2020 2020 2020 2020 2067 726f 7570             group
+00007300: 6279 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d  by_cols = None,.
+00007310: 0a20 2020 2020 2020 2020 2020 2066 6f63  .            foc
+00007320: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
+00007330: 6c20 3d20 5472 7565 2c0d 0a20 2020 2020  l = True,..     
+00007340: 2020 2020 2020 2069 6e63 6c75 6465 5f6e         include_n
+00007350: 6567 6174 6976 655f 696e 7465 7276 616c  egative_interval
+00007360: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+00007370: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+00007380: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
+00007390: 6f70 5f63 656e 736f 7220 3d20 302e 3235  op_censor = 0.25
+000073a0: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
+000073b0: 7265 6369 7369 6f6e 5f72 6f75 6e64 696e  recision_roundin
+000073c0: 6720 3d20 5472 7565 293a 0d0a 2020 2020  g = True):..    
+000073d0: 2727 270d 0a20 2020 2041 2066 756e 6374  '''..    A funct
+000073e0: 696f 6e20 7468 6174 2063 6f6d 6269 6e65  ion that combine
+000073f0: 7320 7468 6520 7265 6c65 7661 6e74 2061  s the relevant a
+00007400: 7665 7261 6765 2061 6e64 2075 7469 6c69  verage and utili
+00007410: 7479 2066 756e 6374 696f 6e73 2074 6f0d  ty functions to.
+00007420: 0a20 2020 2067 656e 6572 6174 6520 7468  .    generate th
+00007430: 6520 6176 6572 6167 6520 7265 7375 6c74  e average result
+00007440: 7320 666f 7220 6772 6f75 7073 2077 6974  s for groups wit
+00007450: 6869 6e20 6120 4461 7461 4672 616d 652e  hin a DataFrame.
+00007460: 0d0a 0d0a 2020 2020 5061 7261 6d65 7465  ....    Paramete
+00007470: 7273 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d  rs..    --------
+00007480: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
+00007490: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
+000074a0: 4461 7461 4672 616d 6520 7468 6174 2063  DataFrame that c
+000074b0: 6f6e 7461 696e 7320 6365 6e73 6f72 6564  ontains censored
+000074c0: 206f 7220 756e 6365 6e73 6f72 6564 2072   or uncensored r
+000074d0: 6573 756c 7473 0d0a 2020 2020 7265 7375  esults..    resu
+000074e0: 6c74 735f 636f 6c20 3a20 7374 7269 6e67  lts_col : string
+000074f0: 0d0a 2020 2020 2020 2020 5468 6520 636f  ..        The co
+00007500: 6c75 6d6e 206e 616d 6520 666f 7220 7468  lumn name for th
+00007510: 6520 636f 6c75 6d6e 2074 6861 7420 636f  e column that co
+00007520: 6e74 6169 6e20 7468 6520 7265 7375 6c74  ntain the result
+00007530: 7320 6173 2074 6578 742e 0d0a 2020 2020  s as text...    
+00007540: 2020 2020 4f6e 6c79 2066 6f75 7220 706f      Only four po
+00007550: 7373 6962 6c65 2063 656e 736f 7273 2073  ssible censors s
+00007560: 686f 756c 6420 6265 2075 7365 6420 283c  hould be used (<
+00007570: 2ce2 89a4 2ce2 89a5 2c3e 292e 0d0a 2020  ,...,...,>)...  
+00007580: 2020 6772 6f75 7062 795f 636f 6c73 203a    groupby_cols :
+00007590: 206c 6973 7473 206f 6620 7374 7269 6e67   lists of string
+000075a0: 7320 286f 7220 6c69 7374 206f 6620 6c69  s (or list of li
+000075b0: 7374 7329 2c20 6f70 7469 6f6e 616c 0d0a  sts), optional..
+000075c0: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+000075d0: 636f 6c75 6d6e 206e 616d 6573 2074 6861  column names tha
+000075e0: 7420 7368 6f75 6c64 2062 6520 7573 6564  t should be used
+000075f0: 2074 6f20 6372 6561 7465 2067 726f 7570   to create group
+00007600: 732e 2041 6e20 6176 6572 6167 650d 0a20  s. An average.. 
+00007610: 2020 2020 2020 2077 696c 6c20 6265 2066         will be f
+00007620: 6f75 6e64 2077 6974 6869 6e20 6561 6368  ound within each
+00007630: 2067 726f 7570 2e20 4d75 6c74 6970 6c65   group. Multiple
+00007640: 206c 6973 7473 2063 616e 2062 6520 7375   lists can be su
+00007650: 7070 6c69 6564 2074 6f0d 0a20 2020 2020  pplied to..     
+00007660: 2020 2070 6572 666f 726d 2073 6571 7565     perform seque
+00007670: 6e74 6961 6c20 6176 6572 6167 696e 6720  ntial averaging 
+00007680: 6265 666f 7265 2063 6f6e 7665 7274 696e  before convertin
+00007690: 6720 696e 7465 7276 616c 7320 746f 2061  g intervals to a
+000076a0: 2072 6573 756c 742e 0d0a 2020 2020 2020   result...      
+000076b0: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
+000076c0: 204e 6f6e 652e 0d0a 2020 2020 666f 6375   None...    focu
+000076d0: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
+000076e0: 203a 2062 6f6f 6c65 616e 2c20 6f70 7469   : boolean, opti
+000076f0: 6f6e 616c 0d0a 2020 2020 2020 2020 4966  onal..        If
+00007700: 2054 7275 652c 2074 6865 6e20 696e 666f   True, then info
+00007710: 726d 6174 696f 6e20 6f6e 2074 6865 2068  rmation on the h
+00007720: 6967 6865 7374 2070 6f74 656e 7469 616c  ighest potential
+00007730: 2072 6573 756c 7420 7769 6c6c 2062 650d   result will be.
+00007740: 0a20 2020 2020 2020 2066 6f63 7573 6564  .        focused
+00007750: 206f 7665 7220 7468 6520 6c6f 7765 7374   over the lowest
+00007760: 2070 6f74 656e 7469 616c 2072 6573 756c   potential resul
+00007770: 742e 0d0a 2020 2020 696e 636c 7564 655f  t...    include_
+00007780: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
+00007790: 6c20 3a20 626f 6f6c 6561 6e2c 206f 7074  l : boolean, opt
+000077a0: 696f 6e61 6c0d 0a20 2020 2020 2020 2049  ional..        I
+000077b0: 6620 5472 7565 2c20 7468 656e 2061 6c6c  f True, then all
+000077c0: 2070 6f73 6974 6976 6520 616e 6420 6e65   positive and ne
+000077d0: 6761 7469 7665 2076 616c 7565 7320 6172  gative values ar
+000077e0: 6520 636f 6e73 6964 6572 6564 0d0a 2020  e considered..  
+000077f0: 2020 2020 2020 652e 672e 2c20 3c30 2e35        e.g., <0.5
+00007800: 2077 6f75 6c64 2062 6520 636f 6e76 6572   would be conver
+00007810: 7465 6420 746f 2028 2d6e 702e 696e 662c  ted to (-np.inf,
+00007820: 3529 2e0d 0a20 2020 2020 2020 2049 6620  5)...        If 
+00007830: 4661 6c73 652c 2074 6865 6e20 6f6e 6c79  False, then only
+00007840: 206e 6f6e 2d6e 6567 6174 6976 6520 7661   non-negative va
+00007850: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
+00007860: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
+00007870: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
+00007880: 2063 6f6e 7665 7274 6564 2074 6f20 5b30   converted to [0
+00007890: 2c35 292e 0d0a 2020 2020 2020 2020 5468  ,5)...        Th
+000078a0: 6973 2073 6574 7469 6e67 206f 6e6c 7920  is setting only 
+000078b0: 6166 6665 6374 7320 7265 7375 6c74 7320  affects results 
+000078c0: 6966 2066 6f63 7573 5f68 6967 685f 706f  if focus_high_po
+000078d0: 7465 6e74 6961 6c20 6973 2046 616c 7365  tential is False
+000078e0: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
+000078f0: 6566 6175 6c74 2069 7320 4661 6c73 652e  efault is False.
+00007900: 0d0a 2020 2020 7072 6563 6973 696f 6e5f  ..    precision_
+00007910: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+00007920: 705f 6365 6e73 6f72 203a 2066 6c6f 6174  p_censor : float
+00007930: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
+00007940: 2020 2020 5468 7265 7368 6f6c 6420 666f      Threshold fo
+00007950: 7220 7265 706f 7274 696e 6720 6365 6e73  r reporting cens
+00007960: 6f72 6564 2076 7320 6e6f 6e2d 6365 6e73  ored vs non-cens
+00007970: 6f72 6564 2072 6573 756c 7473 2e0d 0a20  ored results... 
+00007980: 2020 2020 2020 2055 7369 6e67 2074 6865         Using the
+00007990: 2064 6566 6175 6c74 2c20 6120 7265 7375   default, a resu
+000079a0: 6c74 2074 6861 7420 6973 206b 6e6f 776e  lt that is known
+000079b0: 2074 6f20 6265 2069 6e20 7468 6520 696e   to be in the in
+000079c0: 7465 7276 616c 2028 302e 332c 2030 2e35  terval (0.3, 0.5
+000079d0: 290d 0a20 2020 2020 2020 2077 6f75 6c64  )..        would
+000079e0: 2062 6520 7265 7475 726e 6564 2061 7320   be returned as 
+000079f0: 302e 342c 2077 6865 7265 6173 2061 2074  0.4, whereas a t
+00007a00: 6f6c 6572 616e 6365 206f 6620 3020 776f  olerance of 0 wo
+00007a10: 756c 6420 7969 656c 6420 610d 0a20 2020  uld yield a..   
+00007a20: 2020 2020 2072 6573 756c 7420 6f66 203c       result of <
+00007a30: 302e 3520 6f72 203e 302e 3320 6465 7065  0.5 or >0.3 depe
+00007a40: 6e64 696e 6720 6f6e 2074 6865 2076 616c  nding on the val
+00007a50: 7565 206f 6620 666f 6375 735f 6869 6768  ue of focus_high
+00007a60: 6573 745f 706f 7465 6e74 6961 6c2e 0d0a  est_potential...
+00007a70: 2020 2020 2020 2020 5468 6520 6465 6661          The defa
+00007a80: 756c 7420 6973 2030 2e32 352e 0d0a 2020  ult is 0.25...  
+00007a90: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
+00007aa0: 6469 6e67 203a 2062 6f6f 6c65 616e 2c20  ding : boolean, 
+00007ab0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+00007ac0: 2020 4966 2054 7275 652c 2061 2072 6f75    If True, a rou
+00007ad0: 6e64 696e 6720 6d65 7468 6f64 2069 7320  nding method is 
+00007ae0: 6170 706c 6965 6420 746f 2072 6f75 6e64  applied to round
+00007af0: 2072 6573 756c 7473 2074 6f20 6861 7665   results to have
+00007b00: 206e 6f20 6d6f 7265 0d0a 2020 2020 2020   no more..      
+00007b10: 2020 6465 6369 6d61 6c73 2074 6861 6e20    decimals than 
+00007b20: 7768 6174 2063 616e 2062 6520 6d65 6173  what can be meas
+00007b30: 7572 6564 2e0d 0a20 2020 2020 2020 2054  ured...        T
+00007b40: 6865 2064 6566 6175 6c74 2069 7320 5472  he default is Tr
+00007b50: 7565 2e0d 0a0d 0a20 2020 2052 6574 7572  ue.....    Retur
+00007b60: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
+00007b70: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
+00007b80: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
+00007b90: 6146 7261 6d65 2074 6861 7420 636f 6e74  aFrame that cont
+00007ba0: 6169 6e73 2063 616c 6375 6c61 7465 6420  ains calculated 
+00007bb0: 6176 6572 6167 6573 0d0a 0d0a 2020 2020  averages....    
+00007bc0: 2727 270d 0a20 2020 200d 0a20 2020 2023  '''..    ..    #
+00007bd0: 2043 7265 6174 6520 6120 636f 7079 206f   Create a copy o
+00007be0: 6620 7468 6520 4461 7461 4672 616d 650d  f the DataFrame.
+00007bf0: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
+00007c00: 7928 290d 0a20 2020 200d 0a20 2020 2023  y()..    ..    #
+00007c10: 2053 706c 6974 2074 6865 2072 6573 756c   Split the resul
+00007c20: 7420 696e 746f 2063 656e 736f 7220 616e  t into censor an
+00007c30: 6420 6e75 6d65 7269 6320 636f 6d70 6f6e  d numeric compon
+00007c40: 656e 7473 0d0a 2020 2020 6466 203d 2072  ents..    df = r
+00007c50: 6573 756c 745f 746f 5f63 6f6d 706f 6e65  esult_to_compone
+00007c60: 6e74 7328 6466 2c72 6573 756c 7473 5f63  nts(df,results_c
+00007c70: 6f6c 290d 0a20 2020 200d 0a20 2020 2023  ol)..    ..    #
+00007c80: 2043 6f6e 7665 7274 2074 6865 2072 6573   Convert the res
+00007c90: 756c 7473 2066 726f 6d20 6365 6e73 6f72  ults from censor
+00007ca0: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
+00007cb0: 706f 6e65 6e74 7320 746f 2061 6e20 696e  ponents to an in
+00007cc0: 7465 7276 616c 2072 6570 7265 7365 6e74  terval represent
+00007cd0: 6174 696f 6e0d 0a20 2020 2064 6620 3d20  ation..    df = 
+00007ce0: 636f 6d70 6f6e 656e 7473 5f74 6f5f 696e  components_to_in
+00007cf0: 7465 7276 616c 2864 662c 2069 6e63 6c75  terval(df, inclu
+00007d00: 6465 5f6e 6567 6174 6976 655f 696e 7465  de_negative_inte
+00007d10: 7276 616c 290d 0a20 2020 200d 0a20 2020  rval)..    ..   
+00007d20: 2023 2055 7369 6e67 2074 6865 2069 6e74   # Using the int
+00007d30: 6572 7661 6c73 2c20 6465 7465 726d 696e  ervals, determin
+00007d40: 6520 7468 6520 7261 6e67 6520 6f66 2070  e the range of p
+00007d50: 6f73 7369 626c 6520 6176 6572 6167 6573  ossible averages
+00007d60: 0d0a 2020 2020 0d0a 2020 2020 2320 4966  ..    ..    # If
+00007d70: 2074 6865 7265 2061 7265 206e 6f20 6772   there are no gr
+00007d80: 6f75 7062 792d 636f 6c75 6d6e 732c 2074  oupby-columns, t
+00007d90: 6865 6e20 7461 6b65 2061 7665 7261 6765  hen take average
+00007da0: 206f 6620 616c 6c20 7265 7375 6c74 730d   of all results.
+00007db0: 0a20 2020 2069 6620 6e6f 7420 6772 6f75  .    if not grou
+00007dc0: 7062 795f 636f 6c73 3a0d 0a20 2020 2020  pby_cols:..     
+00007dd0: 2020 2064 6620 3d20 6176 6572 6167 655f     df = average_
+00007de0: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
+00007df0: 7570 6279 5f63 6f6c 733d 5b5d 290d 0a20  upby_cols=[]).. 
+00007e00: 2020 2023 2049 6620 7468 6520 6772 6f75     # If the grou
+00007e10: 7062 795f 636f 6c73 2069 7320 6120 6c69  pby_cols is a li
+00007e20: 7374 206f 6620 6c69 7374 732c 2074 6865  st of lists, the
+00007e30: 6e20 7065 7266 6f72 6d20 6d75 6c74 6970  n perform multip
+00007e40: 6c65 2061 7665 7261 6765 730d 0a20 2020  le averages..   
+00007e50: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00007e60: 2867 726f 7570 6279 5f63 6f6c 735b 305d  (groupby_cols[0]
+00007e70: 2c6c 6973 7429 3a0d 0a20 2020 2020 2020  ,list):..       
+00007e80: 2066 6f72 2067 726f 7570 696e 6720 696e   for grouping in
+00007e90: 2067 726f 7570 6279 5f63 6f6c 733a 0d0a   groupby_cols:..
+00007ea0: 2020 2020 2020 2020 2020 2020 2320 5573              # Us
+00007eb0: 696e 6720 7468 6520 696e 7465 7276 616c  ing the interval
+00007ec0: 732c 2064 6574 6572 6d69 6e65 2074 6865  s, determine the
+00007ed0: 2072 616e 6765 206f 6620 706f 7373 6962   range of possib
+00007ee0: 6c65 206d 6178 696d 610d 0a20 2020 2020  le maxima..     
+00007ef0: 2020 2020 2020 2064 6620 3d20 6176 6572         df = aver
+00007f00: 6167 655f 696e 7465 7276 616c 2864 662c  age_interval(df,
+00007f10: 2067 726f 7570 696e 6729 0d0a 2020 2020   grouping)..    
+00007f20: 2320 456c 7365 2074 6865 2067 726f 7570  # Else the group
+00007f30: 6279 5f63 6f6c 7320 6973 2061 206c 6973  by_cols is a lis
+00007f40: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
+00007f50: 730d 0a20 2020 2065 6c73 653a 0d0a 2020  s..    else:..  
+00007f60: 2020 2020 2020 6466 203d 2061 7665 7261        df = avera
+00007f70: 6765 5f69 6e74 6572 7661 6c28 6466 2c20  ge_interval(df, 
+00007f80: 6772 6f75 7062 795f 636f 6c73 290d 0a20  groupby_cols).. 
+00007f90: 2020 200d 0a20 2020 2023 2043 6f6e 7665     ..    # Conve
+00007fa0: 7274 2074 6865 2069 6e74 6572 7661 6c20  rt the interval 
+00007fb0: 666f 7220 7468 6520 6176 6572 6167 6520  for the average 
+00007fc0: 696e 746f 2063 656e 736f 7220 616e 6420  into censor and 
+00007fd0: 6e75 6d65 7269 6320 6e6f 7461 7469 6f6e  numeric notation
+00007fe0: 0d0a 2020 2020 6466 203d 2069 6e74 6572  ..    df = inter
+00007ff0: 7661 6c5f 746f 5f63 6f6d 706f 6e65 6e74  val_to_component
+00008000: 7328 6466 2c0d 0a20 2020 2020 2020 2020  s(df,..         
+00008010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008020: 2020 2020 2020 2066 6f63 7573 5f68 6967         focus_hig
+00008030: 685f 706f 7465 6e74 6961 6c20 3d20 666f  h_potential = fo
+00008040: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
+00008050: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
+00008060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008070: 2020 2020 2069 6e63 6c75 6465 5f6e 6567       include_neg
+00008080: 6174 6976 655f 696e 7465 7276 616c 203d  ative_interval =
+00008090: 2069 6e63 6c75 6465 5f6e 6567 6174 6976   include_negativ
+000080a0: 655f 696e 7465 7276 616c 2c0d 0a20 2020  e_interval,..   
+000080b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080c0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+000080d0: 6369 7369 6f6e 5f74 6f6c 6572 616e 6365  cision_tolerance
+000080e0: 5f74 6f5f 6472 6f70 5f63 656e 736f 7220  _to_drop_censor 
+000080f0: 3d20 7072 6563 6973 696f 6e5f 746f 6c65  = precision_tole
+00008100: 7261 6e63 655f 746f 5f64 726f 705f 6365  rance_to_drop_ce
+00008110: 6e73 6f72 290d 0a20 2020 200d 0a20 2020  nsor)..    ..   
+00008120: 2023 2043 7265 6174 6520 696e 7465 7276   # Create interv
+00008130: 616c 206e 6f74 6174 696f 6e20 666f 7220  al notation for 
+00008140: 7468 6520 6176 6572 6167 650d 0a20 2020  the average..   
+00008150: 2064 6620 3d20 696e 7465 7276 616c 5f6e   df = interval_n
+00008160: 6f74 6174 696f 6e28 6466 2c20 7072 6563  otation(df, prec
+00008170: 6973 696f 6e5f 726f 756e 6469 6e67 290d  ision_rounding).
+00008180: 0a20 2020 200d 0a20 2020 2023 2043 6f6d  .    ..    # Com
+00008190: 6269 6e65 2074 6865 2063 656e 736f 7220  bine the censor 
+000081a0: 616e 6420 6e75 6d65 7269 6320 636f 6d70  and numeric comp
+000081b0: 6f6e 656e 7473 2069 6e74 6f20 6120 7265  onents into a re
+000081c0: 7375 6c74 0d0a 2020 2020 6466 203d 2063  sult..    df = c
+000081d0: 6f6d 706f 6e65 6e74 735f 746f 5f72 6573  omponents_to_res
+000081e0: 756c 7428 6466 2c20 7072 6563 6973 696f  ult(df, precisio
+000081f0: 6e5f 726f 756e 6469 6e67 290d 0a20 2020  n_rounding)..   
+00008200: 200d 0a20 2020 2023 2044 726f 7020 776f   ..    # Drop wo
+00008210: 726b 696e 6720 636f 6c75 6d6e 730d 0a20  rking columns.. 
+00008220: 2020 2064 6620 3d20 6466 2e64 726f 7028     df = df.drop(
+00008230: 6466 2e66 696c 7465 7228 7265 6765 783d  df.filter(regex=
+00008240: 275f 5f27 292e 636f 6c75 6d6e 732c 2061  '__').columns, a
+00008250: 7869 733d 3129 0d0a 2020 2020 0d0a 2020  xis=1)..    ..  
+00008260: 2020 2320 5265 6f72 6465 7220 636f 6c75    # Reorder colu
+00008270: 6d6e 730d 0a20 2020 2066 6f72 2063 6f6c  mns..    for col
+00008280: 2069 6e20 5b73 7461 745f 636f 6c2c 7265   in [stat_col,re
+00008290: 7375 6c74 5f63 6f6c 2c63 656e 736f 725f  sult_col,censor_
+000082a0: 636f 6c2c 6e75 6d65 7269 635f 636f 6c2c  col,numeric_col,
+000082b0: 696e 7465 7276 616c 5f63 6f6c 5d3a 0d0a  interval_col]:..
+000082c0: 2020 2020 2020 2020 6466 5b63 6f6c 5d20          df[col] 
+000082d0: 3d20 6466 2e70 6f70 2863 6f6c 290d 0a20  = df.pop(col).. 
+000082e0: 2020 200d 0a20 2020 2072 6574 7572 6e20     ..    return 
+000082f0: 6466 0d0a 0d0a 2325 2520 5065 7263 656e  df....#%% Percen
+00008300: 7469 6c65 2052 6573 756c 740d 0a0d 0a64  tile Result....d
+00008310: 6566 2070 6572 6365 6e74 696c 655f 696e  ef percentile_in
+00008320: 7465 7276 616c 2864 662c 0d0a 2020 2020  terval(df,..    
+00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008340: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
+00008350: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00008360: 2020 2020 2020 2020 2020 2070 6572 6365             perce
+00008370: 6e74 696c 652c 0d0a 2020 2020 2020 2020  ntile,..        
+00008380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008390: 6d65 7468 6f64 203d 2027 6861 7a65 6e27  method = 'hazen'
+000083a0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
+000083b0: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
+000083c0: 2061 6e61 6c79 7365 7320 7468 6520 696e   analyses the in
+000083d0: 7465 7276 616c 206e 6f74 6174 696f 6e20  terval notation 
+000083e0: 666f 726d 206f 6620 7265 7375 6c74 7320  form of results 
+000083f0: 7265 7475 726e 6564 0d0a 2020 2020 6672  returned..    fr
+00008400: 6f6d 2063 6f6d 706f 6e65 6e74 735f 746f  om components_to
+00008410: 5f69 6e74 6572 7661 6c20 746f 2067 656e  _interval to gen
+00008420: 6572 6174 6520 6120 6e65 7720 696e 7465  erate a new inte
+00008430: 7276 616c 2066 6f72 2070 6572 6365 6e74  rval for percent
+00008440: 696c 6573 2e20 4772 6f75 7073 0d0a 2020  iles. Groups..  
+00008450: 2020 6f66 2072 6573 756c 7473 2063 616e    of results can
+00008460: 2062 6520 6465 6669 6e65 6420 6279 2069   be defined by i
+00008470: 6e63 6c75 6469 6e67 2074 6865 2063 6f6c  ncluding the col
+00008480: 756d 6e73 2074 6861 7420 7368 6f75 6c64  umns that should
+00008490: 2062 6520 7573 6564 2074 6f0d 0a20 2020   be used to..   
+000084a0: 2063 7265 6174 6520 6772 6f75 7073 2e0d   create groups..
+000084b0: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+000084c0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
+000084d0: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+000084e0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+000084f0: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
+00008500: 6e74 6169 6e73 2072 6573 756c 7473 2069  ntains results i
+00008510: 6e20 6120 7370 6563 6966 6963 2069 6e74  n a specific int
+00008520: 6572 7661 6c20 6e6f 7461 7469 6f6e 2e0d  erval notation..
+00008530: 0a20 2020 2067 726f 7570 6279 5f63 6f6c  .    groupby_col
+00008540: 7320 3a20 6c69 7374 206f 6620 7374 7269  s : list of stri
+00008550: 6e67 730d 0a20 2020 2020 2020 204c 6973  ngs..        Lis
+00008560: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
+00008570: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
+00008580: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
+00008590: 6772 6f75 7073 2e0d 0a20 2020 2070 6572  groups...    per
+000085a0: 6365 6e74 696c 6520 3a20 666c 6f61 740d  centile : float.
+000085b0: 0a20 2020 2020 2020 2054 6865 2064 6573  .        The des
+000085c0: 6972 6564 2070 6572 6365 6e74 696c 652e  ired percentile.
+000085d0: 2056 616c 7565 7320 7368 6f75 6c64 2062   Values should b
+000085e0: 6520 6265 7477 6565 6e20 3020 616e 6420  e between 0 and 
+000085f0: 3130 302e 0d0a 2020 2020 6d65 7468 6f64  100...    method
+00008600: 203a 2073 7472 696e 670d 0a20 2020 2020   : string..     
+00008610: 2020 2054 6865 2070 6572 6365 6e74 696c     The percentil
+00008620: 6520 6d65 7468 6f64 2e20 5468 6520 6f70  e method. The op
+00008630: 7469 6f6e 7320 616e 6420 6465 6669 6e69  tions and defini
+00008640: 7469 6f6e 7320 636f 6d65 2066 726f 6d3a  tions come from:
+00008650: 0d0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
+00008660: 7470 733a 2f2f 656e 7669 726f 6e6d 656e  tps://environmen
+00008670: 742e 676f 7674 2e6e 7a2f 6173 7365 7473  t.govt.nz/assets
+00008680: 2f50 7562 6c69 6361 7469 6f6e 732f 4669  /Publications/Fi
+00008690: 6c65 732f 6861 7a65 6e2d 7065 7263 656e  les/hazen-percen
+000086a0: 7469 6c65 2d63 616c 6375 6c61 746f 722d  tile-calculator-
+000086b0: 322e 786c 730d 0a20 2020 2020 2020 2020  2.xls..         
+000086c0: 2020 204f 7074 696f 6e73 2069 6e63 6c75     Options inclu
+000086d0: 6465 2074 6865 2066 6f6c 6c6f 7769 6e67  de the following
+000086e0: 2c20 6f72 6465 7265 6420 6672 6f6d 206c  , ordered from l
+000086f0: 6172 6765 7374 2074 6f20 736d 616c 6c65  argest to smalle
+00008700: 7374 2072 6573 756c 742e 0d0a 2020 2020  st result...    
+00008710: 2020 2020 2020 2020 2d20 7765 6962 616c          - weibal
+00008720: 6c0d 0a20 2020 2020 2020 2020 2020 202d  l..            -
+00008730: 2074 756b 6579 0d0a 2020 2020 2020 2020   tukey..        
+00008740: 2020 2020 2d20 626c 6f6d 0d0a 2020 2020      - blom..    
+00008750: 2020 2020 2020 2020 2d20 6861 7a65 6e0d          - hazen.
+00008760: 0a20 2020 2020 2020 2020 2020 202d 2065  .            - e
+00008770: 7863 656c 0d0a 2020 2020 2020 2020 5468  xcel..        Th
+00008780: 6520 6465 6661 756c 7420 6973 2068 617a  e default is haz
+00008790: 656e 2e0d 0a0d 0a20 2020 2052 6574 7572  en.....    Retur
+000087a0: 6e73 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d  ns..    -------.
+000087b0: 0a20 2020 2064 6620 3a20 4461 7461 4672  .    df : DataFr
+000087c0: 616d 650d 0a20 2020 2020 2020 2044 6174  ame..        Dat
+000087d0: 6146 7261 6d65 2074 6861 7420 6861 7320  aFrame that has 
+000087e0: 7468 6520 696e 7465 7276 616c 2066 6f72  the interval for
+000087f0: 2074 6865 2070 6572 6365 6e74 696c 6520   the percentile 
+00008800: 2866 6f72 2065 6163 6820 6772 6f75 7020  (for each group 
+00008810: 6966 0d0a 2020 2020 2020 2020 636f 6c75  if..        colu
+00008820: 6d6e 206e 616d 6573 2061 7265 2070 726f  mn names are pro
+00008830: 7669 6465 6420 666f 7220 6772 6f75 7069  vided for groupi
+00008840: 6e67 290d 0a0d 0a20 2020 2027 2727 0d0a  ng)....    '''..
+00008850: 2020 2020 0d0a 2020 2020 2320 4372 6561      ..    # Crea
+00008860: 7465 2061 2063 6f70 7920 6f66 2074 6865  te a copy of the
+00008870: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
+00008880: 6466 203d 2064 662e 636f 7079 2829 0d0a  df = df.copy()..
+00008890: 2020 2020 0d0a 2020 2020 2320 4368 6563      ..    # Chec
+000088a0: 6b20 7468 6520 7065 7263 656e 7469 6c65  k the percentile
+000088b0: 2069 7320 6265 7477 6565 6e20 3020 616e   is between 0 an
+000088c0: 6420 310d 0a20 2020 2069 6620 7065 7263  d 1..    if perc
+000088d0: 656e 7469 6c65 203c 2030 206f 7220 7065  entile < 0 or pe
+000088e0: 7263 656e 7469 6c65 203e 2031 3030 3a0d  rcentile > 100:.
+000088f0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+00008900: 616c 7565 4572 726f 7228 6627 5065 7263  alueError(f'Perc
+00008910: 656e 7469 6c65 206f 7574 206f 6620 7261  entile out of ra
+00008920: 6e67 652e 2041 7474 656d 7074 6564 2070  nge. Attempted p
+00008930: 6572 6365 6e74 696c 653a 207b 7065 7263  ercentile: {perc
+00008940: 656e 7469 6c65 7d27 290d 0a20 2020 200d  entile}')..    .
+00008950: 0a20 2020 2023 2043 7265 6174 6520 636f  .    # Create co
+00008960: 6c75 6d6e 2074 6861 7420 696e 6469 6361  lumn that indica
+00008970: 7465 7320 7468 6520 6765 6e65 7261 7465  tes the generate
+00008980: 6420 7374 6174 6973 7469 6320 616e 6420  d statistic and 
+00008990: 6170 7065 6e64 2074 6f20 6772 6f75 7069  append to groupi
+000089a0: 6e67 206c 6973 740d 0a20 2020 2064 665b  ng list..    df[
+000089b0: 7374 6174 5f63 6f6c 5d20 3d20 6627 5065  stat_col] = f'Pe
+000089c0: 7263 656e 7469 6c65 2d7b 7065 7263 656e  rcentile-{percen
+000089d0: 7469 6c65 7d27 0d0a 2020 2020 6772 6f75  tile}'..    grou
+000089e0: 7062 795f 636f 6c73 2e61 7070 656e 6428  pby_cols.append(
+000089f0: 7374 6174 5f63 6f6c 290d 0a20 2020 200d  stat_col)..    .
+00008a00: 0a20 2020 2023 2043 6f6e 7665 7274 2070  .    # Convert p
+00008a10: 6572 6365 6e74 696c 6520 746f 2062 6520  ercentile to be 
+00008a20: 6265 7477 6565 6e20 3020 616e 6420 310d  between 0 and 1.
+00008a30: 0a20 2020 2070 6572 6365 6e74 696c 6520  .    percentile 
+00008a40: 3d20 7065 7263 656e 7469 6c65 2f31 3030  = percentile/100
+00008a50: 0d0a 2020 2020 0d0a 2020 2020 2320 4465  ..    ..    # De
+00008a60: 7465 726d 696e 6520 7369 7a65 206f 6620  termine size of 
+00008a70: 6561 6368 2067 726f 7570 0d0a 2020 2020  each group..    
+00008a80: 6466 5b27 5f5f 5369 7a65 5f5f 275d 203d  df['__Size__'] =
+00008a90: 2064 662e 6772 6f75 7062 7928 6772 6f75   df.groupby(grou
+00008aa0: 7062 795f 636f 6c73 292e 7472 616e 7366  pby_cols).transf
+00008ab0: 6f72 6d28 2773 697a 6527 290d 0a20 2020  orm('size')..   
+00008ac0: 200d 0a20 2020 2023 2053 6574 2076 616c   ..    # Set val
+00008ad0: 7565 7320 666f 7220 7065 7263 656e 7469  ues for percenti
+00008ae0: 6c65 206d 6574 686f 6473 0d0a 2020 2020  le methods..    
+00008af0: 6d65 7468 6f64 5f64 6963 7420 3d20 7b27  method_dict = {'
+00008b00: 7765 6962 616c 6c27 3a30 2e30 2c20 2774  weiball':0.0, 't
+00008b10: 756b 6579 273a 312f 332c 2027 626c 6f6d  ukey':1/3, 'blom
+00008b20: 273a 332f 382c 2027 6861 7a65 6e27 3a31  ':3/8, 'hazen':1
+00008b30: 2f32 2c20 2765 7863 656c 273a 312e 307d  /2, 'excel':1.0}
+00008b40: 0d0a 2020 2020 2320 6874 7470 733a 2f2f  ..    # https://
+00008b50: 656e 2e77 696b 6970 6564 6961 2e6f 7267  en.wikipedia.org
+00008b60: 2f77 696b 692f 5065 7263 656e 7469 6c65  /wiki/Percentile
+00008b70: 0d0a 2020 2020 4320 3d20 6d65 7468 6f64  ..    C = method
+00008b80: 5f64 6963 745b 6d65 7468 6f64 5d0d 0a20  _dict[method].. 
+00008b90: 2020 200d 0a20 2020 2023 2043 616c 6375     ..    # Calcu
+00008ba0: 6c61 7465 206d 696e 696d 756d 2064 6174  late minimum dat
+00008bb0: 6120 7369 7a65 2066 6f72 2070 6572 6365  a size for perce
+00008bc0: 6e74 696c 6520 6d65 7468 6f64 2074 6f20  ntile method to 
+00008bd0: 0d0a 2020 2020 2320 656e 7375 7265 2072  ..    # ensure r
+00008be0: 616e 6b20 6973 2061 7420 6c65 6173 7420  ank is at least 
+00008bf0: 3120 616e 6420 6e6f 206d 6f72 6520 7468  1 and no more th
+00008c00: 616e 206c 656e 2864 6174 6129 0d0a 2020  an len(data)..  
+00008c10: 2020 6d69 6e69 6d75 6d5f 7369 7a65 203d    minimum_size =
+00008c20: 2072 6f75 6e64 2843 202b 2028 312d 4329   round(C + (1-C)
+00008c30: 2a6d 6178 2828 312d 7065 7263 656e 7469  *max((1-percenti
+00008c40: 6c65 292f 7065 7263 656e 7469 6c65 2c0d  le)/percentile,.
+00008c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c70: 2020 2020 2020 2020 7065 7263 656e 7469          percenti
+00008c80: 6c65 2f28 312d 7065 7263 656e 7469 6c65  le/(1-percentile
+00008c90: 2929 2c31 3029 0d0a 2020 2020 0d0a 2020  )),10)..    ..  
+00008ca0: 2020 2320 4f6e 6c79 2063 6f6e 7369 6465    # Only conside
+00008cb0: 7220 6772 6f75 7073 2074 6861 7420 6d65  r groups that me
+00008cc0: 6574 2074 6865 206d 696e 696d 756d 2073  et the minimum s
+00008cd0: 697a 6520 7265 7175 6972 656d 656e 740d  ize requirement.
+00008ce0: 0a20 2020 2064 6620 3d20 6466 5b64 665b  .    df = df[df[
+00008cf0: 275f 5f53 697a 655f 5f27 5d20 3e3d 206d  '__Size__'] >= m
+00008d00: 696e 696d 756d 5f73 697a 655d 0d0a 2020  inimum_size]..  
+00008d10: 2020 0d0a 2020 2020 2320 4465 7465 726d    ..    # Determ
+00008d20: 696e 6520 6c65 6674 2062 6f75 6e64 2061  ine left bound a
+00008d30: 6e64 2062 6f75 6e64 6172 7920 666f 7220  nd boundary for 
+00008d40: 6561 6368 2067 726f 7570 0d0a 2020 2020  each group..    
+00008d50: 0d0a 2020 2020 2320 4368 616e 6765 206e  ..    # Change n
+00008d60: 6f74 6174 696f 6e20 6f66 2027 436c 6f73  otation of 'Clos
+00008d70: 6564 2720 616e 6420 274f 7065 6e27 2062  ed' and 'Open' b
+00008d80: 6f75 6e64 6172 6965 7320 746f 2030 2061  oundaries to 0 a
+00008d90: 6e64 2031 2c20 7265 7370 6563 7469 7665  nd 1, respective
+00008da0: 6c79 0d0a 2020 2020 2320 5573 6520 3020  ly..    # Use 0 
+00008db0: 666f 7220 636c 6f73 6564 2074 6f20 656e  for closed to en
+00008dc0: 7375 7265 2074 6861 7420 636c 6f73 6564  sure that closed
+00008dd0: 2062 6f75 6e64 6172 6965 7320 6172 6520   boundaries are 
+00008de0: 736f 7274 6564 206c 6573 7320 7468 616e  sorted less than
+00008df0: 206f 7065 6e0d 0a20 2020 2023 2062 6f75   open..    # bou
+00008e00: 6e64 6172 6965 7320 7768 656e 2074 6865  ndaries when the
+00008e10: 206c 6566 7420 626f 756e 6420 6973 2074   left bound is t
+00008e20: 6965 640d 0a20 2020 2064 665b 6c65 6674  ied..    df[left
+00008e30: 5f62 6f75 6e64 6172 795f 636f 6c5d 203d  _boundary_col] =
+00008e40: 2064 665b 6c65 6674 5f62 6f75 6e64 6172   df[left_boundar
+00008e50: 795f 636f 6c5d 2e72 6570 6c61 6365 285b  y_col].replace([
+00008e60: 2743 6c6f 7365 6427 2c27 4f70 656e 275d  'Closed','Open']
+00008e70: 2c20 5b30 2c31 5d29 0d0a 2020 2020 0d0a  , [0,1])..    ..
+00008e80: 2020 2020 2320 536f 7274 206c 6566 7420      # Sort left 
+00008e90: 626f 756e 6420 7661 6c75 6573 0d0a 2020  bound values..  
+00008ea0: 2020 6c65 6674 203d 2064 662e 636f 7079    left = df.copy
+00008eb0: 2829 5b67 726f 7570 6279 5f63 6f6c 732b  ()[groupby_cols+
+00008ec0: 5b27 5f5f 5369 7a65 5f5f 272c 6c65 6674  ['__Size__',left
+00008ed0: 5f62 6f75 6e64 6172 795f 636f 6c2c 6c65  _boundary_col,le
+00008ee0: 6674 5f62 6f75 6e64 5f63 6f6c 5d5d 2e73  ft_bound_col]].s
+00008ef0: 6f72 745f 7661 6c75 6573 2862 793d 5b6c  ort_values(by=[l
+00008f00: 6566 745f 626f 756e 645f 636f 6c2c 6c65  eft_bound_col,le
+00008f10: 6674 5f62 6f75 6e64 6172 795f 636f 6c5d  ft_boundary_col]
+00008f20: 290d 0a20 2020 200d 0a20 2020 2023 2041  )..    ..    # A
+00008f30: 6464 2069 6e64 6578 2066 6f72 2065 6163  dd index for eac
+00008f40: 6820 6772 6f75 700d 0a20 2020 206c 6566  h group..    lef
+00008f50: 745b 275f 5f49 6e64 6578 5f5f 275d 203d  t['__Index__'] =
+00008f60: 206c 6566 742e 6772 6f75 7062 7928 6772   left.groupby(gr
+00008f70: 6f75 7062 795f 636f 6c73 292e 6375 6d63  oupby_cols).cumc
+00008f80: 6f75 6e74 2829 202b 2031 0d0a 2020 2020  ount() + 1..    
+00008f90: 0d0a 2020 2020 2320 4465 7465 726d 696e  ..    # Determin
+00008fa0: 6520 7468 6520 7261 6e6b 2069 6e20 6561  e the rank in ea
+00008fb0: 6368 2067 726f 7570 2066 6f72 2074 6865  ch group for the
+00008fc0: 2070 6572 6365 6e74 696c 650d 0a20 2020   percentile..   
+00008fd0: 206c 6566 745b 275f 5f52 616e 6b5f 5f27   left['__Rank__'
+00008fe0: 5d20 3d20 726f 756e 6428 4320 2b20 7065  ] = round(C + pe
+00008ff0: 7263 656e 7469 6c65 2a28 6c65 6674 5b27  rcentile*(left['
+00009000: 5f5f 5369 7a65 5f5f 275d 202b 2031 202d  __Size__'] + 1 -
+00009010: 2032 2a43 292c 3829 0d0a 2020 2020 0d0a   2*C),8)..    ..
+00009020: 2020 2020 2320 4765 6e65 7261 7465 2070      # Generate p
+00009030: 726f 7869 6d69 7479 206f 6620 6561 6368  roximity of each
+00009040: 2072 6573 756c 7420 746f 2070 6572 6365   result to perce
+00009050: 6e74 696c 6520 7261 6e6b 2075 7369 6e67  ntile rank using
+00009060: 2074 6865 2069 6e64 6578 0d0a 2020 2020   the index..    
+00009070: 6c65 6674 5b27 5f5f 5072 6f78 696d 6974  left['__Proximit
+00009080: 795f 5f27 5d20 3d20 300d 0a20 2020 200d  y__'] = 0..    .
+00009090: 0a20 2020 2063 6f6e 6469 7469 6f6e 7320  .    conditions 
+000090a0: 3d20 5b0d 0a20 2020 2020 2020 2023 2049  = [..        # I
+000090b0: 6620 7468 6520 7065 7263 656e 7469 6c65  f the percentile
+000090c0: 2072 616e 6b20 6973 2061 2077 686f 6c65   rank is a whole
+000090d0: 206e 756d 6265 722c 2074 6865 6e20 7573   number, then us
+000090e0: 6520 7468 6174 2069 6e64 6578 2072 6573  e that index res
+000090f0: 756c 740d 0a20 2020 2020 2020 2028 6c65  ult..        (le
+00009100: 6674 5b27 5f5f 5261 6e6b 5f5f 275d 203d  ft['__Rank__'] =
+00009110: 3d20 6c65 6674 5b27 5f5f 496e 6465 785f  = left['__Index_
+00009120: 5f27 5d29 2c0d 0a20 2020 2020 2020 2023  _']),..        #
+00009130: 2049 6620 7468 6520 7065 7263 656e 7469   If the percenti
+00009140: 6c65 2072 616e 6b20 6973 206c 6573 7320  le rank is less 
+00009150: 7468 616e 2031 2061 626f 7665 2074 6865  than 1 above the
+00009160: 2069 6e64 6578 2076 616c 7565 2c0d 0a20   index value,.. 
+00009170: 2020 2020 2020 2023 2074 6865 6e20 6173         # then as
+00009180: 7369 676e 2074 6865 2061 7070 726f 7072  sign the appropr
+00009190: 6961 7465 2063 6f6e 7472 6962 7574 696f  iate contributio
+000091a0: 6e20 746f 2074 6861 7420 696e 6465 7820  n to that index 
+000091b0: 7661 6c75 650d 0a20 2020 2020 2020 2028  value..        (
+000091c0: 6c65 6674 5b27 5f5f 5261 6e6b 5f5f 275d  left['__Rank__']
+000091d0: 202d 206c 6566 745b 275f 5f49 6e64 6578   - left['__Index
+000091e0: 5f5f 275d 292e 6265 7477 6565 6e28 302c  __']).between(0,
+000091f0: 312c 696e 636c 7573 6976 653d 276e 6569  1,inclusive='nei
+00009200: 7468 6572 2729 2c0d 0a20 2020 2020 2020  ther'),..       
+00009210: 2023 2049 6620 7468 6520 7065 7263 656e   # If the percen
+00009220: 7469 6c65 2072 616e 6b20 6973 206c 6573  tile rank is les
+00009230: 7320 7468 616e 2031 2062 656c 6f77 2074  s than 1 below t
+00009240: 6865 2069 6e64 6578 2076 616c 7565 2c0d  he index value,.
+00009250: 0a20 2020 2020 2020 2023 2074 6865 6e20  .        # then 
+00009260: 6173 7369 676e 2074 6865 2061 7070 726f  assign the appro
+00009270: 7072 6961 7465 2063 6f6e 7472 6962 7574  priate contribut
+00009280: 696f 6e20 746f 2074 6861 7420 696e 6465  ion to that inde
+00009290: 7820 7661 6c75 650d 0a20 2020 2020 2020  x value..       
+000092a0: 2028 6c65 6674 5b27 5f5f 496e 6465 785f   (left['__Index_
+000092b0: 5f27 5d20 2d20 6c65 6674 5b27 5f5f 5261  _'] - left['__Ra
+000092c0: 6e6b 5f5f 275d 292e 6265 7477 6565 6e28  nk__']).between(
+000092d0: 302c 312c 696e 636c 7573 6976 653d 276e  0,1,inclusive='n
+000092e0: 6569 7468 6572 2729 0d0a 2020 2020 2020  either')..      
+000092f0: 2020 5d0d 0a20 2020 200d 0a20 2020 2072    ]..    ..    r
+00009300: 6573 756c 7473 203d 205b 0d0a 2020 2020  esults = [..    
+00009310: 2020 2020 312c 0d0a 2020 2020 2020 2020      1,..        
+00009320: 3120 2d20 286c 6566 745b 275f 5f52 616e  1 - (left['__Ran
+00009330: 6b5f 5f27 5d20 2d20 6c65 6674 5b27 5f5f  k__'] - left['__
+00009340: 496e 6465 785f 5f27 5d29 2c0d 0a20 2020  Index__']),..   
+00009350: 2020 2020 2031 202d 2028 6c65 6674 5b27       1 - (left['
+00009360: 5f5f 496e 6465 785f 5f27 5d20 2d20 6c65  __Index__'] - le
+00009370: 6674 5b27 5f5f 5261 6e6b 5f5f 275d 292c  ft['__Rank__']),
+00009380: 0d0a 2020 2020 2020 2020 5d0d 0a20 2020  ..        ]..   
+00009390: 200d 0a20 2020 206c 6566 745b 275f 5f50   ..    left['__P
+000093a0: 726f 7869 6d69 7479 5f5f 275d 203d 206e  roximity__'] = n
+000093b0: 702e 7365 6c65 6374 2863 6f6e 6469 7469  p.select(conditi
+000093c0: 6f6e 732c 2072 6573 756c 7473 2c20 6e70  ons, results, np
+000093d0: 2e6e 616e 290d 0a20 2020 200d 0a20 2020  .nan)..    ..   
+000093e0: 2023 2044 726f 7020 6e6f 6e2d 636f 6e74   # Drop non-cont
+000093f0: 7269 6275 7469 6e67 2072 6f77 730d 0a20  ributing rows.. 
+00009400: 2020 206c 6566 7420 3d20 6c65 6674 5b6c     left = left[l
+00009410: 6566 745b 275f 5f50 726f 7869 6d69 7479  eft['__Proximity
+00009420: 5f5f 275d 203e 2030 5d0d 0a20 2020 200d  __'] > 0]..    .
+00009430: 0a20 2020 2023 2043 616c 6375 6c61 7465  .    # Calculate
+00009440: 2063 6f6e 7472 6962 7574 696f 6e20 666f   contribution fo
+00009450: 7220 696e 6465 7820 7661 6c75 6573 2074  r index values t
+00009460: 6861 7420 636f 6e74 7269 6275 7465 2074  hat contribute t
+00009470: 6f20 7468 6520 7265 7375 6c74 0d0a 2020  o the result..  
+00009480: 2020 6c65 6674 5b27 5f5f 436f 6e74 7269    left['__Contri
+00009490: 6275 7469 6f6e 5f5f 275d 203d 206c 6566  bution__'] = lef
+000094a0: 745b 275f 5f50 726f 7869 6d69 7479 5f5f  t['__Proximity__
+000094b0: 275d 202a 206c 6566 745b 6c65 6674 5f62  '] * left[left_b
+000094c0: 6f75 6e64 5f63 6f6c 5d0d 0a20 2020 200d  ound_col]..    .
+000094d0: 0a20 2020 2023 2044 6574 6572 6d69 6e65  .    # Determine
+000094e0: 206c 6566 7420 626f 756e 6420 616e 6420   left bound and 
+000094f0: 626f 756e 6461 7279 2075 7369 6e67 2074  boundary using t
+00009500: 6865 2073 756d 206f 6620 7468 6520 636f  he sum of the co
+00009510: 6e74 7269 6275 7469 6f6e 730d 0a20 2020  ntributions..   
+00009520: 2023 2061 6e64 2061 6e20 6f70 656e 2062   # and an open b
+00009530: 6f75 6e64 6172 7920 6966 2061 6e79 206f  oundary if any o
+00009540: 6620 7468 6520 636f 6e74 7269 6275 7469  f the contributi
+00009550: 6e67 2076 616c 7565 7320 6973 206f 7065  ng values is ope
+00009560: 6e0d 0a20 2020 206c 6566 7420 3d20 6c65  n..    left = le
+00009570: 6674 2e67 726f 7570 6279 2867 726f 7570  ft.groupby(group
+00009580: 6279 5f63 6f6c 7329 2e61 6767 282a 2a7b  by_cols).agg(**{
+00009590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000095a0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+000095b0: 6674 5f62 6f75 6e64 6172 795f 636f 6c3a  ft_boundary_col:
+000095c0: 2028 6c65 6674 5f62 6f75 6e64 6172 795f   (left_boundary_
+000095d0: 636f 6c2c 2027 6d61 7827 292c 0d0a 2020  col, 'max'),..  
+000095e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095f0: 2020 2020 2020 2020 2020 6c65 6674 5f62            left_b
+00009600: 6f75 6e64 5f63 6f6c 3a20 2827 5f5f 436f  ound_col: ('__Co
+00009610: 6e74 7269 6275 7469 6f6e 5f5f 272c 2773  ntribution__','s
+00009620: 756d 2729 2c0d 0a20 2020 2020 2020 2020  um'),..         
+00009630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009640: 2020 2027 5f5f 4d69 6e69 6d75 6d5f 5f27     '__Minimum__'
+00009650: 3a20 2827 5f5f 436f 6e74 7269 6275 7469  : ('__Contributi
+00009660: 6f6e 5f5f 272c 276d 696e 2729 0d0a 2020  on__','min')..  
+00009670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009680: 2020 2020 2020 2020 2020 7d29 0d0a 2020            })..  
+00009690: 2020 0d0a 2020 2020 2320 5265 706c 6163    ..    # Replac
+000096a0: 6520 7468 6520 6e75 6d65 7269 6320 7661  e the numeric va
+000096b0: 6c75 6520 666f 7220 7468 6520 626f 756e  lue for the boun
+000096c0: 6461 7279 0d0a 2020 2020 6c65 6674 5b6c  dary..    left[l
+000096d0: 6566 745f 626f 756e 6461 7279 5f63 6f6c  eft_boundary_col
+000096e0: 5d20 3d20 6c65 6674 5b6c 6566 745f 626f  ] = left[left_bo
+000096f0: 756e 6461 7279 5f63 6f6c 5d2e 7265 706c  undary_col].repl
+00009700: 6163 6528 5b30 2c31 5d2c 205b 2743 6c6f  ace([0,1], ['Clo
+00009710: 7365 6427 2c27 4f70 656e 275d 290d 0a20  sed','Open']).. 
+00009720: 2020 200d 0a20 2020 2023 204d 6561 6e73     ..    # Means
+00009730: 2077 6974 6820 696e 6669 6e69 7465 2076   with infinite v
+00009740: 616c 7565 7320 7072 6f64 7563 6520 6e61  alues produce na
+00009750: 6e20 7661 6c75 6573 2072 6174 6865 7220  n values rather 
+00009760: 7468 616e 206e 702e 696e 6620 7661 6c75  than np.inf valu
+00009770: 6573 0d0a 2020 2020 2320 436f 6e76 6572  es..    # Conver
+00009780: 7420 6e61 6e20 746f 2069 6e66 206f 6e6c  t nan to inf onl
+00009790: 7920 6966 2069 6e66 696e 6974 6520 7661  y if infinite va
+000097a0: 6c75 6573 2061 7265 2069 6e63 6c75 6465  lues are include
+000097b0: 6420 696e 2074 6865 206d 6561 6e0d 0a20  d in the mean.. 
+000097c0: 2020 206c 6566 745b 6c65 6674 5f62 6f75     left[left_bou
+000097d0: 6e64 5f63 6f6c 5d20 3d20 6e70 2e77 6865  nd_col] = np.whe
+000097e0: 7265 286c 6566 745b 275f 5f4d 696e 696d  re(left['__Minim
+000097f0: 756d 5f5f 275d 203d 3d20 2d6e 702e 696e  um__'] == -np.in
+00009800: 662c 202d 6e70 2e69 6e66 2c20 6c65 6674  f, -np.inf, left
+00009810: 5b6c 6566 745f 626f 756e 645f 636f 6c5d  [left_bound_col]
+00009820: 290d 0a20 2020 200d 0a20 2020 2023 2044  )..    ..    # D
+00009830: 6574 6572 6d69 6e65 2072 6967 6874 2062  etermine right b
+00009840: 6f75 6e64 2061 6e64 2062 6f75 6e64 6172  ound and boundar
+00009850: 7920 666f 7220 6561 6368 2067 726f 7570  y for each group
+00009860: 0d0a 2020 2020 0d0a 2020 2020 2320 4368  ..    ..    # Ch
+00009870: 616e 6765 206e 6f74 6174 696f 6e20 6f66  ange notation of
+00009880: 2027 436c 6f73 6564 2720 616e 6420 274f   'Closed' and 'O
+00009890: 7065 6e27 2062 6f75 6e64 6172 6965 7320  pen' boundaries 
+000098a0: 746f 2031 2061 6e64 2030 2c20 7265 7370  to 1 and 0, resp
+000098b0: 6563 7469 7665 6c79 0d0a 2020 2020 2320  ectively..    # 
+000098c0: 5573 6520 3120 666f 7220 636c 6f73 6564  Use 1 for closed
+000098d0: 2074 6f20 656e 7375 7265 2074 6861 7420   to ensure that 
+000098e0: 636c 6f73 6564 2062 6f75 6e64 6172 6965  closed boundarie
+000098f0: 7320 6172 6520 736f 7274 6564 206c 6172  s are sorted lar
+00009900: 6765 7220 7468 616e 206f 7065 6e0d 0a20  ger than open.. 
+00009910: 2020 2023 2062 6f75 6e64 6172 6965 7320     # boundaries 
+00009920: 7768 656e 2074 6865 2072 6967 6874 2062  when the right b
+00009930: 6f75 6e64 2069 7320 7469 6564 0d0a 2020  ound is tied..  
+00009940: 2020 6466 5b72 6967 6874 5f62 6f75 6e64    df[right_bound
+00009950: 6172 795f 636f 6c5d 203d 2064 665b 7269  ary_col] = df[ri
+00009960: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
+00009970: 5d2e 7265 706c 6163 6528 5b27 436c 6f73  ].replace(['Clos
+00009980: 6564 272c 274f 7065 6e27 5d2c 205b 312c  ed','Open'], [1,
+00009990: 305d 290d 0a20 2020 200d 0a20 2020 2023  0])..    ..    #
+000099a0: 2053 6f72 7420 7269 6768 7420 626f 756e   Sort right boun
+000099b0: 6420 7661 6c75 6573 0d0a 2020 2020 7269  d values..    ri
+000099c0: 6768 7420 3d20 6466 2e63 6f70 7928 295b  ght = df.copy()[
+000099d0: 6772 6f75 7062 795f 636f 6c73 2b5b 275f  groupby_cols+['_
+000099e0: 5f53 697a 655f 5f27 2c72 6967 6874 5f62  _Size__',right_b
+000099f0: 6f75 6e64 6172 795f 636f 6c2c 7269 6768  oundary_col,righ
+00009a00: 745f 626f 756e 645f 636f 6c5d 5d2e 736f  t_bound_col]].so
+00009a10: 7274 5f76 616c 7565 7328 6279 3d5b 7269  rt_values(by=[ri
+00009a20: 6768 745f 626f 756e 645f 636f 6c2c 7269  ght_bound_col,ri
+00009a30: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
+00009a40: 5d29 0d0a 2020 2020 0d0a 2020 2020 2320  ])..    ..    # 
+00009a50: 4164 6420 696e 6465 7820 666f 7220 6561  Add index for ea
+00009a60: 6368 2067 726f 7570 0d0a 2020 2020 7269  ch group..    ri
+00009a70: 6768 745b 275f 5f49 6e64 6578 5f5f 275d  ght['__Index__']
+00009a80: 203d 2072 6967 6874 2e67 726f 7570 6279   = right.groupby
+00009a90: 2867 726f 7570 6279 5f63 6f6c 7329 2e63  (groupby_cols).c
+00009aa0: 756d 636f 756e 7428 2920 2b20 310d 0a20  umcount() + 1.. 
+00009ab0: 2020 200d 0a20 2020 2023 2044 6574 6572     ..    # Deter
+00009ac0: 6d69 6e65 2074 6865 2072 616e 6b20 696e  mine the rank in
+00009ad0: 2065 6163 6820 6772 6f75 7020 666f 7220   each group for 
+00009ae0: 7468 6520 7065 7263 656e 7469 6c65 0d0a  the percentile..
+00009af0: 2020 2020 7269 6768 745b 275f 5f52 616e      right['__Ran
+00009b00: 6b5f 5f27 5d20 3d20 726f 756e 6428 4320  k__'] = round(C 
+00009b10: 2b20 7065 7263 656e 7469 6c65 2a28 7269  + percentile*(ri
+00009b20: 6768 745b 275f 5f53 697a 655f 5f27 5d20  ght['__Size__'] 
+00009b30: 2b20 3120 2d20 322a 4329 2c38 290d 0a20  + 1 - 2*C),8).. 
+00009b40: 2020 200d 0a20 2020 2023 2047 656e 6572     ..    # Gener
+00009b50: 6174 6520 7072 6f78 696d 6974 7920 6f66  ate proximity of
+00009b60: 2065 6163 6820 7265 7375 6c74 2074 6f20   each result to 
+00009b70: 7065 7263 656e 7469 6c65 2072 616e 6b20  percentile rank 
+00009b80: 7573 696e 6720 7468 6520 696e 6465 780d  using the index.
+00009b90: 0a20 2020 2072 6967 6874 5b27 5f5f 5072  .    right['__Pr
+00009ba0: 6f78 696d 6974 795f 5f27 5d20 3d20 300d  oximity__'] = 0.
+00009bb0: 0a20 2020 200d 0a20 2020 2063 6f6e 6469  .    ..    condi
+00009bc0: 7469 6f6e 7320 3d20 5b0d 0a20 2020 2020  tions = [..     
+00009bd0: 2020 2023 2049 6620 7468 6520 7065 7263     # If the perc
+00009be0: 656e 7469 6c65 2072 616e 6b20 6973 2061  entile rank is a
+00009bf0: 2077 686f 6c65 206e 756d 6265 722c 2074   whole number, t
+00009c00: 6865 6e20 7573 6520 7468 6174 2069 6e64  hen use that ind
+00009c10: 6578 2072 6573 756c 740d 0a20 2020 2020  ex result..     
+00009c20: 2020 2028 7269 6768 745b 275f 5f52 616e     (right['__Ran
+00009c30: 6b5f 5f27 5d20 3d3d 2072 6967 6874 5b27  k__'] == right['
+00009c40: 5f5f 496e 6465 785f 5f27 5d29 2c0d 0a20  __Index__']),.. 
+00009c50: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00009c60: 7065 7263 656e 7469 6c65 2072 616e 6b20  percentile rank 
+00009c70: 6973 206c 6573 7320 7468 616e 2031 2061  is less than 1 a
+00009c80: 626f 7665 2074 6865 2069 6e64 6578 2076  bove the index v
+00009c90: 616c 7565 2c0d 0a20 2020 2020 2020 2023  alue,..        #
+00009ca0: 2074 6865 6e20 6173 7369 676e 2074 6865   then assign the
+00009cb0: 2061 7070 726f 7072 6961 7465 2063 6f6e   appropriate con
+00009cc0: 7472 6962 7574 696f 6e20 746f 2074 6861  tribution to tha
+00009cd0: 7420 696e 6465 7820 7661 6c75 650d 0a20  t index value.. 
+00009ce0: 2020 2020 2020 2028 7269 6768 745b 275f         (right['_
+00009cf0: 5f52 616e 6b5f 5f27 5d20 2d20 7269 6768  _Rank__'] - righ
+00009d00: 745b 275f 5f49 6e64 6578 5f5f 275d 292e  t['__Index__']).
+00009d10: 6265 7477 6565 6e28 302c 312c 696e 636c  between(0,1,incl
+00009d20: 7573 6976 653d 276e 6569 7468 6572 2729  usive='neither')
+00009d30: 2c0d 0a20 2020 2020 2020 2023 2049 6620  ,..        # If 
+00009d40: 7468 6520 7065 7263 656e 7469 6c65 2072  the percentile r
+00009d50: 616e 6b20 6973 206c 6573 7320 7468 616e  ank is less than
+00009d60: 2031 2062 656c 6f77 2074 6865 2069 6e64   1 below the ind
+00009d70: 6578 2076 616c 7565 2c0d 0a20 2020 2020  ex value,..     
+00009d80: 2020 2023 2074 6865 6e20 6173 7369 676e     # then assign
+00009d90: 2074 6865 2061 7070 726f 7072 6961 7465   the appropriate
+00009da0: 2063 6f6e 7472 6962 7574 696f 6e20 746f   contribution to
+00009db0: 2074 6861 7420 696e 6465 7820 7661 6c75   that index valu
+00009dc0: 650d 0a20 2020 2020 2020 2028 7269 6768  e..        (righ
+00009dd0: 745b 275f 5f49 6e64 6578 5f5f 275d 202d  t['__Index__'] -
+00009de0: 2072 6967 6874 5b27 5f5f 5261 6e6b 5f5f   right['__Rank__
+00009df0: 275d 292e 6265 7477 6565 6e28 302c 312c  ']).between(0,1,
+00009e00: 696e 636c 7573 6976 653d 276e 6569 7468  inclusive='neith
+00009e10: 6572 2729 0d0a 2020 2020 2020 2020 5d0d  er')..        ].
+00009e20: 0a20 2020 200d 0a20 2020 2072 6573 756c  .    ..    resul
+00009e30: 7473 203d 205b 0d0a 2020 2020 2020 2020  ts = [..        
+00009e40: 312c 0d0a 2020 2020 2020 2020 3120 2d20  1,..        1 - 
+00009e50: 2872 6967 6874 5b27 5f5f 5261 6e6b 5f5f  (right['__Rank__
+00009e60: 275d 202d 2072 6967 6874 5b27 5f5f 496e  '] - right['__In
+00009e70: 6465 785f 5f27 5d29 2c0d 0a20 2020 2020  dex__']),..     
+00009e80: 2020 2031 202d 2028 7269 6768 745b 275f     1 - (right['_
+00009e90: 5f49 6e64 6578 5f5f 275d 202d 2072 6967  _Index__'] - rig
+00009ea0: 6874 5b27 5f5f 5261 6e6b 5f5f 275d 292c  ht['__Rank__']),
+00009eb0: 0d0a 2020 2020 2020 2020 5d0d 0a20 2020  ..        ]..   
+00009ec0: 200d 0a20 2020 2072 6967 6874 5b27 5f5f   ..    right['__
+00009ed0: 5072 6f78 696d 6974 795f 5f27 5d20 3d20  Proximity__'] = 
+00009ee0: 6e70 2e73 656c 6563 7428 636f 6e64 6974  np.select(condit
+00009ef0: 696f 6e73 2c20 7265 7375 6c74 732c 206e  ions, results, n
+00009f00: 702e 6e61 6e29 0d0a 2020 2020 0d0a 2020  p.nan)..    ..  
+00009f10: 2020 2320 4472 6f70 206e 6f6e 2d63 6f6e    # Drop non-con
+00009f20: 7472 6962 7574 696e 6720 726f 7773 0d0a  tributing rows..
+00009f30: 2020 2020 7269 6768 7420 3d20 7269 6768      right = righ
+00009f40: 745b 7269 6768 745b 275f 5f50 726f 7869  t[right['__Proxi
+00009f50: 6d69 7479 5f5f 275d 203e 2030 5d0d 0a20  mity__'] > 0].. 
+00009f60: 2020 200d 0a20 2020 2023 2043 616c 6375     ..    # Calcu
+00009f70: 6c61 7465 2063 6f6e 7472 6962 7574 696f  late contributio
+00009f80: 6e20 666f 7220 696e 6465 7820 7661 6c75  n for index valu
+00009f90: 6573 2074 6861 7420 636f 6e74 7269 6275  es that contribu
+00009fa0: 7465 2074 6f20 7468 6520 7265 7375 6c74  te to the result
+00009fb0: 0d0a 2020 2020 7269 6768 745b 275f 5f43  ..    right['__C
+00009fc0: 6f6e 7472 6962 7574 696f 6e5f 5f27 5d20  ontribution__'] 
+00009fd0: 3d20 7269 6768 745b 275f 5f50 726f 7869  = right['__Proxi
+00009fe0: 6d69 7479 5f5f 275d 202a 2072 6967 6874  mity__'] * right
+00009ff0: 5b72 6967 6874 5f62 6f75 6e64 5f63 6f6c  [right_bound_col
+0000a000: 5d0d 0a20 2020 200d 0a20 2020 2023 2044  ]..    ..    # D
+0000a010: 6574 6572 6d69 6e65 2072 6967 6874 2062  etermine right b
+0000a020: 6f75 6e64 2061 6e64 2062 6f75 6e64 6172  ound and boundar
+0000a030: 7920 7573 696e 6720 7468 6520 7375 6d20  y using the sum 
+0000a040: 6f66 2074 6865 2063 6f6e 7472 6962 7574  of the contribut
+0000a050: 696f 6e73 0d0a 2020 2020 2320 616e 6420  ions..    # and 
+0000a060: 616e 206f 7065 6e20 626f 756e 6461 7279  an open boundary
+0000a070: 2069 6620 616e 7920 6f66 2074 6865 2063   if any of the c
+0000a080: 6f6e 7472 6962 7574 696e 6720 7661 6c75  ontributing valu
+0000a090: 6573 2069 7320 6f70 656e 0d0a 2020 2020  es is open..    
+0000a0a0: 7269 6768 7420 3d20 7269 6768 742e 6772  right = right.gr
+0000a0b0: 6f75 7062 7928 6772 6f75 7062 795f 636f  oupby(groupby_co
+0000a0c0: 6c73 292e 6167 6728 2a2a 7b0d 0a20 2020  ls).agg(**{..   
+0000a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0e0: 2020 2020 2020 2020 2072 6967 6874 5f62           right_b
+0000a0f0: 6f75 6e64 5f63 6f6c 3a20 2827 5f5f 436f  ound_col: ('__Co
+0000a100: 6e74 7269 6275 7469 6f6e 5f5f 272c 2773  ntribution__','s
+0000a110: 756d 2729 2c0d 0a20 2020 2020 2020 2020  um'),..         
+0000a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a130: 2020 2072 6967 6874 5f62 6f75 6e64 6172     right_boundar
+0000a140: 795f 636f 6c3a 2028 7269 6768 745f 626f  y_col: (right_bo
+0000a150: 756e 6461 7279 5f63 6f6c 2c20 276d 696e  undary_col, 'min
+0000a160: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
+0000a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a180: 2027 5f5f 4d61 7869 6d75 6d5f 5f27 3a20   '__Maximum__': 
+0000a190: 2827 5f5f 436f 6e74 7269 6275 7469 6f6e  ('__Contribution
+0000a1a0: 5f5f 272c 276d 6178 2729 0d0a 2020 2020  __','max')..    
+0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1c0: 2020 2020 2020 2020 7d29 0d0a 2020 2020          })..    
+0000a1d0: 0d0a 2020 2020 2320 5265 706c 6163 6520  ..    # Replace 
+0000a1e0: 7468 6520 6e75 6d65 7269 6320 7661 6c75  the numeric valu
+0000a1f0: 6520 666f 7220 7468 6520 626f 756e 6461  e for the bounda
+0000a200: 7279 0d0a 2020 2020 7269 6768 745b 7269  ry..    right[ri
+0000a210: 6768 745f 626f 756e 6461 7279 5f63 6f6c  ght_boundary_col
+0000a220: 5d20 3d20 7269 6768 745b 7269 6768 745f  ] = right[right_
+0000a230: 626f 756e 6461 7279 5f63 6f6c 5d2e 7265  boundary_col].re
+0000a240: 706c 6163 6528 5b31 2c30 5d2c 205b 2743  place([1,0], ['C
+0000a250: 6c6f 7365 6427 2c27 4f70 656e 275d 290d  losed','Open']).
+0000a260: 0a20 2020 200d 0a20 2020 2023 204d 6561  .    ..    # Mea
+0000a270: 6e73 2077 6974 6820 696e 6669 6e69 7465  ns with infinite
+0000a280: 2076 616c 7565 7320 7072 6f64 7563 6520   values produce 
+0000a290: 6e61 6e20 7661 6c75 6573 2072 6174 6865  nan values rathe
+0000a2a0: 7220 7468 616e 206e 702e 696e 6620 7661  r than np.inf va
+0000a2b0: 6c75 6573 0d0a 2020 2020 2320 436f 6e76  lues..    # Conv
+0000a2c0: 6572 7420 6e61 6e20 746f 2069 6e66 206f  ert nan to inf o
+0000a2d0: 6e6c 7920 6966 2069 6e66 696e 6974 6520  nly if infinite 
+0000a2e0: 7661 6c75 6573 2061 7265 2069 6e63 6c75  values are inclu
+0000a2f0: 6465 6420 696e 2074 6865 206d 6561 6e0d  ded in the mean.
+0000a300: 0a20 2020 2072 6967 6874 5b72 6967 6874  .    right[right
+0000a310: 5f62 6f75 6e64 5f63 6f6c 5d20 3d20 6e70  _bound_col] = np
+0000a320: 2e77 6865 7265 2872 6967 6874 5b27 5f5f  .where(right['__
+0000a330: 4d61 7869 6d75 6d5f 5f27 5d20 3d3d 206e  Maximum__'] == n
+0000a340: 702e 696e 662c 206e 702e 696e 662c 2072  p.inf, np.inf, r
+0000a350: 6967 6874 5b72 6967 6874 5f62 6f75 6e64  ight[right_bound
+0000a360: 5f63 6f6c 5d29 0d0a 2020 2020 0d0a 2020  _col])..    ..  
+0000a370: 2020 2320 4d65 7267 6520 7468 6520 7477    # Merge the tw
+0000a380: 6f20 626f 756e 6461 7269 6573 2074 6f20  o boundaries to 
+0000a390: 6372 6561 7465 2074 6865 2069 6e74 6572  create the inter
+0000a3a0: 7661 6c20 666f 7220 7468 6520 7065 7263  val for the perc
+0000a3b0: 656e 7469 6c65 0d0a 2020 2020 2320 4368  entile..    # Ch
+0000a3c0: 6563 6b20 7468 6174 2074 6865 206d 6572  eck that the mer
+0000a3d0: 6765 2069 7320 312d 746f 2d31 0d0a 2020  ge is 1-to-1..  
+0000a3e0: 2020 6466 203d 206c 6566 742e 6d65 7267    df = left.merg
+0000a3f0: 6528 7269 6768 742c 2068 6f77 203d 2027  e(right, how = '
+0000a400: 6f75 7465 7227 2c20 6f6e 203d 2067 726f  outer', on = gro
+0000a410: 7570 6279 5f63 6f6c 732c 2076 616c 6964  upby_cols, valid
+0000a420: 6174 6520 3d20 2731 3a31 2729 0d0a 2020  ate = '1:1')..  
+0000a430: 2020 0d0a 2020 2020 2320 5265 7365 7420    ..    # Reset 
+0000a440: 696e 6465 780d 0a20 2020 2064 6620 3d20  index..    df = 
+0000a450: 6466 2e72 6573 6574 5f69 6e64 6578 2829  df.reset_index()
+0000a460: 0d0a 2020 2020 0d0a 2020 2020 7265 7475  ..    ..    retu
+0000a470: 726e 2064 660d 0a0d 0a64 6566 2070 6572  rn df....def per
+0000a480: 6365 6e74 696c 6528 6466 2c0d 0a20 2020  centile(df,..   
+0000a490: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0000a4a0: 6c74 735f 636f 6c2c 0d0a 2020 2020 2020  lts_col,..      
+0000a4b0: 2020 2020 2020 2020 2070 6572 6365 6e74           percent
+0000a4c0: 696c 652c 0d0a 2020 2020 2020 2020 2020  ile,..          
+0000a4d0: 2020 2020 206d 6574 686f 6420 3d20 2768       method = 'h
+0000a4e0: 617a 656e 272c 0d0a 2020 2020 2020 2020  azen',..        
+0000a4f0: 2020 2020 2020 2067 726f 7570 6279 5f63         groupby_c
+0000a500: 6f6c 7320 3d20 4e6f 6e65 2c0d 0a20 2020  ols = None,..   
+0000a510: 2020 2020 2020 2020 2020 2020 666f 6375              focu
+0000a520: 735f 6869 6768 5f70 6f74 656e 7469 616c  s_high_potential
+0000a530: 203d 2054 7275 652c 0d0a 2020 2020 2020   = True,..      
+0000a540: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+0000a550: 5f6e 6567 6174 6976 655f 696e 7465 7276  _negative_interv
+0000a560: 616c 203d 2046 616c 7365 2c0d 0a20 2020  al = False,..   
+0000a570: 2020 2020 2020 2020 2020 2020 7072 6563              prec
+0000a580: 6973 696f 6e5f 746f 6c65 7261 6e63 655f  ision_tolerance_
+0000a590: 746f 5f64 726f 705f 6365 6e73 6f72 203d  to_drop_censor =
+0000a5a0: 2030 2e32 352c 0d0a 2020 2020 2020 2020   0.25,..        
+0000a5b0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+0000a5c0: 5f72 6f75 6e64 696e 6720 3d20 5472 7565  _rounding = True
+0000a5d0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
+0000a5e0: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
+0000a5f0: 2063 6f6d 6269 6e65 7320 7468 6520 7265   combines the re
+0000a600: 6c65 7661 6e74 2070 6572 6365 6e74 696c  levant percentil
+0000a610: 6520 616e 6420 7574 696c 6974 7920 6675  e and utility fu
+0000a620: 6e63 7469 6f6e 7320 746f 0d0a 2020 2020  nctions to..    
+0000a630: 6765 6e65 7261 7465 2074 6865 2070 6572  generate the per
+0000a640: 6365 6e69 746c 6520 7265 7375 6c74 7320  cenitle results 
+0000a650: 666f 7220 6772 6f75 7073 2077 6974 6869  for groups withi
+0000a660: 6e20 6120 4461 7461 4672 616d 652e 0d0a  n a DataFrame...
+0000a670: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+0000a680: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  ..    ----------
+0000a690: 0d0a 2020 2020 6466 203a 2044 6174 6146  ..    df : DataF
+0000a6a0: 7261 6d65 0d0a 2020 2020 2020 2020 4461  rame..        Da
+0000a6b0: 7461 4672 616d 6520 7468 6174 2063 6f6e  taFrame that con
+0000a6c0: 7461 696e 7320 6365 6e73 6f72 6564 206f  tains censored o
+0000a6d0: 7220 756e 6365 6e73 6f72 6564 2072 6573  r uncensored res
+0000a6e0: 756c 7473 0d0a 2020 2020 7265 7375 6c74  ults..    result
+0000a6f0: 735f 636f 6c20 3a20 7374 7269 6e67 0d0a  s_col : string..
+0000a700: 2020 2020 2020 2020 5468 6520 636f 6c75          The colu
+0000a710: 6d6e 206e 616d 6520 666f 7220 7468 6520  mn name for the 
+0000a720: 636f 6c75 6d6e 2074 6861 7420 636f 6e74  column that cont
+0000a730: 6169 6e20 7468 6520 7265 7375 6c74 7320  ain the results 
+0000a740: 6173 2074 6578 742e 0d0a 2020 2020 2020  as text...      
+0000a750: 2020 4f6e 6c79 2066 6f75 7220 706f 7373    Only four poss
+0000a760: 6962 6c65 2063 656e 736f 7273 2073 686f  ible censors sho
+0000a770: 756c 6420 6265 2075 7365 6420 283c 2ce2  uld be used (<,.
+0000a780: 89a4 2ce2 89a5 2c3e 292e 0d0a 2020 2020  ..,...,>)...    
+0000a790: 7065 7263 656e 7469 6c65 203a 2066 6c6f  percentile : flo
+0000a7a0: 6174 0d0a 2020 2020 2020 2020 5468 6520  at..        The 
+0000a7b0: 6465 7369 7265 6420 7065 7263 656e 7469  desired percenti
+0000a7c0: 6c65 2e20 5661 6c75 6573 2073 686f 756c  le. Values shoul
+0000a7d0: 6420 6265 2062 6574 7765 656e 2030 2061  d be between 0 a
+0000a7e0: 6e64 2031 3030 2e0d 0a20 2020 206d 6574  nd 100...    met
+0000a7f0: 686f 6420 3a20 7374 7269 6e67 0d0a 2020  hod : string..  
+0000a800: 2020 2020 2020 5468 6520 7065 7263 656e        The percen
+0000a810: 7469 6c65 206d 6574 686f 642e 2054 6865  tile method. The
+0000a820: 206f 7074 696f 6e73 2061 6e64 2064 6566   options and def
+0000a830: 696e 6974 696f 6e73 2063 6f6d 6520 6672  initions come fr
+0000a840: 6f6d 3a0d 0a20 2020 2020 2020 2020 2020  om:..           
+0000a850: 2068 7474 7073 3a2f 2f65 6e76 6972 6f6e   https://environ
+0000a860: 6d65 6e74 2e67 6f76 742e 6e7a 2f61 7373  ment.govt.nz/ass
+0000a870: 6574 732f 5075 626c 6963 6174 696f 6e73  ets/Publications
+0000a880: 2f46 696c 6573 2f68 617a 656e 2d70 6572  /Files/hazen-per
+0000a890: 6365 6e74 696c 652d 6361 6c63 756c 6174  centile-calculat
+0000a8a0: 6f72 2d32 2e78 6c73 0d0a 2020 2020 2020  or-2.xls..      
+0000a8b0: 2020 2020 2020 4f70 7469 6f6e 7320 696e        Options in
+0000a8c0: 636c 7564 6520 7468 6520 666f 6c6c 6f77  clude the follow
+0000a8d0: 696e 672c 206f 7264 6572 6564 2066 726f  ing, ordered fro
+0000a8e0: 6d20 6c61 7267 6573 7420 746f 2073 6d61  m largest to sma
+0000a8f0: 6c6c 6573 7420 7265 7375 6c74 2e0d 0a20  llest result... 
+0000a900: 2020 2020 2020 2020 2020 202d 2077 6569             - wei
+0000a910: 6261 6c6c 0d0a 2020 2020 2020 2020 2020  ball..          
+0000a920: 2020 2d20 7475 6b65 790d 0a20 2020 2020    - tukey..     
+0000a930: 2020 2020 2020 202d 2062 6c6f 6d0d 0a20         - blom.. 
+0000a940: 2020 2020 2020 2020 2020 202d 2068 617a             - haz
+0000a950: 656e 0d0a 2020 2020 2020 2020 2020 2020  en..            
+0000a960: 2d20 6578 6365 6c0d 0a20 2020 2020 2020  - excel..       
+0000a970: 2054 6865 2064 6566 6175 6c74 2069 7320   The default is 
+0000a980: 6861 7a65 6e2e 0d0a 2020 2020 6772 6f75  hazen...    grou
+0000a990: 7062 795f 636f 6c73 203a 206c 6973 7473  pby_cols : lists
+0000a9a0: 206f 6620 7374 7269 6e67 7320 286f 7220   of strings (or 
+0000a9b0: 6c69 7374 206f 6620 6c69 7374 7329 2c20  list of lists), 
+0000a9c0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+0000a9d0: 2020 4c69 7374 206f 6620 636f 6c75 6d6e    List of column
+0000a9e0: 206e 616d 6573 2074 6861 7420 7368 6f75   names that shou
+0000a9f0: 6c64 2062 6520 7573 6564 2074 6f20 6372  ld be used to cr
+0000aa00: 6561 7465 2067 726f 7570 732e 2041 2070  eate groups. A p
+0000aa10: 6572 6365 6e74 696c 650d 0a20 2020 2020  ercentile..     
+0000aa20: 2020 2077 696c 6c20 6265 2066 6f75 6e64     will be found
+0000aa30: 2077 6974 6869 6e20 6561 6368 2067 726f   within each gro
+0000aa40: 7570 2e20 4d75 6c74 6970 6c65 206c 6973  up. Multiple lis
+0000aa50: 7473 2063 616e 2062 6520 7375 7070 6c69  ts can be suppli
+0000aa60: 6564 2074 6f0d 0a20 2020 2020 2020 2070  ed to..        p
+0000aa70: 6572 666f 726d 2073 6571 7565 6e74 6961  erform sequentia
+0000aa80: 6c20 6d65 6469 616e 2070 6572 6365 6e74  l median percent
+0000aa90: 696c 6573 2062 6566 6f72 6520 6361 6c63  iles before calc
+0000aaa0: 756c 6174 696e 6720 6120 7065 7263 656e  ulating a percen
+0000aab0: 7469 6c65 0d0a 2020 2020 2020 2020 6f76  tile..        ov
+0000aac0: 6572 2074 6865 2066 696e 616c 2067 726f  er the final gro
+0000aad0: 7570 696e 672e 0d0a 2020 2020 2020 2020  uping...        
+0000aae0: 5468 6520 6465 6661 756c 7420 6973 204e  The default is N
+0000aaf0: 6f6e 652e 0d0a 2020 2020 666f 6375 735f  one...    focus_
+0000ab00: 6869 6768 5f70 6f74 656e 7469 616c 203a  high_potential :
+0000ab10: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
+0000ab20: 616c 0d0a 2020 2020 2020 2020 4966 2054  al..        If T
+0000ab30: 7275 652c 2074 6865 6e20 696e 666f 726d  rue, then inform
+0000ab40: 6174 696f 6e20 6f6e 2074 6865 2068 6967  ation on the hig
+0000ab50: 6865 7374 2070 6f74 656e 7469 616c 2072  hest potential r
+0000ab60: 6573 756c 7420 7769 6c6c 2062 650d 0a20  esult will be.. 
+0000ab70: 2020 2020 2020 2066 6f63 7573 6564 206f         focused o
+0000ab80: 7665 7220 7468 6520 6c6f 7765 7374 2070  ver the lowest p
+0000ab90: 6f74 656e 7469 616c 2072 6573 756c 742e  otential result.
+0000aba0: 0d0a 2020 2020 696e 636c 7564 655f 6e65  ..    include_ne
+0000abb0: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
+0000abc0: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
+0000abd0: 6e61 6c0d 0a20 2020 2020 2020 2049 6620  nal..        If 
+0000abe0: 5472 7565 2c20 7468 656e 2061 6c6c 2070  True, then all p
+0000abf0: 6f73 6974 6976 6520 616e 6420 6e65 6761  ositive and nega
+0000ac00: 7469 7665 2076 616c 7565 7320 6172 6520  tive values are 
+0000ac10: 636f 6e73 6964 6572 6564 0d0a 2020 2020  considered..    
+0000ac20: 2020 2020 652e 672e 2c20 3c30 2e35 2077      e.g., <0.5 w
+0000ac30: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
+0000ac40: 6420 746f 2028 2d6e 702e 696e 662c 3529  d to (-np.inf,5)
+0000ac50: 2e0d 0a20 2020 2020 2020 2049 6620 4661  ...        If Fa
+0000ac60: 6c73 652c 2074 6865 6e20 6f6e 6c79 206e  lse, then only n
+0000ac70: 6f6e 2d6e 6567 6174 6976 6520 7661 6c75  on-negative valu
+0000ac80: 6573 2061 7265 2063 6f6e 7369 6465 7265  es are considere
+0000ac90: 640d 0a20 2020 2020 2020 2065 2e67 2e2c  d..        e.g.,
+0000aca0: 203c 302e 3520 776f 756c 6420 6265 2063   <0.5 would be c
+0000acb0: 6f6e 7665 7274 6564 2074 6f20 5b30 2c35  onverted to [0,5
+0000acc0: 292e 0d0a 2020 2020 2020 2020 5468 6973  )...        This
+0000acd0: 2073 6574 7469 6e67 206f 6e6c 7920 6166   setting only af
+0000ace0: 6665 6374 7320 7265 7375 6c74 7320 6966  fects results if
+0000acf0: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
+0000ad00: 6e74 6961 6c20 6973 2046 616c 7365 2e0d  ntial is False..
+0000ad10: 0a20 2020 2020 2020 2054 6865 2064 6566  .        The def
+0000ad20: 6175 6c74 2069 7320 4661 6c73 652e 0d0a  ault is False...
+0000ad30: 2020 2020 7072 6563 6973 696f 6e5f 746f      precision_to
+0000ad40: 6c65 7261 6e63 655f 746f 5f64 726f 705f  lerance_to_drop_
+0000ad50: 6365 6e73 6f72 203a 2066 6c6f 6174 2c20  censor : float, 
+0000ad60: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+0000ad70: 2020 5468 7265 7368 6f6c 6420 666f 7220    Threshold for 
+0000ad80: 7265 706f 7274 696e 6720 6365 6e73 6f72  reporting censor
+0000ad90: 6564 2076 7320 6e6f 6e2d 6365 6e73 6f72  ed vs non-censor
+0000ada0: 6564 2072 6573 756c 7473 2e0d 0a20 2020  ed results...   
+0000adb0: 2020 2020 2055 7369 6e67 2074 6865 2064       Using the d
+0000adc0: 6566 6175 6c74 2c20 6120 7265 7375 6c74  efault, a result
+0000add0: 2074 6861 7420 6973 206b 6e6f 776e 2074   that is known t
+0000ade0: 6f20 6265 2069 6e20 7468 6520 696e 7465  o be in the inte
+0000adf0: 7276 616c 2028 302e 332c 2030 2e35 290d  rval (0.3, 0.5).
+0000ae00: 0a20 2020 2020 2020 2077 6f75 6c64 2062  .        would b
+0000ae10: 6520 7265 7475 726e 6564 2061 7320 302e  e returned as 0.
+0000ae20: 342c 2077 6865 7265 6173 2061 2074 6f6c  4, whereas a tol
+0000ae30: 6572 616e 6365 206f 6620 3020 776f 756c  erance of 0 woul
+0000ae40: 6420 7969 656c 6420 610d 0a20 2020 2020  d yield a..     
+0000ae50: 2020 2072 6573 756c 7420 6f66 203c 302e     result of <0.
+0000ae60: 3520 6f72 203e 302e 3320 6465 7065 6e64  5 or >0.3 depend
+0000ae70: 696e 6720 6f6e 2074 6865 2076 616c 7565  ing on the value
+0000ae80: 206f 6620 666f 6375 735f 6869 6768 6573   of focus_highes
+0000ae90: 745f 706f 7465 6e74 6961 6c2e 0d0a 2020  t_potential...  
+0000aea0: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
+0000aeb0: 7420 6973 2030 2e32 352e 0d0a 2020 2020  t is 0.25...    
+0000aec0: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
+0000aed0: 6e67 203a 2062 6f6f 6c65 616e 2c20 6f70  ng : boolean, op
+0000aee0: 7469 6f6e 616c 0d0a 2020 2020 2020 2020  tional..        
+0000aef0: 4966 2054 7275 652c 2061 2072 6f75 6e64  If True, a round
+0000af00: 696e 6720 6d65 7468 6f64 2069 7320 6170  ing method is ap
+0000af10: 706c 6965 6420 746f 2072 6f75 6e64 2072  plied to round r
+0000af20: 6573 756c 7473 2074 6f20 6861 7665 206e  esults to have n
+0000af30: 6f20 6d6f 7265 0d0a 2020 2020 2020 2020  o more..        
+0000af40: 6465 6369 6d61 6c73 2074 6861 6e20 7768  decimals than wh
+0000af50: 6174 2063 616e 2062 6520 6d65 6173 7572  at can be measur
+0000af60: 6564 2e0d 0a20 2020 2020 2020 2054 6865  ed...        The
+0000af70: 2064 6566 6175 6c74 2069 7320 5472 7565   default is True
+0000af80: 2e0d 0a0d 0a20 2020 2052 6574 7572 6e73  .....    Returns
+0000af90: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20  ..    -------.. 
+0000afa0: 2020 2064 6620 3a20 4461 7461 4672 616d     df : DataFram
+0000afb0: 650d 0a20 2020 2020 2020 2044 6174 6146  e..        DataF
+0000afc0: 7261 6d65 2074 6861 7420 636f 6e74 6169  rame that contai
+0000afd0: 6e73 2063 616c 6375 6c61 7465 6420 7065  ns calculated pe
+0000afe0: 7263 656e 7469 6c65 730d 0a0d 0a20 2020  rcentiles....   
+0000aff0: 2027 2727 0d0a 2020 2020 0d0a 2020 2020   '''..    ..    
+0000b000: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
+0000b010: 6f66 2074 6865 2044 6174 6146 7261 6d65  of the DataFrame
+0000b020: 0d0a 2020 2020 6466 203d 2064 662e 636f  ..    df = df.co
+0000b030: 7079 2829 0d0a 2020 2020 0d0a 2020 2020  py()..    ..    
+0000b040: 2320 5370 6c69 7420 7468 6520 7265 7375  # Split the resu
+0000b050: 6c74 2069 6e74 6f20 6365 6e73 6f72 2061  lt into censor a
+0000b060: 6e64 206e 756d 6572 6963 2063 6f6d 706f  nd numeric compo
+0000b070: 6e65 6e74 730d 0a20 2020 2064 6620 3d20  nents..    df = 
+0000b080: 7265 7375 6c74 5f74 6f5f 636f 6d70 6f6e  result_to_compon
+0000b090: 656e 7473 2864 662c 7265 7375 6c74 735f  ents(df,results_
+0000b0a0: 636f 6c29 0d0a 2020 2020 0d0a 2020 2020  col)..    ..    
+0000b0b0: 2320 436f 6e76 6572 7420 7468 6520 7265  # Convert the re
+0000b0c0: 7375 6c74 7320 6672 6f6d 2063 656e 736f  sults from censo
+0000b0d0: 7220 616e 6420 6e75 6d65 7269 6320 636f  r and numeric co
+0000b0e0: 6d70 6f6e 656e 7473 2074 6f20 616e 2069  mponents to an i
+0000b0f0: 6e74 6572 7661 6c20 7265 7072 6573 656e  nterval represen
+0000b100: 7461 7469 6f6e 0d0a 2020 2020 6466 203d  tation..    df =
+0000b110: 2063 6f6d 706f 6e65 6e74 735f 746f 5f69   components_to_i
+0000b120: 6e74 6572 7661 6c28 6466 2c20 696e 636c  nterval(df, incl
+0000b130: 7564 655f 6e65 6761 7469 7665 5f69 6e74  ude_negative_int
+0000b140: 6572 7661 6c29 0d0a 2020 2020 0d0a 2020  erval)..    ..  
+0000b150: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
+0000b160: 7465 7276 616c 732c 2064 6574 6572 6d69  tervals, determi
+0000b170: 6e65 2074 6865 2072 616e 6765 206f 6620  ne the range of 
+0000b180: 706f 7373 6962 6c65 2070 6572 6365 6e74  possible percent
+0000b190: 696c 6573 0d0a 2020 2020 0d0a 2020 2020  iles..    ..    
+0000b1a0: 2320 4966 2074 6865 7265 2061 7265 206e  # If there are n
+0000b1b0: 6f20 6772 6f75 7062 792d 636f 6c75 6d6e  o groupby-column
+0000b1c0: 732c 2074 6865 6e20 7461 6b65 2070 6572  s, then take per
+0000b1d0: 6365 6e74 696c 6520 6f66 2061 6c6c 2072  centile of all r
+0000b1e0: 6573 756c 7473 0d0a 2020 2020 6966 206e  esults..    if n
+0000b1f0: 6f74 2067 726f 7570 6279 5f63 6f6c 733a  ot groupby_cols:
+0000b200: 0d0a 2020 2020 2020 2020 6466 203d 2070  ..        df = p
+0000b210: 6572 6365 6e74 696c 655f 696e 7465 7276  ercentile_interv
+0000b220: 616c 2864 662c 2067 726f 7570 6279 5f63  al(df, groupby_c
+0000b230: 6f6c 733d 5b5d 2c0d 0a20 2020 2020 2020  ols=[],..       
+0000b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b250: 2020 2020 2020 2020 2020 7065 7263 656e            percen
+0000b260: 7469 6c65 3d70 6572 6365 6e74 696c 652c  tile=percentile,
+0000b270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b290: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+0000b2a0: 290d 0a20 2020 2023 2049 6620 7468 6520  )..    # If the 
+0000b2b0: 6772 6f75 7062 795f 636f 6c73 2069 7320  groupby_cols is 
+0000b2c0: 6120 6c69 7374 206f 6620 6c69 7374 732c  a list of lists,
+0000b2d0: 2074 6865 6e20 7065 7266 6f72 6d20 6d75   then perform mu
+0000b2e0: 6c74 6970 6c65 2070 6572 6365 6e74 696c  ltiple percentil
+0000b2f0: 6573 0d0a 2020 2020 656c 6966 2069 7369  es..    elif isi
+0000b300: 6e73 7461 6e63 6528 6772 6f75 7062 795f  nstance(groupby_
+0000b310: 636f 6c73 5b30 5d2c 6c69 7374 293a 0d0a  cols[0],list):..
+0000b320: 2020 2020 2020 2020 666f 7220 6772 6f75          for grou
+0000b330: 7069 6e67 2069 6e20 6772 6f75 7062 795f  ping in groupby_
+0000b340: 636f 6c73 3a0d 0a20 2020 2020 2020 2020  cols:..         
+0000b350: 2020 2023 204f 6e6c 7920 6170 706c 7920     # Only apply 
+0000b360: 7065 7263 656e 7469 6c65 2074 6f20 6669  percentile to fi
+0000b370: 6e61 6c20 6772 6f75 7069 6e67 0d0a 2020  nal grouping..  
+0000b380: 2020 2020 2020 2020 2020 6966 2067 726f            if gro
+0000b390: 7570 696e 6720 3d3d 2067 726f 7570 6279  uping == groupby
+0000b3a0: 5f63 6f6c 735b 2d31 5d3a 0d0a 2020 2020  _cols[-1]:..    
+0000b3b0: 2020 2020 2020 2020 2020 2020 2320 5573              # Us
+0000b3c0: 696e 6720 7468 6520 696e 7465 7276 616c  ing the interval
+0000b3d0: 732c 2064 6574 6572 6d69 6e65 2074 6865  s, determine the
+0000b3e0: 2072 616e 6765 206f 6620 706f 7373 6962   range of possib
+0000b3f0: 6c65 2070 6572 6365 6e74 696c 6573 0d0a  le percentiles..
+0000b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b410: 6466 203d 2070 6572 6365 6e74 696c 655f  df = percentile_
+0000b420: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
+0000b430: 7570 696e 672c 2070 6572 6365 6e74 696c  uping, percentil
+0000b440: 652c 206d 6574 686f 6429 0d0a 2020 2020  e, method)..    
+0000b450: 2020 2020 2020 2020 2320 4170 706c 7920          # Apply 
+0000b460: 6d65 6469 616e 2074 6f20 616c 6c20 7072  median to all pr
+0000b470: 696f 7220 6772 6f75 7069 6e67 730d 0a20  ior groupings.. 
+0000b480: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000b490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b4a0: 2020 2320 5573 696e 6720 7468 6520 696e    # Using the in
+0000b4b0: 7465 7276 616c 732c 2064 6574 6572 6d69  tervals, determi
+0000b4c0: 6e65 2074 6865 2072 616e 6765 206f 6620  ne the range of 
+0000b4d0: 706f 7373 6962 6c65 206d 6564 6961 6e73  possible medians
+0000b4e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b4f0: 2020 6466 203d 2070 6572 6365 6e74 696c    df = percentil
+0000b500: 655f 696e 7465 7276 616c 2864 662c 2067  e_interval(df, g
+0000b510: 726f 7570 696e 672c 2035 302c 206d 6574  rouping, 50, met
+0000b520: 686f 6429 0d0a 2020 2020 2320 456c 7365  hod)..    # Else
+0000b530: 2074 6865 2067 726f 7570 6279 5f63 6f6c   the groupby_col
+0000b540: 7320 6973 2061 206c 6973 7420 6f66 2063  s is a list of c
+0000b550: 6f6c 756d 6e20 6e61 6d65 730d 0a20 2020  olumn names..   
+0000b560: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000b570: 6466 203d 2070 6572 6365 6e74 696c 655f  df = percentile_
+0000b580: 696e 7465 7276 616c 2864 662c 2067 726f  interval(df, gro
+0000b590: 7570 6279 5f63 6f6c 732c 2070 6572 6365  upby_cols, perce
+0000b5a0: 6e74 696c 652c 206d 6574 686f 6429 0d0a  ntile, method)..
+0000b5b0: 2020 2020 0d0a 2020 2020 2320 436f 6e76      ..    # Conv
+0000b5c0: 6572 7420 7468 6520 696e 7465 7276 616c  ert the interval
+0000b5d0: 2066 6f72 2074 6865 206d 696e 696d 756d   for the minimum
+0000b5e0: 2069 6e74 6f20 6365 6e73 6f72 2061 6e64   into censor and
+0000b5f0: 206e 756d 6572 6963 206e 6f74 6174 696f   numeric notatio
+0000b600: 6e0d 0a20 2020 2064 6620 3d20 696e 7465  n..    df = inte
+0000b610: 7276 616c 5f74 6f5f 636f 6d70 6f6e 656e  rval_to_componen
+0000b620: 7473 2864 662c 0d0a 2020 2020 2020 2020  ts(df,..        
+0000b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b640: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
+0000b650: 6768 5f70 6f74 656e 7469 616c 203d 2066  gh_potential = f
+0000b660: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
+0000b670: 6961 6c2c 0d0a 2020 2020 2020 2020 2020  ial,..          
+0000b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b690: 2020 2020 2020 696e 636c 7564 655f 6e65        include_ne
+0000b6a0: 6761 7469 7665 5f69 6e74 6572 7661 6c20  gative_interval 
+0000b6b0: 3d20 696e 636c 7564 655f 6e65 6761 7469  = include_negati
+0000b6c0: 7665 5f69 6e74 6572 7661 6c2c 0d0a 2020  ve_interval,..  
+0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000b6f0: 6563 6973 696f 6e5f 746f 6c65 7261 6e63  ecision_toleranc
+0000b700: 655f 746f 5f64 726f 705f 6365 6e73 6f72  e_to_drop_censor
+0000b710: 203d 2070 7265 6369 7369 6f6e 5f74 6f6c   = precision_tol
+0000b720: 6572 616e 6365 5f74 6f5f 6472 6f70 5f63  erance_to_drop_c
+0000b730: 656e 736f 7229 0d0a 2020 2020 0d0a 2020  ensor)..    ..  
+0000b740: 2020 2320 4372 6561 7465 2069 6e74 6572    # Create inter
+0000b750: 7661 6c20 6e6f 7461 7469 6f6e 2066 6f72  val notation for
+0000b760: 2074 6865 2070 6572 6365 6e74 696c 650d   the percentile.
+0000b770: 0a20 2020 2064 6620 3d20 696e 7465 7276  .    df = interv
+0000b780: 616c 5f6e 6f74 6174 696f 6e28 6466 2c20  al_notation(df, 
+0000b790: 7072 6563 6973 696f 6e5f 726f 756e 6469  precision_roundi
+0000b7a0: 6e67 290d 0a20 2020 200d 0a20 2020 2023  ng)..    ..    #
+0000b7b0: 2043 6f6d 6269 6e65 2074 6865 2063 656e   Combine the cen
+0000b7c0: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
+0000b7d0: 636f 6d70 6f6e 656e 7473 2069 6e74 6f20  components into 
+0000b7e0: 6120 7265 7375 6c74 0d0a 2020 2020 6466  a result..    df
+0000b7f0: 203d 2063 6f6d 706f 6e65 6e74 735f 746f   = components_to
+0000b800: 5f72 6573 756c 7428 6466 2c20 7072 6563  _result(df, prec
+0000b810: 6973 696f 6e5f 726f 756e 6469 6e67 290d  ision_rounding).
+0000b820: 0a20 2020 200d 0a20 2020 2023 2044 726f  .    ..    # Dro
+0000b830: 7020 776f 726b 696e 6720 636f 6c75 6d6e  p working column
+0000b840: 730d 0a20 2020 2064 6620 3d20 6466 2e64  s..    df = df.d
+0000b850: 726f 7028 6466 2e66 696c 7465 7228 7265  rop(df.filter(re
+0000b860: 6765 783d 275f 5f27 292e 636f 6c75 6d6e  gex='__').column
+0000b870: 732c 2061 7869 733d 3129 0d0a 2020 2020  s, axis=1)..    
+0000b880: 0d0a 2020 2020 2320 5265 6f72 6465 7220  ..    # Reorder 
+0000b890: 636f 6c75 6d6e 730d 0a20 2020 2066 6f72  columns..    for
+0000b8a0: 2063 6f6c 2069 6e20 5b73 7461 745f 636f   col in [stat_co
+0000b8b0: 6c2c 7265 7375 6c74 5f63 6f6c 2c63 656e  l,result_col,cen
+0000b8c0: 736f 725f 636f 6c2c 6e75 6d65 7269 635f  sor_col,numeric_
+0000b8d0: 636f 6c2c 696e 7465 7276 616c 5f63 6f6c  col,interval_col
+0000b8e0: 5d3a 0d0a 2020 2020 2020 2020 6466 5b63  ]:..        df[c
+0000b8f0: 6f6c 5d20 3d20 6466 2e70 6f70 2863 6f6c  ol] = df.pop(col
+0000b900: 290d 0a20 2020 200d 0a20 2020 2072 6574  )..    ..    ret
+0000b910: 7572 6e20 6466 0d0a 0d0a 6465 6620 6d65  urn df....def me
+0000b920: 6469 616e 2864 662c 0d0a 2020 2020 2020  dian(df,..      
+0000b930: 2020 2020 2072 6573 756c 7473 5f63 6f6c       results_col
+0000b940: 2c0d 0a20 2020 2020 2020 2020 2020 6772  ,..           gr
+0000b950: 6f75 7062 795f 636f 6c73 203d 204e 6f6e  oupby_cols = Non
+0000b960: 652c 0d0a 2020 2020 2020 2020 2020 2066  e,..           f
+0000b970: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
+0000b980: 6961 6c20 3d20 5472 7565 2c0d 0a20 2020  ial = True,..   
+0000b990: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+0000b9a0: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
+0000b9b0: 6c20 3d20 4661 6c73 652c 0d0a 2020 2020  l = False,..    
+0000b9c0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+0000b9d0: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
+0000b9e0: 6f70 5f63 656e 736f 7220 3d20 302e 3235  op_censor = 0.25
+0000b9f0: 2c0d 0a20 2020 2020 2020 2020 2020 7072  ,..           pr
+0000ba00: 6563 6973 696f 6e5f 726f 756e 6469 6e67  ecision_rounding
+0000ba10: 203d 2054 7275 6529 3a0d 0a20 2020 2027   = True):..    '
+0000ba20: 2727 0d0a 2020 2020 4120 6675 6e63 7469  ''..    A functi
+0000ba30: 6f6e 2074 6861 7420 6765 6e65 7261 7465  on that generate
+0000ba40: 7320 6d65 6469 616e 2072 6573 756c 7473  s median results
+0000ba50: 2066 6f72 2067 726f 7570 7320 7769 7468   for groups with
+0000ba60: 696e 2061 2044 6174 6146 7261 6d65 2e0d  in a DataFrame..
+0000ba70: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+0000ba80: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
+0000ba90: 2d0d 0a20 2020 2064 6620 3a20 4461 7461  -..    df : Data
+0000baa0: 4672 616d 650d 0a20 2020 2020 2020 2044  Frame..        D
+0000bab0: 6174 6146 7261 6d65 2074 6861 7420 636f  ataFrame that co
+0000bac0: 6e74 6169 6e73 2063 656e 736f 7265 6420  ntains censored 
+0000bad0: 6f72 2075 6e63 656e 736f 7265 6420 7265  or uncensored re
+0000bae0: 7375 6c74 730d 0a20 2020 2072 6573 756c  sults..    resul
+0000baf0: 7473 5f63 6f6c 203a 2073 7472 696e 670d  ts_col : string.
+0000bb00: 0a20 2020 2020 2020 2054 6865 2063 6f6c  .        The col
+0000bb10: 756d 6e20 6e61 6d65 2066 6f72 2074 6865  umn name for the
+0000bb20: 2063 6f6c 756d 6e20 7468 6174 2063 6f6e   column that con
+0000bb30: 7461 696e 2074 6865 2072 6573 756c 7473  tain the results
+0000bb40: 2061 7320 7465 7874 2e0d 0a20 2020 2020   as text...     
+0000bb50: 2020 204f 6e6c 7920 666f 7572 2070 6f73     Only four pos
+0000bb60: 7369 626c 6520 6365 6e73 6f72 7320 7368  sible censors sh
+0000bb70: 6f75 6c64 2062 6520 7573 6564 2028 3c2c  ould be used (<,
+0000bb80: e289 a42c e289 a52c 3e29 2e0d 0a20 2020  ...,...,>)...   
+0000bb90: 2067 726f 7570 6279 5f63 6f6c 7320 3a20   groupby_cols : 
+0000bba0: 6c69 7374 7320 6f66 2073 7472 696e 6773  lists of strings
+0000bbb0: 2028 6f72 206c 6973 7420 6f66 206c 6973   (or list of lis
+0000bbc0: 7473 292c 206f 7074 696f 6e61 6c0d 0a20  ts), optional.. 
+0000bbd0: 2020 2020 2020 204c 6973 7420 6f66 2063         List of c
+0000bbe0: 6f6c 756d 6e20 6e61 6d65 7320 7468 6174  olumn names that
+0000bbf0: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
+0000bc00: 746f 2063 7265 6174 6520 6772 6f75 7073  to create groups
+0000bc10: 2e20 4120 6d65 6469 616e 0d0a 2020 2020  . A median..    
+0000bc20: 2020 2020 7769 6c6c 2062 6520 666f 756e      will be foun
+0000bc30: 6420 7769 7468 696e 2065 6163 6820 6772  d within each gr
+0000bc40: 6f75 702e 204d 756c 7469 706c 6520 6c69  oup. Multiple li
+0000bc50: 7374 7320 6361 6e20 6265 2073 7570 706c  sts can be suppl
+0000bc60: 6965 6420 746f 0d0a 2020 2020 2020 2020  ied to..        
+0000bc70: 7065 7266 6f72 6d20 7365 7175 656e 7469  perform sequenti
+0000bc80: 616c 206d 6564 6961 6e20 7065 7263 656e  al median percen
+0000bc90: 7469 6c65 7320 6265 666f 7265 2063 616c  tiles before cal
+0000bca0: 6375 6c61 7469 6e67 2061 206d 6564 6961  culating a media
+0000bcb0: 6e0d 0a20 2020 2020 2020 206f 7665 7220  n..        over 
+0000bcc0: 7468 6520 6669 6e61 6c20 6772 6f75 7069  the final groupi
+0000bcd0: 6e67 2e0d 0a20 2020 2020 2020 2054 6865  ng...        The
+0000bce0: 2064 6566 6175 6c74 2069 7320 4e6f 6e65   default is None
+0000bcf0: 2e0d 0a20 2020 2066 6f63 7573 5f68 6967  ...    focus_hig
+0000bd00: 685f 706f 7465 6e74 6961 6c20 3a20 626f  h_potential : bo
+0000bd10: 6f6c 6561 6e2c 206f 7074 696f 6e61 6c0d  olean, optional.
+0000bd20: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
+0000bd30: 2c20 7468 656e 2069 6e66 6f72 6d61 7469  , then informati
+0000bd40: 6f6e 206f 6e20 7468 6520 6869 6768 6573  on on the highes
+0000bd50: 7420 706f 7465 6e74 6961 6c20 7265 7375  t potential resu
+0000bd60: 6c74 2077 696c 6c20 6265 0d0a 2020 2020  lt will be..    
+0000bd70: 2020 2020 666f 6375 7365 6420 6f76 6572      focused over
+0000bd80: 2074 6865 206c 6f77 6573 7420 706f 7465   the lowest pote
+0000bd90: 6e74 6961 6c20 7265 7375 6c74 2e0d 0a20  ntial result... 
+0000bda0: 2020 2069 6e63 6c75 6465 5f6e 6567 6174     include_negat
+0000bdb0: 6976 655f 696e 7465 7276 616c 203a 2062  ive_interval : b
+0000bdc0: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
+0000bdd0: 0d0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
+0000bde0: 652c 2074 6865 6e20 616c 6c20 706f 7369  e, then all posi
+0000bdf0: 7469 7665 2061 6e64 206e 6567 6174 6976  tive and negativ
+0000be00: 6520 7661 6c75 6573 2061 7265 2063 6f6e  e values are con
+0000be10: 7369 6465 7265 640d 0a20 2020 2020 2020  sidered..       
+0000be20: 2065 2e67 2e2c 203c 302e 3520 776f 756c   e.g., <0.5 woul
+0000be30: 6420 6265 2063 6f6e 7665 7274 6564 2074  d be converted t
+0000be40: 6f20 282d 6e70 2e69 6e66 2c35 292e 0d0a  o (-np.inf,5)...
+0000be50: 2020 2020 2020 2020 4966 2046 616c 7365          If False
+0000be60: 2c20 7468 656e 206f 6e6c 7920 6e6f 6e2d  , then only non-
+0000be70: 6e65 6761 7469 7665 2076 616c 7565 7320  negative values 
+0000be80: 6172 6520 636f 6e73 6964 6572 6564 0d0a  are considered..
+0000be90: 2020 2020 2020 2020 652e 672e 2c20 3c30          e.g., <0
+0000bea0: 2e35 2077 6f75 6c64 2062 6520 636f 6e76  .5 would be conv
+0000beb0: 6572 7465 6420 746f 205b 302c 3529 2e0d  erted to [0,5)..
+0000bec0: 0a20 2020 2020 2020 2054 6869 7320 7365  .        This se
+0000bed0: 7474 696e 6720 6f6e 6c79 2061 6666 6563  tting only affec
+0000bee0: 7473 2072 6573 756c 7473 2069 6620 666f  ts results if fo
+0000bef0: 6375 735f 6869 6768 5f70 6f74 656e 7469  cus_high_potenti
+0000bf00: 616c 2069 7320 4661 6c73 652e 0d0a 2020  al is False...  
+0000bf10: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
+0000bf20: 7420 6973 2046 616c 7365 2e0d 0a20 2020  t is False...   
+0000bf30: 2070 7265 6369 7369 6f6e 5f74 6f6c 6572   precision_toler
+0000bf40: 616e 6365 5f74 6f5f 6472 6f70 5f63 656e  ance_to_drop_cen
+0000bf50: 736f 7220 3a20 666c 6f61 742c 206f 7074  sor : float, opt
+0000bf60: 696f 6e61 6c0d 0a20 2020 2020 2020 2054  ional..        T
+0000bf70: 6872 6573 686f 6c64 2066 6f72 2072 6570  hreshold for rep
+0000bf80: 6f72 7469 6e67 2063 656e 736f 7265 6420  orting censored 
+0000bf90: 7673 206e 6f6e 2d63 656e 736f 7265 6420  vs non-censored 
+0000bfa0: 7265 7375 6c74 732e 0d0a 2020 2020 2020  results...      
+0000bfb0: 2020 5573 696e 6720 7468 6520 6465 6661    Using the defa
+0000bfc0: 756c 742c 2061 2072 6573 756c 7420 7468  ult, a result th
+0000bfd0: 6174 2069 7320 6b6e 6f77 6e20 746f 2062  at is known to b
+0000bfe0: 6520 696e 2074 6865 2069 6e74 6572 7661  e in the interva
+0000bff0: 6c20 2830 2e33 2c20 302e 3529 0d0a 2020  l (0.3, 0.5)..  
+0000c000: 2020 2020 2020 776f 756c 6420 6265 2072        would be r
+0000c010: 6574 7572 6e65 6420 6173 2030 2e34 2c20  eturned as 0.4, 
+0000c020: 7768 6572 6561 7320 6120 746f 6c65 7261  whereas a tolera
+0000c030: 6e63 6520 6f66 2030 2077 6f75 6c64 2079  nce of 0 would y
+0000c040: 6965 6c64 2061 0d0a 2020 2020 2020 2020  ield a..        
+0000c050: 7265 7375 6c74 206f 6620 3c30 2e35 206f  result of <0.5 o
+0000c060: 7220 3e30 2e33 2064 6570 656e 6469 6e67  r >0.3 depending
+0000c070: 206f 6e20 7468 6520 7661 6c75 6520 6f66   on the value of
+0000c080: 2066 6f63 7573 5f68 6967 6865 7374 5f70   focus_highest_p
+0000c090: 6f74 656e 7469 616c 2e0d 0a20 2020 2020  otential...     
+0000c0a0: 2020 2054 6865 2064 6566 6175 6c74 2069     The default i
+0000c0b0: 7320 302e 3235 2e0d 0a20 2020 2070 7265  s 0.25...    pre
+0000c0c0: 6369 7369 6f6e 5f72 6f75 6e64 696e 6720  cision_rounding 
+0000c0d0: 3a20 626f 6f6c 6561 6e2c 206f 7074 696f  : boolean, optio
+0000c0e0: 6e61 6c0d 0a20 2020 2020 2020 2049 6620  nal..        If 
+0000c0f0: 5472 7565 2c20 6120 726f 756e 6469 6e67  True, a rounding
+0000c100: 206d 6574 686f 6420 6973 2061 7070 6c69   method is appli
+0000c110: 6564 2074 6f20 726f 756e 6420 7265 7375  ed to round resu
+0000c120: 6c74 7320 746f 2068 6176 6520 6e6f 206d  lts to have no m
+0000c130: 6f72 650d 0a20 2020 2020 2020 2064 6563  ore..        dec
+0000c140: 696d 616c 7320 7468 616e 2077 6861 7420  imals than what 
+0000c150: 6361 6e20 6265 206d 6561 7375 7265 642e  can be measured.
+0000c160: 0d0a 2020 2020 2020 2020 5468 6520 6465  ..        The de
+0000c170: 6661 756c 7420 6973 2054 7275 652e 0d0a  fault is True...
+0000c180: 0d0a 2020 2020 5265 7475 726e 730d 0a20  ..    Returns.. 
+0000c190: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+0000c1a0: 6466 203a 2044 6174 6146 7261 6d65 0d0a  df : DataFrame..
+0000c1b0: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
+0000c1c0: 6520 7468 6174 2063 6f6e 7461 696e 7320  e that contains 
+0000c1d0: 6361 6c63 756c 6174 6564 2070 6572 6365  calculated perce
+0000c1e0: 6e74 696c 6573 0d0a 0d0a 2020 2020 2727  ntiles....    ''
+0000c1f0: 270d 0a20 2020 200d 0a20 2020 2023 2043  '..    ..    # C
+0000c200: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
+0000c210: 7468 6520 4461 7461 4672 616d 650d 0a20  the DataFrame.. 
+0000c220: 2020 2064 6620 3d20 6466 2e63 6f70 7928     df = df.copy(
+0000c230: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
+0000c240: 616c 6c20 7065 7263 656e 7469 6c65 2066  all percentile f
+0000c250: 756e 6374 696f 6e20 7769 7468 2070 6572  unction with per
+0000c260: 6365 6e74 696c 6520 3d20 3530 0d0a 2020  centile = 50..  
+0000c270: 2020 6466 203d 2070 6572 6365 6e74 696c    df = percentil
+0000c280: 6528 6466 2c0d 0a20 2020 2020 2020 2020  e(df,..         
+0000c290: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0000c2a0: 7473 5f63 6f6c 2c0d 0a20 2020 2020 2020  ts_col,..       
+0000c2b0: 2020 2020 2020 2020 2020 2020 2035 302c               50,
+0000c2c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c2d0: 2020 2020 2020 6772 6f75 7062 795f 636f        groupby_co
+0000c2e0: 6c73 203d 2067 726f 7570 6279 5f63 6f6c  ls = groupby_col
+0000c2f0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000c300: 2020 2020 2020 2020 666f 6375 735f 6869          focus_hi
+0000c310: 6768 5f70 6f74 656e 7469 616c 203d 2066  gh_potential = f
+0000c320: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
+0000c330: 6961 6c2c 0d0a 2020 2020 2020 2020 2020  ial,..          
+0000c340: 2020 2020 2020 2020 2020 696e 636c 7564            includ
+0000c350: 655f 6e65 6761 7469 7665 5f69 6e74 6572  e_negative_inter
+0000c360: 7661 6c20 3d20 696e 636c 7564 655f 6e65  val = include_ne
+0000c370: 6761 7469 7665 5f69 6e74 6572 7661 6c2c  gative_interval,
+0000c380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c390: 2020 2020 2020 7072 6563 6973 696f 6e5f        precision_
+0000c3a0: 746f 6c65 7261 6e63 655f 746f 5f64 726f  tolerance_to_dro
+0000c3b0: 705f 6365 6e73 6f72 203d 2070 7265 6369  p_censor = preci
+0000c3c0: 7369 6f6e 5f74 6f6c 6572 616e 6365 5f74  sion_tolerance_t
+0000c3d0: 6f5f 6472 6f70 5f63 656e 736f 722c 0d0a  o_drop_censor,..
+0000c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3f0: 2020 2020 7072 6563 6973 696f 6e5f 726f      precision_ro
+0000c400: 756e 6469 6e67 203d 2070 7265 6369 7369  unding = precisi
+0000c410: 6f6e 5f72 6f75 6e64 696e 6729 0d0a 2020  on_rounding)..  
+0000c420: 2020 0d0a 2020 2020 7265 7475 726e 2064    ..    return d
+0000c430: 660d 0a0d 0a23 2525 2050 6572 6365 6e74  f....#%% Percent
+0000c440: 2045 7863 6565 6461 6e63 6520 5265 7375   Exceedance Resu
+0000c450: 6c74 0d0a 0d0a 6465 6620 7065 7263 656e  lt....def percen
+0000c460: 745f 6578 6365 6564 616e 6365 5f61 7373  t_exceedance_ass
+0000c470: 6573 736d 656e 7428 6466 2c0d 0a20 2020  essment(df,..   
+0000c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c490: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000c4a0: 6872 6573 686f 6c64 2c0d 0a20 2020 2020  hreshold,..     
+0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4c0: 2020 2020 2020 2020 2020 2020 2063 6f75               cou
+0000c4d0: 6e74 5f74 6872 6573 686f 6c64 5f61 735f  nt_threshold_as_
+0000c4e0: 6578 6365 6564 616e 6365 3d46 616c 7365  exceedance=False
+0000c4f0: 293a 0d0a 2020 2020 2727 270d 0a20 2020  ):..    '''..   
+0000c500: 2041 2066 756e 6374 696f 6e20 7468 6174   A function that
+0000c510: 2061 6e61 6c79 7365 7320 7468 6520 696e   analyses the in
+0000c520: 7465 7276 616c 206e 6f74 6174 696f 6e20  terval notation 
+0000c530: 666f 726d 206f 6620 7265 7375 6c74 7320  form of results 
+0000c540: 7265 7475 726e 6564 0d0a 2020 2020 6672  returned..    fr
+0000c550: 6f6d 2063 6f6d 706f 6e65 6e74 735f 746f  om components_to
+0000c560: 5f69 6e74 6572 7661 6c20 616e 6420 6465  _interval and de
+0000c570: 7465 726d 696e 6573 2077 6865 7468 6572  termines whether
+0000c580: 2074 6865 2072 6573 756c 7420 6973 2061   the result is a
+0000c590: 6e0d 0a20 2020 2065 7863 6565 6461 6e63  n..    exceedanc
+0000c5a0: 6520 6f72 206e 6f74 2e0d 0a0d 0a20 2020  e or not.....   
+0000c5b0: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+0000c5c0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+0000c5d0: 2064 6620 3a20 4461 7461 4672 616d 650d   df : DataFrame.
+0000c5e0: 0a20 2020 2020 2020 2044 6174 6146 7261  .        DataFra
+0000c5f0: 6d65 2074 6861 7420 636f 6e74 6169 6e73  me that contains
+0000c600: 2072 6573 756c 7473 2069 6e20 6120 7370   results in a sp
+0000c610: 6563 6966 6963 2069 6e74 6572 7661 6c20  ecific interval 
+0000c620: 6e6f 7461 7469 6f6e 2e0d 0a20 2020 2074  notation...    t
+0000c630: 6872 6573 686f 6c64 203a 2066 6c6f 6174  hreshold : float
+0000c640: 0d0a 2020 2020 2020 2020 5468 6520 7468  ..        The th
+0000c650: 7265 7368 6f6c 6420 6f66 2069 6e74 6572  reshold of inter
+0000c660: 6573 742e 0d0a 2020 2020 636f 756e 745f  est...    count_
+0000c670: 7468 7265 7368 6f6c 645f 6173 5f65 7863  threshold_as_exc
+0000c680: 6565 6461 6e63 6520 3a20 626f 6f6c 6561  eedance : boolea
+0000c690: 6e0d 0a20 2020 2020 2020 2053 6574 2061  n..        Set a
+0000c6a0: 7320 5472 7565 2069 6620 7468 6520 7468  s True if the th
+0000c6b0: 7265 7368 6f6c 6420 7661 6c75 6520 7368  reshold value sh
+0000c6c0: 6f75 6c64 2062 6520 636f 756e 7465 6420  ould be counted 
+0000c6d0: 6173 2061 6e20 6578 6365 6564 616e 6365  as an exceedance
+0000c6e0: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
+0000c6f0: 6566 6175 6c74 2069 7320 4661 6c73 652e  efault is False.
+0000c700: 0d0a 0d0a 2020 2020 5265 7475 726e 730d  ....    Returns.
+0000c710: 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a 2020  .    -------..  
+0000c720: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
+0000c730: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
+0000c740: 616d 6520 7468 6174 2068 6173 2061 6e20  ame that has an 
+0000c750: 6578 6365 6564 616e 6365 2061 7373 6573  exceedance asses
+0000c760: 736d 656e 7420 666f 7220 6561 6368 2072  sment for each r
+0000c770: 6573 756c 742e 0d0a 0d0a 2020 2020 2727  esult.....    ''
+0000c780: 270d 0a20 2020 200d 0a20 2020 2023 2043  '..    ..    # C
+0000c790: 7265 6174 6520 6120 636f 7079 206f 6620  reate a copy of 
+0000c7a0: 7468 6520 4461 7461 4672 616d 650d 0a20  the DataFrame.. 
+0000c7b0: 2020 2064 6620 3d20 6466 2e63 6f70 7928     df = df.copy(
+0000c7c0: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
+0000c7d0: 6865 636b 2074 6861 7420 696e 7075 7420  heck that input 
+0000c7e0: 6973 2069 6e74 6567 6572 206f 7220 666c  is integer or fl
+0000c7f0: 6f61 740d 0a20 2020 2069 6620 6e6f 7420  oat..    if not 
+0000c800: 6973 696e 7374 616e 6365 2874 6872 6573  isinstance(thres
+0000c810: 686f 6c64 2c20 2869 6e74 2c20 666c 6f61  hold, (int, floa
+0000c820: 7429 293a 0d0a 2020 2020 2020 2020 7261  t)):..        ra
+0000c830: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+0000c840: 7468 7265 7368 6f6c 6420 696e 7075 7420  threshold input 
+0000c850: 6e65 6564 7320 746f 2062 6520 696e 7465  needs to be inte
+0000c860: 6765 7220 6f72 2066 6c6f 6174 2074 7970  ger or float typ
+0000c870: 652e 2729 0d0a 2020 2020 0d0a 2020 2020  e.')..    ..    
+0000c880: 2320 5365 7420 636f 6e64 6974 696f 6e73  # Set conditions
+0000c890: 2064 6570 656e 6469 6e67 206f 6e20 7768   depending on wh
+0000c8a0: 6574 6865 7220 7468 6520 7468 7265 7368  ether the thresh
+0000c8b0: 6f6c 6420 6973 2061 6e20 6578 6365 6564  old is an exceed
+0000c8c0: 616e 6365 0d0a 2020 2020 6966 2063 6f75  ance..    if cou
+0000c8d0: 6e74 5f74 6872 6573 686f 6c64 5f61 735f  nt_threshold_as_
+0000c8e0: 6578 6365 6564 616e 6365 3a0d 0a20 2020  exceedance:..   
+0000c8f0: 2020 2020 2023 2053 6574 2063 6f6e 6469       # Set condi
+0000c900: 7469 6f6e 7320 666f 7220 6578 6365 6564  tions for exceed
+0000c910: 616e 6365 7320 616e 6420 6e6f 6e2d 6578  ances and non-ex
+0000c920: 6365 6564 616e 6365 730d 0a20 2020 2020  ceedances..     
+0000c930: 2020 2063 6f6e 6469 7469 6f6e 7320 3d20     conditions = 
+0000c940: 5b0d 0a20 2020 2020 2020 2020 2020 2023  [..            #
+0000c950: 2049 6620 7468 6520 6c65 6674 2062 6f75   If the left bou
+0000c960: 6e64 2069 7320 6772 6561 7465 7220 7468  nd is greater th
+0000c970: 616e 206f 7220 6571 7561 6c20 746f 2074  an or equal to t
+0000c980: 6865 2074 6872 6573 686f 6c64 2074 6861  he threshold tha
+0000c990: 6e20 6578 6365 6564 616e 6365 0d0a 2020  n exceedance..  
+0000c9a0: 2020 2020 2020 2020 2020 2864 665b 6c65            (df[le
+0000c9b0: 6674 5f62 6f75 6e64 5f63 6f6c 5d20 3e3d  ft_bound_col] >=
+0000c9c0: 2074 6872 6573 686f 6c64 292c 0d0a 2020   threshold),..  
+0000c9d0: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
+0000c9e0: 6865 2072 6967 6874 2062 6f75 6e64 2069  he right bound i
+0000c9f0: 7320 6c65 7373 2074 6861 6e20 7468 6520  s less than the 
+0000ca00: 7472 6573 686f 6c64 2074 6861 6e20 6e6f  treshold than no
+0000ca10: 6e2d 6578 6365 6564 616e 6365 0d0a 2020  n-exceedance..  
+0000ca20: 2020 2020 2020 2020 2020 2864 665b 7269            (df[ri
+0000ca30: 6768 745f 626f 756e 645f 636f 6c5d 203c  ght_bound_col] <
+0000ca40: 2074 6872 6573 686f 6c64 290d 0a20 2020   threshold)..   
+0000ca50: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
+0000ca60: 656c 7365 3a0d 0a20 2020 2020 2020 2023  else:..        #
+0000ca70: 2053 6574 2063 6f6e 6469 7469 6f6e 7320   Set conditions 
+0000ca80: 666f 7220 6578 6365 6564 616e 6365 7320  for exceedances 
+0000ca90: 616e 6420 6e6f 6e2d 6578 6365 6564 616e  and non-exceedan
+0000caa0: 6365 730d 0a20 2020 2020 2020 2063 6f6e  ces..        con
+0000cab0: 6469 7469 6f6e 7320 3d20 5b0d 0a20 2020  ditions = [..   
+0000cac0: 2020 2020 2020 2020 2023 2049 6620 7468           # If th
+0000cad0: 6520 6c65 6674 2062 6f75 6e64 2069 7320  e left bound is 
+0000cae0: 6772 6561 7465 7220 7468 616e 2074 6865  greater than the
+0000caf0: 2074 6872 6573 686f 6c64 2074 6861 6e20   threshold than 
+0000cb00: 6578 6365 6564 616e 6365 0d0a 2020 2020  exceedance..    
+0000cb10: 2020 2020 2020 2020 2864 665b 6c65 6674          (df[left
+0000cb20: 5f62 6f75 6e64 5f63 6f6c 5d20 3e20 7468  _bound_col] > th
+0000cb30: 7265 7368 6f6c 6429 2c0d 0a20 2020 2020  reshold),..     
+0000cb40: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+0000cb50: 7269 6768 7420 626f 756e 6420 6973 206c  right bound is l
+0000cb60: 6573 7320 7468 616e 206f 7220 6571 7561  ess than or equa
+0000cb70: 6c20 746f 2074 6865 2074 7265 7368 6f6c  l to the treshol
+0000cb80: 6420 7468 616e 206e 6f6e 2d65 7863 6565  d than non-excee
+0000cb90: 6461 6e63 650d 0a20 2020 2020 2020 2020  dance..         
+0000cba0: 2020 2028 6466 5b72 6967 6874 5f62 6f75     (df[right_bou
+0000cbb0: 6e64 5f63 6f6c 5d20 3c3d 2074 6872 6573  nd_col] <= thres
+0000cbc0: 686f 6c64 290d 0a20 2020 2020 2020 2020  hold)..         
+0000cbd0: 2020 205d 0d0a 2020 2020 2320 4578 6365     ]..    # Exce
+0000cbe0: 6564 616e 6365 7320 6172 6520 696e 6469  edances are indi
+0000cbf0: 6361 7465 6420 6279 2069 6e74 6567 6572  cated by integer
+0000cc00: 730d 0a20 2020 2023 2028 313d 6578 6365  s..    # (1=exce
+0000cc10: 6564 616e 6365 2c20 303d 6e6f 6e2d 6578  edance, 0=non-ex
+0000cc20: 6365 6564 616e 6365 290d 0a20 2020 2072  ceedance)..    r
+0000cc30: 6573 756c 7473 203d 205b 0d0a 2020 2020  esults = [..    
+0000cc40: 2020 2020 312c 0d0a 2020 2020 2020 2020      1,..        
+0000cc50: 300d 0a20 2020 2020 2020 205d 0d0a 2020  0..        ]..  
+0000cc60: 2020 2320 4465 6661 756c 7420 6578 6365    # Default exce
+0000cc70: 6564 616e 6365 2028 6e70 2e6e 616e 3d75  edance (np.nan=u
+0000cc80: 6e6b 6e6f 776e 290d 0a20 2020 2064 665b  nknown)..    df[
+0000cc90: 275f 5f45 7863 6565 6461 6e63 655f 5f27  '__Exceedance__'
+0000cca0: 5d20 3d20 6e70 2e73 656c 6563 7428 636f  ] = np.select(co
+0000ccb0: 6e64 6974 696f 6e73 2c20 7265 7375 6c74  nditions, result
+0000ccc0: 732c 206e 702e 6e61 6e29 0d0a 2020 2020  s, np.nan)..    
+0000ccd0: 0d0a 2020 2020 7265 7475 726e 2064 660d  ..    return df.
+0000cce0: 0a0d 0a64 6566 2070 6572 6365 6e74 5f65  ...def percent_e
+0000ccf0: 7863 6565 6461 6e63 6528 6466 2c0d 0a20  xceedance(df,.. 
+0000cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd10: 2020 2020 2020 7265 7375 6c74 735f 636f        results_co
+0000cd20: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+0000cd30: 2020 2020 2020 2020 2020 2074 6872 6573             thres
+0000cd40: 686f 6c64 2c0d 0a20 2020 2020 2020 2020  hold,..         
+0000cd50: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000cd60: 756e 745f 7468 7265 7368 6f6c 645f 6173  unt_threshold_as
+0000cd70: 5f65 7863 6565 6461 6e63 653d 4661 6c73  _exceedance=Fals
+0000cd80: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000cd90: 2020 2020 2020 2020 2020 2067 726f 7570             group
+0000cda0: 6279 5f63 6f6c 7320 3d20 4e6f 6e65 2c0d  by_cols = None,.
+0000cdb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cdc0: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+0000cdd0: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
+0000cde0: 6c20 3d20 4661 6c73 6529 3a0d 0a20 2020  l = False):..   
+0000cdf0: 2027 2727 0d0a 2020 2020 4120 6675 6e63   '''..    A func
+0000ce00: 7469 6f6e 2074 6861 7420 636f 6d62 696e  tion that combin
+0000ce10: 6573 2074 6865 2072 656c 6576 616e 7420  es the relevant 
+0000ce20: 7065 7263 656e 7469 6c65 2061 6e64 2075  percentile and u
+0000ce30: 7469 6c69 7479 2066 756e 6374 696f 6e73  tility functions
+0000ce40: 2074 6f0d 0a20 2020 2067 656e 6572 6174   to..    generat
+0000ce50: 6520 7468 6520 7065 7263 656e 6974 6c65  e the percenitle
+0000ce60: 2072 6573 756c 7473 2066 6f72 2067 726f   results for gro
+0000ce70: 7570 7320 7769 7468 696e 2061 2044 6174  ups within a Dat
+0000ce80: 6146 7261 6d65 2e0d 0a0d 0a20 2020 2050  aFrame.....    P
+0000ce90: 6172 616d 6574 6572 730d 0a20 2020 202d  arameters..    -
+0000cea0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2064  ---------..    d
+0000ceb0: 6620 3a20 4461 7461 4672 616d 650d 0a20  f : DataFrame.. 
+0000cec0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
+0000ced0: 2074 6861 7420 636f 6e74 6169 6e73 2063   that contains c
+0000cee0: 656e 736f 7265 6420 6f72 2075 6e63 656e  ensored or uncen
+0000cef0: 736f 7265 6420 7265 7375 6c74 730d 0a20  sored results.. 
+0000cf00: 2020 2072 6573 756c 7473 5f63 6f6c 203a     results_col :
+0000cf10: 2073 7472 696e 670d 0a20 2020 2020 2020   string..       
+0000cf20: 2054 6865 2063 6f6c 756d 6e20 6e61 6d65   The column name
+0000cf30: 2066 6f72 2074 6865 2063 6f6c 756d 6e20   for the column 
+0000cf40: 7468 6174 2063 6f6e 7461 696e 2074 6865  that contain the
+0000cf50: 2072 6573 756c 7473 2061 7320 7465 7874   results as text
+0000cf60: 2e0d 0a20 2020 2020 2020 204f 6e6c 7920  ...        Only 
+0000cf70: 666f 7572 2070 6f73 7369 626c 6520 6365  four possible ce
+0000cf80: 6e73 6f72 7320 7368 6f75 6c64 2062 6520  nsors should be 
+0000cf90: 7573 6564 2028 3c2c e289 a42c e289 a52c  used (<,...,...,
+0000cfa0: 3e29 2e0d 0a20 2020 2074 6872 6573 686f  >)...    thresho
+0000cfb0: 6c64 203a 2066 6c6f 6174 0d0a 2020 2020  ld : float..    
+0000cfc0: 2020 2020 5468 6520 7468 7265 7368 6f6c      The threshol
+0000cfd0: 6420 6f66 2069 6e74 6572 6573 742e 0d0a  d of interest...
+0000cfe0: 2020 2020 636f 756e 745f 7468 7265 7368      count_thresh
+0000cff0: 6f6c 645f 6173 5f65 7863 6565 6461 6e63  old_as_exceedanc
+0000d000: 6520 3a20 626f 6f6c 6561 6e0d 0a20 2020  e : boolean..   
+0000d010: 2020 2020 2053 6574 2061 7320 5472 7565       Set as True
+0000d020: 2069 6620 7468 6520 7468 7265 7368 6f6c   if the threshol
+0000d030: 6420 7661 6c75 6520 7368 6f75 6c64 2062  d value should b
+0000d040: 6520 636f 756e 7465 6420 6173 2061 6e20  e counted as an 
+0000d050: 6578 6365 6564 616e 6365 2e0d 0a20 2020  exceedance...   
+0000d060: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
+0000d070: 2069 7320 4661 6c73 652e 0d0a 2020 2020   is False...    
+0000d080: 6772 6f75 7062 795f 636f 6c73 203a 206c  groupby_cols : l
+0000d090: 6973 7473 206f 6620 7374 7269 6e67 7320  ists of strings 
+0000d0a0: 286f 7220 6c69 7374 206f 6620 7477 6f20  (or list of two 
+0000d0b0: 6c69 7374 7329 2c20 6f70 7469 6f6e 616c  lists), optional
+0000d0c0: 0d0a 2020 2020 2020 2020 4c69 7374 206f  ..        List o
+0000d0d0: 6620 636f 6c75 6d6e 206e 616d 6573 2074  f column names t
+0000d0e0: 6861 7420 7368 6f75 6c64 2062 6520 7573  hat should be us
+0000d0f0: 6564 2074 6f20 6372 6561 7465 2067 726f  ed to create gro
+0000d100: 7570 732e 2050 6572 6365 6e74 6167 650d  ups. Percentage.
+0000d110: 0a20 2020 2020 2020 206f 6620 6578 6365  .        of exce
+0000d120: 6564 616e 6365 7320 7769 6c6c 2062 6520  edances will be 
+0000d130: 666f 756e 6420 7769 7468 696e 2065 6163  found within eac
+0000d140: 6820 6772 6f75 702e 2054 776f 206c 6973  h group. Two lis
+0000d150: 7473 2063 616e 2062 650d 0a20 2020 2020  ts can be..     
+0000d160: 2020 2073 7570 706c 6965 6420 746f 2066     supplied to f
+0000d170: 6972 7374 2066 696e 6420 7468 6520 6d61  irst find the ma
+0000d180: 7869 6d75 6d20 7769 7468 696e 2065 6163  ximum within eac
+0000d190: 6820 6772 6f75 7020 6265 666f 7265 0d0a  h group before..
+0000d1a0: 2020 2020 2020 2020 6465 7465 726d 696e          determin
+0000d1b0: 696e 6720 7468 6520 7065 7263 656e 7461  ing the percenta
+0000d1c0: 6765 206f 6620 6578 6365 6564 616e 6365  ge of exceedance
+0000d1d0: 7320 6f76 6572 2074 6865 2073 6563 6f6e  s over the secon
+0000d1e0: 6420 6772 6f75 7069 6e67 2e0d 0a20 2020  d grouping...   
+0000d1f0: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
+0000d200: 2069 7320 4e6f 6e65 2e0d 0a20 2020 2069   is None...    i
+0000d210: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
+0000d220: 696e 7465 7276 616c 203a 2062 6f6f 6c65  interval : boole
+0000d230: 616e 2c20 6f70 7469 6f6e 616c 0d0a 2020  an, optional..  
+0000d240: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+0000d250: 6865 6e20 616c 6c20 706f 7369 7469 7665  hen all positive
+0000d260: 2061 6e64 206e 6567 6174 6976 6520 7661   and negative va
+0000d270: 6c75 6573 2061 7265 2063 6f6e 7369 6465  lues are conside
+0000d280: 7265 640d 0a20 2020 2020 2020 2065 2e67  red..        e.g
+0000d290: 2e2c 203c 302e 3520 776f 756c 6420 6265  ., <0.5 would be
+0000d2a0: 2063 6f6e 7665 7274 6564 2074 6f20 282d   converted to (-
+0000d2b0: 6e70 2e69 6e66 2c35 292e 0d0a 2020 2020  np.inf,5)...    
+0000d2c0: 2020 2020 4966 2046 616c 7365 2c20 7468      If False, th
+0000d2d0: 656e 206f 6e6c 7920 6e6f 6e2d 6e65 6761  en only non-nega
+0000d2e0: 7469 7665 2076 616c 7565 7320 6172 6520  tive values are 
+0000d2f0: 636f 6e73 6964 6572 6564 0d0a 2020 2020  considered..    
+0000d300: 2020 2020 652e 672e 2c20 3c30 2e35 2077      e.g., <0.5 w
+0000d310: 6f75 6c64 2062 6520 636f 6e76 6572 7465  ould be converte
+0000d320: 6420 746f 205b 302c 3529 2e0d 0a20 2020  d to [0,5)...   
+0000d330: 2020 2020 2054 6869 7320 7365 7474 696e       This settin
+0000d340: 6720 6f6e 6c79 2061 6666 6563 7473 2072  g only affects r
+0000d350: 6573 756c 7473 2069 6620 666f 6375 735f  esults if focus_
+0000d360: 6869 6768 5f70 6f74 656e 7469 616c 2069  high_potential i
+0000d370: 7320 4661 6c73 652e 0d0a 2020 2020 2020  s False...      
+0000d380: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
+0000d390: 2046 616c 7365 2e0d 0a0d 0a20 2020 2052   False.....    R
+0000d3a0: 6574 7572 6e73 0d0a 2020 2020 2d2d 2d2d  eturns..    ----
+0000d3b0: 2d2d 2d0d 0a20 2020 2064 6620 3a20 4461  ---..    df : Da
+0000d3c0: 7461 4672 616d 650d 0a20 2020 2020 2020  taFrame..       
+0000d3d0: 2044 6174 6146 7261 6d65 2074 6861 7420   DataFrame that 
+0000d3e0: 636f 6e74 6169 6e73 2063 616c 6375 6c61  contains calcula
+0000d3f0: 7465 6420 7065 7263 656e 7469 6c65 730d  ted percentiles.
+0000d400: 0a0d 0a20 2020 2027 2727 0d0a 2020 2020  ...    '''..    
+0000d410: 0d0a 2020 2020 2320 4372 6561 7465 2061  ..    # Create a
+0000d420: 2063 6f70 7920 6f66 2074 6865 2044 6174   copy of the Dat
+0000d430: 6146 7261 6d65 0d0a 2020 2020 6466 203d  aFrame..    df =
+0000d440: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
+0000d450: 0d0a 2020 2020 2320 5370 6c69 7420 7468  ..    # Split th
+0000d460: 6520 7265 7375 6c74 2069 6e74 6f20 6365  e result into ce
+0000d470: 6e73 6f72 2061 6e64 206e 756d 6572 6963  nsor and numeric
+0000d480: 2063 6f6d 706f 6e65 6e74 730d 0a20 2020   components..   
+0000d490: 2064 6620 3d20 7265 7375 6c74 5f74 6f5f   df = result_to_
+0000d4a0: 636f 6d70 6f6e 656e 7473 2864 662c 7265  components(df,re
+0000d4b0: 7375 6c74 735f 636f 6c29 0d0a 2020 2020  sults_col)..    
+0000d4c0: 0d0a 2020 2020 2320 436f 6e76 6572 7420  ..    # Convert 
+0000d4d0: 7468 6520 7265 7375 6c74 7320 6672 6f6d  the results from
+0000d4e0: 2063 656e 736f 7220 616e 6420 6e75 6d65   censor and nume
+0000d4f0: 7269 6320 636f 6d70 6f6e 656e 7473 2074  ric components t
+0000d500: 6f20 616e 2069 6e74 6572 7661 6c20 7265  o an interval re
+0000d510: 7072 6573 656e 7461 7469 6f6e 0d0a 2020  presentation..  
+0000d520: 2020 6466 203d 2063 6f6d 706f 6e65 6e74    df = component
+0000d530: 735f 746f 5f69 6e74 6572 7661 6c28 6466  s_to_interval(df
+0000d540: 2c20 696e 636c 7564 655f 6e65 6761 7469  , include_negati
+0000d550: 7665 5f69 6e74 6572 7661 6c29 0d0a 2020  ve_interval)..  
+0000d560: 2020 0d0a 2020 2020 2320 4173 7365 7373    ..    # Assess
+0000d570: 2065 7863 6565 6461 6e63 6573 0d0a 2020   exceedances..  
+0000d580: 2020 6466 203d 2070 6572 6365 6e74 5f65    df = percent_e
+0000d590: 7863 6565 6461 6e63 655f 6173 7365 7373  xceedance_assess
+0000d5a0: 6d65 6e74 2864 662c 0d0a 2020 2020 2020  ment(df,..      
+0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5d0: 2074 6872 6573 686f 6c64 3d74 6872 6573   threshold=thres
+0000d5e0: 686f 6c64 2c0d 0a20 2020 2020 2020 2020  hold,..         
+0000d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d600: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000d610: 756e 745f 7468 7265 7368 6f6c 645f 6173  unt_threshold_as
+0000d620: 5f65 7863 6565 6461 6e63 653d 636f 756e  _exceedance=coun
+0000d630: 745f 7468 7265 7368 6f6c 645f 6173 5f65  t_threshold_as_e
+0000d640: 7863 6565 6461 6e63 6529 0d0a 2020 2020  xceedance)..    
+0000d650: 0d0a 2020 2020 2320 4966 2074 6865 7265  ..    # If there
+0000d660: 2061 7265 206e 6f20 6772 6f75 7062 792d   are no groupby-
+0000d670: 636f 6c75 6d6e 732c 2074 6865 6e20 6361  columns, then ca
+0000d680: 6c63 756c 6174 6520 7065 7263 656e 7420  lculate percent 
+0000d690: 6578 6365 6564 616e 6365 7320 6f66 2061  exceedances of a
+0000d6a0: 6c6c 2072 6573 756c 7473 0d0a 2020 2020  ll results..    
+0000d6b0: 6966 206e 6f74 2067 726f 7570 6279 5f63  if not groupby_c
+0000d6c0: 6f6c 733a 0d0a 2020 2020 2020 2020 6466  ols:..        df
+0000d6d0: 203d 2064 662e 6167 6728 2a2a 7b0d 0a20   = df.agg(**{.. 
+0000d6e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000d6f0: 7863 6565 6461 6e63 6573 5f63 6f6c 3a20  xceedances_col: 
+0000d700: 2827 5f5f 4578 6365 6564 616e 6365 5f5f  ('__Exceedance__
+0000d710: 272c 2773 756d 2729 2c0d 0a20 2020 2020  ','sum'),..     
+0000d720: 2020 2020 2020 2020 2020 2027 5f5f 4465             '__De
+0000d730: 7465 726d 696e 6564 4578 6365 6564 616e  terminedExceedan
+0000d740: 6365 735f 5f27 3a20 2827 5f5f 4578 6365  ces__': ('__Exce
+0000d750: 6564 616e 6365 5f5f 272c 2763 6f75 6e74  edance__','count
+0000d760: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
+0000d770: 2020 2020 2027 5f5f 546f 7461 6c43 6f75       '__TotalCou
+0000d780: 6e74 5f5f 273a 2028 275f 5f45 7863 6565  nt__': ('__Excee
+0000d790: 6461 6e63 655f 5f27 2c27 7369 7a65 2729  dance__','size')
+0000d7a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d7b0: 2020 7d29 2e74 7261 6e73 706f 7365 2829    }).transpose()
+0000d7c0: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
+0000d7d0: 703d 5472 7565 290d 0a20 2020 2023 2049  p=True)..    # I
+0000d7e0: 6620 7468 6520 6772 6f75 7062 795f 636f  f the groupby_co
+0000d7f0: 6c73 2069 7320 6120 6c69 7374 206f 6620  ls is a list of 
+0000d800: 6c69 7374 732c 2074 6865 6e20 6173 7365  lists, then asse
+0000d810: 7373 206d 6178 696d 756d 7320 666f 7220  ss maximums for 
+0000d820: 6669 7273 7420 6772 6f75 7069 6e67 0d0a  first grouping..
+0000d830: 2020 2020 2320 616e 6420 7065 7263 656e      # and percen
+0000d840: 7461 6765 206f 6620 6578 6365 6564 616e  tage of exceedan
+0000d850: 6365 7320 666f 7220 7468 6520 7365 636f  ces for the seco
+0000d860: 6e64 2067 726f 7570 696e 670d 0a20 2020  nd grouping..   
+0000d870: 2065 6c69 6620 2869 7369 6e73 7461 6e63   elif (isinstanc
+0000d880: 6528 6772 6f75 7062 795f 636f 6c73 5b30  e(groupby_cols[0
+0000d890: 5d2c 6c69 7374 2929 2026 2028 6c65 6e28  ],list)) & (len(
+0000d8a0: 6772 6f75 7062 795f 636f 6c73 2920 213d  groupby_cols) !=
+0000d8b0: 2032 293a 0d0a 2020 2020 2020 2020 7261   2):..        ra
+0000d8c0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+0000d8d0: 5477 6f20 6c69 7374 7320 6d75 7374 2062  Two lists must b
+0000d8e0: 6520 696e 636c 7564 6564 2066 6f72 2067  e included for g
+0000d8f0: 726f 7570 6279 5f63 6f6c 7320 7468 6174  roupby_cols that
+0000d900: 2069 7320 6120 6c69 7374 206f 6620 6c69   is a list of li
+0000d910: 7374 732e 2729 0d0a 2020 2020 656c 6966  sts.')..    elif
+0000d920: 2069 7369 6e73 7461 6e63 6528 6772 6f75   isinstance(grou
+0000d930: 7062 795f 636f 6c73 5b30 5d2c 6c69 7374  pby_cols[0],list
+0000d940: 293a 0d0a 2020 2020 2020 2020 2320 5573  ):..        # Us
+0000d950: 6520 6d61 7869 6d75 6d20 7769 7468 696e  e maximum within
+0000d960: 2065 6163 6820 6772 6f75 7020 666f 7220   each group for 
+0000d970: 6669 7273 7420 6772 6f75 7069 6e67 0d0a  first grouping..
+0000d980: 2020 2020 2020 2020 6466 203d 2064 662e          df = df.
+0000d990: 6772 6f75 7062 7928 6772 6f75 7062 795f  groupby(groupby_
+0000d9a0: 636f 6c73 5b30 5d29 5b27 5f5f 4578 6365  cols[0])['__Exce
+0000d9b0: 6564 616e 6365 5f5f 275d 2e6d 6178 2829  edance__'].max()
+0000d9c0: 2e72 6573 6574 5f69 6e64 6578 2829 0d0a  .reset_index()..
+0000d9d0: 2020 2020 2020 2020 2320 5573 6520 7365          # Use se
+0000d9e0: 636f 6e64 2067 726f 7570 696e 6720 666f  cond grouping fo
+0000d9f0: 7220 7065 7263 656e 7461 6765 206f 6620  r percentage of 
+0000da00: 6578 6365 6564 616e 6365 730d 0a20 2020  exceedances..   
+0000da10: 2020 2020 2064 6620 3d20 6466 2e67 726f       df = df.gro
+0000da20: 7570 6279 2867 726f 7570 6279 5f63 6f6c  upby(groupby_col
+0000da30: 735b 315d 292e 6167 6728 2a2a 7b0d 0a20  s[1]).agg(**{.. 
+0000da40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000da50: 7863 6565 6461 6e63 6573 5f63 6f6c 3a20  xceedances_col: 
+0000da60: 2827 5f5f 4578 6365 6564 616e 6365 5f5f  ('__Exceedance__
+0000da70: 272c 2773 756d 2729 2c0d 0a20 2020 2020  ','sum'),..     
+0000da80: 2020 2020 2020 2020 2020 2027 5f5f 4465             '__De
+0000da90: 7465 726d 696e 6564 4578 6365 6564 616e  terminedExceedan
+0000daa0: 6365 735f 5f27 3a20 2827 5f5f 4578 6365  ces__': ('__Exce
+0000dab0: 6564 616e 6365 5f5f 272c 2763 6f75 6e74  edance__','count
+0000dac0: 2729 2c0d 0a20 2020 2020 2020 2020 2020  '),..           
+0000dad0: 2020 2020 2027 5f5f 546f 7461 6c43 6f75       '__TotalCou
+0000dae0: 6e74 5f5f 273a 2028 275f 5f45 7863 6565  nt__': ('__Excee
+0000daf0: 6461 6e63 655f 5f27 2c27 7369 7a65 2729  dance__','size')
+0000db00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000db10: 2020 7d29 0d0a 2020 2020 2320 456c 7365    })..    # Else
+0000db20: 2074 6865 2067 726f 7570 6279 5f63 6f6c   the groupby_col
+0000db30: 7320 6973 2061 206c 6973 7420 6f66 2063  s is a list of c
+0000db40: 6f6c 756d 6e20 6e61 6d65 730d 0a20 2020  olumn names..   
+0000db50: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000db60: 6466 203d 2064 662e 6772 6f75 7062 7928  df = df.groupby(
+0000db70: 6772 6f75 7062 795f 636f 6c73 292e 6167  groupby_cols).ag
+0000db80: 6728 2a2a 7b0d 0a20 2020 2020 2020 2020  g(**{..         
+0000db90: 2020 2020 2020 2065 7863 6565 6461 6e63         exceedanc
+0000dba0: 6573 5f63 6f6c 3a20 2827 5f5f 4578 6365  es_col: ('__Exce
+0000dbb0: 6564 616e 6365 5f5f 272c 2773 756d 2729  edance__','sum')
+0000dbc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000dbd0: 2020 2027 5f5f 4465 7465 726d 696e 6564     '__Determined
+0000dbe0: 4578 6365 6564 616e 6365 735f 5f27 3a20  Exceedances__': 
+0000dbf0: 2827 5f5f 4578 6365 6564 616e 6365 5f5f  ('__Exceedance__
+0000dc00: 272c 2763 6f75 6e74 2729 2c0d 0a20 2020  ','count'),..   
+0000dc10: 2020 2020 2020 2020 2020 2020 2027 5f5f               '__
+0000dc20: 546f 7461 6c43 6f75 6e74 5f5f 273a 2028  TotalCount__': (
+0000dc30: 275f 5f45 7863 6565 6461 6e63 655f 5f27  '__Exceedance__'
+0000dc40: 2c27 7369 7a65 2729 0d0a 2020 2020 2020  ,'size')..      
+0000dc50: 2020 2020 2020 2020 2020 7d29 0d0a 2020            })..  
+0000dc60: 2020 0d0a 2020 2020 2320 4465 7465 726d    ..    # Determ
+0000dc70: 696e 6520 636f 756e 7473 2061 6e64 2063  ine counts and c
+0000dc80: 616c 6375 6c61 7465 2070 6572 6365 6e74  alculate percent
+0000dc90: 6167 650d 0a20 2020 2064 665b 6e6f 6e5f  age..    df[non_
+0000dca0: 6578 6365 6564 616e 6365 735f 636f 6c5d  exceedances_col]
+0000dcb0: 203d 2064 665b 275f 5f44 6574 6572 6d69   = df['__Determi
+0000dcc0: 6e65 6445 7863 6565 6461 6e63 6573 5f5f  nedExceedances__
+0000dcd0: 275d 202d 2064 665b 6578 6365 6564 616e  '] - df[exceedan
+0000dce0: 6365 735f 636f 6c5d 0d0a 2020 2020 6466  ces_col]..    df
+0000dcf0: 5b69 676e 6f72 6564 5f63 6f6c 5d20 3d20  [ignored_col] = 
+0000dd00: 6466 5b27 5f5f 546f 7461 6c43 6f75 6e74  df['__TotalCount
+0000dd10: 5f5f 275d 2d64 665b 275f 5f44 6574 6572  __']-df['__Deter
+0000dd20: 6d69 6e65 6445 7863 6565 6461 6e63 6573  minedExceedances
+0000dd30: 5f5f 275d 0d0a 2020 2020 6466 5b70 6572  __']..    df[per
+0000dd40: 6365 6e74 5f65 7863 6565 6461 6e63 6573  cent_exceedances
+0000dd50: 5f63 6f6c 5d20 3d20 6466 5b65 7863 6565  _col] = df[excee
+0000dd60: 6461 6e63 6573 5f63 6f6c 5d20 2f20 6466  dances_col] / df
+0000dd70: 5b27 5f5f 4465 7465 726d 696e 6564 4578  ['__DeterminedEx
+0000dd80: 6365 6564 616e 6365 735f 5f27 5d20 2a20  ceedances__'] * 
+0000dd90: 3130 300d 0a20 2020 200d 0a20 2020 2023  100..    ..    #
+0000dda0: 2044 726f 7020 776f 726b 696e 6720 636f   Drop working co
+0000ddb0: 6c75 6d6e 730d 0a20 2020 2064 6620 3d20  lumns..    df = 
+0000ddc0: 6466 2e64 726f 7028 6466 2e66 696c 7465  df.drop(df.filte
+0000ddd0: 7228 7265 6765 783d 275f 5f27 292e 636f  r(regex='__').co
+0000dde0: 6c75 6d6e 732c 2061 7869 733d 3129 0d0a  lumns, axis=1)..
+0000ddf0: 2020 2020 0d0a 2020 2020 2320 5265 6f72      ..    # Reor
+0000de00: 6465 7220 636f 6c75 6d6e 730d 0a20 2020  der columns..   
+0000de10: 2066 6f72 2063 6f6c 2069 6e20 5b70 6572   for col in [per
+0000de20: 6365 6e74 5f65 7863 6565 6461 6e63 6573  cent_exceedances
+0000de30: 5f63 6f6c 2c65 7863 6565 6461 6e63 6573  _col,exceedances
+0000de40: 5f63 6f6c 2c6e 6f6e 5f65 7863 6565 6461  _col,non_exceeda
+0000de50: 6e63 6573 5f63 6f6c 2c69 676e 6f72 6564  nces_col,ignored
+0000de60: 5f63 6f6c 5d3a 0d0a 2020 2020 2020 2020  _col]:..        
+0000de70: 6466 5b63 6f6c 5d20 3d20 6466 2e70 6f70  df[col] = df.pop
+0000de80: 2863 6f6c 290d 0a20 2020 200d 0a20 2020  (col)..    ..   
+0000de90: 2072 6574 7572 6e20 6466 0d0a 0d0a 2325   return df....#%
+0000dea0: 2520 4164 6469 7469 6f6e 0d0a 0d0a 6465  % Addition....de
+0000deb0: 6620 6164 645f 696e 7465 7276 616c 7328  f add_intervals(
+0000dec0: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
+0000ded0: 2020 2020 2020 2067 726f 7570 6279 5f63         groupby_c
+0000dee0: 6f6c 7329 3a0d 0a20 2020 2027 2727 0d0a  ols):..    '''..
+0000def0: 2020 2020 4120 6675 6e63 7469 6f6e 2074      A function t
+0000df00: 6861 7420 6164 6473 2074 6865 2069 6e74  hat adds the int
+0000df10: 6572 7661 6c20 6e6f 7461 7469 6f6e 2066  erval notation f
+0000df20: 6f72 6d20 6f66 2072 6573 756c 7473 2072  orm of results r
+0000df30: 6574 7572 6e65 640d 0a20 2020 2066 726f  eturned..    fro
+0000df40: 6d20 636f 6d70 6f6e 656e 7473 5f74 6f5f  m components_to_
+0000df50: 696e 7465 7276 616c 2074 6f20 6765 6e65  interval to gene
+0000df60: 7261 7465 2061 206e 6577 2069 6e74 6572  rate a new inter
+0000df70: 7661 6c20 666f 7220 7468 6520 7375 6d2e  val for the sum.
+0000df80: 2047 726f 7570 730d 0a20 2020 206f 6620   Groups..    of 
+0000df90: 7265 7375 6c74 7320 6361 6e20 6265 2064  results can be d
+0000dfa0: 6566 696e 6564 2062 7920 696e 636c 7564  efined by includ
+0000dfb0: 696e 6720 7468 6520 636f 6c75 6d6e 7320  ing the columns 
+0000dfc0: 7468 6174 2073 686f 756c 6420 6265 2075  that should be u
+0000dfd0: 7365 6420 746f 0d0a 2020 2020 6372 6561  sed to..    crea
+0000dfe0: 7465 2067 726f 7570 732e 0d0a 0d0a 2020  te groups.....  
+0000dff0: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+0000e000: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+0000e010: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
+0000e020: 0d0a 2020 2020 2020 2020 4461 7461 4672  ..        DataFr
+0000e030: 616d 6520 7468 6174 2063 6f6e 7461 696e  ame that contain
+0000e040: 7320 7265 7375 6c74 7320 696e 2061 2073  s results in a s
+0000e050: 7065 6369 6669 6320 696e 7465 7276 616c  pecific interval
+0000e060: 206e 6f74 6174 696f 6e2e 0d0a 2020 2020   notation...    
+0000e070: 6772 6f75 7062 795f 636f 6c73 203a 206c  groupby_cols : l
+0000e080: 6973 7420 6f66 2073 7472 696e 6773 0d0a  ist of strings..
+0000e090: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+0000e0a0: 636f 6c75 6d6e 206e 616d 6573 2074 6861  column names tha
+0000e0b0: 7420 7368 6f75 6c64 2062 6520 7573 6564  t should be used
+0000e0c0: 2074 6f20 6372 6561 7465 2067 726f 7570   to create group
+0000e0d0: 732e 0d0a 0d0a 2020 2020 5265 7475 726e  s.....    Return
+0000e0e0: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 0d0a  s..    -------..
+0000e0f0: 2020 2020 6466 203a 2044 6174 6146 7261      df : DataFra
+0000e100: 6d65 0d0a 2020 2020 2020 2020 4461 7461  me..        Data
+0000e110: 4672 616d 6520 7468 6174 2068 6173 2074  Frame that has t
+0000e120: 6865 2069 6e74 6572 7661 6c20 666f 7220  he interval for 
+0000e130: 7468 6520 7375 6d20 2866 6f72 2065 6163  the sum (for eac
+0000e140: 6820 6772 6f75 7020 6966 0d0a 2020 2020  h group if..    
+0000e150: 2020 2020 636f 6c75 6d6e 206e 616d 6573      column names
+0000e160: 2061 7265 2070 726f 7669 6465 6420 666f   are provided fo
+0000e170: 7220 6772 6f75 7069 6e67 290d 0a0d 0a20  r grouping).... 
+0000e180: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
+0000e190: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
+0000e1a0: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
+0000e1b0: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
+0000e1c0: 636f 7079 2829 0d0a 2020 2020 0d0a 2020  copy()..    ..  
+0000e1d0: 2020 2320 4372 6561 7465 2063 6f6c 756d    # Create colum
+0000e1e0: 6e20 7468 6174 2069 6e64 6963 6174 6573  n that indicates
+0000e1f0: 2074 6865 2067 656e 6572 6174 6564 2073   the generated s
+0000e200: 7461 7469 7374 6963 2061 6e64 2061 7070  tatistic and app
+0000e210: 656e 6420 746f 2067 726f 7570 696e 6720  end to grouping 
+0000e220: 6c69 7374 0d0a 2020 2020 6466 5b73 7461  list..    df[sta
+0000e230: 745f 636f 6c5d 203d 2027 5375 6d27 0d0a  t_col] = 'Sum'..
+0000e240: 2020 2020 6772 6f75 7062 795f 636f 6c73      groupby_cols
+0000e250: 2e61 7070 656e 6428 7374 6174 5f63 6f6c  .append(stat_col
+0000e260: 290d 0a20 2020 200d 0a20 2020 2023 2043  )..    ..    # C
+0000e270: 6861 6e67 6520 6e6f 7461 7469 6f6e 206f  hange notation o
+0000e280: 6620 2743 6c6f 7365 6427 2061 6e64 2027  f 'Closed' and '
+0000e290: 4f70 656e 2720 626f 756e 6461 7269 6573  Open' boundaries
+0000e2a0: 2074 6f20 3020 616e 6420 312c 2072 6573   to 0 and 1, res
+0000e2b0: 7065 6374 6976 656c 790d 0a20 2020 2023  pectively..    #
+0000e2c0: 2054 6865 2070 7265 7365 6e63 6520 6f66   The presence of
+0000e2d0: 2061 6e79 206f 7065 6e20 626f 756e 6461   any open bounda
+0000e2e0: 7269 6573 206f 6e20 6f6e 6520 7369 6465  ries on one side
+0000e2f0: 2065 6e73 7572 6520 7468 6174 2074 6865   ensure that the
+0000e300: 2069 6e74 6572 7661 6c20 666f 7220 7468   interval for th
+0000e310: 6520 7375 6d20 6973 2061 6c73 6f0d 0a20  e sum is also.. 
+0000e320: 2020 2023 206f 7065 6e20 6f6e 2074 6861     # open on tha
+0000e330: 7420 7369 6465 0d0a 2020 2020 6466 5b5b  t side..    df[[
+0000e340: 6c65 6674 5f62 6f75 6e64 6172 795f 636f  left_boundary_co
+0000e350: 6c2c 7269 6768 745f 626f 756e 6461 7279  l,right_boundary
+0000e360: 5f63 6f6c 5d5d 203d 2064 665b 5b6c 6566  _col]] = df[[lef
+0000e370: 745f 626f 756e 6461 7279 5f63 6f6c 2c72  t_boundary_col,r
+0000e380: 6967 6874 5f62 6f75 6e64 6172 795f 636f  ight_boundary_co
+0000e390: 6c5d 5d2e 7265 706c 6163 6528 5b27 436c  l]].replace(['Cl
+0000e3a0: 6f73 6564 272c 274f 7065 6e27 5d2c 205b  osed','Open'], [
+0000e3b0: 302c 315d 290d 0a20 2020 200d 0a20 2020  0,1])..    ..   
+0000e3c0: 2023 2047 6574 2074 6865 206c 6566 742f   # Get the left/
+0000e3d0: 7269 6768 7420 626f 756e 6473 206f 6620  right bounds of 
+0000e3e0: 7468 6520 7375 6d20 6279 2061 6464 696e  the sum by addin
+0000e3f0: 6720 626f 756e 6473 2077 6974 6869 6e20  g bounds within 
+0000e400: 7468 6520 6772 6f75 700d 0a20 2020 2023  the group..    #
+0000e410: 2044 6574 6572 6d69 6e65 2077 6865 7468   Determine wheth
+0000e420: 6572 2061 6e79 204f 7065 6e20 286e 6f77  er any Open (now
+0000e430: 2076 616c 7565 206f 6620 3129 2062 6f75   value of 1) bou
+0000e440: 6e64 6172 6965 7320 6578 6973 742e 2049  ndaries exist. I
+0000e450: 6620 7468 6572 6520 6172 650d 0a20 2020  f there are..   
+0000e460: 2023 2061 6e79 206f 7065 6e20 626f 756e   # any open boun
+0000e470: 6461 7269 6573 2075 7365 6420 696e 2074  daries used in t
+0000e480: 6865 2073 756d 2c20 7468 656e 2074 6865  he sum, then the
+0000e490: 2072 6573 756c 7469 6e67 2073 756d 2077   resulting sum w
+0000e4a0: 696c 6c20 6265 206f 7065 6e0d 0a20 2020  ill be open..   
+0000e4b0: 2064 6620 3d20 6466 2e67 726f 7570 6279   df = df.groupby
+0000e4c0: 2867 726f 7570 6279 5f63 6f6c 7329 2e61  (groupby_cols).a
+0000e4d0: 6767 282a 2a7b 0d0a 2020 2020 2020 2020  gg(**{..        
+0000e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4f0: 2020 2020 6c65 6674 5f62 6f75 6e64 6172      left_boundar
+0000e500: 795f 636f 6c3a 2028 6c65 6674 5f62 6f75  y_col: (left_bou
+0000e510: 6e64 6172 795f 636f 6c2c 2027 6d61 7827  ndary_col, 'max'
+0000e520: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0000e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e540: 275f 5f4d 696e 696d 756d 5f5f 273a 2028  '__Minimum__': (
+0000e550: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 2c27  left_bound_col,'
+0000e560: 6d69 6e27 292c 0d0a 2020 2020 2020 2020  min'),..        
+0000e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e580: 2020 2020 6c65 6674 5f62 6f75 6e64 5f63      left_bound_c
+0000e590: 6f6c 3a20 286c 6566 745f 626f 756e 645f  ol: (left_bound_
+0000e5a0: 636f 6c2c 2773 756d 2729 2c0d 0a20 2020  col,'sum'),..   
+0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5c0: 2020 2020 2020 2020 2072 6967 6874 5f62           right_b
+0000e5d0: 6f75 6e64 5f63 6f6c 3a20 2872 6967 6874  ound_col: (right
+0000e5e0: 5f62 6f75 6e64 5f63 6f6c 2c27 7375 6d27  _bound_col,'sum'
+0000e5f0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0000e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e610: 275f 5f4d 6178 696d 756d 5f5f 273a 2028  '__Maximum__': (
+0000e620: 7269 6768 745f 626f 756e 645f 636f 6c2c  right_bound_col,
+0000e630: 276d 6178 2729 2c0d 0a20 2020 2020 2020  'max'),..       
+0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e650: 2020 2020 2072 6967 6874 5f62 6f75 6e64       right_bound
+0000e660: 6172 795f 636f 6c3a 2028 7269 6768 745f  ary_col: (right_
+0000e670: 626f 756e 6461 7279 5f63 6f6c 2c27 6d61  boundary_col,'ma
+0000e680: 7827 290d 0a20 2020 2020 2020 2020 2020  x')..           
+0000e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6a0: 207d 290d 0a20 2020 200d 0a20 2020 2023   })..    ..    #
+0000e6b0: 2052 6570 6c61 6365 2069 6e74 6567 6572   Replace integer
+0000e6c0: 7320 7769 7468 2074 6578 7420 666f 7220  s with text for 
+0000e6d0: 626f 756e 6461 7269 6573 0d0a 2020 2020  boundaries..    
+0000e6e0: 6466 5b5b 6c65 6674 5f62 6f75 6e64 6172  df[[left_boundar
+0000e6f0: 795f 636f 6c2c 7269 6768 745f 626f 756e  y_col,right_boun
+0000e700: 6461 7279 5f63 6f6c 5d5d 203d 2064 665b  dary_col]] = df[
+0000e710: 5b6c 6566 745f 626f 756e 6461 7279 5f63  [left_boundary_c
+0000e720: 6f6c 2c72 6967 6874 5f62 6f75 6e64 6172  ol,right_boundar
+0000e730: 795f 636f 6c5d 5d2e 7265 706c 6163 6528  y_col]].replace(
+0000e740: 5b30 2c31 5d2c 205b 2743 6c6f 7365 6427  [0,1], ['Closed'
+0000e750: 2c27 4f70 656e 275d 290d 0a20 2020 200d  ,'Open'])..    .
+0000e760: 0a20 2020 2023 2053 756d 7320 7769 7468  .    # Sums with
+0000e770: 2069 6e66 696e 6974 6520 7661 6c75 6573   infinite values
+0000e780: 2070 726f 6475 6365 206e 616e 2076 616c   produce nan val
+0000e790: 7565 7320 7261 7468 6572 2074 6861 6e20  ues rather than 
+0000e7a0: 6e70 2e69 6e66 2076 616c 7565 730d 0a20  np.inf values.. 
+0000e7b0: 2020 2023 2043 6f6e 7665 7274 206e 616e     # Convert nan
+0000e7c0: 2074 6f20 696e 6620 6f6e 6c79 2069 6620   to inf only if 
+0000e7d0: 696e 6669 6e69 7465 2076 616c 7565 7320  infinite values 
+0000e7e0: 6172 6520 696e 636c 7564 6564 2069 6e20  are included in 
+0000e7f0: 7468 6520 7375 6d0d 0a20 2020 2064 665b  the sum..    df[
+0000e800: 6c65 6674 5f62 6f75 6e64 5f63 6f6c 5d20  left_bound_col] 
+0000e810: 3d20 6e70 2e77 6865 7265 2864 665b 275f  = np.where(df['_
+0000e820: 5f4d 696e 696d 756d 5f5f 275d 203d 3d20  _Minimum__'] == 
+0000e830: 2d6e 702e 696e 662c 202d 6e70 2e69 6e66  -np.inf, -np.inf
+0000e840: 2c20 6466 5b6c 6566 745f 626f 756e 645f  , df[left_bound_
+0000e850: 636f 6c5d 290d 0a20 2020 2064 665b 7269  col])..    df[ri
+0000e860: 6768 745f 626f 756e 645f 636f 6c5d 203d  ght_bound_col] =
+0000e870: 206e 702e 7768 6572 6528 6466 5b27 5f5f   np.where(df['__
+0000e880: 4d61 7869 6d75 6d5f 5f27 5d20 3d3d 206e  Maximum__'] == n
+0000e890: 702e 696e 662c 206e 702e 696e 662c 2064  p.inf, np.inf, d
+0000e8a0: 665b 7269 6768 745f 626f 756e 645f 636f  f[right_bound_co
+0000e8b0: 6c5d 290d 0a20 2020 200d 0a20 2020 2023  l])..    ..    #
+0000e8c0: 2052 6573 6574 2069 6e64 6578 0d0a 2020   Reset index..  
+0000e8d0: 2020 6466 203d 2064 662e 7265 7365 745f    df = df.reset_
+0000e8e0: 696e 6465 7828 290d 0a20 2020 200d 0a20  index()..    .. 
+0000e8f0: 2020 2072 6574 7572 6e20 6466 0d0a 0d0a     return df....
+0000e900: 6465 6620 6164 6469 7469 6f6e 2864 662c  def addition(df,
+0000e910: 0d0a 2020 2020 2020 2020 2020 2020 2072  ..             r
+0000e920: 6573 756c 7473 5f63 6f6c 2c0d 0a20 2020  esults_col,..   
+0000e930: 2020 2020 2020 2020 2020 6772 6f75 7062            groupb
+0000e940: 795f 636f 6c73 203d 204e 6f6e 652c 0d0a  y_cols = None,..
+0000e950: 2020 2020 2020 2020 2020 2020 2066 6f63               foc
+0000e960: 7573 5f68 6967 685f 706f 7465 6e74 6961  us_high_potentia
+0000e970: 6c20 3d20 5472 7565 2c0d 0a20 2020 2020  l = True,..     
+0000e980: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+0000e990: 6e65 6761 7469 7665 5f69 6e74 6572 7661  negative_interva
+0000e9a0: 6c20 3d20 4661 6c73 652c 0d0a 2020 2020  l = False,..    
+0000e9b0: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
+0000e9c0: 6f6e 5f74 6f6c 6572 616e 6365 5f74 6f5f  on_tolerance_to_
+0000e9d0: 6472 6f70 5f63 656e 736f 7220 3d20 302e  drop_censor = 0.
+0000e9e0: 3235 2c0d 0a20 2020 2020 2020 2020 2020  25,..           
+0000e9f0: 2020 7072 6563 6973 696f 6e5f 726f 756e    precision_roun
+0000ea00: 6469 6e67 203d 2054 7275 6529 3a0d 0a20  ding = True):.. 
+0000ea10: 2020 2027 2727 0d0a 2020 2020 4120 6675     '''..    A fu
+0000ea20: 6e63 7469 6f6e 2074 6861 7420 636f 6d62  nction that comb
+0000ea30: 696e 6573 2074 6865 2072 656c 6576 616e  ines the relevan
+0000ea40: 7420 6164 6469 7469 6f6e 2061 6e64 2075  t addition and u
+0000ea50: 7469 6c69 7479 2066 756e 6374 696f 6e73  tility functions
+0000ea60: 2074 6f0d 0a20 2020 2073 756d 2072 6573   to..    sum res
+0000ea70: 756c 7473 2066 6f72 2067 726f 7570 7320  ults for groups 
+0000ea80: 7769 7468 696e 2061 2044 6174 6146 7261  within a DataFra
+0000ea90: 6d65 2e0d 0a0d 0a20 2020 2050 6172 616d  me.....    Param
+0000eaa0: 6574 6572 730d 0a20 2020 202d 2d2d 2d2d  eters..    -----
+0000eab0: 2d2d 2d2d 2d0d 0a20 2020 2064 6620 3a20  -----..    df : 
+0000eac0: 4461 7461 4672 616d 650d 0a20 2020 2020  DataFrame..     
+0000ead0: 2020 2044 6174 6146 7261 6d65 2074 6861     DataFrame tha
+0000eae0: 7420 636f 6e74 6169 6e73 2063 656e 736f  t contains censo
+0000eaf0: 7265 6420 6f72 2075 6e63 656e 736f 7265  red or uncensore
+0000eb00: 6420 7265 7375 6c74 730d 0a20 2020 2072  d results..    r
+0000eb10: 6573 756c 7473 5f63 6f6c 203a 2073 7472  esults_col : str
+0000eb20: 696e 670d 0a20 2020 2020 2020 2054 6865  ing..        The
+0000eb30: 2063 6f6c 756d 6e20 6e61 6d65 2066 6f72   column name for
+0000eb40: 2074 6865 2063 6f6c 756d 6e20 7468 6174   the column that
+0000eb50: 2063 6f6e 7461 696e 2074 6865 2072 6573   contain the res
+0000eb60: 756c 7473 2061 7320 7465 7874 2e0d 0a20  ults as text... 
+0000eb70: 2020 2020 2020 204f 6e6c 7920 666f 7572         Only four
+0000eb80: 2070 6f73 7369 626c 6520 6365 6e73 6f72   possible censor
+0000eb90: 7320 7368 6f75 6c64 2062 6520 7573 6564  s should be used
+0000eba0: 2028 3c2c e289 a42c e289 a52c 3e29 2e0d   (<,...,...,>)..
+0000ebb0: 0a20 2020 2067 726f 7570 6279 5f63 6f6c  .    groupby_col
+0000ebc0: 7320 3a20 6c69 7374 7320 6f66 2073 7472  s : lists of str
+0000ebd0: 696e 6773 2028 6f72 206c 6973 7420 6f66  ings (or list of
+0000ebe0: 206c 6973 7473 292c 206f 7074 696f 6e61   lists), optiona
+0000ebf0: 6c0d 0a20 2020 2020 2020 204c 6973 7420  l..        List 
+0000ec00: 6f66 2063 6f6c 756d 6e20 6e61 6d65 7320  of column names 
+0000ec10: 7468 6174 2073 686f 756c 6420 6265 2075  that should be u
+0000ec20: 7365 6420 746f 2063 7265 6174 6520 6772  sed to create gr
+0000ec30: 6f75 7073 2e20 416e 2061 7665 7261 6765  oups. An average
+0000ec40: 0d0a 2020 2020 2020 2020 7769 6c6c 2062  ..        will b
+0000ec50: 6520 666f 756e 6420 7769 7468 696e 2065  e found within e
+0000ec60: 6163 6820 6772 6f75 702e 204d 756c 7469  ach group. Multi
+0000ec70: 706c 6520 6c69 7374 7320 6361 6e20 6265  ple lists can be
+0000ec80: 2073 7570 706c 6965 6420 746f 0d0a 2020   supplied to..  
+0000ec90: 2020 2020 2020 7065 7266 6f72 6d20 7365        perform se
+0000eca0: 7175 656e 7469 616c 2061 7665 7261 6769  quential averagi
+0000ecb0: 6e67 2062 6566 6f72 6520 636f 6e76 6572  ng before conver
+0000ecc0: 7469 6e67 2069 6e74 6572 7661 6c73 2074  ting intervals t
+0000ecd0: 6f20 6120 7265 7375 6c74 2e0d 0a20 2020  o a result...   
+0000ece0: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
+0000ecf0: 2069 7320 4e6f 6e65 2e0d 0a20 2020 2066   is None...    f
+0000ed00: 6f63 7573 5f68 6967 685f 706f 7465 6e74  ocus_high_potent
+0000ed10: 6961 6c20 3a20 626f 6f6c 6561 6e2c 206f  ial : boolean, o
+0000ed20: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
+0000ed30: 2049 6620 5472 7565 2c20 7468 656e 2069   If True, then i
+0000ed40: 6e66 6f72 6d61 7469 6f6e 206f 6e20 7468  nformation on th
+0000ed50: 6520 6869 6768 6573 7420 706f 7465 6e74  e highest potent
+0000ed60: 6961 6c20 7265 7375 6c74 2077 696c 6c20  ial result will 
+0000ed70: 6265 0d0a 2020 2020 2020 2020 666f 6375  be..        focu
+0000ed80: 7365 6420 6f76 6572 2074 6865 206c 6f77  sed over the low
+0000ed90: 6573 7420 706f 7465 6e74 6961 6c20 7265  est potential re
+0000eda0: 7375 6c74 2e0d 0a20 2020 2069 6e63 6c75  sult...    inclu
+0000edb0: 6465 5f6e 6567 6174 6976 655f 696e 7465  de_negative_inte
+0000edc0: 7276 616c 203a 2062 6f6f 6c65 616e 2c20  rval : boolean, 
+0000edd0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+0000ede0: 2020 4966 2054 7275 652c 2074 6865 6e20    If True, then 
+0000edf0: 616c 6c20 706f 7369 7469 7665 2061 6e64  all positive and
+0000ee00: 206e 6567 6174 6976 6520 7661 6c75 6573   negative values
+0000ee10: 2061 7265 2063 6f6e 7369 6465 7265 640d   are considered.
+0000ee20: 0a20 2020 2020 2020 2065 2e67 2e2c 203c  .        e.g., <
+0000ee30: 302e 3520 776f 756c 6420 6265 2063 6f6e  0.5 would be con
+0000ee40: 7665 7274 6564 2074 6f20 282d 6e70 2e69  verted to (-np.i
+0000ee50: 6e66 2c35 292e 0d0a 2020 2020 2020 2020  nf,5)...        
+0000ee60: 4966 2046 616c 7365 2c20 7468 656e 206f  If False, then o
+0000ee70: 6e6c 7920 6e6f 6e2d 6e65 6761 7469 7665  nly non-negative
+0000ee80: 2076 616c 7565 7320 6172 6520 636f 6e73   values are cons
+0000ee90: 6964 6572 6564 0d0a 2020 2020 2020 2020  idered..        
+0000eea0: 652e 672e 2c20 3c30 2e35 2077 6f75 6c64  e.g., <0.5 would
+0000eeb0: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
+0000eec0: 205b 302c 3529 2e0d 0a20 2020 2020 2020   [0,5)...       
+0000eed0: 2054 6869 7320 7365 7474 696e 6720 6f6e   This setting on
+0000eee0: 6c79 2061 6666 6563 7473 2072 6573 756c  ly affects resul
+0000eef0: 7473 2069 6620 666f 6375 735f 6869 6768  ts if focus_high
+0000ef00: 5f70 6f74 656e 7469 616c 2069 7320 4661  _potential is Fa
+0000ef10: 6c73 652e 0d0a 2020 2020 2020 2020 5468  lse...        Th
+0000ef20: 6520 6465 6661 756c 7420 6973 2046 616c  e default is Fal
+0000ef30: 7365 2e0d 0a20 2020 2070 7265 6369 7369  se...    precisi
+0000ef40: 6f6e 5f74 6f6c 6572 616e 6365 5f74 6f5f  on_tolerance_to_
+0000ef50: 6472 6f70 5f63 656e 736f 7220 3a20 666c  drop_censor : fl
+0000ef60: 6f61 742c 206f 7074 696f 6e61 6c0d 0a20  oat, optional.. 
+0000ef70: 2020 2020 2020 2054 6872 6573 686f 6c64         Threshold
+0000ef80: 2066 6f72 2072 6570 6f72 7469 6e67 2063   for reporting c
+0000ef90: 656e 736f 7265 6420 7673 206e 6f6e 2d63  ensored vs non-c
+0000efa0: 656e 736f 7265 6420 7265 7375 6c74 732e  ensored results.
+0000efb0: 0d0a 2020 2020 2020 2020 5573 696e 6720  ..        Using 
+0000efc0: 7468 6520 6465 6661 756c 742c 2061 2072  the default, a r
+0000efd0: 6573 756c 7420 7468 6174 2069 7320 6b6e  esult that is kn
+0000efe0: 6f77 6e20 746f 2062 6520 696e 2074 6865  own to be in the
+0000eff0: 2069 6e74 6572 7661 6c20 2830 2e33 2c20   interval (0.3, 
+0000f000: 302e 3529 0d0a 2020 2020 2020 2020 776f  0.5)..        wo
+0000f010: 756c 6420 6265 2072 6574 7572 6e65 6420  uld be returned 
+0000f020: 6173 2030 2e34 2c20 7768 6572 6561 7320  as 0.4, whereas 
+0000f030: 6120 746f 6c65 7261 6e63 6520 6f66 2030  a tolerance of 0
+0000f040: 2077 6f75 6c64 2079 6965 6c64 2061 0d0a   would yield a..
+0000f050: 2020 2020 2020 2020 7265 7375 6c74 206f          result o
+0000f060: 6620 3c30 2e35 206f 7220 3e30 2e33 2064  f <0.5 or >0.3 d
+0000f070: 6570 656e 6469 6e67 206f 6e20 7468 6520  epending on the 
+0000f080: 7661 6c75 6520 6f66 2066 6f63 7573 5f68  value of focus_h
+0000f090: 6967 6865 7374 5f70 6f74 656e 7469 616c  ighest_potential
+0000f0a0: 2e0d 0a20 2020 2020 2020 2054 6865 2064  ...        The d
+0000f0b0: 6566 6175 6c74 2069 7320 302e 3235 2e0d  efault is 0.25..
+0000f0c0: 0a20 2020 2070 7265 6369 7369 6f6e 5f72  .    precision_r
+0000f0d0: 6f75 6e64 696e 6720 3a20 626f 6f6c 6561  ounding : boolea
+0000f0e0: 6e2c 206f 7074 696f 6e61 6c0d 0a20 2020  n, optional..   
+0000f0f0: 2020 2020 2049 6620 5472 7565 2c20 6120       If True, a 
+0000f100: 726f 756e 6469 6e67 206d 6574 686f 6420  rounding method 
+0000f110: 6973 2061 7070 6c69 6564 2074 6f20 726f  is applied to ro
+0000f120: 756e 6420 7265 7375 6c74 7320 746f 2068  und results to h
+0000f130: 6176 6520 6e6f 206d 6f72 650d 0a20 2020  ave no more..   
+0000f140: 2020 2020 2064 6563 696d 616c 7320 7468       decimals th
+0000f150: 616e 2077 6861 7420 6361 6e20 6265 206d  an what can be m
+0000f160: 6561 7375 7265 642e 0d0a 2020 2020 2020  easured...      
+0000f170: 2020 5468 6520 6465 6661 756c 7420 6973    The default is
+0000f180: 2054 7275 652e 0d0a 0d0a 2020 2020 5265   True.....    Re
+0000f190: 7475 726e 730d 0a20 2020 202d 2d2d 2d2d  turns..    -----
+0000f1a0: 2d2d 0d0a 2020 2020 6466 203a 2044 6174  --..    df : Dat
+0000f1b0: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
+0000f1c0: 4461 7461 4672 616d 6520 7468 6174 2063  DataFrame that c
+0000f1d0: 6f6e 7461 696e 7320 6361 6c63 756c 6174  ontains calculat
+0000f1e0: 6564 2061 7665 7261 6765 730d 0a0d 0a20  ed averages.... 
+0000f1f0: 2020 2027 2727 0d0a 2020 2020 0d0a 2020     '''..    ..  
+0000f200: 2020 2320 4372 6561 7465 2061 2063 6f70    # Create a cop
+0000f210: 7920 6f66 2074 6865 2044 6174 6146 7261  y of the DataFra
+0000f220: 6d65 0d0a 2020 2020 6466 203d 2064 662e  me..    df = df.
+0000f230: 636f 7079 2829 0d0a 2020 2020 0d0a 2020  copy()..    ..  
+0000f240: 2020 2320 5370 6c69 7420 7468 6520 7265    # Split the re
+0000f250: 7375 6c74 2069 6e74 6f20 6365 6e73 6f72  sult into censor
+0000f260: 2061 6e64 206e 756d 6572 6963 2063 6f6d   and numeric com
+0000f270: 706f 6e65 6e74 730d 0a20 2020 2064 6620  ponents..    df 
+0000f280: 3d20 7265 7375 6c74 5f74 6f5f 636f 6d70  = result_to_comp
+0000f290: 6f6e 656e 7473 2864 662c 7265 7375 6c74  onents(df,result
+0000f2a0: 735f 636f 6c29 0d0a 2020 2020 0d0a 2020  s_col)..    ..  
+0000f2b0: 2020 2320 436f 6e76 6572 7420 7468 6520    # Convert the 
+0000f2c0: 7265 7375 6c74 7320 6672 6f6d 2063 656e  results from cen
+0000f2d0: 736f 7220 616e 6420 6e75 6d65 7269 6320  sor and numeric 
+0000f2e0: 636f 6d70 6f6e 656e 7473 2074 6f20 616e  components to an
+0000f2f0: 2069 6e74 6572 7661 6c20 7265 7072 6573   interval repres
+0000f300: 656e 7461 7469 6f6e 0d0a 2020 2020 6466  entation..    df
+0000f310: 203d 2063 6f6d 706f 6e65 6e74 735f 746f   = components_to
+0000f320: 5f69 6e74 6572 7661 6c28 6466 2c20 696e  _interval(df, in
+0000f330: 636c 7564 655f 6e65 6761 7469 7665 5f69  clude_negative_i
+0000f340: 6e74 6572 7661 6c29 0d0a 2020 2020 0d0a  nterval)..    ..
+0000f350: 2020 2020 2320 5573 696e 6720 7468 6520      # Using the 
+0000f360: 696e 7465 7276 616c 732c 2064 6574 6572  intervals, deter
+0000f370: 6d69 6e65 2074 6865 2072 616e 6765 206f  mine the range o
+0000f380: 6620 706f 7373 6962 6c65 2061 7665 7261  f possible avera
+0000f390: 6765 730d 0a20 2020 200d 0a20 2020 2023  ges..    ..    #
+0000f3a0: 2049 6620 7468 6572 6520 6172 6520 6e6f   If there are no
+0000f3b0: 2067 726f 7570 6279 2d63 6f6c 756d 6e73   groupby-columns
+0000f3c0: 2c20 7468 656e 2074 616b 6520 6176 6572  , then take aver
+0000f3d0: 6167 6520 6f66 2061 6c6c 2072 6573 756c  age of all resul
+0000f3e0: 7473 0d0a 2020 2020 6966 206e 6f74 2067  ts..    if not g
+0000f3f0: 726f 7570 6279 5f63 6f6c 733a 0d0a 2020  roupby_cols:..  
+0000f400: 2020 2020 2020 6466 203d 2061 6464 5f69        df = add_i
+0000f410: 6e74 6572 7661 6c73 2864 662c 2067 726f  ntervals(df, gro
+0000f420: 7570 6279 5f63 6f6c 733d 5b5d 290d 0a20  upby_cols=[]).. 
+0000f430: 2020 2023 2049 6620 7468 6520 6772 6f75     # If the grou
+0000f440: 7062 795f 636f 6c73 2069 7320 6120 6c69  pby_cols is a li
+0000f450: 7374 206f 6620 6c69 7374 732c 2074 6865  st of lists, the
+0000f460: 6e20 7065 7266 6f72 6d20 6d75 6c74 6970  n perform multip
+0000f470: 6c65 2061 7665 7261 6765 730d 0a20 2020  le averages..   
+0000f480: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0000f490: 2867 726f 7570 6279 5f63 6f6c 735b 305d  (groupby_cols[0]
+0000f4a0: 2c6c 6973 7429 3a0d 0a20 2020 2020 2020  ,list):..       
+0000f4b0: 2066 6f72 2067 726f 7570 696e 6720 696e   for grouping in
+0000f4c0: 2067 726f 7570 6279 5f63 6f6c 733a 0d0a   groupby_cols:..
+0000f4d0: 2020 2020 2020 2020 2020 2020 2320 5573              # Us
+0000f4e0: 696e 6720 7468 6520 696e 7465 7276 616c  ing the interval
+0000f4f0: 732c 2064 6574 6572 6d69 6e65 2074 6865  s, determine the
+0000f500: 2072 616e 6765 206f 6620 706f 7373 6962   range of possib
+0000f510: 6c65 206d 6178 696d 610d 0a20 2020 2020  le maxima..     
+0000f520: 2020 2020 2020 2064 6620 3d20 6164 645f         df = add_
+0000f530: 696e 7465 7276 616c 7328 6466 2c20 6772  intervals(df, gr
+0000f540: 6f75 7069 6e67 290d 0a20 2020 2023 2045  ouping)..    # E
+0000f550: 6c73 6520 7468 6520 6772 6f75 7062 795f  lse the groupby_
+0000f560: 636f 6c73 2069 7320 6120 6c69 7374 206f  cols is a list o
+0000f570: 6620 636f 6c75 6d6e 206e 616d 6573 0d0a  f column names..
+0000f580: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000f590: 2020 2064 6620 3d20 6164 645f 696e 7465     df = add_inte
+0000f5a0: 7276 616c 7328 6466 2c20 6772 6f75 7062  rvals(df, groupb
+0000f5b0: 795f 636f 6c73 290d 0a20 2020 200d 0a20  y_cols)..    .. 
+0000f5c0: 2020 2023 2043 6f6e 7665 7274 2074 6865     # Convert the
+0000f5d0: 2069 6e74 6572 7661 6c20 666f 7220 7468   interval for th
+0000f5e0: 6520 6176 6572 6167 6520 696e 746f 2063  e average into c
+0000f5f0: 656e 736f 7220 616e 6420 6e75 6d65 7269  ensor and numeri
+0000f600: 6320 6e6f 7461 7469 6f6e 0d0a 2020 2020  c notation..    
+0000f610: 6466 203d 2069 6e74 6572 7661 6c5f 746f  df = interval_to
+0000f620: 5f63 6f6d 706f 6e65 6e74 7328 6466 2c0d  _components(df,.
+0000f630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f650: 2066 6f63 7573 5f68 6967 685f 706f 7465   focus_high_pote
+0000f660: 6e74 6961 6c20 3d20 666f 6375 735f 6869  ntial = focus_hi
+0000f670: 6768 5f70 6f74 656e 7469 616c 2c0d 0a20  gh_potential,.. 
+0000f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f690: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000f6a0: 6e63 6c75 6465 5f6e 6567 6174 6976 655f  nclude_negative_
+0000f6b0: 696e 7465 7276 616c 203d 2069 6e63 6c75  interval = inclu
+0000f6c0: 6465 5f6e 6567 6174 6976 655f 696e 7465  de_negative_inte
+0000f6d0: 7276 616c 2c0d 0a20 2020 2020 2020 2020  rval,..         
+0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6f0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+0000f700: 5f74 6f6c 6572 616e 6365 5f74 6f5f 6472  _tolerance_to_dr
+0000f710: 6f70 5f63 656e 736f 7220 3d20 7072 6563  op_censor = prec
+0000f720: 6973 696f 6e5f 746f 6c65 7261 6e63 655f  ision_tolerance_
+0000f730: 746f 5f64 726f 705f 6365 6e73 6f72 290d  to_drop_censor).
+0000f740: 0a20 2020 200d 0a20 2020 2023 2043 7265  .    ..    # Cre
+0000f750: 6174 6520 696e 7465 7276 616c 206e 6f74  ate interval not
+0000f760: 6174 696f 6e20 666f 7220 7468 6520 6176  ation for the av
+0000f770: 6572 6167 650d 0a20 2020 2064 6620 3d20  erage..    df = 
+0000f780: 696e 7465 7276 616c 5f6e 6f74 6174 696f  interval_notatio
+0000f790: 6e28 6466 2c20 7072 6563 6973 696f 6e5f  n(df, precision_
+0000f7a0: 726f 756e 6469 6e67 290d 0a20 2020 200d  rounding)..    .
+0000f7b0: 0a20 2020 2023 2043 6f6d 6269 6e65 2074  .    # Combine t
+0000f7c0: 6865 2063 656e 736f 7220 616e 6420 6e75  he censor and nu
+0000f7d0: 6d65 7269 6320 636f 6d70 6f6e 656e 7473  meric components
+0000f7e0: 2069 6e74 6f20 6120 7265 7375 6c74 0d0a   into a result..
+0000f7f0: 2020 2020 6466 203d 2063 6f6d 706f 6e65      df = compone
+0000f800: 6e74 735f 746f 5f72 6573 756c 7428 6466  nts_to_result(df
+0000f810: 2c20 7072 6563 6973 696f 6e5f 726f 756e  , precision_roun
+0000f820: 6469 6e67 290d 0a20 2020 200d 0a20 2020  ding)..    ..   
+0000f830: 2023 2044 726f 7020 776f 726b 696e 6720   # Drop working 
+0000f840: 636f 6c75 6d6e 730d 0a20 2020 2064 6620  columns..    df 
+0000f850: 3d20 6466 2e64 726f 7028 6466 2e66 696c  = df.drop(df.fil
+0000f860: 7465 7228 7265 6765 783d 275f 5f27 292e  ter(regex='__').
+0000f870: 636f 6c75 6d6e 732c 2061 7869 733d 3129  columns, axis=1)
+0000f880: 0d0a 2020 2020 0d0a 2020 2020 2320 5265  ..    ..    # Re
+0000f890: 6f72 6465 7220 636f 6c75 6d6e 730d 0a20  order columns.. 
+0000f8a0: 2020 2066 6f72 2063 6f6c 2069 6e20 5b73     for col in [s
+0000f8b0: 7461 745f 636f 6c2c 7265 7375 6c74 5f63  tat_col,result_c
+0000f8c0: 6f6c 2c63 656e 736f 725f 636f 6c2c 6e75  ol,censor_col,nu
+0000f8d0: 6d65 7269 635f 636f 6c2c 696e 7465 7276  meric_col,interv
+0000f8e0: 616c 5f63 6f6c 5d3a 0d0a 2020 2020 2020  al_col]:..      
+0000f8f0: 2020 6466 5b63 6f6c 5d20 3d20 6466 2e70    df[col] = df.p
+0000f900: 6f70 2863 6f6c 290d 0a20 2020 200d 0a20  op(col)..    .. 
+0000f910: 2020 2072 6574 7572 6e20 6466 0d0a          return df..
```

### Comparing `censoredsummarystats-0.0.3/censoredsummarystats/utils.py` & `censoredsummarystats-0.0.4/censoredsummarystats/utils.py`

 * *Files identical despite different names*

### Comparing `censoredsummarystats-0.0.3/LICENSE` & `censoredsummarystats-0.0.4/LICENSE`

 * *Files identical despite different names*

### Comparing `censoredsummarystats-0.0.3/pyproject.toml` & `censoredsummarystats-0.0.4/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [tool.poetry]
 name = "censoredsummarystats"
-version = "0.0.3"
+version = "0.0.4"
 description = "A python package for calculating summary stats on censored data (data that contains < and > symbols)."
 authors = ["Kurt van Ness <vanness.kurt@gmail.com>"]
 readme = "README.md"
 repository = "https://github.com/kurtvanness/CensoredSummaryStats"
 license = "Apache-2.0"
 packages = [{include = "censoredsummarystats"}]
```

